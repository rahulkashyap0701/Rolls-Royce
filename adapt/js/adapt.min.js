function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}define("core/js/wait",[],function(){var Wait=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"begin","end")},_waitCount:0,_callbackHandle:null,_timeoutHandlerId:null,_timeoutInSeconds:7,isWaiting:function isWaiting(){return this._waitCount!==0},startTimer:function startTimer(){this.stopTimer();this._timeoutHandlerId=setInterval(function(){while(this._waitCount>0){this.end()}if(this._waitCount===0){this.stopTimer()}}.bind(this),this._timeoutInSeconds*1000)},stopTimer:function stopTimer(){if(this._timeoutHandlerId){clearInterval(this._timeoutHandlerId)}},begin:function begin(){if(!this.isWaiting()){this.trigger("wait")}this._waitCount++;if(this._callbackHandle){clearTimeout(this._callbackHandle);this._callbackHandle=null}this.startTimer();return this},end:function end(){if(!this.isWaiting()){return this}this._waitCount--;if(this._waitCount===0){this.stopTimer()}if(this.isWaiting()){return this}if(this._callbackHandle){return this}this._callbackHandle=setTimeout(function(){this._callbackHandle=null;this.trigger("ready")}.bind(this),0);return this},queue:function queue(callback){this.begin();this.once("ready",callback);this.end();return this},for:function _for(callback){this.begin();_.defer(function(){callback(_.once(this.end))}.bind(this));return this}});return Wait});define("core/js/models/lockingModel",[],function(){var _set=Backbone.Model.prototype.set;_.extend(Backbone.Model.prototype,{set:function set(attrName,attrVal,options){var stopProcessing=!this.lockedAttributes||_typeof(attrName)==="object"||typeof attrVal!=="boolean"||!this.isLocking(attrName);if(stopProcessing)return _set.apply(this,arguments);options=options||{};var isSettingValueForSpecificPlugin=options&&options.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to change a locked attribute");options.pluginName="compatibility"}var pluginName=options.pluginName;if(this.defaults[attrName]!==undefined){this.lockedAttributes[attrName]=!this.defaults[attrName]}var lockingValue=this.lockedAttributes[attrName];var isAttemptingToLock=lockingValue===attrVal;if(isAttemptingToLock){this.setLockState(attrName,true,{pluginName:pluginName,skipcheck:true});return _set.call(this,attrName,lockingValue)}this.setLockState(attrName,false,{pluginName:pluginName,skipcheck:true});var totalLockValue=this.getLockCount(attrName,{skipcheck:true});if(totalLockValue===0){return _set.call(this,attrName,!lockingValue)}return this},setLocking:function setLocking(attrName,defaultLockValue){if(this.isLocking(attrName))return;if(!this.lockedAttributes)this.lockedAttributes={};this.lockedAttributes[attrName]=defaultLockValue},unsetLocking:function unsetLocking(attrName){if(!this.isLocking(attrName))return;if(!this.lockedAttributes)return;delete this.lockedAttributes[attrName];delete this._lockedAttributesValues[attrName];if(_.keys(this.lockedAttributes).length===0){delete this.lockedAttributes;delete this._lockedAttributesValues}},isLocking:function isLocking(attrName){var isCheckingGeneralLockingState=attrName===undefined;var isUsingLockedAttributes=this.lockedAttributes!==undefined;if(isCheckingGeneralLockingState){return isUsingLockedAttributes}if(!isUsingLockedAttributes)return false;var isAttributeALockingAttribute=this.lockedAttributes[attrName]!==undefined;if(!isAttributeALockingAttribute)return false;if(this._lockedAttributesValues===undefined){this._lockedAttributesValues={}}if(this._lockedAttributesValues[attrName]===undefined){this._lockedAttributesValues[attrName]={}}return true},isLocked:function isLocked(attrName,options){var shouldSkipCheck=options&&options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}return this.getLockCount(attrName)>0},getLockCount:function getLockCount(attrName,options){var shouldSkipCheck=options&&options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}var isGettingValueForSpecificPlugin=options&&options.pluginName;if(isGettingValueForSpecificPlugin){return this._lockedAttributesValues[attrName][options.pluginName]?1:0}var lockingAttributeValues=_.values(this._lockedAttributesValues[attrName]);var lockingAttributeValuesSum=_.reduce(lockingAttributeValues,function(sum,value){return sum+(value?1:0)},0);return lockingAttributeValuesSum},setLockState:function setLockState(attrName,value,options){var shouldSkipCheck=options&&options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return this}var isSettingValueForSpecificPlugin=options&&options.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to set a locked attribute lock value");options.pluginName="compatibility"}if(value){this._lockedAttributesValues[attrName][options.pluginName]=value}else{delete this._lockedAttributesValues[attrName][options.pluginName]}return this}})});define("core/js/adapt",["core/js/wait","core/js/models/lockingModel"],function(Wait){var Adapt=Backbone.Model.extend({loadScript:window.__loadScript,location:{},componentStore:{},defaults:{_canScroll:true,_outstandingCompletionChecks:0,_pluginWaitCount:0,_isStarted:false},lockedAttributes:{_canScroll:false},init:function init(){this.trigger("adapt:preInitialize");this.deferUntilCompletionChecked(function(){this.trigger("adapt:start");if(!Backbone.History.started){Backbone.history.start()}this.set("_isStarted",true);this.trigger("adapt:initialize")}.bind(this))},initialize:function initialize(){this.setupWait()},checkingCompletion:function checkingCompletion(){var outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",++outstandingChecks)},checkedCompletion:function checkedCompletion(){var outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",--outstandingChecks)},deferUntilCompletionChecked:function deferUntilCompletionChecked(callback){if(this.get("_outstandingCompletionChecks")===0)return callback();var checkIfAnyChecksOutstanding=function checkIfAnyChecksOutstanding(model,outstandingChecks){if(outstandingChecks!==0)return;this.off("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding);callback()};this.on("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding)},setupWait:function setupWait(){this.wait=new Wait;var beginWait=function(){this.log.warn("DEPRECATED - Use Adapt.wait.begin() as Adapt.trigger('plugin:beginWait') may be removed in the future");this.wait.begin()}.bind(this);var endWait=function(){this.log.warn("DEPRECATED - Use Adapt.wait.end() as Adapt.trigger('plugin:endWait') may be removed in the future");this.wait.end()}.bind(this);var ready=function(){if(this.wait.isWaiting()){return}var isEventListening=this._events["plugins:ready"];if(!isEventListening){return}this.log.warn("DEPRECATED - Use Adapt.wait.queue(callback) as Adapt.on('plugins:ready', callback) may be removed in the future");this.trigger("plugins:ready")}.bind(this);this.listenTo(this.wait,"ready",ready);this.listenTo(this,{"plugin:beginWait":beginWait,"plugin:endWait":endWait})},isWaitingForPlugins:function isWaitingForPlugins(){this.log.warn("DEPRECATED - Use Adapt.wait.isWaiting() as Adapt.isWaitingForPlugins() may be removed in the future");return this.wait.isWaiting()},checkPluginsReady:function checkPluginsReady(){this.log.warn("DEPRECATED - Use Adapt.wait.isWaiting() as Adapt.checkPluginsReady() may be removed in the future");if(this.isWaitingForPlugins()){return}this.trigger("plugins:ready")},navigateToElement:function navigateToElement(selector,settings){settings=settings||{};var currentModelId=selector.replace(/\./g,"");var currentModel=this.data.findById(currentModelId);var currentPage=currentModel._siblings==="contentObjects"?currentModel:currentModel.findAncestor("contentObjects");if(currentPage.get("_id")===this.location._currentId){return this.scrollTo(selector,settings)}this.once("pageView:ready",_.debounce(function(){this.router.set("_shouldNavigateFocus",true);this.scrollTo(selector,settings)}.bind(this),1));var shouldReplaceRoute=settings.replace||false;this.router.set("_shouldNavigateFocus",false);Backbone.history.navigate("#/id/"+currentPage.get("_id"),{trigger:true,replace:shouldReplaceRoute})},register:function register(name,object){if(this.componentStore[name]){throw Error("The component \""+name+"\" already exists in your project")}if(object.view){if(!object.view.template)object.view.template=name}else{if(!object.template)object.template=name}this.componentStore[name]=object;return object},getViewClass:function getViewClass(name){var object=this.componentStore[name];if(!object){throw Error("The component \""+name+"\" doesn't exist in your project")}return object.view||object},mapById:function mapById(id){return this.data.mapById(id)},findById:function findById(id){return this.data.findById(id)},findViewByModelId:function findViewByModelId(id){var model=this.data.findById(id);if(!model)return;if(model===this.parentView.model)return this.parentView;var idPathToView=[id];var currentLocationId=this.location._currentId;var currentLocationModel=_.find(model.getAncestorModels(),function(model){var modelId=model.get("_id");if(modelId===currentLocationId)return true;idPathToView.unshift(modelId)});if(!currentLocationModel){return console.warn("Adapt.findViewByModelId() unable to find view for model id: "+id)}var foundView=_.reduce(idPathToView,function(view,currentId){return view&&view.childViews&&view.childViews[currentId]},this.parentView);return foundView},parseRelativeString:function parseRelativeString(relativeString){if(relativeString[0]==="@"){relativeString=relativeString.substr(1)}var type=relativeString.match(/(component|block|article|page|menu)/);if(!type){this.log.error("Adapt.parseRelativeString() could not match relative type",relativeString);return}type=type[0];var offset=parseInt(relativeString.substr(type.length).trim()||0);if(isNaN(offset)){this.log.error("Adapt.parseRelativeString() could not parse relative offset",relativeString);return}return{type:type,offset:offset}},remove:function remove(){this.trigger("preRemove");this.trigger("remove");_.defer(this.trigger.bind(this),"postRemove")}});return new Adapt});define("core/js/a11y/browserFocus",["core/js/adapt"],function(Adapt){var BrowserFocus=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"_onBlur","_onClick");this.$body=$("body");this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})},_attachEventListeners:function _attachEventListeners(){this.$body.on("blur","*",this._onBlur).on("blur",this._onBlur);this.$body[0].addEventListener("click",this._onClick,true)},_onBlur:function _onBlur(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusNextOnDisabled){return}var $element=$(event.target);if($element.is("[data-a11y-force-focus]")){_.defer(function(){$element.removeAttr("tabindex data-a11y-force-focus")})}if(event.target!==event.currentTarget){return}if(!$element.is("[disabled]")){return}Adapt.a11y.focusNext($element)},_onClick:function _onClick(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusOnClickEnabled){return}var $element=$(event.target);var $stack=$().add($element).add($element.parents());var $focusable=$stack.filter(config._options._tabbableElements);if(!$focusable.length){return}$focusable[0].focus()}});return BrowserFocus});define("core/js/a11y/focusOptions",[],function(){var FocusOptions=function FocusOptions(options){_.defaults(this,options,{preventScroll:true,defer:false})};return FocusOptions});define("core/js/a11y/keyboardFocusOutline",["core/js/adapt"],function(Adapt){var KeyboardFocusOutline=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"_onKeyDown");this.$html=$("html");this.showOnKeys={9:true,13:true,32:true,37:true,38:true,39:true,40:true};this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})},_attachEventListeners:function _attachEventListeners(){document.addEventListener("keydown",this._onKeyDown);this._start()},_start:function _start(){var config=Adapt.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled){return}this.$html.addClass("a11y-disable-focusoutline")},_onKeyDown:function _onKeyDown(event){var config=Adapt.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled||!this.showOnKeys[event.keyCode]){return}var $element=$(event.target);if(!$element.is(config._options._tabbableElements)||$element.is(config._options._focusOutlineKeyboardOnlyIgnore)){return}this.$html.removeClass("a11y-disable-focusoutline")}});return KeyboardFocusOutline});define("core/js/a11y/log",["core/js/adapt"],function(Adapt){var Log=Backbone.Controller.extend({_warned:{},_hasWarned:function _hasWarned(args){var config=Adapt.a11y.config;if(!config._options._warnFirstOnly){return false}var hash=_.map(args,String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false},_canWarn:function _canWarn(){var config=Adapt.a11y.config;return Boolean(config._options._warn)},removed:function removed(){if(!this._canWarn){return}var args=Array.prototype.slice.call(arguments);if(this._hasWarned(args)){return}Adapt.log.warn.apply(Adapt.log,["A11Y REMOVED:"].concat(args));return this},deprecated:function deprecated(){if(!this._canWarn){return}var args=Array.prototype.slice.call(arguments);if(this._hasWarned(args)){return}Adapt.log.warn.apply(Adapt.log,["A11Y DEPRECATED:"].concat(args));return this}});return Log});define("core/js/a11y/scroll",[],function(){var Scroll=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"_onTouchStart","_onTouchEnd","_onScrollEvent","_onKeyDown");this._scrollDisabledElements=$([]);this.$window=$(window);this.$body=$("body");this._preventScrollOnKeys={37:true,38:true,39:true,40:true};this._ignoreKeysOnElementsMatching="textarea, input, select";this._isRunning=false;this._touchStartEventObject=null},disable:function disable($elements){$elements=$($elements);this._scrollDisabledElements=this._scrollDisabledElements.add($elements);this._checkRunning();return this},enable:function enable($elements){$elements=$($elements);if(!$elements||!$elements.length){this.clear();return this}this._scrollDisabledElements=this._scrollDisabledElements.not($elements);this._checkRunning();return this},clear:function clear(){this._scrollDisabledElements=$([]);this._checkRunning();return this},_checkRunning:function _checkRunning(){if(!this._scrollDisabledElements.length){this._stop();return}this._start()},_start:function _start(){if(this._isRunning){return}this._isRunning=true;window.addEventListener("touchstart",this._onTouchStart);window.addEventListener("touchend",this._onTouchEnd);window.addEventListener("touchmove",this._onScrollEvent,{passive:false});window.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("keydown",this._onKeyDown)},_onTouchStart:function _onTouchStart(event){event=$.event.fix(event);this._touchStartEventObject=event;return true},_onTouchEnd:function _onTouchEnd(){this._touchStartEventObject=null;return true},_onScrollEvent:function _onScrollEvent(event){event=$.event.fix(event);return this._preventScroll(event)},_onKeyDown:function _onKeyDown(event){event=$.event.fix(event);if(!this._preventScrollOnKeys[event.keyCode]){return}var $target=$(event.target);if($target.is(this._ignoreKeysOnElementsMatching)){return}return this._preventScroll(event)},_preventScroll:function _preventScroll(event){var $target=$(event.target);if(this._scrollDisabledElements.length){var scrollingParent=this._getScrollingParent(event,$target);if(scrollingParent.filter(this._scrollDisabledElements).length===0){this.$window.scroll();return}}event.preventDefault();return false},_getScrollingParent:function _getScrollingParent(event,$target){var isTouchEvent=event.type=="touchmove";var hasTouchStartEvent=this._touchStartEventObject&&this._touchStartEventObject.originalEvent;if(isTouchEvent&&!hasTouchStartEvent){return $target}var directionY=this._getScrollDirection(event);if(directionY==="none"){return this.$body}var parents=$target.parents();for(var i=0,l=parents.length;i<l;i++){var $parent=$(parents[i]);if($parent.is("body")){return this.$body}if(!this._isScrollable($parent)){continue}if(!this._isScrolling($parent,directionY)){continue}return $parent}return this.$body},_isScrollable:function _isScrollable($target){var scrollType=$target.css("overflow-y");if(scrollType!=="auto"&&scrollType!=="scroll"){return false}var pointerEvents=$target.css("pointer-events");if(pointerEvents==="none"){return false}return true},_isScrolling:function _isScrolling($target,directionY){var scrollTop=Math.ceil($target.scrollTop());var innerHeight=$target.outerHeight();var scrollHeight=$target[0].scrollHeight;var hasScrollingSpace=false;switch(directionY){case"down":hasScrollingSpace=scrollTop+innerHeight<scrollHeight;if(hasScrollingSpace){return true}break;case"up":hasScrollingSpace=scrollTop>0;if(hasScrollingSpace){return true}break;}return false},_getScrollDirection:function _getScrollDirection(event){var deltaY=this._getScrollDelta(event);if(deltaY===0){return"none"}return deltaY>0?"up":"down"},_getScrollDelta:function _getScrollDelta(event){var deltaY=0;var isTouchEvent=event.type=="touchmove";var originalEvent=event.originalEvent;if(isTouchEvent){var startOriginalEvent=this._touchStartEventObject.originalEvent;var currentY=originalEvent.pageY;var previousY=startOriginalEvent.pageY;if(currentY===0||currentY==previousY){currentY=originalEvent.touches[0].pageY;previousY=startOriginalEvent.touches[0].pageY}deltaY=currentY-previousY}else{var hasDeltaY=originalEvent.wheelDeltaY||originalEvent.deltaY!==undefined;if(hasDeltaY){deltaY=-originalEvent.deltaY}else{deltaY=originalEvent.wheelDelta||0}}return deltaY},_stop:function _stop(){if(!this._isRunning){return}this._isRunning=false;window.removeEventListener("touchstart",this._onTouchStart);window.removeEventListener("touchend",this._onTouchEnd);window.removeEventListener("touchmove",this._onScrollEvent,{passive:false});window.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("keydown",this._onKeyDown)}});return Scroll});define("core/js/a11y/wrapFocus",["core/js/adapt"],function(Adapt){var WrapFocus=Backbone.Controller.extend({initialize:function initialize(){_.bindAll(this,"_onWrapAround");this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})},_attachEventListeners:function _attachEventListeners(){var config=Adapt.a11y.config;$("body").on("click focus",config._options._focusguard,this._onWrapAround)},_onWrapAround:function _onWrapAround(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupWrapFocusEnabled){return}event.preventDefault();event.stopPropagation();Adapt.a11y.focusFirst("body",{defer:false})}});return WrapFocus});define("core/js/a11y/popup",["core/js/adapt"],function(Adapt){var Popup=Backbone.Controller.extend({_floorStack:[$("body")],_focusStack:[],_tabIndexes:{},_ariaHiddens:{},_elementUIDIndex:0,initialize:function initialize(){this.listenTo(Adapt,{"popup:opened":function popupOpened($element,ignoreInternalTrigger){if(ignoreInternalTrigger){return}Adapt.a11y.log.deprecated("Adapt.trigger(\"popup:opened\", $element) is replaced with Adapt.a11y.popupOpened($element);");this.opened($element,true)},"popup:closed":function popupClosed($target,ignoreInternalTrigger){if(ignoreInternalTrigger){return}Adapt.a11y.log.deprecated("Adapt.trigger(\"popup:closed\", $target) is replaced with Adapt.a11y.popupClosed($target);");this.closed($target,true)}})},opened:function opened($popupElement,silent){$popupElement=$popupElement||$(document.activeElement);this._addPopupLayer($popupElement);if(!silent){Adapt.trigger("popup:opened",$popupElement,true)}return this},_addPopupLayer:function _addPopupLayer($popupElement){$popupElement=$($popupElement);var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled||$popupElement.length===0){return $popupElement}this._floorStack.push($popupElement);this._focusStack.push($(document.activeElement));var $elements=$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);var $branch=$popupElement.add($popupElement.parents());var $siblings=$branch.siblings().filter(config._options._tabbableElementsExcludes);$elements=$elements.add($siblings);$elements.each(function(index,item){var $item=$(item);var elementUID;if(item.a11y_uid==undefined){item.a11y_uid="UID"+ ++this._elementUIDIndex}elementUID=item.a11y_uid;if(this._tabIndexes[elementUID]===undefined){this._tabIndexes[elementUID]=[]}if(this._ariaHiddens[elementUID]===undefined){this._ariaHiddens[elementUID]=[]}var tabindex=$item.attr("tabindex");var ariaHidden=$item.attr("aria-hidden");this._tabIndexes[elementUID].push(tabindex===undefined?"":tabindex);this._ariaHiddens[elementUID].push(ariaHidden===undefined?"":ariaHidden);if(config._options._isPopupTabIndexManagementEnabled){$item.attr("tabindex",-1)}if(config._options._isPopupAriaHiddenManagementEnabled){$item.attr("aria-hidden",true)}}.bind(this));var $items=$popupElement.find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);if(config._options._isPopupTabIndexManagementEnabled){$items.attr("tabindex",0)}if(config._options._isPopupAriaHiddenManagementEnabled){$items.removeAttr("aria-hidden").removeClass("aria-hidden").parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}},closed:function closed($focusElement,silent){var $previousFocusElement=this._removeLastPopupLayer();$focusElement=$focusElement||$previousFocusElement||$("body");if(!silent){Adapt.trigger("popup:closed",$focusElement,true)}Adapt.a11y.focusFirst($($focusElement));return this},_removeLastPopupLayer:function _removeLastPopupLayer(){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled){return $(document.activeElement)}if(this._floorStack.length<=1){return}this._floorStack.pop();$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes).each(function(index,item){var $item=$(item);var previousTabIndex="";var previousAriaHidden="";var elementUID;if(item.a11y_uid==undefined){item.a11y_uid="UID"+ ++this._elementUIDIndex}elementUID=item.a11y_uid;if(this._tabIndexes[elementUID]!==undefined&&this._tabIndexes[elementUID].length!==0){previousTabIndex=this._tabIndexes[elementUID].pop();previousAriaHidden=this._ariaHiddens[elementUID].pop()}if(this._tabIndexes[elementUID]!==undefined&&this._tabIndexes[elementUID].length===0){delete this._tabIndexes[elementUID];delete this._ariaHiddens[elementUID]}if(config._options._isPopupTabIndexManagementEnabled){if(previousTabIndex===""){$item.removeAttr("tabindex")}else{$item.attr({"tabindex":previousTabIndex})}}if(config._options._isPopupAriaHiddenManagementEnabled){if(previousAriaHidden===""){$item.removeAttr("aria-hidden")}else{$item.attr({"aria-hidden":previousAriaHidden})}}}.bind(this));return document.activeElement=this._focusStack.pop()},setCloseTo:function setCloseTo($focusElement){var $original=this._focusStack.pop();this._focusStack.push($focusElement);return $original}});return Popup});define("core/js/a11y/deprecated",["core/js/adapt"],function(Adapt){_.extend($.fn,{isFixedPostion:function isFixedPostion(){Adapt.a11y.log.removed("$(\"..\").isFixedPostion was unneeded and has been removed, let us know if you need it back.");return false},a11y_aria_label:function a11y_aria_label(){Adapt.a11y.log.removed("$(\"..\").a11y_aria_label was incorrect behaviour.");return this},limitedScrollTo:function limitedScrollTo(){Adapt.a11y.log.removed("$.limitedScrollTo had no impact on the screen reader cursor.");return this},a11y_text:function a11y_text(){Adapt.a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return this},a11y_selected:function a11y_selected(){Adapt.a11y.log.removed("$(\"..\").a11y_selected is removed. Please use aria-live instead.");return this},a11y_on:function a11y_on(isOn){Adapt.a11y.log.deprecated("$(\"..\").a11y_on, use Adapt.a11y.findTabbable($element); and Adapt.a11y.toggleAccessible($elements, isAccessible); instead.");var $tabbable=Adapt.a11y.findTabbable(this);Adapt.a11y.toggleAccessible($tabbable,isOn);return this},a11y_only:function a11y_only(){Adapt.a11y.log.removed("$(\"..\").a11y_only, use Adapt.a11y.popupOpened($popupElement); instead.");return this},scrollDisable:function scrollDisable(){if(Adapt.a11y.config._options._isScrollDisableEnabled===false){return this}Adapt.a11y.log.deprecated("$(\"..\").scrollDisable, use Adapt.a11y.scrollDisable($elements); instead.");Adapt.a11y.scrollDisable(this);return this},scrollEnable:function scrollEnable(){if(Adapt.a11y.config._options._isScrollDisableEnabled===false){return this}Adapt.a11y.log.deprecated("$(\"..\").scrollEnable, use Adapt.a11y.scrollEnable($elements); instead.");Adapt.a11y.scrollEnable(this);return this},a11y_popup:function a11y_popup(){Adapt.a11y.log.deprecated("$(\"..\").a11y_popup, use Adapt.a11y.popupOpened($popupElement); instead.");return Adapt.a11y.popupOpened(this)},a11y_cntrl:function a11y_cntrl(isOn,withDisabled){Adapt.a11y.log.deprecated("$(\"..\").a11y_cntrl, use Adapt.a11y.toggleAccessible($elements, isAccessible); and if needed Adapt.a11y.toggleEnabled($elements, isEnabled); instead.");Adapt.a11y.toggleAccessible(this,isOn);if(withDisabled)Adapt.a11y.toggleEnabled(this,isOn);return this},a11y_cntrl_enabled:function a11y_cntrl_enabled(isOn){Adapt.a11y.log.deprecated("$(\"..\").a11y_cntrl_enabled, use Adapt.a11y.toggleAccessibleEnabled($elements, isAccessibleEnabled); instead.");Adapt.a11y.toggleAccessibleEnabled(this,isOn);return this},isReadable:function isReadable(){Adapt.a11y.log.deprecated("$(\"..\").isReadable, use Adapt.a11y.isReadable($element); instead.");return Adapt.a11y.isReadable(this)},findForward:function findForward(selector){Adapt.a11y.log.removed("$(\"..\").findForward has been removed as the use cases are very small, let us know if you need it back.");return Adapt.a11y._findFirstForward(this,selector)},findWalk:function findWalk(selector){Adapt.a11y.log.removed("$(\"..\").findWalk has been removed as the use cases are very small, let us know if you need it back.");return Adapt.a11y._findFindForwardDescendant(this,selector)},focusNoScroll:function focusNoScroll(){Adapt.a11y.log.deprecated("$(\"..\").focusNoScroll, use Adapt.a11y.focus($element); instead.");return Adapt.a11y.focus(this)},focusNext:function focusNext(returnOnly){Adapt.a11y.log.deprecated("$(\"..\").focusNext, use Adapt.a11y.focusNext($element); or if needed Adapt.a11y.findFirstReadable($element); instead.");if(returnOnly){return Adapt.a11y.findFirstReadable(this)}return Adapt.a11y.focusNext(this)},focusOrNext:function focusOrNext(returnOnly){Adapt.a11y.log.deprecated("$(\"..\").focusOrNext, use Adapt.a11y.focusFirst($element); or if needed Adapt.a11y.findFirstReadable($element); or Adapt.a11y.isReadable($element); instead.");if(returnOnly){if(Adapt.a11y.isReadable(this))return this;return Adapt.a11y.findFirstReadable(this)}return Adapt.a11y.focusFirst(this)},a11y_focus:function a11y_focus(dontDefer){Adapt.a11y.log.deprecated("$(\"..\").a11y_focus, use Adapt.a11y.focusFirst($element, { defer: true }); instead.");Adapt.a11y.focusFirst(this,{defer:!dontDefer});return this}});_.extend($,{a11y_alert:function a11y_alert(){Adapt.a11y.log.removed("$.a11y_alert is removed. Please use aria-live instead.");return this},a11y_update:function a11y_update(){Adapt.a11y.log.removed("a11y_update is no longer required.");return this},a11y_text:function a11y_text(text){Adapt.a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_on:function a11y_on(isOn,selector){Adapt.a11y.log.deprecated("$(\"..\").a11y_on, use Adapt.a11y.toggleHidden($elements, isHidden); instead.");return Adapt.a11y.toggleHidden(selector,!isOn)},a11y_popdown:function a11y_popdown($focusTarget){Adapt.a11y.log.removed("$.a11y_popdown, use Adapt.a11y.popupClosed($focusTarget); instead.");return Adapt.a11y.popupClosed($focusTarget)},a11y_focus:function a11y_focus(dontDefer){Adapt.a11y.log.deprecated("$.a11y_focus, use Adapt.a11y.focusFirst(\"body\", { defer: true }); instead.");Adapt.a11y.focusFirst("body",{defer:!dontDefer});return this},a11y_normalize:function a11y_normalize(html){Adapt.a11y.log.deprecated("$.a11y_normalize, use Adapt.a11y.normalize(\"html\"); instead.");return Adapt.a11y.normalize(html)},a11y_remove_breaks:function a11y_remove_breaks(html){Adapt.a11y.log.deprecated("$.a11y_remove_breaks, use Adapt.a11y.removeBreaks(\"html\"); instead.");return Adapt.a11y.removeBreaks(html)}})});define("core/js/a11y",["core/js/adapt","./a11y/browserFocus","./a11y/focusOptions","./a11y/keyboardFocusOutline","./a11y/log","./a11y/scroll","./a11y/wrapFocus","./a11y/popup","./a11y/deprecated"],function(Adapt,BrowserFocus,FocusOptions,KeyboardFocusOutline,Log,Scroll,WrapFocus,Popup){var A11y=Backbone.Controller.extend({$html:$("html"),_htmlCharRegex:/&.*;/g,config:null,defaults:{_isFocusOutlineKeyboardOnlyEnabled:true,_isFocusOutlineDisabled:false,_isFocusAssignmentEnabled:true,_isFocusOnClickEnabled:true,_isFocusNextOnDisabled:true,_isScrollDisableEnabled:true,_isAriaHiddenManagementEnabled:true,_isPopupManagementEnabled:true,_isPopupWrapFocusEnabled:true,_isPopupAriaHiddenManagementEnabled:true,_isPopupTabIndexManagementEnabled:true,_ariaHiddenExcludes:":not(#wrapper):not(body)",_tabbableElements:"a,button,input,select,textarea,[tabindex]:not([data-a11y-force-focus])",_focusOutlineKeyboardOnlyIgnore:"input,textarea",_tabbableElementsExcludes:":not(.a11y-ignore):not([data-a11y-force-focus])",_focusableElements:"a,button,input,select,textarea,[tabindex],label",_readableElements:"[role=heading],[aria-label],[aria-labelledby],[alt]",_focusguard:".a11y-focusguard",_wrapStyleElements:"b,i,abbr,strong,em,small,sub,sup,ins,del,mark,zw,nb",_warnFirstOnly:true,_warn:true},_browserFocus:new BrowserFocus,_keyboardFocusOutline:new KeyboardFocusOutline,_wrapFocus:new WrapFocus,_popup:new Popup,_scroll:new Scroll,log:new Log,initialize:function initialize(){this._removeLegacyElements();this.listenToOnce(Adapt,{"app:dataLoaded":this._onDataLoaded,"navigationView:postRender":this._removeLegacyElements},this);Adapt.on("device:changed",this._setupNoSelect);this.listenTo(Adapt,{"router:location":this._onNavigationStart,"pageView:ready menuView:ready router:plugin":this._onNavigationEnd})},_onDataLoaded:function _onDataLoaded(){this.config=Adapt.config.get("_accessibility");this.config._isActive=false;this.config._options=_.defaults(this.config._options||{},this.defaults);Adapt.offlineStorage.set("a11y",false);this.$html.toggleClass("accessibility",this.isEnabled());this._setupNoSelect();this._addFocuserDiv();if(this._isReady){return}this._isReady=true;Adapt.trigger("accessibility:ready")},_setupNoSelect:function _setupNoSelect(){if(!this.config||!this.config._disableTextSelectOnClasses){return}var classes=this.config._disableTextSelectOnClasses.split(" ");var isMatch=false;for(var i=0,item;item=classes[i++];){if(this.$html.is(item)){isMatch=true;break}}this.$html.toggleClass("no-select",isMatch)},_addFocuserDiv:function _addFocuserDiv(){if($("#a11y-focuser").length){return}$("body").append($("<div id=\"a11y-focuser\" class=\"a11y-ignore\" tabindex=\"-1\" role=\"presentation\">&nbsp;</div>"))},_removeLegacyElements:function _removeLegacyElements(){var $legacyElements=$("body").children("#accessibility-toggle, #accessibility-instructions");var $navigationElements=$(".navigation").find("#accessibility-toggle, #accessibility-instructions");if(!$legacyElements.length&&!$navigationElements.length){return}Adapt.log.warn("REMOVED: #accessibility-toggle and #accessibility-instructions have been removed. Please remove them from all of your .html files.");$legacyElements.remove();$navigationElements.remove()},_onNavigationStart:function _onNavigationStart(){if(!this.isEnabled()){return}_.defer(function(){Adapt.a11y.toggleHidden(".page, .menu",true)})},_onNavigationEnd:function _onNavigationEnd(view){if(view&&view.model&&view.model.get("_id")!==Adapt.location._currentId||!this.isEnabled()){return}Adapt.a11y.toggleHidden(".page, .menu",false)},isActive:function isActive(){this.log.removed("Accessibility is now always active when enabled. Please unify your user experiences.");return false},isEnabled:function isEnabled(){return this.config&&this.config._isEnabled},toggleHidden:function toggleHidden($elements,isHidden){$elements=$($elements);var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled){return this}isHidden=isHidden===undefined?true:isHidden;if(isHidden===true){$elements.attr("aria-hidden",true)}else{$elements.removeAttr("aria-hidden")}return this},toggleAccessibleEnabled:function toggleAccessibleEnabled($elements,isAccessibleEnabled){this.toggleAccessible($elements,isAccessibleEnabled);this.toggleEnabled($elements,isAccessibleEnabled);return this},toggleAccessible:function toggleAccessible($elements,isReadable){$elements=$($elements);var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled||$elements.length===0){return this}isReadable=isReadable===undefined?true:isReadable;if(!isReadable){$elements.attr({tabindex:"-1","aria-hidden":"true"}).addClass("aria-hidden")}else{$elements.removeAttr("aria-hidden tabindex").removeClass("aria-hidden");$elements.parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}return this},toggleEnabled:function toggleEnabled($elements,isEnabled){$elements=$($elements);if($elements.length===0){return this}isEnabled=isEnabled===undefined?true:isEnabled;if(!isEnabled){$elements.attr("disabled","disabled").addClass("disabled")}else{$elements.removeAttr("disabled").removeClass("disabled")}return this},findFirstTabbable:function findFirstTabbable($element){$element=$($element).first();return this._findFirstForward($element,this.isTabbable)},findFirstReadable:function findFirstReadable($element){$element=$($element).first();return this._findFirstForward($element,this.isReadable)},findTabbable:function findTabbable($element){var config=Adapt.a11y.config;return $($element).find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes)},findReadable:function findReadable($element){var config=Adapt.a11y.config;return $($element).find("*").filter(function(index,element){return this.isReadable(element)}.bind(this))},isTabbable:function isTabbable($element){var config=Adapt.a11y.config;var value=$($element).is(config._options._tabbableElements).is(config._options._tabbableElementsExcludes);if(!value){return undefined}return value},isReadable:function isReadable($element,checkParents){var config=Adapt.a11y.config;$element=$($element).first();checkParents=checkParents===undefined?true:false;var $branch=checkParents?$element.add($element.parents()):$element;var isNotVisible=_.find($branch.toArray(),function(item){var $item=$(item);var isNotVisible=$item.css("display")==="none"||$item.css("visibility")==="hidden"||$item.attr("aria-hidden")==="true";if(isNotVisible){return true}});if(isNotVisible){return false}var hasNativeFocusOrIsScreenReadable=$element.is(config._options._focusableElements)||$element.is(config._options._readableElements);if(hasNativeFocusOrIsScreenReadable){return true}var childNodes=$element[0].childNodes;for(var c=0,cl=childNodes.length;c<cl;c++){var childNode=childNodes[c];var isTextNode=childNode.nodeType===3;if(!isTextNode){continue}var isOnlyWhiteSpace=/^\s*$/.test(childNode.nodeValue);if(isOnlyWhiteSpace){continue}return true}return undefined},_findFirstForward:function _findFirstForward($element,selector){$element=$($element).first();var iterator;switch(_typeof(selector)){case"string":iterator=function iterator($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}if($element.length===0){return $element.not("*")}var $found=this._findFirstForwardDescendant($element,iterator);if($found&&$found.length){return $found}var $nextSiblings=$element.nextAll().toArray();_.find($nextSiblings,function(sibling){var $sibling=$(sibling);var value=iterator($sibling);if(value===false){return}if(value){$found=$sibling;return true}$found=this._findFirstForwardDescendant($sibling,iterator);if($found&&$found.length)return true}.bind(this));if($found&&$found.length){return $found}var $branch=$element.add($element.parents()).toArray().reverse();_.find($branch,function(parent){var $parent=$(parent);if(iterator($parent)===false){return false}var $siblings=$parent.nextAll().toArray();return _.find($siblings,function(sibling){var $sibling=$(sibling);var value=iterator($sibling);if(value===false){return}if(value){$found=$sibling;return true}$found=this._findFirstForwardDescendant($sibling,iterator);if($found&&$found.length){return true}}.bind(this))}.bind(this));if(!$found||!$found.length){return $element.not("*")}return $found},_findFirstForwardDescendant:function _findFirstForwardDescendant($element,selector){$element=$($element).first();var iterator;switch(_typeof(selector)){case"string":iterator=function iterator($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}var $notFound=$element.not("*");if($element.length===0){return $notFound}var stack=[{item:$element[0],value:undefined}];var stackIndexPosition=0;var childIndexPosition=stackIndexPosition+1;do{var stackEntry=stack[stackIndexPosition];var $stackItem=$(stackEntry.item);switch(stackEntry.value){case true:return $stackItem;case false:return $notFound;}var $children=$stackItem.children().toArray();_.find($children,function(item){var $item=$(item);var value=iterator($item);if(value===false){return false}stack.splice(childIndexPosition++,0,{item:item,value:value})});stackIndexPosition++;childIndexPosition=stackIndexPosition+1}while(stackIndexPosition<stack.length);return $notFound},focusNext:function focusNext($element,options){options=new FocusOptions(options);$element=$($element).first();$element=Adapt.a11y.findFirstReadable($element);this.focus($element,options);return this},focusFirst:function focusFirst($element,options){options=new FocusOptions(options);$element=$($element).first();if(Adapt.a11y.isReadable($element)){this.focus($element,options);return $element}$element=Adapt.a11y.findFirstReadable($element);this.focus($element,options);return $element},focus:function focus($element,options){options=new FocusOptions(options);$element=$($element).first();var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusAssignmentEnabled||$element.length===0){return this}function perform(){if(options.preventScroll){var y=$(window).scrollTop();try{if($element.attr("tabindex")===undefined){$element.attr({"tabindex":"-1","data-a11y-force-focus":"true"})}$element[0].focus({preventScroll:true})}catch(e){}window.scrollTo(null,y)}else{$element[0].focus()}}if(options.defer){_.defer(function(){perform()}.bind(this))}else{perform()}return this},normalize:function normalize(htmls){var values=Array.prototype.slice.call(arguments,0);values=values.filter(Boolean);values=values.filter(_.isString);htmls=values.join(" ");var text=$("<div>"+htmls+"</div>").html();return text.replace(this._htmlCharRegex,"")},removeBreaks:function removeBreaks(htmls){var values=Array.prototype.slice.call(arguments,0);values=values.filter(Boolean);values=values.filter(_.isString);htmls=values.join(" ");var $div=$("<div>"+htmls+"</div>");var stack=[$div[0]];var stackIndex=0;var outputs=[];do{if(stack[stackIndex].childNodes.length){var nodes=stack[stackIndex].childNodes;var usable=_.filter(nodes,function(node){var isTextNode=node.nodeType===3;if(isTextNode){return true}var isStyleElement=$(node).is(Adapt.a11y.config._options._wrapStyleElements);if(isStyleElement){return true}return false});outputs.push.apply(outputs,usable);stack.push.apply(stack,nodes)}stackIndex++}while(stackIndex<stack.length);var rtnText="";outputs.forEach(function(item){rtnText+=item.outerHTML||item.textContent});return rtnText},scrollEnable:function scrollEnable($elements){this._scroll.enable($elements);return this},scrollDisable:function scrollDisable($elements){this._scroll.disable($elements);return this},popupOpened:function popupOpened($popupElement){this._popup.opened($popupElement);return this},popupClosed:function popupClosed($focusElement){this._popup.closed($focusElement);return this},setPopupCloseTo:function setPopupCloseTo($focusElement){return this._popup.setCloseTo($focusElement)}});return Adapt.a11y=new A11y});define("core/js/accessibility",["core/js/adapt","./a11y"],function(Adapt,a11y){Object.defineProperty(Adapt,"accessibility",{get:function get(){a11y.log.deprecated("Adapt.accessibility has moved to Adapt.a11y");return Adapt.accessibility=a11y}})});define("core/js/collections/adaptCollection",["core/js/adapt"],function(Adapt){var AdaptCollection=Backbone.Collection.extend({initialize:function initialize(models,options){this.url=options.url;this.once("reset",this.loadedData,this);if(this.url){this.fetch({reset:true,error:_.bind(function(model,xhr,options){console.error("ERROR: unable to load file "+this.url)},this)})}},loadedData:function loadedData(){Adapt.trigger("adaptCollection:dataLoaded")}});return AdaptCollection});define("core/js/modelEvent",[],function(){var ModelEvent=Backbone.Controller.extend({type:null,target:null,value:null,canBubble:true,deepPath:null,timeStamp:null,initialize:function initialize(type,target,value){this.type=type;this.target=target;this.value=value;this.deepPath=[target]},stopPropagation:function stopPropagation(){this.canBubble=false},addPath:function addPath(target){this.deepPath.unshift(target)}});return ModelEvent});define("core/js/enums/logLevelEnum",[],function(){var LOG_LEVEL=ENUM(["DEBUG","INFO","WARN","ERROR","FATAL"]);return LOG_LEVEL});define("core/js/logging",["core/js/adapt","core/js/enums/logLevelEnum"],function(Adapt,LOG_LEVEL){var Logging=Backbone.Controller.extend({_config:{_isEnabled:true,_level:LOG_LEVEL.INFO.asLowerCase,_console:true},initialize:function initialize(){Adapt.once("configModel:dataLoaded",this.onLoadConfigData.bind(this))},onLoadConfigData:function onLoadConfigData(){this.loadConfig();this.debug("Logging config loaded");this.trigger("log:ready")},loadConfig:function loadConfig(){if(Adapt.config.has("_logging")){this._config=Adapt.config.get("_logging")}this.checkQueryStringOverride()},checkQueryStringOverride:function checkQueryStringOverride(){var matches=window.location.search.match(/[?&]loglevel=([a-z]*)/i);if(!matches||matches.length<2)return;var override=LOG_LEVEL(matches[1].toUpperCase());if(!override)return;this._config._level=override.asLowerCase;this.debug("Loglevel override in query string:",this._config._level)},debug:function debug(){this._log(LOG_LEVEL.DEBUG,Array.prototype.slice.call(arguments))},info:function info(){this._log(LOG_LEVEL.INFO,Array.prototype.slice.call(arguments))},warn:function warn(){this._log(LOG_LEVEL.WARN,Array.prototype.slice.call(arguments))},error:function error(){this._log(LOG_LEVEL.ERROR,Array.prototype.slice.call(arguments))},fatal:function fatal(){this._log(LOG_LEVEL.FATAL,Array.prototype.slice.call(arguments))},_log:function _log(level,data){var isEnabled=this._config._isEnabled;if(!isEnabled)return;var configLevel=LOG_LEVEL(this._config._level.toUpperCase());var isLogLevelAllowed=level>=configLevel;if(!isLogLevelAllowed)return;this._logToConsole(level,data);this.trigger("log",level,data);this.trigger("log:"+level.asLowerCase,level,data)},_logToConsole:function _logToConsole(level,data){var shouldLogToConsole=this._config._console;if(!shouldLogToConsole)return;var log=[level.asUpperCase+":"];data&&log.push.apply(log,data);if(console[level.asLowerCase]){console[level.asLowerCase].apply(console,log)}else{console.log.apply(console,log)}}});Adapt.log=new Logging});define("core/js/models/adaptModel",["core/js/adapt","core/js/modelEvent","core/js/logging"],function(Adapt,ModelEvent){var AdaptModel=Backbone.Model.extend({defaults:{_canShowFeedback:true,_classes:"",_canReset:false,_isComplete:false,_isInteractionComplete:false,_isA11yRegionEnabled:false,_isA11yCompletionDescriptionEnabled:true,_requireCompletionOf:-1,_isEnabled:true,_isResetOnRevisit:false,_isAvailable:true,_isOptional:false,_isReady:false,_isVisible:true,_isLocked:false,_isHidden:false},trackable:["_id","_isComplete","_isInteractionComplete"],bubblingEvents:["change:_isComplete","change:_isInteractionComplete"],initialize:function initialize(){this.listenToOnce(Adapt,"app:dataLoaded",this.setupModel)},setupModel:function setupModel(){if(this.get("_type")==="page"){this._children="articles"}if(this._siblings==="contentObjects"&&this.get("_parentId")!==Adapt.course.get("_id")){this._parent="contentObjects"}if(this._children){this.setupChildListeners()}this.init();_.defer(function(){if(this._children){this.checkCompletionStatus();this.checkInteractionCompletionStatus();this.checkLocking()}this.setupTrackables()}.bind(this))},setupTrackables:function setupTrackables(){var originalTrackableStateFunction=this.triggerTrackableState;this.triggerTrackableState=_.compose(function(){this.triggerTrackableState.isQueued=true}.bind(this),_.debounce(function(){originalTrackableStateFunction.apply(this);this.triggerTrackableState.isQueued=false}.bind(this),17));this.listenTo(this,"change",function(model,value){if(this.triggerTrackableState.isQueued||!Adapt.attributes._isStarted){return}var trackablePropertyNames=_.result(this,"trackable",[]);var changedPropertyNames=_.keys(model.changed);var isTrackable=_.find(changedPropertyNames,function(item,index){return _.contains(trackablePropertyNames,item)}.bind(this));if(isTrackable){this.triggerTrackableState()}})},setupChildListeners:function setupChildListeners(){var children=this.getChildren();if(!children.length){return}this.listenTo(children,{"all":this.onAll,"bubble":this.bubble,"change:_isReady":this.checkReadyStatus,"change:_isComplete":this.onIsComplete,"change:_isInteractionComplete":this.checkInteractionCompletionStatus})},init:function init(){},getTrackableState:function getTrackableState(){var trackable=this.resultExtend("trackable",[]);var json=this.toJSON();var args=trackable;args.unshift(json);return _.pick.apply(_,args)},setTrackableState:function setTrackableState(state){var trackable=this.resultExtend("trackable",[]);var args=trackable;args.unshift(state);state=_.pick.apply(_,args);this.set(state);return this},triggerTrackableState:function triggerTrackableState(){Adapt.trigger("state:change",this,this.getTrackableState())},reset:function reset(type,force){if(!this.get("_canReset")&&!force)return;type=type||true;switch(type){case"hard":case true:this.set({_isEnabled:true,_isComplete:false,_isInteractionComplete:false});break;case"soft":this.set({_isEnabled:true,_isInteractionComplete:false});break;}},checkReadyStatus:function checkReadyStatus(){var children=this.getAvailableChildModels();if(_.find(children,function(child){return child.get("_isReady")===false})){return}this.set("_isReady",true)},setCompletionStatus:function setCompletionStatus(){if(!this.get("_isVisible"))return;this.set({_isComplete:true,_isInteractionComplete:true})},checkCompletionStatus:function checkCompletionStatus(){Adapt.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isComplete")},checkInteractionCompletionStatus:function checkInteractionCompletionStatus(){Adapt.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isInteractionComplete")},checkCompletionStatusFor:function checkCompletionStatusFor(completionAttribute){if(!completionAttribute)completionAttribute="_isComplete";var completed=false;var children=this.getAvailableChildModels();var requireCompletionOf=this.get("_requireCompletionOf");if(requireCompletionOf===-1){completed=_.find(children,function(child){return!child.get(completionAttribute)&&!child.get("_isOptional")})===undefined}else{completed=_.filter(children,function(child){return child.get(completionAttribute)&&!child.get("_isOptional")}).length>=requireCompletionOf}this.set(completionAttribute,completed);Adapt.checkedCompletion()},findAncestor:function findAncestor(ancestorType){var parent=this.getParent();if(!parent)return;if(ancestorType==="pages"){ancestorType="contentObjects"}if(!ancestorType||this._parent===ancestorType){return parent}return parent.findAncestor(ancestorType)},findDescendantModels:function findDescendantModels(descendants,options){var types=[descendants.slice(0,-1)];if(descendants==="contentObjects"){types.push.apply(types,["page","menu"])}var allDescendantsModels=this.getAllDescendantModels();var returnedDescendants=allDescendantsModels.filter(function(model){return _.contains(types,model.get("_type"))});if(!options){return returnedDescendants}if(options.where){return returnedDescendants.filter(function(descendant){for(var property in options.where){var value=options.where[property];if(descendant.get(property)!==value){return false}}return true})}},getAllDescendantModels:function getAllDescendantModels(isParentFirst){var descendants=[];if(this.get("_type")==="component"){descendants.push(this);return descendants}var children=this.getChildren();for(var i=0,l=children.models.length;i<l;i++){var child=children.models[i];if(child.get("_type")==="component"){descendants.push(child);continue}var subDescendants=child.getAllDescendantModels(isParentFirst);if(isParentFirst===true){descendants.push(child)}descendants=descendants.concat(subDescendants);if(isParentFirst!==true){descendants.push(child)}}return descendants},findDescendants:function findDescendants(descendants){Adapt.log.warn("DEPRECATED - Use findDescendantModels() as findDescendants() may be removed in the future");if(this._children===descendants){return this.getChildren()}var allDescendants=[];var flattenedDescendants;var children=this.getChildren();var returnedDescendants;function searchChildren(children){var models=children.models;for(var i=0,len=models.length;i<len;i++){var model=models[i];var childrensModels=model.getChildren().models;allDescendants.push(childrensModels);flattenedDescendants=_.flatten(allDescendants)}returnedDescendants=new Backbone.Collection(flattenedDescendants);if(children.models.length===0||children.models[0]._children===descendants){return}else{allDescendants=[];searchChildren(returnedDescendants)}}searchChildren(children);return returnedDescendants},findRelativeModel:function findRelativeModel(relativeString,options){var types=["menu","page","article","block","component"];options=options||{};var modelId=this.get("_id");var modelType=this.get("_type");var rootModel=Adapt.course;if(options.limitParentId){rootModel=Adapt.findById(options.limitParentId)}var relativeDescriptor=Adapt.parseRelativeString(relativeString);var findAncestorType=_.indexOf(types,modelType)>_.indexOf(types,relativeDescriptor.type);var findSiblingType=modelType===relativeDescriptor.type;var searchBackwards=relativeDescriptor.offset<0;var moveBy=Math.abs(relativeDescriptor.offset);var movementCount=0;var findDescendantType=!findSiblingType&&!findAncestorType;if(findDescendantType){moveBy--}var pageDescendants;if(searchBackwards){pageDescendants=rootModel.getAllDescendantModels(true);pageDescendants.reverse()}else{pageDescendants=rootModel.getAllDescendantModels(false)}if(typeof options.filter==="function"){pageDescendants=_.filter(pageDescendants,options.filter)}var modelIndex=_.findIndex(pageDescendants,function(pageDescendant){if(pageDescendant.get("_id")===modelId){return true}return false});if(options.loop){var typeCounts={};pageDescendants.forEach(function(model){var type=model.get("_type");typeCounts[type]=typeCounts[type]||0;typeCounts[type]++});moveBy=moveBy%typeCounts[relativeDescriptor.type];pageDescendants=pageDescendants.concat(pageDescendants.slice(0))}for(var i=modelIndex,l=pageDescendants.length;i<l;i++){var descendant=pageDescendants[i];if(descendant.get("_type")===relativeDescriptor.type){if(movementCount===moveBy){return Adapt.findById(descendant.get("_id"))}movementCount++}}return undefined},getChildren:function getChildren(){if(this.get("_children"))return this.get("_children");var childrenCollection;if(!this._children){childrenCollection=new Backbone.Collection}else{var children=Adapt[this._children].where({_parentId:this.get("_id")});childrenCollection=new Backbone.Collection(children)}if(this.get("_type")=="block"&&childrenCollection.length==2&&childrenCollection.models[0].get("_layout")!=="left"&&this.get("_sortComponents")!==false){childrenCollection.comparator="_layout";childrenCollection.sort()}this.set("_children",childrenCollection);return childrenCollection},getAvailableChildModels:function getAvailableChildModels(){return this.getChildren().where({_isAvailable:true})},getAvailableChildren:function getAvailableChildren(){Adapt.log.warn("DEPRECATED - Use getAvailableChildModels() as getAvailableChildren() may be removed in the future");return new Backbone.Collection(this.getChildren().where({_isAvailable:true}))},getParent:function getParent(){if(this.get("_parent"))return this.get("_parent");if(this._parent==="course"){return Adapt.course}var parent=Adapt.findById(this.get("_parentId"));this.set("_parent",parent);return parent},getAncestorModels:function getAncestorModels(shouldIncludeChild){var parents=[];var context=this;if(shouldIncludeChild)parents.push(context);while(context.has("_parentId")){context=context.getParent();parents.push(context)}return parents.length?parents:null},getParents:function getParents(shouldIncludeChild){Adapt.log.warn("DEPRECATED - Use getAncestorModels() as getParents() may be removed in the future");var parents=[];var context=this;if(shouldIncludeChild)parents.push(context);while(context.has("_parentId")){context=context.getParent();parents.push(context)}return parents.length?new Backbone.Collection(parents):null},getSiblings:function getSiblings(passSiblingsAndIncludeSelf){var siblings;if(!passSiblingsAndIncludeSelf){if(this._hasSiblingsAndSelf===false){return this.get("_siblings")}siblings=_.reject(Adapt[this._siblings].where({_parentId:this.get("_parentId")}),function(model){return model.get("_id")==this.get("_id")}.bind(this));this._hasSiblingsAndSelf=false}else{if(this._hasSiblingsAndSelf){return this.get("_siblings")}siblings=Adapt[this._siblings].where({_parentId:this.get("_parentId")});this._hasSiblingsAndSelf=true}var siblingsCollection=new Backbone.Collection(siblings);this.set("_siblings",siblingsCollection);return siblingsCollection},setOnChildren:function setOnChildren(key,value,options){var args=arguments;this.set.apply(this,args);if(!this._children)return;var children=this.getChildren();var models=children.models;for(var i=0,len=models.length;i<len;i++){var child=models[i];child.setOnChildren.apply(child,args)}},setOptional:function setOptional(value){this.set({_isOptional:value})},checkLocking:function checkLocking(){var lockType=this.get("_lockType");if(!lockType)return;switch(lockType){case"sequential":this.setSequentialLocking();break;case"unlockFirst":this.setUnlockFirstLocking();break;case"lockLast":this.setLockLastLocking();break;case"custom":this.setCustomLocking();break;default:console.warn("AdaptModel.checkLocking: unknown _lockType \""+lockType+"\" found on "+this.get("_id"));}},setSequentialLocking:function setSequentialLocking(){var children=this.getAvailableChildModels();for(var i=1,j=children.length;i<j;i++){children[i].set("_isLocked",!children[i-1].get("_isComplete"))}},setUnlockFirstLocking:function setUnlockFirstLocking(){var children=this.getAvailableChildModels();var isFirstChildComplete=children[0].get("_isComplete");for(var i=1,j=children.length;i<j;i++){children[i].set("_isLocked",!isFirstChildComplete)}},setLockLastLocking:function setLockLastLocking(){var children=this.getAvailableChildModels();var lastIndex=children.length-1;for(var i=lastIndex-1;i>=0;i--){if(!children[i].get("_isComplete")){return children[lastIndex].set("_isLocked",true)}}children[lastIndex].set("_isLocked",false)},setCustomLocking:function setCustomLocking(){var children=this.getAvailableChildModels();for(var i=0,j=children.length;i<j;i++){var child=children[i];child.set("_isLocked",this.shouldLock(child))}},shouldLock:function shouldLock(child){var lockedBy=child.get("_lockedBy");if(!lockedBy)return false;for(var i=lockedBy.length-1;i>=0;i--){var id=lockedBy[i];try{var model=Adapt.findById(id);if(!model.get("_isAvailable"))continue;if(!model.get("_isComplete"))return true}catch(e){console.warn("AdaptModel.shouldLock: unknown _lockedBy ID \""+id+"\" found on "+child.get("_id"))}}return false},onIsComplete:function onIsComplete(){this.checkCompletionStatus();this.checkLocking()},onAll:function onAll(type,model,value){if(!_.contains(this.bubblingEvents,type))return;var event=new ModelEvent(type,model,value);this.bubble(event)},bubble:function bubble(event){if(!event.canBubble)return;event.addPath(this);this.trigger("bubble:"+event.type+" bubble",event)}});return AdaptModel});define("core/js/models/articleModel",["core/js/models/adaptModel"],function(AdaptModel){var ArticleModel=AdaptModel.extend({_parent:"contentObjects",_siblings:"articles",_children:"blocks"});return ArticleModel});define("core/js/models/blockModel",["core/js/models/adaptModel"],function(AdaptModel){var BlockModel=AdaptModel.extend({_parent:"articles",_siblings:"blocks",_children:"components",defaults:function defaults(){return _.extend({_sortComponents:true},AdaptModel.prototype.defaults)}});return BlockModel});define("core/js/models/configModel",["core/js/adapt"],function(Adapt){var ConfigModel=Backbone.Model.extend({defaults:{screenSize:{small:520,medium:760,large:1024},_forceRouteLocking:false,_canLoadData:true,_disableAnimation:false},initialize:function initialize(attrs,options){this.url=options.url;this.fetch({success:function(){Adapt.trigger("offlineStorage:prepare");Adapt.wait.queue(function(){Adapt.trigger("configModel:dataLoaded");if(this.get("_canLoadData")){Adapt.trigger("configModel:loadCourseData")}if(this.get("_defaultDirection")==="rtl"){$("html").addClass("dir-rtl")}var disableAnimationArray=this.get("_disableAnimationFor");if(disableAnimationArray&&disableAnimationArray.length>0){for(var i=0;i<disableAnimationArray.length;i++){if($("html").is(disableAnimationArray[i])){this.set("_disableAnimation",true);console.log("Animation disabled.")}}}}.bind(this))}.bind(this),error:function error(){console.log("Unable to load course/config.json")}})},loadData:function loadData(){}});return ConfigModel});define("core/js/models/contentObjectModel",["core/js/models/adaptModel"],function(AdaptModel){var ContentObjectModel=AdaptModel.extend({_parent:"course",_siblings:"contentObjects",_children:"contentObjects"});return ContentObjectModel});define("core/js/models/componentModel",["core/js/models/adaptModel"],function(AdaptModel){var ComponentModel=AdaptModel.extend({_parent:"blocks",_siblings:"components",defaults:AdaptModel.resultExtend("defaults",{_isA11yComponentDescriptionEnabled:true}),trackable:AdaptModel.resultExtend("trackable",["_userAnswer"])});return ComponentModel});define("core/js/models/courseModel",["core/js/adapt","core/js/models/adaptModel"],function(Adapt,AdaptModel){var CourseModel=AdaptModel.extend({initialize:function initialize(attrs,options){AdaptModel.prototype.initialize.apply(this,arguments);Adapt.trigger("courseModel:dataLoading");this.url=options.url;this.on("sync",this.loadedData,this);if(this.url){this.fetch({error:_.bind(function(model,xhr,options){console.error("ERROR: unable to load file "+this.url)},this)})}},loadedData:function loadedData(){Adapt.trigger("courseModel:dataLoaded")},_children:"contentObjects"});return CourseModel});define("core/js/enums/buttonStateEnum",[],function(){var BUTTON_STATE=ENUM(["SUBMIT","CORRECT","INCORRECT","SHOW_CORRECT_ANSWER","HIDE_CORRECT_ANSWER","SHOW_FEEDBACK","RESET"]);return BUTTON_STATE});define("core/js/models/questionModel",["core/js/adapt","core/js/models/componentModel","core/js/enums/buttonStateEnum"],function(Adapt,ComponentModel,BUTTON_STATE){var QuestionModel=ComponentModel.extend({defaults:function defaults(){return ComponentModel.resultExtend("defaults",{_isQuestionType:true,_shouldDisplayAttempts:false,_canShowModelAnswer:true,_canShowFeedback:true,_canShowMarking:true,_isSubmitted:false,_questionWeight:Adapt.config.get("_questionWeight"),_items:[]})},trackable:ComponentModel.resultExtend("trackable",["_isSubmitted","_score","_isCorrect","_attemptsLeft"]),init:function init(){this.setupDefaultSettings();this.listenToOnce(Adapt,"adapt:initialize",this.onAdaptInitialize)},setupDefaultSettings:function setupDefaultSettings(){this.setupWeightSettings();this.setupButtonSettings()},setupButtonSettings:function setupButtonSettings(){var globalButtons=Adapt.course.get("_buttons");if(!this.has("_buttons")){this.set("_buttons",globalButtons)}else{var componentButtons=this.get("_buttons");for(var key in componentButtons){if(_typeof(componentButtons[key])==="object"){if(!componentButtons[key].buttonText&&globalButtons[key].buttonText){componentButtons[key].buttonText=globalButtons[key].buttonText}if(!componentButtons[key].ariaLabel&&globalButtons[key].ariaLabel){componentButtons[key].ariaLabel=globalButtons[key].ariaLabel}}if(!componentButtons[key]&&globalButtons[key]){componentButtons[key]=globalButtons[key]}}}},setupWeightSettings:function setupWeightSettings(){},onAdaptInitialize:function onAdaptInitialize(){this.restoreUserAnswers()},restoreUserAnswers:function restoreUserAnswers(){},canSubmit:function canSubmit(){},updateAttempts:function updateAttempts(){if(!this.get("_attemptsLeft")){this.set("_attemptsLeft",this.get("_attempts"))}this.set("_attemptsLeft",this.get("_attemptsLeft")-1)},setQuestionAsSubmitted:function setQuestionAsSubmitted(){this.set({_isEnabled:false,_isSubmitted:true})},storeUserAnswer:function storeUserAnswer(){},markQuestion:function markQuestion(){if(this.isCorrect()){this.set("_isCorrect",true)}else{this.set("_isCorrect",false)}},isCorrect:function isCorrect(){},setScore:function setScore(){},checkQuestionCompletion:function checkQuestionCompletion(){var isComplete=this.get("_isCorrect")||this.get("_attemptsLeft")===0;if(isComplete){this.setCompletionStatus()}return isComplete},updateButtons:function updateButtons(){var isInteractionComplete=this.get("_isInteractionComplete");var isCorrect=this.get("_isCorrect");var isEnabled=this.get("_isEnabled");var buttonState=this.get("_buttonState");var canShowModelAnswer=this.get("_canShowModelAnswer");if(isInteractionComplete){if(isCorrect||!canShowModelAnswer){this.set("_buttonState",BUTTON_STATE.CORRECT)}else{switch(buttonState){case BUTTON_STATE.SUBMIT:case BUTTON_STATE.HIDE_CORRECT_ANSWER:this.set("_buttonState",BUTTON_STATE.SHOW_CORRECT_ANSWER);break;default:this.set("_buttonState",BUTTON_STATE.HIDE_CORRECT_ANSWER);}}}else{if(isEnabled){this.set("_buttonState",BUTTON_STATE.SUBMIT)}else{this.set("_buttonState",BUTTON_STATE.RESET)}}},setupFeedback:function setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback()}else if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback()}else{this.setupIncorrectFeedback()}},isPartlyCorrect:function isPartlyCorrect(){},setupCorrectFeedback:function setupCorrectFeedback(){this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:this.get("_feedback").correct})},setupPartlyCorrectFeedback:function setupPartlyCorrectFeedback(){var feedback=this.get("_feedback")._partlyCorrect;if(feedback&&feedback.final){this.setAttemptSpecificFeedback(feedback)}else{this.setupIncorrectFeedback()}},setupIncorrectFeedback:function setupIncorrectFeedback(){this.setAttemptSpecificFeedback(this.get("_feedback")._incorrect)},setAttemptSpecificFeedback:function setAttemptSpecificFeedback(feedback){var body=this.get("_attemptsLeft")&&feedback.notFinal||feedback.final;this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:body})},getFeedbackTitle:function getFeedbackTitle(){return this.get("_feedback").title||this.get("displayTitle")||this.get("title")||""},isInteractive:function isInteractive(){return!this.get("_isComplete")||this.get("_isEnabled")&&!this.get("_isSubmitted")},reset:function reset(type,force){if(!this.get("_canReset")&&!force)return;type=type||true;ComponentModel.prototype.reset.call(this,type,force);var attempts=this.get("_attempts");this.set({_attemptsLeft:attempts,_isCorrect:undefined,_isSubmitted:false,_buttonState:BUTTON_STATE.SUBMIT})},setQuestionAsReset:function setQuestionAsReset(){this.set({_isEnabled:true,_isSubmitted:false})},resetUserAnswer:function resetUserAnswer(){},refresh:function refresh(){this.trigger("question:refresh")},getButtonState:function getButtonState(){if(this.get("_isCorrect")){return BUTTON_STATE.CORRECT}if(this.get("_attemptsLeft")===0){return this.get("_canShowModelAnswer")?BUTTON_STATE.SHOW_CORRECT_ANSWER:BUTTON_STATE.INCORRECT}return this.get("_isSubmitted")?BUTTON_STATE.RESET:BUTTON_STATE.SUBMIT},getInteractionObject:function getInteractionObject(){return{}},getResponse:function getResponse(){},getResponseType:function getResponseType(){}});return QuestionModel});define("core/js/models/buildModel",["core/js/adapt","core/js/logging"],function(Adapt){var BuildModel=Backbone.Model.extend({defaults:{jsonext:"json"},initialize:function initialize(attrs,options){this.url=options.url;this.fetch({success:_.bind(function(){this.isLoaded=true;Adapt.trigger("buildModel:dataLoaded")},this),error:function error(){console.log("Unable to load adapt/js/build.js");Adapt.trigger("buildModel:dataLoaded")}})},whenReady:function whenReady(){if(this.isLoaded)return Promise.resolve();return new Promise(function(resolve){Adapt.once("buildModel:dataLoaded",resolve)}.bind(this))}});return Adapt.build=new BuildModel(null,{url:"adapt/js/build.min.js",reset:true})});define("core/js/startController",["core/js/adapt"],function(Adapt){var StartController=Backbone.Controller.extend({model:null,loadCourseData:function loadCourseData(){this.model=new Backbone.Model(Adapt.course.get("_start"))},setStartLocation:function setStartLocation(){if(!this.isEnabled())return;window.history.replaceState("","",this.getStartHash())},getStartHash:function getStartHash(alwaysForce){var startId=this.getStartId();var hasStartId=startId?true:false;var isRouteSpecified=_.indexOf(window.location.href,"#")>-1;var shouldForceStartId=alwaysForce||this.model.get("_force");var shouldNavigateToStartId=hasStartId&&(!isRouteSpecified||shouldForceStartId);var startHash="#/";if(shouldNavigateToStartId){if(startId!==Adapt.course.get("_id")){startHash="#/id/"+startId}}else{var hasLocationHash=window.location.hash?true:false;startHash=hasLocationHash?window.location.hash:startHash}return startHash},isEnabled:function isEnabled(){if(!this.model||!this.model.get("_isEnabled"))return false;return true},getStartId:function getStartId(){var startId=this.model.get("_id");var startIds=this.model.get("_startIds");var $html=$("html");var hasStartIdsConfiguration=startIds&&startIds.length>0;if(hasStartIdsConfiguration){for(var i=0,l=startIds.length;i<l;i++){var item=startIds[i];var className=item._className;var skipIfComplete=item._skipIfComplete;var model=Adapt.findById(item._id);if(!model){console.log("startController: cannot find id",item._id);continue}if(skipIfComplete){if(model.get("_isComplete"))continue}if(!className||$html.is(className)||$html.hasClass(className)){startId=item._id;break}}}return startId}});Adapt.once("adapt:start",function(){Adapt.startController.loadCourseData();Adapt.startController.setStartLocation()});return Adapt.startController=new StartController});define("core/js/data",["core/js/adapt","core/js/collections/adaptCollection","core/js/models/articleModel","core/js/models/blockModel","core/js/models/configModel","core/js/models/contentObjectModel","core/js/models/componentModel","core/js/models/courseModel","core/js/models/questionModel","core/js/models/lockingModel","core/js/models/buildModel","core/js/startController"],function(Adapt,AdaptCollection,ArticleModel,BlockModel,ConfigModel,ContentObjectModel,ComponentModel,CourseModel,QuestionModel){var Data=Backbone.Controller.extend({mappedIds:{},init:function init(){Adapt.build.whenReady().then(this.onBuildDataLoaded.bind(this))},onBuildDataLoaded:function onBuildDataLoaded(){$("html").attr("data-adapt-framework-version",Adapt.build.get("package").version);Adapt.config=new ConfigModel(null,{url:"course/config."+Adapt.build.get("jsonext"),reset:true});Adapt.config.on({"change:_activeLanguage":this.onLanguageChange.bind(this),"change:_defaultDirection":this.onDirectionChange.bind(this)});Adapt.once("configModel:loadCourseData",this.onLoadCourseData.bind(this))},onLanguageChange:function onLanguageChange(model,language){Adapt.offlineStorage.set("lang",language);this.loadCourseData(this.triggerDataReady.bind(this),language)},onDirectionChange:function onDirectionChange(model,direction){if(direction==="rtl"){$("html").removeClass("dir-ltr").addClass("dir-rtl").attr("dir","rtl")}else{$("html").removeClass("dir-rtl").addClass("dir-ltr").attr("dir","ltr")}},onLoadCourseData:function onLoadCourseData(){if(Adapt.config.get("_activeLanguage")){this.loadCourseData(this.triggerDataReady.bind(this))}else{Adapt.config.set("_activeLanguage",Adapt.config.get("_defaultLanguage"))}},loadCourseData:function loadCourseData(callback,newLanguage){Adapt.on("adaptCollection:dataLoaded courseModel:dataLoaded",function(){this.checkDataIsLoaded(callback,newLanguage)}.bind(this));var language=Adapt.config.get("_activeLanguage");var jsonext=Adapt.build.get("jsonext");var courseFolder="course/"+language+"/";$("html").attr("lang",language);Adapt.course=new CourseModel(null,{url:courseFolder+"course."+jsonext,reset:true});Adapt.contentObjects=new AdaptCollection(null,{model:ContentObjectModel,url:courseFolder+"contentObjects."+jsonext});Adapt.articles=new AdaptCollection(null,{model:ArticleModel,url:courseFolder+"articles."+jsonext});Adapt.blocks=new AdaptCollection(null,{model:BlockModel,url:courseFolder+"blocks."+jsonext});Adapt.components=new AdaptCollection(null,{model:function model(json){var ViewModelObject=Adapt.componentStore[json._component];if(!ViewModelObject){throw new Error("One or more components of type \""+json._component+"\" were included in the course - but no component of that type is installed...")}if(ViewModelObject.model){return new ViewModelObject.model(json)}var View=ViewModelObject.view||ViewModelObject;if(View._isQuestionType){return new QuestionModel(json)}return new ComponentModel(json)},url:courseFolder+"components."+jsonext})},checkDataIsLoaded:function checkDataIsLoaded(callback,newLanguage){if(Adapt.contentObjects.models.length>0&&Adapt.articles.models.length>0&&Adapt.blocks.models.length>0&&Adapt.components.models.length>0&&Adapt.course.get("_id")){this.mapAdaptIdsToObjects();Adapt.log.debug("Firing app:dataLoaded");try{Adapt.trigger("app:dataLoaded")}catch(e){Adapt.log.error("Error during app:dataLoading trigger",e)}this.setupMapping();Adapt.wait.queue(function(){callback(newLanguage)})}},mapAdaptIdsToObjects:function mapAdaptIdsToObjects(){Adapt.contentObjects._byAdaptID=Adapt.contentObjects.groupBy("_id");Adapt.articles._byAdaptID=Adapt.articles.groupBy("_id");Adapt.blocks._byAdaptID=Adapt.blocks.groupBy("_id");Adapt.components._byAdaptID=Adapt.components.groupBy("_id")},setupMapping:function setupMapping(){this.mappedIds={};this.mappedIds[Adapt.course.get("_id")]="course";var collections=["contentObjects","articles","blocks","components"];collections.forEach(function(collection){Adapt[collection].models.forEach(function(model){var id=model.get("_id");this.mappedIds[id]=collection}.bind(this))}.bind(this))},triggerDataReady:function triggerDataReady(newLanguage){if(newLanguage){Adapt.trigger("app:languageChanged",newLanguage);_.defer(function(){Adapt.startController.loadCourseData();var hash="#/";if(Adapt.startController.isEnabled()){hash=Adapt.startController.getStartHash(true)}Backbone.history.navigate(hash,{trigger:true,replace:true})})}Adapt.log.debug("Firing app:dataReady");try{Adapt.trigger("app:dataReady")}catch(e){Adapt.log.error("Error during app:dataReady trigger",e)}Adapt.wait.queue(this.triggerInit.bind(this))},triggerInit:function triggerInit(){this.isReady=true;this.trigger("ready")},whenReady:function whenReady(){if(this.isReady)return Promise.resolve();return new Promise(function(resolve){this.once("ready",resolve)}.bind(this))},mapById:function mapById(id){return this.mappedIds[id]},findById:function findById(id){if(id===Adapt.course.get("_id")){return Adapt.course}var collectionType=Adapt.mapById(id);if(!collectionType){console.warn("Adapt.findById() unable to find collection type for id: "+id);return}return Adapt[collectionType]._byAdaptID[id][0]}});return Adapt.data=new Data});define("core/js/offlineStorage",["core/js/adapt"],function(Adapt){var OfflineStorage=Backbone.Controller.extend({ready:true,_handler:undefined,initialize:function initialize(handler){if(!handler){return}this.ready=false;this._handler=handler},hasHandler:function hasHandler(){return this._handler!==undefined},set:function set(name,value){if(this._handler&&this._handler.set){return this._handler.set.apply(this._handler,arguments)}this[name]=value},get:function get(name){if(this._handler&&this._handler.get){return this._handler.get.apply(this._handler,arguments)}return this[name]},setReadyStatus:function setReadyStatus(){this.ready=true;Adapt.trigger("offlineStorage:ready")}});Adapt.offlineStorage=new OfflineStorage;return Adapt.offlineStorage});define("core/js/enums/completionStateEnum",[],function(){var COMPLETION_STATE=ENUM(["INCOMPLETE","COMPLETED","PASSED","FAILED"]);return COMPLETION_STATE});define("core/js/tracking",["core/js/adapt","core/js/enums/completionStateEnum"],function(Adapt,COMPLETION_STATE){var Tracking=Backbone.Controller.extend({_config:{_requireContentCompleted:true,_requireAssessmentCompleted:false},_assessmentState:null,initialize:function initialize(){Adapt.once("configModel:dataLoaded",this.loadConfig.bind(this));Adapt.on("app:dataReady",this.setupEventListeners.bind(this))},setupEventListeners:function setupEventListeners(){if(this._config._requireAssessmentCompleted){this.listenTo(Adapt,{"assessment:complete":this.onAssessmentComplete,"assessment:restored":this.onAssessmentRestored})}if(this._config._requireContentCompleted){this.listenTo(Adapt.course,"change:_isComplete",this.checkCompletion)}},onAssessmentComplete:function onAssessmentComplete(assessmentState){this._assessmentState=assessmentState;this.checkCompletion()},onAssessmentRestored:function onAssessmentRestored(assessmentState){this._assessmentState=assessmentState},checkCompletion:function checkCompletion(){var completionData=this.getCompletionData();if(completionData.status===COMPLETION_STATE.INCOMPLETE){return}Adapt.trigger("tracking:complete",completionData);Adapt.log.debug("tracking:complete",completionData)},getCompletionData:function getCompletionData(){var completionData={status:COMPLETION_STATE.INCOMPLETE,assessment:null};if(this._config._requireContentCompleted&&!Adapt.course.get("_isComplete")){return completionData}if(this._config._requireAssessmentCompleted){if(!this._assessmentState){return completionData}completionData.status=this._assessmentState.isPass?COMPLETION_STATE.PASSED:COMPLETION_STATE.FAILED;completionData.assessment=this._assessmentState;return completionData}completionData.status=COMPLETION_STATE.COMPLETED;return completionData},loadConfig:function loadConfig(){if(Adapt.config.has("_completionCriteria")){this._config=Adapt.config.get("_completionCriteria")}}});Adapt.tracking=new Tracking;return Adapt.tracking});define("core/js/device",["core/js/adapt","bowser"],function(Adapt,Bowser){var $html=$("html");var $window=$(window);Adapt.device={touch:Modernizr.touchevents,screenWidth:getScreenWidth(),screenHeight:getScreenHeight(),browser:(Bowser.name||"").toLowerCase(),version:(Bowser.version||"").toLowerCase(),OS:getOperatingSystem().toLowerCase(),osVersion:Bowser.osversion||"",renderingEngine:getRenderingEngine()};Object.defineProperties(Adapt.device,{"orientation":{get:function get(){return this.screenWidth>=this.screenHeight?"landscape":"portrait"}},"aspectRatio":{get:function get(){return this.screenWidth/this.screenHeight}}});Adapt.once("app:dataReady",function(){Adapt.device.screenSize=checkScreenSize();$html.addClass("size-"+Adapt.device.screenSize);if(Adapt.device.orientation){$html.addClass("orientation-"+Adapt.device.orientation)}$window.on("resize orientationchange",onWindowResize)});function checkScreenSize(){var screenSizeConfig=Adapt.config.get("screenSize");var screenSize;if(Adapt.device.screenWidth>screenSizeConfig.medium){screenSize="large"}else if(Adapt.device.screenWidth>screenSizeConfig.small){screenSize="medium"}else{screenSize="small"}return screenSize}function getScreenWidth(){return isAppleDevice()?getAppleScreenWidth():window.innerWidth||$window.width()}function getScreenHeight(){return isAppleDevice()?getAppleScreenHeight():window.innerHeight||$window.height()}function getOperatingSystem(){var os="";var flags=["windows","mac","linux","windowsphone","chromeos","android","ios","blackberry","firefoxos","webos","bada","tizen","sailfish"];for(var i=0;i<flags.length;i++){if(Bowser[flags[i]]){os=flags[i];break}}if(os===""){var platform=navigator.platform;var platforms=["Win","Mac","Linux"];os="PlatformUnknown";for(var i=0;i<platforms.length;i++){if(platform.indexOf(platforms[i])!=-1){os=platforms[i].toLowerCase();break}}if(os=="win"){os="windows"}}return os}function getRenderingEngine(){var engine="";var flags=["webkit","blink","gecko","msie","msedge"];for(var i=0;i<flags.length;i++){if(Bowser[flags[i]]){engine=flags[i];break}}return engine}var onWindowResize=_.debounce(function onScreenSizeChanged(){var previousWidth=Adapt.device.screenWidth;var previousHeight=Adapt.device.screenHeight;Adapt.device.screenWidth=getScreenWidth();Adapt.device.screenHeight=getScreenHeight();if(previousWidth===Adapt.device.screenWidth&&previousHeight===Adapt.device.screenHeight){return}var newScreenSize=checkScreenSize();if(newScreenSize!==Adapt.device.screenSize){Adapt.device.screenSize=newScreenSize;$html.removeClass("size-small size-medium size-large").addClass("size-"+Adapt.device.screenSize);if(Adapt.device.orientation){$html.removeClass("orientation-landscape orientation-portrait").addClass("orientation-"+Adapt.device.orientation)}Adapt.trigger("device:changed",Adapt.device.screenSize)}Adapt.trigger("device:preResize device:resize device:postResize",Adapt.device.screenWidth)},100);function isAppleDevice(){return /iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function getAppleScreenWidth(){return Math.abs(window.orientation)===90?screen.height:screen.width}function getAppleScreenHeight(){return Math.abs(window.orientation)===90?screen.width:screen.height}function getAppleDeviceType(){var type="";var flags=["iphone","ipad","ipod"];for(var i=0;i<flags.length;i++){if(Bowser[flags[i]]){type=flags[i];break}}return type}function pixelDensity(){var pixelDensity=window.devicePixelRatio||1;if(pixelDensity>=3){return"ultra-high"}else if(pixelDensity>=2){return"high"}else if(pixelDensity>=1.5){return"medium"}else{return"low"}}var browser=Adapt.device.browser.toLowerCase();var browserString=browser.replace(/msie|internet explorer/,"ie");browserString=browserString+" version-"+Adapt.device.version+" OS-"+Adapt.device.OS+" "+getAppleDeviceType();browserString+=browserString.replace(".","-").toLowerCase();$html.addClass(browserString+" pixel-density-"+pixelDensity())});define("core/js/views/drawerView",["core/js/adapt"],function(Adapt){var DrawerView=Backbone.View.extend({className:"drawer display-none",disableAnimation:false,attributes:{"role":"dialog","aria-modal":"true","aria-labelledby":"drawer-heading","aria-hidden":"true"},initialize:function initialize(){this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this._isVisible=false;this.drawerDir="right";if(Adapt.config.get("_defaultDirection")=="rtl"){this.drawerDir="left"}this.setupEventListeners();this.render();this.drawerDuration=Adapt.config.get("_drawer")._duration;this.drawerDuration=this.drawerDuration?this.drawerDuration:400;this.$wrapper=$("#wrapper")},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"navigation:toggleDrawer":this.toggleDrawer,"drawer:triggerCustomView":this.openCustomView,"drawer:closeDrawer":this.onCloseDrawer,"remove":this.onCloseDrawer,"drawer:remove":this.remove});this._onKeyUp=_.bind(this.onKeyUp,this);this.setupEscapeKey()},setupEscapeKey:function setupEscapeKey(){$(window).on("keyup",this._onKeyUp)},onKeyUp:function onKeyUp(event){if(event.which!=27)return;event.preventDefault();this.onCloseDrawer()},events:{"click .drawer-back":"onBackButtonClicked","click .drawer-close":"onCloseClicked"},render:function render(){var template=Handlebars.templates["drawer"];$(this.el).html(template({_globals:Adapt.course.get("_globals")})).prependTo("body");var shadowTemplate=Handlebars.templates["shadow"];$(shadowTemplate()).prependTo("body");_.defer(_.bind(function(){this.postRender()},this));return this},postRender:function postRender(){this.$("a, button, input, select, textarea").attr("tabindex",-1);this.checkIfDrawerIsAvailable()},openCustomView:function openCustomView(view,hasBackButton){this._hasBackButton=hasBackButton;this._isCustomViewVisible=true;Adapt.trigger("drawer:empty");this.showDrawer();this.$(".drawer-holder").html(view)},checkIfDrawerIsAvailable:function checkIfDrawerIsAvailable(){if(this.collection.length==0){$(".navigation-drawer-toggle-button").addClass("display-none");Adapt.trigger("drawer:noItems")}else{$(".navigation-drawer-toggle-button").removeClass("display-none")}},onBackButtonClicked:function onBackButtonClicked(event){event.preventDefault();this.showDrawer(true)},onCloseClicked:function onCloseClicked(event){event.preventDefault();this.hideDrawer()},onCloseDrawer:function onCloseDrawer($toElement){this.hideDrawer($toElement)},toggleDrawer:function toggleDrawer(){if(this._isVisible&&this._isCustomViewVisible===false){this.hideDrawer()}else{this.showDrawer(true)}},showDrawer:function showDrawer(emptyDrawer){this.$el.removeClass("display-none").removeAttr("aria-hidden");if(!this._isVisible){Adapt.a11y.popupOpened(this.$el);Adapt.a11y.scrollDisable("body");this._isVisible=true}var drawerWidth=this.$el.width();this.$("a, button, input, select, textarea").attr("tabindex",0);if(emptyDrawer){this.$(".drawer-back").addClass("display-none");this._isCustomViewVisible=false;this.emptyDrawer();if(this.collection.models.length===1){Adapt.trigger(this.collection.models[0].get("eventCallback"));this._isCustomViewVisible=false}else{this.renderItems();Adapt.trigger("drawer:openedItemView")}}else{if(this._hasBackButton&&this.collection.models.length>1){this.$(".drawer-back").removeClass("display-none")}else{this.$(".drawer-back").addClass("display-none")}Adapt.trigger("drawer:openedCustomView")}if(this.disableAnimation){$("#shadow").removeClass("display-none");var direction={};direction[this.drawerDir]=0;this.$el.css(direction);complete.call(this)}else{$("#shadow").velocity({opacity:1},{duration:this.drawerDuration,begin:_.bind(function(){$("#shadow").removeClass("display-none");complete.call(this)},this)});var showEasingAnimation=Adapt.config.get("_drawer")._showEasing;var easing=showEasingAnimation?showEasingAnimation:"easeOutQuart";var direction={};direction[this.drawerDir]=0;this.$el.velocity(direction,this.drawerDuration,easing)}function complete(){this.addShadowEvent();Adapt.trigger("drawer:opened");Adapt.a11y.focusFirst(this.$el,{defer:true})}},emptyDrawer:function emptyDrawer(){this.$(".drawer-holder").empty()},renderItems:function renderItems(){Adapt.trigger("drawer:empty");this.emptyDrawer();var models=this.collection.models;for(var i=0,len=models.length;i<len;i++){var item=models[i];new DrawerItemView({model:item})}},hideDrawer:function hideDrawer($toElement){if(this._isVisible){Adapt.a11y.popupClosed($toElement);this._isVisible=false;Adapt.a11y.scrollEnable("body")}else{return}if(this.disableAnimation){var direction={};direction[this.drawerDir]=-this.$el.width();this.$el.css(direction).addClass("display-none").attr("aria-hidden","true");$("#shadow").addClass("display-none");Adapt.trigger("drawer:closed")}else{var showEasingAnimation=Adapt.config.get("_drawer")._hideEasing;var easing=showEasingAnimation?showEasingAnimation:"easeOutQuart";var direction={};direction[this.drawerDir]=-this.$el.width();this.$el.velocity(direction,this.drawerDuration,easing,_.bind(function(){this.$el.addClass("display-none").attr("aria-hidden","true");Adapt.trigger("drawer:closed")},this));$("#shadow").velocity({opacity:0},{duration:this.drawerDuration,complete:function complete(){$("#shadow").addClass("display-none")}})}this._isCustomViewVisible=false;this.removeShadowEvent()},addShadowEvent:function addShadowEvent(){$("#shadow").one("click touchstart",_.bind(function(){this.onCloseDrawer()},this))},removeShadowEvent:function removeShadowEvent(){$("#shadow").off("click touchstart")},remove:function remove(){Backbone.View.prototype.remove.apply(this,arguments);$(window).off("keyup",this._onKeyUp);Adapt.trigger("drawer:empty");this.collection.reset();$("#shadow").remove()}});var DrawerItemView=Backbone.View.extend({className:"drawer-item",attributes:{role:"listitem"},initialize:function initialize(){this.listenTo(Adapt,"drawer:empty",this.remove);this.render()},events:{"click .drawer-item-open":"onDrawerItemClicked"},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates["drawerItem"];$(this.el).html(template(data)).appendTo(".drawer-holder");return this},onDrawerItemClicked:function onDrawerItemClicked(event){event.preventDefault();var eventCallback=this.model.get("eventCallback");Adapt.trigger(eventCallback)}});return DrawerView});define("core/js/drawer",["core/js/adapt","core/js/views/drawerView"],function(Adapt,DrawerView){var DrawerCollection=new Backbone.Collection(null,{comparator:"drawerOrder"});var Drawer={};Drawer.addItem=function(drawerObject,eventCallback){drawerObject.eventCallback=eventCallback;DrawerCollection.add(drawerObject)};Drawer.triggerCustomView=function(view,hasBackButton){if(hasBackButton!==false){hasBackButton=true}Adapt.trigger("drawer:triggerCustomView",view,hasBackButton)};Adapt.on({"adapt:start":function adaptStart(){new DrawerView({collection:DrawerCollection})},"app:languageChanged":function appLanguageChanged(){Adapt.trigger("drawer:remove")}});Adapt.drawer=Drawer});define("core/js/views/notifyPushView",["core/js/adapt"],function(Adapt){var NotifyPushView=Backbone.View.extend({className:function className(){var classes="notify-push ";classes+=this.model.get("_classes")||"";return classes},attributes:{"role":"dialog","aria-labelledby":"notify-push-heading","aria-modal":"false"},initialize:function initialize(){this.listenTo(Adapt,{"notify:pushShown notify:pushRemoved":this.updateIndexPosition,"remove":this.remove});this.listenTo(this.model.collection,{"remove":this.updateIndexPosition,"change:_index":this.updatePushPosition});this.preRender();this.render()},events:{"click .notify-push-close":"closePush","click .notify-push-inner":"triggerEvent"},preRender:function preRender(){this.hasBeenRemoved=false},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates["notifyPush"];this.$el.html(template(data)).appendTo("#wrapper");_.defer(this.postRender.bind(this));return this},postRender:function postRender(){this.$el.addClass("show");_.delay(this.closePush.bind(this),this.model.get("_timeout"));Adapt.trigger("notify:pushShown")},closePush:function closePush(event){if(event){event.preventDefault()}if(this.hasBeenRemoved===false){this.hasBeenRemoved=true;this.$el.removeClass("show");_.delay(function(){this.model.collection.remove(this.model);Adapt.trigger("notify:pushRemoved",this);this.remove()}.bind(this),600)}},triggerEvent:function triggerEvent(event){Adapt.trigger(this.model.get("_callbackEvent"));this.closePush()},updateIndexPosition:function updateIndexPosition(){if(!this.hasBeenRemoved){var models=this.model.collection.models;for(var i=0,len=models.length;i<len;i++){var index=i;var model=models[i];if(model.get("_isActive")===true){model.set("_index",index);this.updatePushPosition()}}}},updatePushPosition:function updatePushPosition(){if(this.hasBeenRemoved){return}if(this.model.get("_index")!=undefined){var elementHeight=this.$el.height();var offset=20;var navigationHeight=$(".navigation").height();var currentIndex=this.model.get("_index");var flippedIndex=currentIndex==0?1:0;if(this.model.collection.where({_isActive:true}).length===1){flippedIndex=0}var positionLowerPush=(elementHeight+offset)*flippedIndex+navigationHeight+offset;this.$el.css("top",positionLowerPush)}}});return NotifyPushView});define("core/js/models/notifyModel",[],function(){var NotifyModel=Backbone.Model.extend({defaults:{_isActive:false,_showIcon:false,_timeout:3000}});return NotifyModel});define("core/js/collections/notifyPushCollection",["core/js/adapt","core/js/views/notifyPushView","core/js/models/notifyModel"],function(Adapt,NotifyPushView,NotifyModel){var NotifyPushCollection=Backbone.Collection.extend({model:NotifyModel,initialize:function initialize(){this.listenTo(this,"add",this.onPushAdded);this.listenTo(Adapt,"notify:pushRemoved",this.onRemovePush)},onPushAdded:function onPushAdded(model){this.checkPushCanShow(model)},checkPushCanShow:function checkPushCanShow(model){if(this.canShowPush()){model.set("_isActive",true);this.showPush(model)}},canShowPush:function canShowPush(){var availablePushNotifications=this.where({_isActive:true});if(availablePushNotifications.length>=2){return false}return true},showPush:function showPush(model){new NotifyPushView({model:model})},onRemovePush:function onRemovePush(view){var inactivePushNotifications=this.where({_isActive:false});if(inactivePushNotifications.length>0){this.checkPushCanShow(inactivePushNotifications[0])}}});return NotifyPushCollection});define("core/js/views/notifyView",["core/js/adapt"],function(Adapt){var NotifyView=Backbone.View.extend({className:function className(){var classes="notify ";classes+=this.model.get("_classes")||"";return classes},attributes:{"role":"dialog","aria-labelledby":"notify-heading","aria-modal":"true"},disableAnimation:false,isOpen:false,hasOpened:false,initialize:function initialize(){this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this.setupEventListeners();this.render()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"remove page:scrollTo":this.closeNotify,"notify:resize":this.resetNotifySize,"notify:cancel":this.cancelNotify,"notify:close":this.closeNotify,"device:resize":this.resetNotifySize});this._onKeyUp=this.onKeyUp.bind(this);this.setupEscapeKey()},setupEscapeKey:function setupEscapeKey(){$(window).on("keyup",this._onKeyUp)},onKeyUp:function onKeyUp(event){if(event.which!=27)return;event.preventDefault();this.cancelNotify()},events:{"click .notify-popup-alert-button":"onAlertButtonClicked","click .notify-popup-prompt-button":"onPromptButtonClicked","click .notify-popup-done":"onCloseButtonClicked","click .notify-shadow":"onShadowClicked"},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates.notify;this.$el.css("visibility","hidden");this.$el.html(template(data)).prependTo("body");this.$(".notify-popup").css("visibility","hidden");this.$el.css("visibility","visible");this.showNotify();return this},onAlertButtonClicked:function onAlertButtonClicked(event){event.preventDefault();this.closeNotify();Adapt.trigger(this.model.get("_callbackEvent"),this)},onPromptButtonClicked:function onPromptButtonClicked(event){event.preventDefault();this.closeNotify();Adapt.trigger($(event.currentTarget).attr("data-event"),this)},onCloseButtonClicked:function onCloseButtonClicked(event){event.preventDefault();this.cancelNotify()},onShadowClicked:function onShadowClicked(event){event.preventDefault();if(this.model.get("_closeOnShadowClick")===false)return;this.cancelNotify()},cancelNotify:function cancelNotify(){if(this.model.get("_isCancellable")===false)return;this.closeNotify();Adapt.trigger("notify:cancelled",this)},resetNotifySize:function resetNotifySize(){$(".notify-popup").removeAttr("style");this.resizeNotify()},resizeNotify:function resizeNotify(){var windowHeight=$(window).height();var notifyHeight=this.$(".notify-popup").outerHeight();if(notifyHeight>windowHeight){this.$(".notify-popup").css({"height":"100%","top":0,"overflow-y":"scroll","-webkit-overflow-scrolling":"touch"})}else{this.$(".notify-popup").css({"margin-top":-(notifyHeight/2)})}},showNotify:function showNotify(){this.isOpen=true;this.addSubView();this.$previousActiveElement=$(document.activeElement);Adapt.trigger("notify:opened",this);this.$el.imageready(this.onLoaded.bind(this))},onLoaded:function onLoaded(){if(this.disableAnimation){this.$(".notify-shadow").css("display","block")}else{this.$(".notify-shadow").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:function(){this.$(".notify-shadow").css("display","block")}.bind(this)})}this.resizeNotify();if(this.disableAnimation){this.$(".notify-popup").css("visibility","visible");this.onOpened()}else{this.$(".notify-popup").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:function(){this.$(".notify-popup").css("visibility","visible");this.onOpened()}.bind(this)})}},onOpened:function onOpened(){this.hasOpened=true;Adapt.a11y.popupOpened(this.$(".notify-popup"));Adapt.a11y.scrollDisable("body");$("html").addClass("notify");Adapt.a11y.focusFirst(this.$(".notify-popup"),{defer:false})},addSubView:function addSubView(){this.subView=this.model.get("_view");if(!this.subView)return;this.$(".notify-popup-content-inner").append(this.subView.$el)},closeNotify:function closeNotify(event){if(!this.isOpen)return;this.isOpen=false;if(!this.hasOpened){this.listenToOnce(Adapt,"popup:opened",function(){_.defer(this.onCloseReady.bind(this))})}else{this.onCloseReady()}},onCloseReady:function onCloseReady(){if(this.disableAnimation){this.$(".notify-popup").css("visibility","hidden");this.$el.css("visibility","hidden");this.remove()}else{this.$(".notify-popup").velocity({opacity:0},{duration:400,complete:function(){this.$(".notify-popup").css("visibility","hidden")}.bind(this)});this.$(".notify-shadow").velocity({opacity:0},{duration:400,complete:function(){this.$el.css("visibility","hidden");this.remove()}.bind(this)})}Adapt.a11y.scrollEnable("body");$("html").removeClass("notify");Adapt.a11y.popupClosed(this.$previousActiveElement);Adapt.trigger("notify:closed",this)},remove:function remove(){this.removeSubView();$(window).off("keyup",this._onKeyUp);Backbone.View.prototype.remove.apply(this,arguments)},removeSubView:function removeSubView(){if(!this.subView)return;this.subView.remove();this.subView=null}});return NotifyView});define("core/js/notify",["core/js/adapt","core/js/collections/notifyPushCollection","core/js/views/notifyView","core/js/models/notifyModel"],function(Adapt,NotifyPushCollection,NotifyView,NotifyModel){var Notify=Backbone.Controller.extend({notifyPushes:null,_warnFirstOnly:true,_warn:true,_hasWarned:false,initialize:function initialize(){this.notifyPushes=new NotifyPushCollection;this.listenTo(Adapt,{"notify:popup":this._deprecated.bind(this,"popup"),"notify:alert":this._deprecated.bind(this,"alert"),"notify:prompt":this._deprecated.bind(this,"prompt"),"notify:push":this._deprecated.bind(this,"push")})},_deprecated:function _deprecated(type,notifyObject){if(this._warn&&this._warnFirstOnly&&!this._hasWarned){Adapt.log.warn("NOTIFY DEPRECATED: Adapt.trigger('notify:"+type+"', notifyObject); is no longer supported, please use Adapt.notify."+type+"(notifyObject);");this._hasWarned=true}return this.create(notifyObject,{_type:type})},create:function create(notifyObject,defaults){notifyObject=_.defaults({},notifyObject,defaults,{_type:"popup",_isCancellable:true,_showCloseButton:true,_closeOnShadowClick:true});if(notifyObject._type==="push"){this.notifyPushes.push(notifyObject);return}return new NotifyView({model:new NotifyModel(notifyObject)})},popup:function popup(notifyObject){return this.create(notifyObject,{_type:"popup"})},alert:function alert(notifyObject){return this.create(notifyObject,{_type:"alert"})},prompt:function prompt(notifyObject){return this.create(notifyObject,{_type:"prompt"})},push:function push(notifyObject){return this.create(notifyObject,{_type:"push"})}});return Adapt.notify=new Notify});define("core/js/models/routerModel",["core/js/adapt"],function(Adapt){var RouterModel=Backbone.Model.extend({defaults:{_canNavigate:true,_shouldNavigateFocus:true},lockedAttributes:{_canNavigate:false,_shouldNavigateFocus:false}});return RouterModel});define("core/js/views/adaptView",["core/js/adapt"],function(Adapt){var AdaptView=Backbone.View.extend({attributes:function attributes(){return{"data-adapt-id":this.model.get("_id")}},initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.listenTo(this.model,{"change:_isVisible":this.toggleVisibility,"change:_isHidden":this.toggleHidden,"change:_isComplete":this.onIsCompleteChange});this.model.set({"_globals":Adapt.course.get("_globals"),"_isReady":false});this._isRemoved=false;if(Adapt.location._currentId===this.model.get("_id")){Adapt.parentView=this}this.preRender();this.render();this.setupOnScreenHandler()},preRender:function preRender(){},postRender:function postRender(){this.addChildren()},render:function render(){Adapt.trigger(this.constructor.type+"View:preRender",this);var data=this.model.toJSON();data.view=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data));Adapt.trigger(this.constructor.type+"View:render",this);_.defer(function(){if(this._isRemoved)return;this.postRender();Adapt.trigger(this.constructor.type+"View:postRender",this)}.bind(this));return this},setupOnScreenHandler:function setupOnScreenHandler(){var onscreen=this.model.get("_onScreen");if(!onscreen||!onscreen._isEnabled)return;this.$el.on("onscreen.adaptView",function(e,m){if(!m.onscreen)return;var minVerticalInview=onscreen._percentInviewVertical||33;if(m.percentInviewVertical<minVerticalInview)return;this.$el.addClass(onscreen._classes||"onscreen").off("onscreen.adaptView")}.bind(this))},addChildren:function addChildren(){var nthChild=0;var children=this.model.getChildren();var models=children.models;this.childViews={};for(var i=0,len=models.length;i<len;i++){var model=models[i];if(!model.get("_isAvailable"))continue;nthChild++;model.set("_nthChild",nthChild);var ViewModelObject=this.constructor.childView||Adapt.componentStore[model.get("_component")];var ChildView=ViewModelObject.view||ViewModelObject;if(!ChildView){throw"The component '"+models[i].attributes._id+"'"+" ('"+models[i].attributes._component+"')"+" has not been installed, and so is not available in your project."}var $parentContainer=this.$(this.constructor.childContainer);var childView=new ChildView({model:model});this.childViews[model.get("_id")]=childView;$parentContainer.append(childView.$el)}},findDescendantViews:function findDescendantViews(isParentFirst){var descendants=[];this.childViews&&_.each(this.childViews,function(view){if(isParentFirst)descendants.push(view);var children=view.findDescendantViews&&view.findDescendantViews(isParentFirst);if(children)descendants.push.apply(descendants,children);if(!isParentFirst)descendants.push(view)});return descendants},setReadyStatus:function setReadyStatus(){this.model.set("_isReady",true)},setCompletionStatus:function setCompletionStatus(){if(this.model.get("_isVisible")){this.model.set({"_isComplete":true,"_isInteractionComplete":true})}},resetCompletionStatus:function resetCompletionStatus(type){if(!this.model.get("_canReset"))return;var descendantComponents=this.model.findDescendantModels("components");if(descendantComponents.length===0){this.model.reset(type)}else{_.each(descendantComponents,function(model){model.reset(type)})}},preRemove:function preRemove(){},remove:function remove(){this.preRemove();this._isRemoved=true;Adapt.wait.for(function(end){this.$el.off("onscreen.adaptView");this.model.setOnChildren("_isReady",false);this.model.set("_isReady",false);Backbone.View.prototype.remove.call(this);end()}.bind(this));return this},setVisibility:function setVisibility(){var visible="visibility-hidden";if(this.model.get("_isVisible")){visible=""}return visible},toggleVisibility:function toggleVisibility(){if(this.model.get("_isVisible")){return this.$el.removeClass("visibility-hidden")}this.$el.addClass("visibility-hidden")},setHidden:function setHidden(){var hidden="";if(this.model.get("_isHidden")){hidden="display-none"}return hidden},toggleHidden:function toggleHidden(){if(!this.model.get("_isHidden")){return this.$el.removeClass("display-none")}this.$el.addClass("display-none")},onIsCompleteChange:function onIsCompleteChange(model,isComplete){this.$el.toggleClass("completed",isComplete)},getChildViews:function getChildViews(){return this.childViews}});return AdaptView});define("core/js/views/blockView",["core/js/views/adaptView"],function(AdaptView){var BlockView=AdaptView.extend({className:function className(){return"block "+this.model.get("_id")+" "+this.model.get("_classes")+" "+this.setVisibility()+" "+this.setHidden()+" nth-child-"+this.model.get("_nthChild")+" "+(this.model.get("_isComplete")?"completed":"")}},{childContainer:".component-container",type:"block",template:"block"});return BlockView});define("core/js/views/articleView",["core/js/views/adaptView","core/js/views/blockView"],function(AdaptView,BlockView){var ArticleView=AdaptView.extend({className:function className(){return"article "+this.model.get("_id")+" "+this.model.get("_classes")+" "+this.setVisibility()+" "+this.setHidden()+" nth-child-"+this.model.get("_nthChild")+" "+(this.model.get("_isComplete")?"completed":"")}},{childContainer:".block-container",childView:BlockView,type:"article",template:"article"});return ArticleView});define("core/js/views/pageView",["core/js/adapt","core/js/views/adaptView","core/js/views/articleView"],function(Adapt,AdaptView,ArticleView){var PageView=AdaptView.extend({attributes:function attributes(){return AdaptView.resultExtend("attributes",{"aria-labelledby":this.model.get("_id")+"-heading","role":"main"},this)},className:function className(){return"page "+this.model.get("_id")+" "+this.model.get("_classes")+" "+this.setVisibility()+" "+(this.model.get("_isComplete")?"completed":"")},preRender:function preRender(){$.inview.lock("pageView");this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this.$el.css("opacity",0);this.listenTo(this.model,"change:_isReady",this.isReady)},isReady:function isReady(){if(!this.model.get("_isReady"))return;var performIsReady=function(){$(".loading").hide();$(window).scrollTop(0);Adapt.trigger("pageView:ready",this);$.inview.unlock("pageView");var styleOptions={opacity:1};if(this.disableAnimation){this.$el.css(styleOptions);$.inview()}else{this.$el.velocity(styleOptions,{duration:"fast",complete:function complete(){$.inview()}})}$(window).scroll()}.bind(this);Adapt.wait.queue(function(){_.defer(performIsReady)})},remove:function remove(){if(this.$pageLabel){this.$pageLabel.remove()}AdaptView.prototype.remove.call(this)}},{childContainer:".article-container",childView:ArticleView,type:"page",template:"page"});return PageView});define("core/js/router",["core/js/adapt","core/js/models/routerModel","core/js/views/pageView","core/js/startController"],function(Adapt,RouterModel,PageView){Adapt.router=new RouterModel(null,{reset:true});var Router=Backbone.Router.extend({_isCircularNavigationInProgress:false,initialize:function initialize(){this.showLoading();this.$wrapper=$("#wrapper");this.$html=$("html");Adapt.once("app:dataReady",function(){document.title=Adapt.course.get("title")});this.listenTo(Adapt,{"navigation:backButton":this.navigateToPreviousRoute,"navigation:homeButton":this.navigateToHomeRoute,"navigation:skipNavigation":this.skipNavigation,"navigation:parentButton":this.navigateToParent,"router:navigateTo":this.navigateToArguments})},routes:{"":"handleRoute","id/:id":"handleRoute",":pluginName(/*location)(/*action)":"handleRoute"},pruneArguments:function pruneArguments(args){var prunedArgs=_.toArray(args);if(prunedArgs.length!==0){prunedArgs=_.without(args,null)}return prunedArgs},handleRoute:function handleRoute(){var args=this.pruneArguments(arguments);if(Adapt.router.get("_canNavigate")){this._isCircularNavigationInProgress=false}if(this._isCircularNavigationInProgress===false){Adapt.trigger("router:navigate",args)}if(Adapt.router.get("_canNavigate")){Adapt.router.set("_canNavigate",false,{pluginName:"adapt"});switch(args.length){case 1:return this.handleId.apply(this,args);case 2:return this.handlePluginRouter.apply(this,args);default:return this.handleCourse();}}if(this._isCircularNavigationInProgress){this._isCircularNavigationInProgress=false;return}this._isCircularNavigationInProgress=true;Adapt.trigger("router:navigationCancelled",args);this.navigateToCurrentRoute(true)},handlePluginRouter:function handlePluginRouter(pluginName,location,action){var pluginLocation=pluginName;if(location){pluginLocation=pluginLocation+"-"+location;if(action){pluginLocation=pluginLocation+"-"+action}}this.updateLocation(pluginLocation,null,null,function(){Adapt.trigger("router:plugin:"+pluginName,pluginName,location,action);Adapt.trigger("router:plugin",pluginName,location,action);Adapt.router.set("_canNavigate",true,{pluginName:"adapt"})})},handleCourse:function handleCourse(){if(Adapt.course.has("_start")){var startController=Adapt.course.get("_start");if(startController._isEnabled==true&&startController._isMenuDisabled==true){return}}this.showLoading();this.removeViews(_.bind(function(){Adapt.course.set("_isReady",false);this.setContentObjectToVisited(Adapt.course);this.updateLocation("course",null,null,_.bind(function(){Adapt.once("menuView:ready",function(){Adapt.router.set("_canNavigate",true,{pluginName:"adapt"});this.handleNavigationFocus()}.bind(this));Adapt.trigger("router:menu",Adapt.course)},this))},this))},handleId:function handleId(id){var currentModel=Adapt.findById(id);var type="";if(!currentModel){Adapt.router.set("_canNavigate",true,{pluginName:"adapt"});return}type=currentModel.get("_type");switch(type){case"page":case"menu":if(currentModel.get("_isLocked")&&Adapt.config.get("_forceRouteLocking")){Adapt.log.warn("Unable to navigate to locked id: "+id);Adapt.router.set("_canNavigate",true,{pluginName:"adapt"});if(Adapt.location._previousId===undefined){return this.navigate("#/",{trigger:true,replace:true})}else{return Backbone.history.history.back()}}else{this.showLoading();this.removeViews(_.bind(function(){this.setContentObjectToVisited(currentModel);if(type=="page"){var location="page-"+id;this.updateLocation(location,"page",id,_.bind(function(){Adapt.once("pageView:ready",function(){Adapt.router.set("_canNavigate",true,{pluginName:"adapt"});this.handleNavigationFocus()}.bind(this));Adapt.trigger("router:page",currentModel);this.$wrapper.append(new PageView({model:currentModel}).$el)},this))}else{var location="menu-"+id;this.updateLocation(location,"menu",id,_.bind(function(){Adapt.once("menuView:ready",function(){Adapt.router.set("_canNavigate",true,{pluginName:"adapt"});this.handleNavigationFocus()}.bind(this));Adapt.trigger("router:menu",currentModel)},this))}},this))}break;default:Adapt.router.set("_canNavigate",true,{pluginName:"adapt"});Adapt.navigateToElement("."+id,{replace:true});}},removeViews:function removeViews(onComplete){Adapt.remove();Adapt.wait.queue(onComplete)},showLoading:function showLoading(){$(".loading").show()},navigateToArguments:function navigateToArguments(args){args=this.pruneArguments(args);var options={trigger:false,replace:false};switch(args.length){case 0:this.navigate("#/",options);break;case 1:if(Adapt.findById(args[0])){this.navigate("#/id/"+args[0],options)}else{this.navigate("#/"+args[0],options)}break;case 2:case 3:this.navigate("#/"+args.join("/"),options);break;default:Adapt.log.warn("DEPRECATED - use Backbone.history.navigate or "+"window.location.href instead of Adapt.trigger(\"router:navigateTo\")");this.handleRoute.apply(this,args);}},skipNavigation:function skipNavigation(){Adapt.a11y.focusFirst("."+Adapt.location._contentType)},navigateToPreviousRoute:function navigateToPreviousRoute(force){if(Adapt.router.get("_canNavigate")||force){if(!Adapt.location._currentId){return Backbone.history.history.back()}if(Adapt.location._previousContentType==="page"&&Adapt.location._contentType==="menu"){return this.navigateToParent()}if(Adapt.location._previousContentType==="page"){return Backbone.history.history.back()}if(Adapt.location._currentLocation==="course"){return}this.navigateToParent()}},navigateToHomeRoute:function navigateToHomeRoute(force){if(Adapt.router.get("_canNavigate")||force){this.navigate("#/",{trigger:true})}},navigateToCurrentRoute:function navigateToCurrentRoute(force){if(Adapt.router.get("_canNavigate")||force){if(!Adapt.location._currentId){return}var currentId=Adapt.location._currentId;var route=currentId===Adapt.course.get("_id")?"#/":"#/id/"+currentId;this.navigate(route,{trigger:true,replace:true})}},navigateToParent:function navigateToParent(force){if(Adapt.router.get("_canNavigate")||force){var parentId=Adapt.contentObjects.findWhere({_id:Adapt.location._currentId}).get("_parentId");var route=parentId===Adapt.course.get("_id")?"#/":"#/id/"+parentId;this.navigate(route,{trigger:true})}},setContentObjectToVisited:function setContentObjectToVisited(model){model.set("_isVisited",true)},updateLocation:function updateLocation(currentLocation,type,id,onComplete){Adapt.location._previousId=Adapt.location._currentId;Adapt.location._previousContentType=Adapt.location._contentType;if(currentLocation==="course"){Adapt.location._currentId=Adapt.course.get("_id");Adapt.location._contentType="menu";Adapt.location._lastVisitedMenu=currentLocation}else if(!type){Adapt.location._currentId=null;Adapt.location._contentType=null}else if(_.isString(id)){Adapt.location._currentId=id;Adapt.location._contentType=type;if(type==="menu"){Adapt.location._lastVisitedType="menu";Adapt.location._lastVisitedMenu=id}else if(type==="page"){Adapt.location._lastVisitedType="page";Adapt.location._lastVisitedPage=id}}Adapt.location._currentLocation=currentLocation;var locationModel=Adapt.findById(id)||Adapt.course;var htmlClassName=locationModel&&locationModel.get("_htmlClassName")||"";var classes=Adapt.location._currentId?"location-"+Adapt.location._contentType+" location-id-"+Adapt.location._currentId:"location-"+Adapt.location._currentLocation;var previousClasses=Adapt.location._previousClasses;if(previousClasses){this.$html.removeClass(previousClasses)}Adapt.location._previousClasses=classes+" "+htmlClassName;this.$html.addClass(classes).addClass(htmlClassName).attr("data-location",Adapt.location._currentLocation);this.$wrapper.removeClass().addClass(classes).attr("data-location",Adapt.location._currentLocation);this.setDocumentTitle();Adapt.trigger("router:location",Adapt.location);Adapt.wait.queue(onComplete)},setDocumentTitle:function setDocumentTitle(){if(!Adapt.location._currentId)return;var currentModel=Adapt.findById(Adapt.location._currentId);var pageTitle="";if(currentModel&&currentModel.get("_type")!=="course"){var currentTitle=currentModel.get("title");if(currentTitle){pageTitle=" | "+currentTitle}}var courseTitle=Adapt.course.get("title");var documentTitle=$("<div>"+courseTitle+pageTitle+"</div>").text();Adapt.once("pageView:ready menuView:ready",function(){document.title=documentTitle})},handleNavigationFocus:function handleNavigationFocus(){if(!Adapt.router.get("_shouldNavigateFocus"))return;Adapt.a11y.focus("body")}});return new Router({model:new Backbone.Model})});define("core/js/helpers",["handlebars","core/js/adapt"],function(Handlebars,Adapt){var defaultAriaLevels={"_menu":1,"_menuItem":2,"_page":1,"_article":2,"_block":3,"_component":4,"_componentItem":5,"_notify":1};var helpers={lowercase:function lowercase(text){return text.toLowerCase()},capitalise:function capitalise(text){return text.charAt(0).toUpperCase()+text.slice(1)},inc:function inc(index){return index+1},dec:function dec(index){return index-1},odd:function odd(index){return(index+1)%2===0?"even":"odd"},equals:function equals(value,text,block){return helpers.compare.call(this,value,"==",text,block)},compare:function compare(value,operator,text,block){switch(operator){case"===":if(value===text)return block.fn(this);break;case"=":case"==":if(value==text)return block.fn(this);break;case">=":if(value>=text)return block.fn(this);break;case"<=":if(value<=text)return block.fn(this);break;case">":if(value>text)return block.fn(this);break;case"<":if(value<text)return block.fn(this);break;}return block.inverse(this)},math:function math(lvalue,operator,rvalue,options){lvalue=parseFloat(lvalue);rvalue=parseFloat(rvalue);switch(operator){case"+":return lvalue+rvalue;case"-":return lvalue-rvalue;case"*":return lvalue*rvalue;case"/":return lvalue/rvalue;case"%":return lvalue%rvalue;}},any:function any(){var args=Array.prototype.slice.call(arguments,0,-1);var block=Array.prototype.slice.call(arguments,-1)[0];return _.any(args)?block.fn(this):block.inverse(this)},all:function all(){var args=Array.prototype.slice.call(arguments,0,-1);var block=Array.prototype.slice.call(arguments,-1)[0];return _.all(args)?block.fn(this):block.inverse(this)},compile:function compile(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();var data=this;if(context){data=!context.data||!context.data.root?context:context.data.root}return Handlebars.compile(template)(data)},compile_a11y_text:function compile_a11y_text(template,context){Adapt.a11y.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return helpers.compile.call(this,template,context)},compile_a11y_normalize:function compile_a11y_normalize(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();return Handlebars.helpers.a11y_normalize.call(this,helpers.compile.call(this,template,context))},compile_a11y_remove_breaks:function compile_a11y_remove_breaks(template,context){if(!template){return""}return Handlebars.helpers.a11y_remove_breaks.call(this,helpers.compile.call(this,template,context))},import_globals:function import_globals(context){if(context.data.root._globals){return""}context.data.root._globals=Adapt.course.get("_globals");return""},import_adapt:function import_adapt(context){if(context.data.root.Adapt){return}var adapt=context.data.root.Adapt={};var i,l,name;var directImport=["config","course"];for(i=0,l=directImport.length;i<l;i++){name=directImport[i];adapt[name]=Adapt[name].toJSON()}var indexedImport=["contentObjects","articles","blocks","components"];for(i=0,l=indexedImport.length;i<l;i++){name=indexedImport[i];var importArray=Adapt[name].toJSON();var importIndex={};for(var i1=0,l1=importArray.length;i1<l1;i1++){var item=importArray[i1];importIndex[item._id]=item}adapt[name]=importIndex}return""},component_description:function component_description(override,context){if(!this._isA11yComponentDescriptionEnabled){return}var isNotDefined=!this._globals._components||!this._globals._components["_"+this._component];if(isNotDefined){return}var hasOverride=arguments.length>1;var description;if(hasOverride){description=override;description=helpers.compile(description,context)}else{description=this._globals._components["_"+this._component].ariaRegion;description=helpers.compile(description,override)}if(!description){return}return new Handlebars.SafeString("<div class=\"aria-label\">"+description+"</div>")},a11y_text:function a11y_text(text){Adapt.a11y.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_normalize:function a11y_normalize(htmls){return Adapt.a11y.normalize.apply(Adapt.a11y,arguments)},a11y_remove_breaks:function a11y_remove_breaks(htmls){return Adapt.a11y.removeBreaks.apply(Adapt.a11y,arguments)},a11y_aria_label:function a11y_aria_label(htmls){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\">"+values.join(" ")+"</div>")},a11y_aria_label_relative:function a11y_aria_label_relative(htmls){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label relative\">"+values.join(" ")+"</div>")},a11y_aria_image:function a11y_aria_image(texts){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\" role=\"img\" aria-label=\""+values.join(" ")+"\"></div>")},a11y_wrap_focus:function a11y_wrap_focus(){var cfg=Adapt.config.get("_accessibility");if(cfg._isPopupWrapFocusEnabled===false)return"";return new Handlebars.SafeString("<a class=\"a11y-focusguard a11y-ignore a11y-ignore-focus\" role=\"presentation\">&nbsp;</a>")},a11y_attrs_heading:function a11y_attrs_heading(levelOrType){var cfg=Adapt.config.get("_accessibility");var level=1;if(this._ariaLevel){levelOrType=this._ariaLevel}if(isNaN(levelOrType)===false){level=levelOrType}else if(_.isString(levelOrType)){cfg._ariaLevels=cfg._ariaLevels||defaultAriaLevels;if(cfg._ariaLevels&&cfg._ariaLevels["_"+levelOrType]!==undefined){level=cfg._ariaLevels["_"+levelOrType]}}return new Handlebars.SafeString(" role=\"heading\" aria-level=\""+level+"\" ")},a11y_attrs_tabbable:function a11y_attrs_tabbable(){Adapt.a11y.log.deprecated("a11y_attrs_tabbable should not be used. tabbable elements should be natively tabbable.");return new Handlebars.SafeString(" role=\"region\" tabindex=\"0\" ")},a11y_alt_text:function a11y_alt_text(visible,alternatives){var values=Array.prototype.slice.call(arguments,1,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<span aria-hidden=\"true\">"+visible+"</span><span class=\"aria-label\">"+values.join(" ")+"</span>")}};_.extend(helpers,{if_value_equals:function if_value_equals(){Adapt.a11y.log.deprecated("if_value_equals, use equals instead.");return helpers.equals.apply(this,arguments)},numbers:function numbers(){Adapt.a11y.log.deprecated("numbers, use inc instead.");return helpers.inc.apply(this,arguments)},lowerCase:function lowerCase(){Adapt.a11y.log.deprecated("lowerCase, use lowercase instead.");return helpers.lowercase.apply(this,arguments)}});for(var name in helpers){if(!helpers.hasOwnProperty(name))continue;Handlebars.registerHelper(name,helpers[name])}return helpers});define("core/js/scrolling",["core/js/adapt"],function(Adapt){var Scrolling=Backbone.Controller.extend({$html:null,$app:null,isLegacyScrolling:true,initialize:function initialize(){this._checkApp();Adapt.once("configModel:dataLoaded",this._loadConfig.bind(this))},_checkApp:function _checkApp(){this.$html=$("html");this.$app=$("#app");if(this.$app.length)return;this.$app=$("<div id=\"app\">");$("body").append(this.$app);this.$app.append($("#wrapper"));Adapt.log.warn("UPDATE - Your html file needs to have #app adding. See https://github.com/adaptlearning/adapt_framework/issues/2168")},_loadConfig:function _loadConfig(){var config=Adapt.config.get("_scrollingContainer");if(!config||!config._isEnabled)return;var limitTo=config._limitToSelector;var isIncluded=!limitTo||this.$html.is(limitTo)||this.$html.hasClass(limitTo);if(!isIncluded)return;this.isLegacyScrolling=false;this._addStyling();this._fixJQuery();this._fixScrollTo();this._fixBrowser()},_addStyling:function _addStyling(){this.$html.addClass("adapt-scrolling")},_fixJQuery:function _fixJQuery(){var selectorScrollTop=$.fn.scrollTop;var $app=Adapt.scrolling.$app;$.fn.scrollTop=function(){if(this[0]===window||this[0]===document.body){return selectorScrollTop.apply($app,arguments)}return selectorScrollTop.apply(this,arguments)};var selectorOffset=$.fn.offset;$.fn.offset=function(coordinates){if(coordinates){return selectorOffset.apply(this,arguments)}var $app=Adapt.scrolling.$app;var $element=this;var elementOffset=selectorOffset.call($element);var isCorrectedContainer=$element.parents().add($element).filter("html,body,#app").length;if(!isCorrectedContainer){return elementOffset}var scrollTop=parseInt($app.scrollTop());var scrollLeft=parseInt($app.scrollLeft());var appOffset=selectorOffset.call($app);elementOffset.top+=scrollTop-appOffset.top;elementOffset.left+=scrollLeft-appOffset.left;return elementOffset}},_fixScrollTo:function _fixScrollTo(){var selectorScrollTo=$.fn.scrollTo;var scrollTo=$.scrollTo;var $app=Adapt.scrolling.$app;$.fn.scrollTo=function(target,duration,settings){if(this[0]===window||this[0]===document.body){return selectorScrollTo.apply($app,arguments)}return selectorScrollTo.apply(this,arguments)};$.scrollTo=function(target,duration,settings){return selectorScrollTo.apply($app,arguments)};_.extend($.scrollTo,scrollTo)},_fixBrowser:function _fixBrowser(){var app=Adapt.scrolling.$app[0];window.scrollTo=function(x,y){app.scrollTop=y||0;app.scrollLeft=x||0};var $window=$(window);this.$app.on("scroll",function(){$window.scroll()})}});Adapt.scrolling=new Scrolling;Adapt.scrollTo=function(selector,settings){var location=Adapt.location._contentType?Adapt.location._contentType:Adapt.location._currentLocation;Adapt.trigger(location+":scrollTo",selector);var settings=settings||{};var disableScrollToAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;if(disableScrollToAnimation){settings.duration=0}else if(!settings.duration){settings.duration=$.scrollTo.defaults.duration}var offsetTop=0;if(Adapt.scrolling.isLegacyScrolling){offsetTop=-$(".navigation").outerHeight();if($(selector).hasClass("component")){offsetTop-=$(selector).find(".aria-label").height()||0}}if(!settings.offset)settings.offset={top:offsetTop,left:0};if(settings.offset.top===undefined)settings.offset.top=offsetTop;if(settings.offset.left===undefined)settings.offset.left=0;if(settings.offset.left===0)settings.axis="y";if(Adapt.get("_canScroll")!==false){$.scrollTo(selector,settings)}_.delay(function(){Adapt.a11y.focusNext(selector);Adapt.trigger(location+":scrolledTo",selector)},settings.duration+300)}});define("core/js/views/headingView",["core/js/adapt"],function(Adapt){var HeadingView=Backbone.View.extend({initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.listenTo(this.model,"change:_isComplete",this.render);this.render()},render:function render(){var template=Handlebars.templates[this.constructor.template];var data=this.model.toJSON();var customHeadingType=this.$el.attr("data-a11y-heading-type");if(customHeadingType)data._type=customHeadingType;this.$el.html(template(data));this.checkCompletion()},checkCompletion:function checkCompletion(){var isComplete=this.model.get("_isComplete");this.$el.toggleClass("complete",isComplete).toggleClass("incomplete",!isComplete)}},{template:"heading"});return HeadingView});define("core/js/headings",["./adapt","./views/headingView"],function(Adapt,HeadingView){var Headings=Backbone.Controller.extend({initialize:function initialize(){var types=["menu","page","article","block","component"];var eventNames=types.concat([""]).join("View:render ");this.listenTo(Adapt,eventNames,this.onViewRender)},onViewRender:function onViewRender(view){var $headingSeats=view.$(".js-heading");$headingSeats.each(function(index,el){new HeadingView({el:el,model:view.model})})}});return new Headings});define("core/js/views/navigationView",["core/js/adapt"],function(Adapt){var NavigationView=Backbone.View.extend({className:"navigation",initialize:function initialize(){this.listenToOnce(Adapt,{"courseModel:dataLoading":this.remove});this.listenTo(Adapt,"router:menu router:page",this.hideNavigationButton);this.template="navigation";this.preRender()},events:{"click [data-event]":"triggerEvent"},attributes:{"role":"navigation"},preRender:function preRender(){Adapt.trigger("navigationView:preRender",this);this.render()},render:function render(){var template=Handlebars.templates[this.template];this.$el.html(template({_globals:Adapt.course.get("_globals"),_accessibility:Adapt.config.get("_accessibility")})).insertBefore("#app");_.defer(_.bind(function(){Adapt.trigger("navigationView:postRender",this)},this));return this},triggerEvent:function triggerEvent(event){event.preventDefault();var currentEvent=$(event.currentTarget).attr("data-event");Adapt.trigger("navigation:"+currentEvent)},hideNavigationButton:function hideNavigationButton(model){if(model.get("_type")==="course"){$(".navigation-back-button, .navigation-home-button").addClass("display-none")}else{this.showNavigationButton()}},showNavigationButton:function showNavigationButton(){$(".navigation-back-button, .navigation-home-button").removeClass("display-none")}});return NavigationView});define("core/js/navigation",["core/js/adapt","core/js/views/navigationView"],function(Adapt,NavigationView){var NavigationController=Backbone.Controller.extend({initialize:function initialize(){this.listenTo(Adapt,"adapt:preInitialize",this.addNavigationBar)},addNavigationBar:function addNavigationBar(){var adaptConfig=Adapt.course.get("_navigation");if(adaptConfig&&adaptConfig._isDefaultNavigationDisabled){Adapt.trigger("navigation:initialize");return}Adapt.navigation=new NavigationView}});return new NavigationController});define("core/js/models/itemModel",[],function(){var ItemModel=Backbone.Model.extend({defaults:{_isActive:false,_isVisited:false},reset:function reset(){this.set({_isActive:false,_isVisited:false})},toggleActive:function toggleActive(isActive){if(isActive===undefined){isActive=!this.get("_isActive")}this.set("_isActive",isActive)},toggleVisited:function toggleVisited(isVisited){if(isVisited===undefined){isVisited=!this.get("_isVisited")}this.set("_isVisited",isVisited)}});return ItemModel});define("core/js/models/itemsComponentModel",["core/js/models/componentModel","core/js/models/itemModel"],function(ComponentModel,ItemModel){var ItemsComponentModel=ComponentModel.extend({toJSON:function toJSON(){var json=_.clone(this.attributes);json._items=this.get("_children").toJSON();return json},init:function init(){this.setUpItems();this.listenTo(this.get("_children"),{"change:_isVisited":this.checkCompletionStatus})},setUpItems:function setUpItems(){var items=this.get("_items")||[];items.forEach(function(item,index){item._index=index});this.set("_children",new Backbone.Collection(items,{model:ItemModel}))},getItem:function getItem(index){return this.get("_children").findWhere({_index:index})},getVisitedItems:function getVisitedItems(){return this.get("_children").where({_isVisited:true})},getActiveItems:function getActiveItems(){return this.get("_children").where({_isActive:true})},getActiveItem:function getActiveItem(){return this.get("_children").findWhere({_isActive:true})},areAllItemsCompleted:function areAllItemsCompleted(){return this.getVisitedItems().length===this.get("_children").length},checkCompletionStatus:function checkCompletionStatus(){if(this.areAllItemsCompleted()){this.setCompletionStatus()}},reset:function reset(type,force){this.get("_children").each(function(item){item.reset()});ComponentModel.prototype.reset.call(this,type,force)},resetActiveItems:function resetActiveItems(){this.get("_children").each(function(item){item.toggleActive(false)})},setActiveItem:function setActiveItem(index){var activeItem=this.getActiveItem();if(activeItem)activeItem.toggleActive(false);this.getItem(index).toggleActive(true)}});return ItemsComponentModel});define("components/adapt-contrib-accordion/js/accordionModel",["core/js/models/itemsComponentModel"],function(ItemsComponentModel){var AccordionModel=ItemsComponentModel.extend({defaults:function defaults(){return _.extend({},_.result(ItemsComponentModel.prototype,"defaults"),{_shouldCollapseItems:true,_toggleSpeed:200})},toggleItemsState:function toggleItemsState(index){var item=this.getItem(index);var previousActiveItem=this.getActiveItem();item.toggleActive();item.toggleVisited(true);if(previousActiveItem&&this.get("_shouldCollapseItems")){previousActiveItem.toggleActive(false)}}});return AccordionModel});define("core/js/views/componentView",["core/js/adapt","core/js/views/adaptView"],function(Adapt,AdaptView){var ComponentView=AdaptView.extend({attributes:function attributes(){if(!this.model.get("_isA11yRegionEnabled")){return AdaptView.resultExtend("attributes",{},this)}return AdaptView.resultExtend("attributes",{"aria-labelledby":this.model.get("_id")+"-heading","role":"region"},this)},className:function className(){return["component",this.model.get("_component")+"-component",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),"component-"+this.model.get("_layout"),"nth-child-"+this.model.get("_nthChild"),this.model.get("_isComplete")?"completed":""].join(" ")},renderState:function renderState(){Adapt.log.warn("REMOVED - renderState is removed and moved to item title")},setupInviewCompletion:function setupInviewCompletion(inviewElementSelector,callback){this.$inviewElement=this.$(inviewElementSelector||".component-inner");this.inviewCallback=callback||this.setCompletionStatus;this.$inviewElement.on("inview.componentView",this.onInview.bind(this))},removeInviewListener:function removeInviewListener(){if(!this.$inviewElement)return;this.$inviewElement.off("inview.componentView");this.$inviewElement=null},onInview:function onInview(event,visible,visiblePartX,visiblePartY){if(!visible)return;switch(visiblePartY){case"top":this.hasSeenTop=true;break;case"bottom":this.hasSeenBottom=true;break;case"both":this.hasSeenTop=this.hasSeenBottom=true;}if(!this.hasSeenTop||!this.hasSeenBottom)return;this.inviewCallback();if(this.model.get("_isComplete")){this.removeInviewListener()}},postRender:function postRender(){},remove:function remove(){this.removeInviewListener();AdaptView.prototype.remove.call(this)}},{type:"component"});return ComponentView});define("components/adapt-contrib-accordion/js/accordionView",["core/js/views/componentView"],function(ComponentView){var AccordionView=ComponentView.extend({events:{"click .accordion-item-title":"onClick"},preRender:function preRender(){this.checkIfResetOnRevisit();this.model.resetActiveItems();this.listenTo(this.model.get("_children"),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange})},postRender:function postRender(){this.setReadyStatus();if(this.model.get("_setCompletionOn")==="inview"){this.setupInviewCompletion()}},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},onClick:function onClick(event){event.preventDefault();this.model.toggleItemsState($(event.currentTarget).parent().data("index"))},onItemsActiveChange:function onItemsActiveChange(item,isActive){this.toggleItem(item,isActive)},onItemsVisitedChange:function onItemsVisitedChange(item,isVisited){if(!isVisited)return;var $item=this.getItemElement(item);$item.children(".accordion-item-title").addClass("visited")},toggleItem:function toggleItem(item,shouldExpand){var $item=this.getItemElement(item);var $body=$item.children(".accordion-item-body").stop(true,true);$item.children(".accordion-item-title").toggleClass("selected",shouldExpand).attr("aria-expanded",shouldExpand);$item.find(".accordion-item-title-icon").toggleClass("icon-plus",!shouldExpand).toggleClass("icon-minus",shouldExpand);if(!shouldExpand){$body.slideUp(this.model.get("_toggleSpeed"));return}$body.slideDown(this.model.get("_toggleSpeed"))},getItemElement:function getItemElement(item){var index=item.get("_index");return this.$(".accordion-item").filter("[data-index=\""+index+"\"]")}});return AccordionView});define("components/adapt-contrib-accordion/js/adapt-contrib-accordion",["core/js/adapt","./accordionModel","./accordionView"],function(Adapt,AccordionModel,AccordionView){return Adapt.register("accordion",{model:AccordionModel,view:AccordionView})});define("components/adapt-contrib-assessmentResults/js/adapt-contrib-assessmentResults",["require","coreViews/componentView","coreJS/adapt"],function(require){var ComponentView=require("coreViews/componentView");var Adapt=require("coreJS/adapt");var val="";var AssessmentResults=ComponentView.extend({events:{"inview":"onInview","click .assessmentResults-retry-button button":"onRetry","click .assessmentResults-certificate-button button":"onCertificateClicked"},preRender:function preRender(){this.setupEventListeners();this.setupModelResetEvent();this.checkIfComplete();this.checkIfVisible();val=this.model.get("_id")},checkIfVisible:function checkIfVisible(){var wasVisible=this.model.get("_isVisible");var isVisibleBeforeCompletion=this.model.get("_isVisibleBeforeCompletion")||false;var isVisible=wasVisible&&isVisibleBeforeCompletion;if(!isVisibleBeforeCompletion){var assessmentModel=Adapt.assessment.get(this.model.get("_assessmentId"));if(!assessmentModel||assessmentModel.length===0)return;var state=assessmentModel.getState();var isComplete=state.isComplete;var isAttemptInProgress=state.attemptInProgress;var attemptsSpent=state.attemptsSpent;isVisible=isVisible||isComplete||!isAttemptInProgress&&attemptsSpent>0}this.model.set("_isVisible",isVisible)},checkIfComplete:function checkIfComplete(){var assessmentModel=Adapt.assessment.get(this.model.get("_assessmentId"));if(!assessmentModel||assessmentModel.length===0)return;var state=assessmentModel.getState();var isComplete=state.isComplete;if(isComplete){this.onAssessmentsComplete(state)}else{this.model.reset("hard",true)}},setupModelResetEvent:function setupModelResetEvent(){if(this.model.onAssessmentsReset)return;this.model.onAssessmentsReset=function(state){if(this.get("_assessmentId")===undefined||this.get("_assessmentId")!=state.id)return;this.reset("hard",true)};this.model.listenTo(Adapt,"assessments:reset",this.model.onAssessmentsReset)},postRender:function postRender(){this.setReadyStatus()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,"assessments:complete",this.onAssessmentsComplete);this.listenToOnce(Adapt,"remove",this.onRemove)},removeEventListeners:function removeEventListeners(){;this.stopListening(Adapt,"assessments:complete",this.onAssessmentsComplete);this.stopListening(Adapt,"remove",this.onRemove)},onAssessmentsComplete:function onAssessmentsComplete(state){if(this.model.get("_assessmentId")===undefined||this.model.get("_assessmentId")!=state.id)return;this.model.set("_state",state);this.setFeedback();this.setImageFeedback();this.render();if(!this.model.get("_isVisible"))this.model.set("_isVisible",true);setTimeout(this.getValueNextUntil,500)},onAssessmentComplete:function onAssessmentComplete(state){this.model.set("_state",state);this.setFeedback();this.setImageFeedback();if(!this.model.get("_isVisible"))this.model.set("_isVisible",true);this.render();this.getValueNextUntil()},onInview:function onInview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop||this._isVisibleBottom){this.setCompletionStatus();this.$el.off("inview")}}},onRetry:function onRetry(){var state=this.model.get("_state");var assessmentModel=Adapt.assessment.get(state.id);assessmentModel.reset()},onCertificateClicked:function onCertificateClicked(){Adapt.trigger("certificate:show");Adapt.once("certificate:close",_.bind(this.onCertificateClosed,this))},onCertificateClosed:function onCertificateClosed(){Adapt.scrollTo("."+this.model.get("_parentId"))},setImageFeedback:function setImageFeedback(){var feedbackBand=this.getFeedbackBand();if(feedbackBand.hasOwnProperty("img")){}},setFeedback:function setFeedback(){var completionBody=this.model.get("_completionBody");var feedbackBand=this.getFeedbackBand();var state=this.model.get("_state");this.$el.removeClass("passed").removeClass("failed");if(state.isPass){this.$el.addClass("passed")}else{this.$el.addClass("failed")}state.feedbackBand=feedbackBand;state.feedback=feedbackBand.feedback;var responsehtml="";$(state.questions).each(function(key,val){responsehtml+="/"+("Q"+(parseInt(key)+1)+"."+" "+(val._isCorrect==true?"Correct ":"Incorrect")+" ");console.log(responsehtml)});state.questions=responsehtml;$(".user_response").find();this.checkRetryEnabled();completionBody=this.stringReplace(completionBody,state);this.model.set("body",completionBody)},getFeedbackBand:function getFeedbackBand(){var state=this.model.get("_state");var questions=state.questions;var bands=this.model.get("_bands");var scoreAsPercent=state.scoreAsPercent;for(var i=bands.length-1;i>=0;i--){if(scoreAsPercent>=bands[i]._score){return bands[i]}}return"";this.getValueNextUntil()},checkRetryEnabled:function checkRetryEnabled(){var state=this.model.get("_state");var assessmentModel=Adapt.assessment.get(state.id);if(!assessmentModel.canResetInPage())return false;var isRetryEnabled=state.feedbackBand._allowRetry!==false;var isAttemptsLeft=state.attemptsLeft>0||state.attemptsLeft==="infinite";var showRetry=isRetryEnabled&&isAttemptsLeft;this.model.set("_isRetryEnabled",showRetry);if(showRetry){var retryFeedback=this.model.get("_retry").feedback;retryFeedback=this.stringReplace(retryFeedback,state);this.model.set("retryFeedback",retryFeedback)}else{this.model.set("retryFeedback","")}},stringReplace:function stringReplace(string,context){var changed=true;while(changed){changed=false;for(var k in context){var contextValue=context[k];switch(_typeof(contextValue)){case"object":continue;case"number":contextValue=Math.floor(contextValue);break;}var regExNoEscaping=new RegExp("((\\{\\{\\{){1}[\\ ]*"+k+"[\\ ]*(\\}\\}\\}){1})","g");var regExEscaped=new RegExp("((\\{\\{){1}[\\ ]*"+k+"[\\ ]*(\\}\\}){1})","g");var preString=string;string=string.replace(regExNoEscaping,contextValue);var escapedText=$("<p>").text(contextValue).html();string=string.replace(regExEscaped,escapedText);if(string!=preString)changed=true}}return string},onRemove:function onRemove(){this.removeEventListeners()},getValueNextUntil:function getValueNextUntil(){var data=$(".user_response").text();var arr=data.split("/");if(val=="c-100-01"){$(".user_response").html("<span class=\"user-result\">"+arr[1]+"</span>");$(".user_response").append("<span class=\"user-result\">"+arr[2]+"</span>");$(".user_response").append("<span class=\"user-result\">"+arr[3]+"</span>");$(".user_response").append("<span class=\"user-result\">"+arr[4]+"</span>");$(".user_response").append("<span class=\"user-result\">"+arr[5]+"</span>")}else{$(".user_response").html("<span class=\"user-result\">"+arr[1]+"</span>");$(".user_response").append("<span class=\"user-result\">"+arr[2]+"</span>");$(".user_response").append("<span class=\"user-result\">"+arr[3]+"</span>");$(".user_response").append("<span class=\"user-result\">"+arr[4]+"</span>");$(".user_response").append("<span class=\"user-result\">"+arr[5]+"</span>")}$(".user-result").each(function(){$(".user-result:contains(\"Incorrect\")").addClass("incrct")})}});Adapt.register("assessmentResults",AssessmentResults)});define("components/adapt-contrib-blank/js/adapt-contrib-blank",["core/js/adapt","core/js/views/componentView","core/js/models/componentModel"],function(Adapt,ComponentView,ComponentModel){var BlankView=ComponentView.extend({preRender:function preRender(){this.$el.addClass("no-state");this.checkIfResetOnRevisit()},postRender:function postRender(){this.setReadyStatus();this.setupInviewCompletion()},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}});return Adapt.register("blank",{model:ComponentModel.extend({}),view:BlankView})});define("components/adapt-contrib-flipcard/js/adapt-contrib-flipcard",["coreViews/componentView","coreJS/adapt"],function(ComponentView,Adapt){var Flipcard=ComponentView.extend({events:{"click .flipcard-item":"onClickFlipItem"},preRender:function preRender(){this.listenTo(Adapt,"device:resize",this.reRender,this);this.checkIfResetOnRevisit()},postRender:function postRender(){if(!Modernizr.testProp("transformStyle","preserve-3d")){this.$(".flipcard-item-back").hide()}this.$(".flipcard-widget").imageready(_.bind(function(){this.setReadyStatus();this.reRender()},this))},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}_.each(this.model.get("_items"),function(item){item._isVisited=false})},reRender:function reRender(){var imageHeight=this.$(".flipcard-item-frontImage").eq(0).height();if(imageHeight){this.$(".flipcard-item").height(imageHeight)}},onClickFlipItem:function onClickFlipItem(event){if(event&&event.target.tagName.toLowerCase()==="a"){return}else{event&&event.preventDefault()}var $selectedElement=$(event.currentTarget);var flipType=this.model.get("_flipType");if(flipType==="allFlip"){this.performAllFlip($selectedElement)}else if(flipType==="singleFlip"){this.performSingleFlip($selectedElement)}},performAllFlip:function performAllFlip($selectedElement){if(!Modernizr.testProp("transformStyle","preserve-3d")){var $frontflipcard=$selectedElement.find(".flipcard-item-front");var $backflipcard=$selectedElement.find(".flipcard-item-back");var flipTime=this.model.get("_flipTime")||"fast";if($frontflipcard.is(":visible")){$frontflipcard.fadeOut(flipTime,function(){$backflipcard.fadeIn(flipTime)})}else if($backflipcard.is(":visible")){$backflipcard.fadeOut(flipTime,function(){$frontflipcard.fadeIn(flipTime)})}}else{$selectedElement.toggleClass("flipcard-flip")}var flipcardElementIndex=this.$(".flipcard-item").index($selectedElement);this.setVisited(flipcardElementIndex)},performSingleFlip:function performSingleFlip($selectedElement){var flipcardContainer=$selectedElement.closest(".flipcard-widget");if(!Modernizr.testProp("transformStyle","preserve-3d")){var frontflipcard=$selectedElement.find(".flipcard-item-front");var backflipcard=$selectedElement.find(".flipcard-item-back");var flipTime=this.model.get("_flipTime")||"fast";if(backflipcard.is(":visible")){backflipcard.fadeOut(flipTime,function(){frontflipcard.fadeIn(flipTime)})}else{var visibleflipcardBack=flipcardContainer.find(".flipcard-item-back:visible");if(visibleflipcardBack.length>0){visibleflipcardBack.fadeOut(flipTime,function(){flipcardContainer.find(".flipcard-item-front:hidden").fadeIn(flipTime)})}frontflipcard.fadeOut(flipTime,function(){backflipcard.fadeIn(flipTime)})}}else{if($selectedElement.hasClass("flipcard-flip")){$selectedElement.removeClass("flipcard-flip")}else{flipcardContainer.find(".flipcard-item").removeClass("flipcard-flip");$selectedElement.addClass("flipcard-flip")}}var flipcardElementIndex=this.$(".flipcard-item").index($selectedElement);this.setVisited(flipcardElementIndex)},setVisited:function setVisited(index){var item=this.model.get("_items")[index];item._isVisited=true;this.checkCompletionStatus()},getVisitedItems:function getVisitedItems(){return _.filter(this.model.get("_items"),function(item){return item._isVisited})},checkCompletionStatus:function checkCompletionStatus(){if(this.getVisitedItems().length===this.model.get("_items").length){this.setCompletionStatus()}}});Adapt.register("flipcard",Flipcard);return Flipcard});define("core/js/views/buttonsView",["core/js/adapt","core/js/enums/buttonStateEnum"],function(Adapt,BUTTON_STATE){var textPropertyName={"SUBMIT":"submit","CORRECT":"correct","INCORRECT":"incorrect","SHOW_CORRECT_ANSWER":"showCorrectAnswer","HIDE_CORRECT_ANSWER":"hideCorrectAnswer","SHOW_FEEDBACK":"showFeedback","RESET":"reset"};var ButtonsView=Backbone.View.extend({initialize:function initialize(options){this.parent=options.parent;this.listenTo(Adapt,"remove",this.remove);this.listenTo(this.model,"change:_buttonState",this.onButtonStateChanged);this.listenTo(this.model,"change:feedbackMessage",this.onFeedbackMessageChanged);this.listenTo(this.model,"change:_attemptsLeft",this.onAttemptsChanged);this.render()},events:{"click .buttons-action":"onActionClicked","click .buttons-feedback":"onFeedbackClicked"},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates["buttons"];_.defer(_.bind(function(){this.postRender();Adapt.trigger("buttonsView:postRender",this)},this));this.$el.html(template(data))},postRender:function postRender(){this.refresh()},checkResetSubmittedState:function checkResetSubmittedState(){var isSubmitted=this.model.get("_isSubmitted");if(!isSubmitted){var $icon=this.$(".buttons-marking-icon");$icon.removeClass("icon-cross");$icon.removeClass("icon-tick");$icon.addClass("display-none");this.$el.removeClass("submitted");this.model.set("feedbackMessage",undefined);Adapt.a11y.toggleAccessibleEnabled(this.$(".buttons-feedback"),false)}else{this.$el.addClass("submitted")}},onActionClicked:function onActionClicked(){var buttonState=this.model.get("_buttonState");this.trigger("buttons:stateUpdate",BUTTON_STATE(buttonState));this.checkResetSubmittedState()},onFeedbackClicked:function onFeedbackClicked(){this.trigger("buttons:stateUpdate",BUTTON_STATE.SHOW_FEEDBACK)},onFeedbackMessageChanged:function onFeedbackMessageChanged(model,changedAttribute){if(changedAttribute&&this.model.get("_canShowFeedback")){Adapt.a11y.toggleAccessibleEnabled(this.$(".buttons-feedback"),true)}else{Adapt.a11y.toggleAccessibleEnabled(this.$(".buttons-feedback"),false)}},onButtonStateChanged:function onButtonStateChanged(model,changedAttribute){this.updateAttemptsCount();var $buttonsAction=this.$(".buttons-action");var buttonState=BUTTON_STATE(changedAttribute);if(changedAttribute===BUTTON_STATE.CORRECT||changedAttribute===BUTTON_STATE.INCORRECT){Adapt.a11y.toggleAccessibleEnabled($buttonsAction,false)}else{var propertyName=textPropertyName[buttonState.asString];var ariaLabel=this.model.get("_buttons")["_"+propertyName].ariaLabel;var buttonText=this.model.get("_buttons")["_"+propertyName].buttonText;Adapt.a11y.toggleAccessibleEnabled($buttonsAction,true);$buttonsAction.html(buttonText).attr("aria-label",ariaLabel);switch(changedAttribute){case BUTTON_STATE.SHOW_CORRECT_ANSWER:case BUTTON_STATE.HIDE_CORRECT_ANSWER:Adapt.a11y.toggleAccessible($buttonsAction,false);}}},checkFeedbackState:function checkFeedbackState(){var canShowFeedback=this.model.get("_canShowFeedback");this.$(".buttons-action").toggleClass("buttons-action-fullwidth buttons-action-enlarge",!canShowFeedback);this.$(".buttons-feedback").toggleClass("no-feedback",!canShowFeedback);this.$(".buttons-marking-icon").toggleClass("no-feedback",!canShowFeedback)},updateAttemptsCount:function updateAttemptsCount(model,changedAttribute){var isInteractionComplete=this.model.get("_isInteractionComplete");var attemptsLeft=this.model.get("_attemptsLeft")?this.model.get("_attemptsLeft"):this.model.get("_attempts");var isCorrect=this.model.get("_isCorrect");var shouldDisplayAttempts=this.model.get("_shouldDisplayAttempts");var attemptsString;this.checkResetSubmittedState();if(!isInteractionComplete&&attemptsLeft!=0){attemptsString=attemptsLeft+" ";if(attemptsLeft>1){attemptsString+=this.model.get("_buttons").remainingAttemptsText}else if(attemptsLeft===1){attemptsString+=this.model.get("_buttons").remainingAttemptText}}else{this.$(".buttons-display-inner").addClass("visibility-hidden");this.showMarking()}if(shouldDisplayAttempts){this.$(".buttons-display-inner").html(attemptsString)}},showMarking:function showMarking(){if(!this.model.get("_canShowMarking"))return;var isCorrect=this.model.get("_isCorrect");var ariaLabels=Adapt.course.get("_globals")._accessibility._ariaLabels;this.$(".buttons-marking-icon").removeClass("display-none").addClass(isCorrect?"icon-tick":"icon-cross").attr("aria-label",isCorrect?ariaLabels.answeredCorrectly:ariaLabels.answeredIncorrectly)},refresh:function refresh(){this.updateAttemptsCount();this.checkResetSubmittedState();this.checkFeedbackState();this.onButtonStateChanged(null,this.model.get("_buttonState"));this.onFeedbackMessageChanged(null,this.model.get("feedbackMessage"))}});return ButtonsView});define("core/js/views/questionView",["core/js/adapt","core/js/views/componentView","core/js/views/buttonsView","core/js/models/questionModel","core/js/enums/buttonStateEnum"],function(Adapt,ComponentView,ButtonsView,QuestionModel,BUTTON_STATE){var useQuestionModelOnly=false;var QuestionView=ComponentView.extend({className:function className(){return"component "+"question-component "+this.model.get("_component")+"-component "+this.model.get("_id")+" "+this.model.get("_classes")+" "+this.setVisibility()+" component-"+this.model.get("_layout")+" nth-child-"+this.model.get("_nthChild")+(this.model.get("_isComplete")?" completed":"")},preRender:function preRender(){this.listenTo(this.model,"change:_isEnabled",this.onEnabledChanged);this.listenTo(this.model,"question:refresh",this.refresh);this.checkIfResetOnRevisit();this._runModelCompatibleFunction("setupDefaultSettings");this.setupQuestion()},onEnabledChanged:function onEnabledChanged(model,changedAttribute){if(!changedAttribute){this.$(".component-widget").addClass("disabled");this.disableQuestion()}else{this.$(".component-widget").removeClass("disabled");this.enableQuestion()}},disableQuestion:function disableQuestion(){},enableQuestion:function enableQuestion(){},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit,true);_.defer(_.bind(function(){this.resetQuestionOnRevisit(isResetOnRevisit)},this))}else{var isInteractionComplete=this.model.get("_isInteractionComplete");if(isInteractionComplete){this.model.set("_buttonState",BUTTON_STATE.HIDE_CORRECT_ANSWER);_.defer(_.bind(function(){this.onHideCorrectAnswerClicked()},this))}else{this.model.set("_buttonState",BUTTON_STATE.SUBMIT);_.defer(_.bind(function(){this.onResetClicked()},this))}}},resetQuestionOnRevisit:function resetQuestionOnRevisit(type){},setupQuestion:function setupQuestion(){},postRender:function postRender(){this.addButtonsView();this.onQuestionRendered()},addButtonsView:function addButtonsView(){this.buttonsView=new ButtonsView({model:this.model,el:this.$(".buttons")});this.listenTo(this.buttonsView,"buttons:stateUpdate",this.onButtonStateUpdate)},onButtonStateUpdate:function onButtonStateUpdate(button_state){switch(button_state){case BUTTON_STATE.SUBMIT:this.onSubmitClicked();break;case BUTTON_STATE.RESET:this.onResetClicked();break;case BUTTON_STATE.SHOW_CORRECT_ANSWER:this.onShowCorrectAnswerClicked();break;case BUTTON_STATE.HIDE_CORRECT_ANSWER:this.onHideCorrectAnswerClicked();break;case BUTTON_STATE.SHOW_FEEDBACK:this.showFeedback();break;}},onQuestionRendered:function onQuestionRendered(){},onSubmitClicked:function onSubmitClicked(){var canSubmit=this._runModelCompatibleFunction("canSubmit");if(!canSubmit){this.showInstructionError();this.onCannotSubmit();return}this._runModelCompatibleFunction("updateAttempts");this._runModelCompatibleFunction("setQuestionAsSubmitted");this.removeInstructionError();this._runModelCompatibleFunction("storeUserAnswer");this._runModelCompatibleFunction("markQuestion","isCorrect");this._runModelCompatibleFunction("setScore");this.showMarking();this._runModelCompatibleFunction("checkQuestionCompletion");this.recordInteraction();this._runModelCompatibleFunction("setupFeedback");this.showFeedback();$(window).resize();this._runModelCompatibleFunction("updateButtons");this.onSubmitted()},showInstructionError:function showInstructionError(){this.$(".component-instruction-inner").addClass("validation-error");Adapt.a11y.focusFirst(this.$el,{defer:true})},onCannotSubmit:function onCannotSubmit(){},onSubmitted:function onSubmitted(){},setQuestionAsSubmitted:function setQuestionAsSubmitted(){this.model.setQuestionAsSubmitted();this.$(".component-widget").addClass("submitted")},removeInstructionError:function removeInstructionError(){this.$(".component-instruction-inner").removeClass("validation-error")},showMarking:function showMarking(){},checkQuestionCompletion:function checkQuestionCompletion(){var isComplete=this.model.checkQuestionCompletion();if(isComplete){this.$(".component-widget").addClass("complete show-user-answer")}},recordInteraction:function recordInteraction(){if(this.model.get("_recordInteraction")===true||!this.model.has("_recordInteraction")){Adapt.trigger("questionView:recordInteraction",this)}},showFeedback:function showFeedback(){if(this.model.get("_canShowFeedback")){Adapt.trigger("questionView:showFeedback",this)}else{Adapt.trigger("questionView:disabledFeedback",this)}},onResetClicked:function onResetClicked(){this.setQuestionAsReset();this._runModelCompatibleFunction("updateButtons");this._runModelCompatibleFunction("resetUserAnswer");this.resetQuestion();if(!this.model.get("_isReady"))return;var currentModel=Adapt.findById(Adapt.location._currentId);if(!currentModel||!currentModel.get("_isReady"))return;Adapt.a11y.focusNext(this.$el)},setQuestionAsReset:function setQuestionAsReset(){this.model.setQuestionAsReset();this.$(".component-widget").removeClass("submitted")},resetQuestion:function resetQuestion(){},refresh:function refresh(){this.model.set("_buttonState",this.model.getButtonState());if(this.model.get("_canShowMarking")&&this.model.get("_isInteractionComplete")&&this.model.get("_isSubmitted")){this.showMarking()}if(this.buttonsView){_.defer(_.bind(this.buttonsView.refresh,this.buttonsView))}},onShowCorrectAnswerClicked:function onShowCorrectAnswerClicked(){this.setQuestionAsShowCorrect();this._runModelCompatibleFunction("updateButtons");this.showCorrectAnswer()},setQuestionAsShowCorrect:function setQuestionAsShowCorrect(){this.$(".component-widget").addClass("submitted show-correct-answer").removeClass("show-user-answer")},showCorrectAnswer:function showCorrectAnswer(){},onHideCorrectAnswerClicked:function onHideCorrectAnswerClicked(){this.setQuestionAsHideCorrect();this._runModelCompatibleFunction("updateButtons");this.hideCorrectAnswer()},setQuestionAsHideCorrect:function setQuestionAsHideCorrect(){this.$(".component-widget").addClass("submitted show-user-answer").removeClass("show-correct-answer")},hideCorrectAnswer:function hideCorrectAnswer(){},getLatency:function getLatency(){return null},_runModelCompatibleFunction:function _runModelCompatibleFunction(name,lookForViewOnlyFunction){return this.model[name]()}},{_isQuestionType:true});if(useQuestionModelOnly)return QuestionView;var viewOnlyCompatibleQuestionView={enableSubmit:function enableSubmit(){this.canSubmit()?this.$(".buttons-action").removeClass("disabled"):this.$(".buttons-action").addClass("disabled")},getInteractionObject:function getInteractionObject(){return this.model.getInteractionObject()},getResponse:function getResponse(){return this.model.getResponse()},getResponseType:function getResponseType(){return this.model.getResponseType()},setupDefaultSettings:function setupDefaultSettings(){return this.model.setupDefaultSettings()},setupButtonSettings:function setupButtonSettings(){return this.model.setupButtonSettings()},setupWeightSettings:function setupWeightSettings(){return this.model.setupWeightSettings()},canSubmit:function canSubmit(){return this.model.canSubmit()},updateAttempts:function updateAttempts(){return this.model.updateAttempts()},storeUserAnswer:function storeUserAnswer(){return this.model.storeUserAnswer()},resetUserAnswer:function resetUserAnswer(){return this.model.resetUserAnswer()},markQuestion:function markQuestion(){if(this._isInViewOnlyCompatibleMode("isCorrect")){if(this.isCorrect()){this.model.set("_isCorrect",true)}else{this.model.set("_isCorrect",false)}}else{return this.model.markQuestion()}},isCorrect:function isCorrect(){return this.model.isCorrect()},setScore:function setScore(){return this.model.setScore()},updateButtons:function updateButtons(){return this.model.updateButtons()},setupFeedback:function setupFeedback(){if(this._isInViewOnlyCompatibleMode("isPartlyCorrect")){if(this.model.get("_isCorrect")){this._runModelCompatibleFunction("setupCorrectFeedback")}else if(this.isPartlyCorrect()){this._runModelCompatibleFunction("setupPartlyCorrectFeedback")}else{this._runModelCompatibleFunction("setupIncorrectFeedback")}}else{this.model.setupFeedback()}},isPartlyCorrect:function isPartlyCorrect(){return this.model.isPartlyCorrect()},setupCorrectFeedback:function setupCorrectFeedback(){return this.model.setupCorrectFeedback()},setupPartlyCorrectFeedback:function setupPartlyCorrectFeedback(){return this.model.setupPartlyCorrectFeedback()},setupIncorrectFeedback:function setupIncorrectFeedback(){return this.model.setupIncorrectFeedback()},_runModelCompatibleFunction:function _runModelCompatibleFunction(name,lookForViewOnlyFunction){if(this._isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction)){return this[name]()}else{return this.model[name]()}},_isInViewOnlyCompatibleMode:function _isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction){var checkForFunction=lookForViewOnlyFunction||name;if(!this.constructor.prototype[checkForFunction])return false;if(this.constructor.prototype[checkForFunction]===viewOnlyCompatibleQuestionView[checkForFunction]){switch(checkForFunction){case"setupFeedback":case"markQuestion":return true;}return false}return true}};return QuestionView.extend(viewOnlyCompatibleQuestionView,{_isQuestionType:true})});define("components/adapt-contrib-mcq/js/mcqView",["core/js/adapt","core/js/views/questionView"],function(Adapt,QuestionView){var McqView=QuestionView.extend({events:{"focus .component-item input":"onItemFocus","blur .component-item input":"onItemBlur","change .component-item input":"onItemSelect","keyup .component-item input":"onKeyPress"},isCorrectAnswerShown:false,initialize:function initialize(){QuestionView.prototype.initialize.apply(this,arguments);this.update=_.debounce(this.update.bind(this),1);this.listenTo(this.model,{"change:_isEnabled change:_isComplete change:_isSubmitted":this.update});this.listenTo(this.model.getChildren(),{"change:_isActive":this.update})},resetQuestionOnRevisit:function resetQuestionOnRevisit(){this.resetQuestion()},setupQuestion:function setupQuestion(){this.model.setupRandomisation()},onQuestionRendered:function onQuestionRendered(){this.setReadyStatus();this.update();var _oScope=this;window.setTimeout(function(){_oScope.enableSubmit()},500)},onKeyPress:function onKeyPress(event){if(event.which!==13)return;this.onItemSelect(event)},onItemFocus:function onItemFocus(event){if(!this.model.isInteractive())return;$("label[for="+$(event.currentTarget).attr("id")+"]").addClass("highlighted")},onItemBlur:function onItemBlur(event){$("label[for="+$(event.currentTarget).attr("id")+"]").removeClass("highlighted")},onItemSelect:function onItemSelect(event){if(!this.model.isInteractive())return;var index=$(event.currentTarget).data("adapt-index");var itemModel=this.model.getItem(index);var shouldSelect=!itemModel.get("_isActive");if(this.model.isSingleSelect()){shouldSelect=true;this.model.resetActiveItems()}else if(shouldSelect&&this.model.isAtActiveLimit()){this.model.getLastActiveItem().toggleActive(false)}itemModel.toggleActive(shouldSelect);this.enableSubmit()},onCannotSubmit:function onCannotSubmit(){},showMarking:function showMarking(){this.update()},resetQuestion:function resetQuestion(){this.model.resetActiveItems();this.model.resetItems()},showCorrectAnswer:function showCorrectAnswer(){this.isCorrectAnswerShown=true;this.update()},hideCorrectAnswer:function hideCorrectAnswer(){this.isCorrectAnswerShown=false;this.update()},update:function update(){this.updateSelection();this.updateMarking()},updateSelection:function updateSelection(){var isEnabled=this.model.get("_isEnabled");this.model.getChildren().each(function(itemModel){var isSelected=this.isCorrectAnswerShown?itemModel.get("_shouldBeSelected"):itemModel.get("_isActive");var index=itemModel.get("_index");this.$("label").filter("[data-adapt-index=\""+index+"\"]").toggleClass("selected",isSelected).toggleClass("disabled",!isEnabled);this.$("input").filter("[data-adapt-index=\""+index+"\"]").prop("checked",isSelected).prop("disabled",!isEnabled)}.bind(this))},updateMarking:function updateMarking(){var isInteractive=this.model.isInteractive();var canShowMarking=this.model.get("_canShowMarking");var ariaLabels=Adapt.course.get("_globals")._accessibility._ariaLabels;this.model.getChildren().each(function(itemModel){var index=itemModel.get("_index");var $itemInput=this.$("input").filter("[data-adapt-index=\""+index+"\"]");var $item=$itemInput.parents(".component-item");if(isInteractive||!canShowMarking){$item.removeClass("correct incorrect");$itemInput.attr("aria-label",$.a11y_normalize(itemModel.get("text")));return}var shouldBeSelected=itemModel.get("_shouldBeSelected");var isCorrect=Boolean(itemModel.get("_isCorrect"));var isActive=Boolean(itemModel.get("_isActive"));$item.toggleClass("correct",isCorrect).toggleClass("incorrect",!isCorrect);$itemInput.attr("aria-label",[shouldBeSelected?ariaLabels.correct:ariaLabels.incorrect,", ",isActive?ariaLabels.selectedAnswer:ariaLabels.unselectedAnswer,". ",$.a11y_normalize(itemModel.get("text"))].join(""))}.bind(this))}});return McqView});define("core/js/models/itemsQuestionModel",["core/js/adapt","core/js/models/questionModel","core/js/models/itemsComponentModel"],function(Adapt,QuestionModel,ItemsComponentModel){var ItemsComponentModelFunctions=_.extendOwn({},ItemsComponentModel.prototype);delete ItemsComponentModelFunctions.constructor;var BlendedModel=QuestionModel.extend(ItemsComponentModelFunctions);var ItemsQuestionModel=BlendedModel.extend({init:function init(){QuestionModel.prototype.init.call(this);ItemsComponentModel.prototype.init.call(this);this.set("_isRadio",this.isSingleSelect())},restoreUserAnswers:function restoreUserAnswers(){if(!this.get("_isSubmitted"))return;var itemModels=this.getChildren();var userAnswer=this.get("_userAnswer");itemModels.each(function(item,index){item.toggleActive(userAnswer[item.get("_index")])});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()},setupRandomisation:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;var children=this.getChildren();children.set(children.shuffle())},canSubmit:function canSubmit(){var activeItems=this.getActiveItems();return activeItems.length>0},storeUserAnswer:function storeUserAnswer(){var items=this.getChildren().slice(0);items.sort(function(a,b){return a.get("_index")-b.get("_index")});var userAnswer=items.map(function(itemModel){return itemModel.get("_isActive")});this.set("_userAnswer",userAnswer)},isCorrect:function isCorrect(){var props={_numberOfRequiredAnswers:0,_numberOfIncorrectAnswers:0,_isAtLeastOneCorrectSelection:false,_numberOfCorrectAnswers:0};this.getChildren().each(function(itemModel){var itemShouldBeActive=itemModel.get("_shouldBeSelected");if(itemShouldBeActive){props._numberOfRequiredAnswers++}if(!itemModel.get("_isActive"))return;if(!itemShouldBeActive){props._numberOfIncorrectAnswers++;return}props._isAtLeastOneCorrectSelection=true;props._numberOfCorrectAnswers++;itemModel.set("_isCorrect",true)});this.set(props);var hasRightNumberOfCorrectAnswers=props._numberOfCorrectAnswers===props._numberOfRequiredAnswers;var hasNoIncorrectAnswers=!props._numberOfIncorrectAnswers;return hasRightNumberOfCorrectAnswers&&hasNoIncorrectAnswers},setScore:function setScore(){var questionWeight=this.get("_questionWeight");var answeredCorrectly=this.get("_isCorrect");var score=answeredCorrectly?questionWeight:0;this.set("_score",score)},setupFeedback:function setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback();return}if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback();return}var activeItem=this.getActiveItem();if(this.isSingleSelect()&&activeItem.get("feedback")){this.setupIndividualFeedback(activeItem);return}this.setupIncorrectFeedback()},setupIndividualFeedback:function setupIndividualFeedback(selectedItem){this.set({feedbackTitle:this.getFeedbackTitle(this.get("_feedback")),feedbackMessage:selectedItem.get("feedback")})},isPartlyCorrect:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")},resetUserAnswer:function resetUserAnswer(){this.set("_userAnswer",[])},isAtActiveLimit:function isAtActiveLimit(){var selectedItems=this.getActiveItems();return selectedItems.length===this.get("_selectable")},isSingleSelect:function isSingleSelect(){return this.get("_selectable")===1},getLastActiveItem:function getLastActiveItem(){var selectedItems=this.getActiveItems();return selectedItems[selectedItems.length-1]},resetItems:function resetItems(){this.resetActiveItems();this.set("_isAtLeastOneCorrectSelection",false)},reset:function reset(type,force){QuestionModel.prototype.reset.apply(this,arguments);ItemsComponentModel.prototype.reset.apply(this,arguments)},getInteractionObject:function getInteractionObject(){var interactions={correctResponsesPattern:[],choices:[]};interactions.choices=this.getChildren().map(function(itemModel){return{id:(itemModel.get("_index")+1).toString(),description:itemModel.get("text")}});var correctItems=this.getChildren().filter(function(itemModel){return itemModel.get("_shouldBeSelected")});interactions.correctResponsesPattern=[correctItems.map(function(itemModel){return String(itemModel.get("_index")+1)}).join("[,]")];return interactions},getResponse:function getResponse(){var activeItems=this.getActiveItems();var activeIndexes=activeItems.map(function(itemModel){return itemModel.get("_index")+1});return activeIndexes.join(",")},getResponseType:function getResponseType(){return"choice"}});return ItemsQuestionModel});define("components/adapt-contrib-mcq/js/adapt-contrib-mcq",["core/js/adapt","./mcqView","core/js/models/itemsQuestionModel"],function(Adapt,McqView,ItemsQuestionModel){return Adapt.register("mcq",{view:McqView,model:ItemsQuestionModel.extend({})})});define("components/adapt-contrib-gmcq/js/adapt-contrib-gmcq",["core/js/adapt","components/adapt-contrib-mcq/js/adapt-contrib-mcq"],function(Adapt,Mcq){var Gmcq=Mcq.view.extend({setupQuestion:function setupQuestion(){Mcq.view.prototype.setupQuestion.call(this);this.listenTo(Adapt,{"device:changed":this.resizeImage,"device:resize":this.onDeviceResize})},onQuestionRendered:function onQuestionRendered(){this.resizeImage(Adapt.device.screenSize);this.setUpColumns();this.$("label").imageready(this.setReadyStatus.bind(this));var _oScope=this;window.setTimeout(function(){_oScope.enableSubmit()},500)},onDeviceResize:function onDeviceResize(){this.setUpColumns()},resizeImage:function resizeImage(width){var imageWidth=width==="medium"?"small":width;this.$("label").each(function(index){var $img=$(this).find("img");var newSrc=$img.attr("data-"+imageWidth);if(!newSrc)return;$img.attr("src",newSrc)})},setUpColumns:function setUpColumns(){var columns=this.model.get("_columns");var columnsmedium=this.model.get("_columns-medium");if(!columns)return;if(Adapt.device.screenSize==="large"){this.$el.addClass("gmcq-column-layout");this.$(".gmcq-item").css("width",100/columns+"%")}else{this.$el.removeClass("gmcq-column-layout");this.$(".gmcq-item").css("width","");if(columnsmedium!=undefined){if(Adapt.device.screenSize==="medium"){this.$el.removeClass("gmcq-column-layout");this.$(".gmcq-item").css("width",100/columnsmedium+"%")}}}}},{template:"gmcq"});return Adapt.register("gmcq",{view:Gmcq,model:Mcq.model.extend({})})});define("components/adapt-contrib-graphic/js/adapt-contrib-graphic",["core/js/adapt","core/js/views/componentView","core/js/models/componentModel"],function(Adapt,ComponentView,ComponentModel){var GraphicView=ComponentView.extend({preRender:function preRender(){this.listenTo(Adapt,"device:changed",this.resizeImage);this.checkIfResetOnRevisit()},postRender:function postRender(){this.resizeImage(Adapt.device.screenSize,true)},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},resizeImage:function resizeImage(width,setupInView){var imageWidth=width==="medium"?"small":width;var imageSrc=this.model.get("_graphic")?this.model.get("_graphic")[imageWidth]:"";this.$(".graphic-widget img").attr("src",imageSrc);this.$(".graphic-widget").imageready(function(){this.setReadyStatus();if(setupInView){this.setupInviewCompletion(".component-widget")}}.bind(this))}});return Adapt.register("graphic",{model:ComponentModel.extend({}),view:GraphicView})});define("components/adapt-contrib-hotgraphic/js/adapt-contrib-hotgraphic",["require","coreViews/componentView","coreJS/adapt"],function(require){var ComponentView=require("coreViews/componentView");var Adapt=require("coreJS/adapt");var HotGraphic=ComponentView.extend({initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.listenTo(this.model,"change:_isVisible",this.toggleVisibility);this.model.set("_globals",Adapt.course.get("_globals"));this.preRender();if(this.model.get("_canCycleThroughPagination")===undefined){this.model.set("_canCycleThroughPagination",false)}if(Adapt.device.screenSize=="large"){this.render()}else{this.reRender()}},events:function events(){return{"click .hotgraphic-graphic-pin":"openHotGraphic","click .hotgraphic-popup-done":"closeHotGraphic","click .hotgraphic-popup-nav .back":"previousHotGraphic","click .hotgraphic-popup-nav .next":"nextHotGraphic","mouseover .hotgraphic-graphic-pin-icon-image":"onHotGraphicOver","mouseout .hotgraphic-graphic-pin-icon-image":"onHotGraphicOver","click .hotgraphic-graphic-pin-icon-image":"onHotGraphicOver"}},preRender:function preRender(){this.listenTo(Adapt,"device:changed",this.reRender,this);this.checkIfResetOnRevisit()},postRender:function postRender(){this.renderState();this.$(".hotgraphic-widget").imageready(_.bind(function(){this.setReadyStatus()},this));this.setupHotspotImages();this.setupEventListeners();this.listenTo(Adapt,"device:resize",this.setDeviceSize,this)},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit);_.each(this.model.get("_items"),function(item){item._isVisited=false})}},reRender:function reRender(){if(Adapt.device.screenSize!="large"){this.replaceWithNarrative()}},setDeviceSize:function setDeviceSize(){var _wW=$(window).width()},inview:function inview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop&&this._isVisibleBottom){this.$(".component-inner").off("inview");this.setCompletionStatus()}}},replaceWithNarrative:function replaceWithNarrative(){if(!Adapt.componentStore.narrative)throw"Narrative not included in build";var Narrative=Adapt.componentStore.narrative;var model=this.prepareNarrativeModel();var newNarrative=new Narrative({model:model});var $container=$(".component-container",$("."+this.model.get("_parentId")));newNarrative.reRender();newNarrative.setupNarrative();$container.append(newNarrative.$el);Adapt.trigger("device:resize");this.remove()},prepareNarrativeModel:function prepareNarrativeModel(){var model=this.model;model.set("_component","narrative");model.set("_wasHotgraphic",true);model.set("originalBody",model.get("body"));model.set("originalInstruction",model.get("instruction"));if(model.get("mobileBody")){model.set("body",model.get("mobileBody"))}if(model.get("mobileInstruction")){model.set("instruction",model.get("mobileInstruction"))}return model},applyNavigationClasses:function applyNavigationClasses(index){var $nav=this.$(".hotgraphic-popup-nav"),itemCount=this.$(".hotgraphic-item").length;$nav.removeClass("first").removeClass("last");this.$(".hotgraphic-popup-done").a11y_cntrl_enabled(true);if(index<=0&&!this.model.get("_canCycleThroughPagination")){this.$(".hotgraphic-popup-nav").addClass("first");this.$(".hotgraphic-popup-controls.back").a11y_cntrl_enabled(false);this.$(".hotgraphic-popup-controls.next").a11y_cntrl_enabled(true)}else if(index>=itemCount-1&&!this.model.get("_canCycleThroughPagination")){this.$(".hotgraphic-popup-nav").addClass("last");this.$(".hotgraphic-popup-controls.back").a11y_cntrl_enabled(true);this.$(".hotgraphic-popup-controls.next").a11y_cntrl_enabled(false)}else{this.$(".hotgraphic-popup-controls.back").a11y_cntrl_enabled(true);this.$(".hotgraphic-popup-controls.next").a11y_cntrl_enabled(true)}var classes=this.model.get("_items")[index]._classes?this.model.get("_items")[index]._classes:"";this.$(".hotgraphic-popup").attr("class","hotgraphic-popup "+"item-"+index+" "+classes)},openHotGraphic:function openHotGraphic(event){event.preventDefault();this.$(".hotgraphic-popup-inner").a11y_on(false);var currentHotSpot=$(event.currentTarget).data("id");this.$(".hotgraphic-item").hide().removeClass("active");this.$("."+currentHotSpot).show().addClass("active");var currentIndex=this.$(".hotgraphic-item.active").index();this.setVisited(currentIndex);console.log("this.model.get(_hidePagination): "+this.model.get("_hidePagination"));var _title=this.model.get("_items")[currentIndex].title;this.$(".hotgraphic-popup-nav-title .currentTitle").html(_title);this.$(".hotgraphic-popup-count .current").html(currentIndex+1);this.$(".hotgraphic-popup-count .total").html(this.$(".hotgraphic-item").length);this.$(".hotgraphic-popup").attr("class","hotgraphic-popup "+"item-"+currentIndex);this.$(".hotgraphic-popup").show();this.$(".hotgraphic-popup-inner .active").a11y_on(true);Adapt.trigger("popup:opened",this.$(".hotgraphic-popup-inner"));this.$(".hotgraphic-popup-inner .active").a11y_focus();this.applyNavigationClasses(currentIndex)},closeHotGraphic:function closeHotGraphic(event){event.preventDefault();var currentIndex=this.$(".hotgraphic-item.active").index();this.$(".hotgraphic-popup").hide();Adapt.trigger("popup:closed",this.$(".hotgraphic-popup-inner"))},previousHotGraphic:function previousHotGraphic(event){event.preventDefault();var currentIndex=this.$(".hotgraphic-item.active").index();if(currentIndex===0&&!this.model.get("_canCycleThroughPagination")){return}else if(currentIndex===0&&this.model.get("_canCycleThroughPagination")){currentIndex=this.model.get("_items").length}this.$(".hotgraphic-item.active").hide().removeClass("active");this.$(".hotgraphic-item").eq(currentIndex-1).show().addClass("active");this.setVisited(currentIndex-1);var _title=this.model.get("_items")[currentIndex-1].title;this.$(".hotgraphic-popup-nav-title .currentTitle").html(_title);this.$(".hotgraphic-popup-count .current").html(currentIndex);this.$(".hotgraphic-popup-inner").a11y_on(false);this.applyNavigationClasses(currentIndex-1);this.$(".hotgraphic-popup-inner .active").a11y_on(true);this.$(".hotgraphic-popup-inner .active").a11y_focus()},nextHotGraphic:function nextHotGraphic(event){event.preventDefault();var currentIndex=this.$(".hotgraphic-item.active").index();if(currentIndex===this.model.get("_items").length-1&&!this.model.get("_canCycleThroughPagination")){return}else if(currentIndex===this.model.get("_items").length-1&&this.model.get("_canCycleThroughPagination")){currentIndex=-1}this.$(".hotgraphic-item.active").hide().removeClass("active");this.$(".hotgraphic-item").eq(currentIndex+1).show().addClass("active");this.setVisited(currentIndex+1);var _title=this.model.get("_items")[currentIndex+1].title;this.$(".hotgraphic-popup-nav-title .currentTitle").html(_title);this.$(".hotgraphic-popup-count .current").html(currentIndex+2);this.$(".hotgraphic-popup-inner").a11y_on(false);this.applyNavigationClasses(currentIndex+1);this.$(".hotgraphic-popup-inner .active").a11y_on(true);this.$(".hotgraphic-popup-inner .active").a11y_focus()},setupHotspotImages:function setupHotspotImages(){$(".hotgraphic-graphic-pin-icon-image").each(function(index){$(this).attr("src",$(this).data("normal"))})},onHotGraphicOver:function onHotGraphicOver(event){var _sET=event.type,_oCT=$(event.currentTarget);_sET=="mouseover"?_oCT.attr("src",_oCT.data("hover")):_oCT.parent().hasClass("active")?_oCT.attr("src",_oCT.data("hover")):_oCT.attr("src",_oCT.data("normal"));if(_sET=="click"){$(".hotgraphic-graphic-pin-icon-image").each(function(index){$(this).attr("src",$(this).data("normal"))});_sET=="click"?_oCT.attr("src",_oCT.data("hover")):_oCT.attr("src",_oCT.data("normal"))}},setVisited:function setVisited(index){var item=this.model.get("_items")[index];item._isVisited=true;this.$(".hotgraphic-graphic-pin").eq(index).addClass("visited").attr("aria-label","Item visited.");$.a11y_alert("visited");this.checkCompletionStatus()},getVisitedItems:function getVisitedItems(){return _.filter(this.model.get("_items"),function(item){return item._isVisited})},checkCompletionStatus:function checkCompletionStatus(){if(!this.model.get("_isComplete")){if(this.getVisitedItems().length==this.model.get("_items").length){this.trigger("allItems")}}},onCompletion:function onCompletion(){this.setCompletionStatus();if(this.completionEvent&&this.completionEvent!="inview"){this.off(this.completionEvent,this)}},setupEventListeners:function setupEventListeners(){this.completionEvent=!this.model.get("_setCompletionOn")?"allItems":this.model.get("_setCompletionOn");if(this.completionEvent!=="inview"){this.on(this.completionEvent,_.bind(this.onCompletion,this))}else{this.$(".component-widget").on("inview",_.bind(this.inview,this))}}});Adapt.register("hotgraphic",HotGraphic);return HotGraphic});define("components/adapt-contrib-matching/js/dropdownOption",[],function(){var DropDownItem=Backbone.View.extend({events:{"click":"onClick","click *":"onClick"},initialize:function initialize(settings){this.settings=settings;this.$inner=this.$("span")},isPlaceholder:function isPlaceholder(){return this.$el.is("[hidden]")},parent:function parent(){return this.settings.parent},onClick:function onClick(event){var parent=this.parent();event.preventDefault();this.select().scrollTo();parent.$button.focus()},getValue:function getValue(){return this.$el.attr("value").trim()},select:function select(){var parent=this.parent();parent.deselectAll();parent.setActiveDescendantId(this.el.id);this.$el.attr({selected:"","aria-selected":"true"});parent.$inner.html(this.$el.attr("text"));var value=this.isPlaceholder()?"":this.getValue();parent.$input.val(value).trigger("change");parent.trigger("change",parent);return this},deselect:function deselect(){if(!this.isSelected())return this;var parent=this.parent();parent.removeActiveDescendantId();this.$el.removeAttr("selected");this.$el.attr("aria-selected","false");parent.$inner.html("");parent.$input.val("").trigger("change");parent.trigger("change",parent);return this},reselect:function reselect(){var parent=this.parent();parent.setActiveDescendantId(this.$el[0].id);if(this.isSelected())return this;this.select();return this},isSelected:function isSelected(){return Boolean(this.$el.attr("selected"))},getIndex:function getIndex(){var parent=this.parent();return _.findIndex(parent.options,function(option){return option===this}.bind(this))},getNext:function getNext(){var parent=this.parent();return parent.options[this.getIndex()+1]},getPrevious:function getPrevious(){var parent=this.parent();return parent.options[this.getIndex()-1]},getFirst:function getFirst(){var parent=this.parent();return parent.options[0]},getLast:function getLast(){var parent=this.parent();return parent.options[parent.options.length-1]},scrollTo:function scrollTo(){var parent=this.parent();parent.settings.scrollToItem.call(parent,this)},destroy:function destroy(){var parent=this.parent();this.remove();if(this.isPlaceholder()){parent.placeholder=null}else{for(var i=0,l=parent.options.length;i<l;i++){var item=parent.options[i];if(item!==this)continue;parent.options.splice(i,1);break}}delete this.settings}});return DropDownItem});define("components/adapt-contrib-matching/js/dropdown",["./dropdownOption"],function(DropDownOption){var DropDown=Backbone.View.extend({initialize:function initialize(settings){_.bindAll(this,"onStartInteraction","onButtonClick","onListBlur","onKeyDown");this.settings=_.defaults(settings,this.getDefaults());this.placeholder=null;this.options=[];this.setUpElements();this.setUpItems();this.select(this.settings.value);this.addEventListeners();this.toggleOpen(false);this.settings.load.call(this,this);this.trigger("load",this)},getDefaults:function getDefaults(){return{load:DropDown.defaults.load,openList:DropDown.defaults.openList,closeList:DropDown.defaults.closeList,scrollToItem:DropDown.defaults.scrollToItem}},setUpElements:function setUpElements(){this.$list=this.$("ul");this.$button=this.$("button");this.$inner=this.$button.find(".dropdown__inner");this.$input=this.$("input")},setUpItems:function setUpItems(){var $options=this.$("li");$options.each(function(index,el){var option=new DropDownOption({parent:this,el:el});if(option.isPlaceholder()){this.placeholder=option;return}this.options.push(option)}.bind(this))},addEventListeners:function addEventListeners(){this.$button.on({"mousedown touchstart":this.onStartInteraction,click:this.onButtonClick});this.$list.on("blur",this.onListBlur);$(document).on("keydown",this.onKeyDown)},onStartInteraction:function onStartInteraction(){this.wasOpen=this.isOpen()},deselectAll:function deselectAll(){this.placeholder.deselect();this.options.forEach(function(option){option.deselect()})},onButtonClick:function onButtonClick(event){if(this.wasOpen||this.isOpen()){this.wasOpen=false;return}this.toggleOpen();var option=this.getFirstSelectedItem()||this.placeholder;if(!option)return;option.reselect();option.scrollTo();this.$list.focus()},isOpen:function isOpen(){return!this.$list.hasClass("hidden")},toggleOpen:function toggleOpen(open){if(open===undefined)open=!this.isOpen();if(open)clearTimeout(this.blurTimeout);this.$button.attr("aria-expanded",open?"true":"false");var name=open?"openList":"closeList";this.settings[name].call(this,this);this.trigger(name,this)},onListBlur:function onListBlur(event){var handleBlur=function(){this.toggleOpen(false);this.removeActiveDescendantId()}.bind(this);this.blurTimeout=setTimeout(handleBlur,100)},onKeyDown:function onKeyDown(event){if(!this.isOpen())return;var option=this.getFirstSelectedItem()||this.placeholder;switch(event.keyCode){case 38:event.preventDefault();option=option.getPrevious()||option.getLast();break;case 40:event.preventDefault();option=option.getNext()||option.getFirst();break;case 13:case 32:case 27:event.preventDefault();this.$button.focus();return;default:return;}option.select().scrollTo()},getFirstSelectedItem:function getFirstSelectedItem(){return _.find(this.options,function(option){return option.isSelected()})},setActiveDescendantId:function setActiveDescendantId(id){this.$list.attr("aria-activedescendant",id)},removeActiveDescendantId:function removeActiveDescendantId(){this.$list.removeAttr("aria-activedescendant")},select:function select(value){value=String(value);var option=_.find(this.options,function(option){return option.getValue()===value});if(option){option.select();return}this.placeholder.select()},toggleDisabled:function toggleDisabled(value){if(value===undefined){value=!this.$input.attr("disabled")}if(value===false){this.$input.removeAttr("disabled");this.$button.removeAttr("disabled");this.$el.removeAttr("disabled");return}this.$input.attr("disabled","");this.$button.attr("disabled","");this.$el.attr("disabled","")},isEmpty:function isEmpty(){return!this.getFirstSelectedItem()},val:function val(){return this.$input.val()},destroy:function destroy(){this.removeEventListeners();this.$el.remove();delete this.options;delete this.$input;delete this.$inner;delete this.$button;delete this.$list;delete this.$el},removeEventListeners:function removeEventListeners(){this.$button.off({"mousedown touchstart":this.onStartInteraction,click:this.onButtonClick});this.$list.off("blur",this.onListBlur);$(document).off("keydown",this.onKeyDown)}},{defaults:{load:function load(){},openList:function openList(){this.$list.css({top:"",left:this.$button[0].offsetLeft,width:this.$button.width()}).addClass("sizing").removeClass("hidden");var offset=this.$list[0].getBoundingClientRect();var height=this.$list.height();var windowHeight=$(window).height();var isOffscreen=offset.top+height>windowHeight;this.$list.css("top",isOffscreen?-height:"").removeClass("sizing").focus()},closeList:function closeList(){this.$list.removeClass("sizing").addClass("hidden").css("top","")},scrollToItem:function scrollToItem(option){var height=this.$list[0].clientHeight;var pos=option.$el[0].offsetTop-height/2;this.$list[0].scrollTop=pos}}});return DropDown});define("components/adapt-contrib-matching/js/matchingView",["core/js/adapt","core/js/views/questionView","./dropdown"],function(Adapt,QuestionView,DropDown){var MatchingView=QuestionView.extend({dropdowns:null,disableQuestion:function disableQuestion(){this.dropdowns.forEach(function(dropdown){dropdown.toggleDisabled(true)})},enableQuestion:function enableQuestion(){this.dropdowns.forEach(function(dropdown){dropdown.toggleDisabled(false)})},resetQuestionOnRevisit:function resetQuestionOnRevisit(){this.resetQuestion()},setupQuestion:function setupQuestion(){this.listenToOnce(Adapt,"preRemove",this.onPreRemove);this.model.setupRandomisation()},onPreRemove:function onPreRemove(){this.dropdowns.forEach(function(dropdown){dropdown.off("change",this.onOptionSelected);dropdown.destroy()},this)},onQuestionRendered:function onQuestionRendered(){this.setReadyStatus();this.setUpDropdowns();var _oScope=this;window.setTimeout(function(){_oScope.enableSubmit()},500)},setUpDropdowns:function setUpDropdowns(){_.bindAll(this,"onOptionSelected");this.dropdowns=[];var items=this.model.get("_items");this.$(".matching-item").each(function(i,el){var item=items[i];var selectedOption=_.find(item._options,function(option){return option._isSelected});var value=selectedOption?selectedOption._index:null;var dropdown=new DropDown({el:$(el).find(".dropdown")[0],placeholder:this.model.get("placeholder"),value:value});this.dropdowns.push(dropdown);dropdown.on("change",this.onOptionSelected)}.bind(this));this.enableQuestion();if(this.model.get("_isEnabled")!==true){this.disableQuestion()}},onCannotSubmit:function onCannotSubmit(){this.dropdowns.forEach(function(dropdown){if(!dropdown.isEmpty())return;dropdown.$el.parents(".matching-select-container").addClass("error")})},onOptionSelected:function onOptionSelected(dropdown){if(this.model.get("_isInteractionComplete"))return;var $container=dropdown.$el.parents(".matching-select-container");$container.removeClass("error");var itemIndex=dropdown.$el.parents(".matching-item").index();if(dropdown.isEmpty())return;var optionIndex=parseInt(dropdown.val());this.model.setOptionSelected(itemIndex,optionIndex,true);this.enableSubmit()},showMarking:function showMarking(){if(!this.model.get("_canShowMarking"))return;this.model.get("_items").forEach(function(item,i){var $item=this.$(".matching-item").eq(i);$item.removeClass("correct incorrect").addClass(item._isCorrect?"correct":"incorrect")},this)},resetQuestion:function resetQuestion(){this.$(".matching-item").removeClass("correct incorrect");this.model.set("_isAtLeastOneCorrectSelection",false);var resetAll=this.model.get("_shouldResetAllAnswers");this.model.get("_items").forEach(function(item,index){if(item._isCorrect&&resetAll===false)return;this.selectValue(index,null);item._options.forEach(function(option,index){option._isSelected=false});item._selected=null},this)},showCorrectAnswer:function showCorrectAnswer(){this.model.get("_items").forEach(function(item,index){var correctOption=_.findWhere(item._options,{_isCorrect:true});this.selectValue(index,correctOption._index)},this)},hideCorrectAnswer:function hideCorrectAnswer(){var answerArray=this.model.has("_tempUserAnswer")?this.model.get("_tempUserAnswer"):this.model.get("_userAnswer");this.model.get("_items").forEach(function(item,index){var key=answerArray[index];var value=item._options[key]._index;this.selectValue(index,value)},this)},selectValue:function selectValue(index,optionIndex){if(!this.dropdowns)return;var dropdown=this.dropdowns[index];if(!dropdown)return;dropdown.select(optionIndex)}});return MatchingView});define("components/adapt-contrib-matching/js/matchingModel",["core/js/models/questionModel"],function(QuestionModel){var MatchingModel=QuestionModel.extend({init:function init(){QuestionModel.prototype.init.call(this);this.setupQuestionItemIndexes()},setupQuestionItemIndexes:function setupQuestionItemIndexes(){this.get("_items").forEach(function(item,index){if(item._index===undefined){item._index=index;item._selected=false}item._options.forEach(function(option,index){if(option._index===undefined){option._index=index;option._isSelected=false}})})},setupRandomisation:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;this.get("_items").forEach(function(item){item._options=_.shuffle(item._options)})},restoreUserAnswers:function restoreUserAnswers(){if(!this.get("_isSubmitted"))return;var userAnswer=this.get("_userAnswer");this.get("_items").forEach(function(item,index){item._options.forEach(function(option,index){if(option._index===userAnswer[item._index]){option._isSelected=true;item._selected=option}})});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()},canSubmit:function canSubmit(){var canSubmit=_.every(this.get("_items"),function(item){return _.findWhere(item._options,{"_isSelected":true})!==undefined});return canSubmit},setOptionSelected:function setOptionSelected(itemIndex,optionIndex,isSelected){var item=this.get("_items")[itemIndex];var option=_.findWhere(item._options,{"_index":optionIndex});option._isSelected=isSelected;item._selected=option},storeUserAnswer:function storeUserAnswer(){var userAnswer=new Array(this.get("_items").length);var tempUserAnswer=new Array(this.get("_items").length);this.get("_items").forEach(function(item,index){var optionIndex=_.findIndex(item._options,function(o){return o._isSelected});tempUserAnswer[item._index]=optionIndex;userAnswer[item._index]=item._options[optionIndex]._index},this);this.set({"_userAnswer":userAnswer,"_tempUserAnswer":tempUserAnswer})},isCorrect:function isCorrect(){var numberOfCorrectAnswers=0;this.get("_items").forEach(function(item,index){var isCorrect=item._selected&&item._selected._isCorrect;if(!isCorrect){item._isCorrect=false;return}numberOfCorrectAnswers++;item._isCorrect=true;this.set({"_numberOfCorrectAnswers":numberOfCorrectAnswers,"_isAtLeastOneCorrectSelection":true})},this);this.set("_numberOfCorrectAnswers",numberOfCorrectAnswers);if(numberOfCorrectAnswers===this.get("_items").length){return true}return false},setScore:function setScore(){var questionWeight=this.get("_questionWeight");if(this.get("_isCorrect")){this.set("_score",questionWeight);return}var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var itemLength=this.get("_items").length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.set("_score",score)},isPartlyCorrect:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")},resetUserAnswer:function resetUserAnswer(){this.set("_userAnswer",[])},getInteractionObject:function getInteractionObject(){var interactions={correctResponsesPattern:null,source:null,target:null};var items=this.get("_items");interactions.correctResponsesPattern=[items.map(function(item,questionIndex){questionIndex=questionIndex+1;return[questionIndex,item._options.filter(function(item){return item._isCorrect}).map(function(item){return questionIndex+"_"+(item._index+1).toString()})].join("[.]")}).join("[,]")];interactions.source=_.flatten(items.map(function(item){return{id:(item._index+1).toString(),description:item.text}}));interactions.target=_.flatten(items.map(function(item,index){index=index+1;return item._options.map(function(option){return{id:index+"_"+(option._index+1),description:option.text}})}));return interactions},getResponse:function getResponse(){var responses=[];this.get("_userAnswer").forEach(function(userAnswer,index){responses.push(index+1+"."+(userAnswer+1))});return responses.join("#")},getResponseType:function getResponseType(){return"matching"}});return MatchingModel});define("components/adapt-contrib-matching/js/adapt-contrib-matching",["core/js/adapt","./matchingView","./matchingModel"],function(Adapt,MatchingView,MatchingModel){if($.a11y&&$.a11y.options&&$.a11y.options.isIOSFixesEnabled){$.a11y.options.isIOSFixesEnabled=false}return Adapt.register("matching",{view:MatchingView,model:MatchingModel})});define("components/adapt-contrib-media/js/adapt-contrib-media",["core/js/adapt","core/js/views/componentView","core/js/models/componentModel","libraries/mediaelement-and-player","libraries/mediaelement-fullscreen-hook"],function(Adapt,ComponentView,ComponentModel){var froogaloopAdded=false;function purge(d){var a=d.attributes,i,l,n;if(a){for(i=a.length-1;i>=0;i-=1){n=a[i].name;if(typeof d[n]==="function"){d[n]=null}}}a=d.childNodes;if(a){l=a.length;for(i=0;i<l;i+=1){purge(d.childNodes[i])}}}_.extend(mejs.MepDefaults,{keyActions:[],defaultSeekForwardInterval:function defaultSeekForwardInterval(duration){if(_typeof(duration)==="object")return duration.duration*0.05;return duration*0.05},defaultSeekBackwardInterval:function defaultSeekBackwardInterval(duration){if(_typeof(duration)==="object")return duration.duration*0.05;return duration*0.05}});var MediaView=ComponentView.extend({events:{"click .media-inline-transcript-button":"onToggleInlineTranscript","click .media-external-transcript-button":"onExternalTranscriptClicked","click .js-skip-to-transcript":"onSkipToTranscript"},className:function className(){var classes=ComponentView.prototype.className.call(this);var playerOptions=this.model.get("_playerOptions");if(playerOptions&&playerOptions.toggleCaptionsButtonWhenOnlyOne){classes+=" toggle-captions"}return classes},preRender:function preRender(){this.listenTo(Adapt,{"device:resize":this.onScreenSizeChanged,"device:changed":this.onDeviceChanged,"media:stop":this.onMediaStop});_.bindAll(this,"onMediaElementPlay","onMediaElementPause","onMediaElementEnded","onMediaElementTimeUpdate","onMediaElementSeeking");this.model.set({"_isMediaEnded":false,"_isMediaPlaying":false});if(this.model.get("_media").source){var media=this.model.get("_media");if(window.location.protocol==="https:"&&media.source.indexOf("http:")===0){media.source=media.source.replace(/^http\:/,"https:")}this.model.set("_media",media)}this.checkIfResetOnRevisit()},postRender:function postRender(){this.setupPlayer()},setupPlayer:function setupPlayer(){if(!this.model.get("_playerOptions"))this.model.set("_playerOptions",{});var modelOptions=this.model.get("_playerOptions");if(modelOptions.pluginPath===undefined)modelOptions.pluginPath="assets/";if(modelOptions.features===undefined){modelOptions.features=["playpause","progress","current","duration"];if(this.model.get("_useClosedCaptions")){modelOptions.features.unshift("tracks")}if(this.model.get("_allowFullScreen")){modelOptions.features.push("fullscreen")}if(this.model.get("_showVolumeControl")){modelOptions.features.push("volume")}}modelOptions.success=_.debounce(this.onPlayerReady.bind(this),100);if(this.model.get("_useClosedCaptions")){var startLanguage=this.model.get("_startLanguage")||"en";if(!Adapt.offlineStorage.get("captions")){Adapt.offlineStorage.set("captions",startLanguage)}modelOptions.startLanguage=this.checkForSupportedCCLanguage(Adapt.offlineStorage.get("captions"))}if(modelOptions.alwaysShowControls===undefined){modelOptions.alwaysShowControls=false}if(modelOptions.hideVideoControlsOnLoad===undefined){modelOptions.hideVideoControlsOnLoad=true}this.addMediaTypeClass();this.addThirdPartyFixes(modelOptions,function createPlayer(){this.$("audio, video").mediaelementplayer(modelOptions);this.cleanUpPlayer();var _media=this.model.get("_media");if(!_media.mp3&&!_media.mp4&&!_media.ogv&&!_media.webm&&!_media.source){Adapt.log.warn("ERROR! No media is selected in components.json for component "+this.model.get("_id"));this.setReadyStatus();return}if(_media.source){this.$(".media-widget").addClass("external-source")}}.bind(this))},addMediaTypeClass:function addMediaTypeClass(){var media=this.model.get("_media");if(media&&media.type){var typeClass=media.type.replace(/\//,"-");this.$(".media-widget").addClass(typeClass)}},addThirdPartyFixes:function addThirdPartyFixes(modelOptions,callback){var media=this.model.get("_media");if(!media)return callback();switch(media.type){case"video/vimeo":modelOptions.alwaysShowControls=false;modelOptions.hideVideoControlsOnLoad=true;modelOptions.features=[];if(froogaloopAdded)return callback();$.getScript("assets/froogaloop.js").done(function(){froogaloopAdded=true;callback()}).fail(function(){froogaloopAdded=false;console.log("Could not load froogaloop.js")});break;default:callback();}},cleanUpPlayer:function cleanUpPlayer(){this.$(".media-widget").children(".mejs-offscreen").remove();this.$("[role=application]").removeAttr("role tabindex");this.$("[aria-controls]").removeAttr("aria-controls")},setupEventListeners:function setupEventListeners(){this.completionEvent=this.model.get("_setCompletionOn")||"play";if(this.completionEvent==="inview"){this.setupInviewCompletion(".component-widget")}if(this.model.get("_preventForwardScrubbing")&&!this.model.get("_isComplete")){$(this.mediaElement).on({"seeking":this.onMediaElementSeeking,"timeupdate":this.onMediaElementTimeUpdate})}$(this.mediaElement).on({"play":this.onMediaElementPlay,"pause":this.onMediaElementPause,"ended":this.onMediaElementEnded});_.delay(this.listenForCaptionsChange.bind(this),250);$(this.mediaElement).on({"play":this.onMediaElementPlay,"pause":this.onMediaElementPause,"ended":this.onMediaElementEnded,"timeupdate":this.onTrackedVideoFrame});this.listenTo(Adapt,"buttons:submit",this.onSubmitClicked)},onSubmitClicked:function onSubmitClicked(event){$(".mediaQuestion-"+(currentIndex+1)).removeClass("showMediaMCQ");var myVideo=document.getElementsByTagName("video")[0];myVideo.play()},onTrackedVideoFrame:function onTrackedVideoFrame(event){var myVideo=document.getElementsByTagName("video")[0];var videoCurrentTime=Math.floor(this.currentTime);for(var i=0;i<arrVideoDuration.length;i++){if(arrVideoDuration[i]===videoCurrentTime){currentIndex=i;this.currentTime=this.currentTime+1;myVideo.pause();$(".mediaQuestion-"+(currentIndex+1)).addClass("showMediaMCQ");console.log("offset value >> "+myVideo.offsetTop)}}},listenForCaptionsChange:function listenForCaptionsChange(){if(!this.model.get("_useClosedCaptions"))return;var selector=this.model.get("_playerOptions").toggleCaptionsButtonWhenOnlyOne?".mejs-captions-button button":".mejs-captions-selector";this.$(selector).on("click.mediaCaptionsChange",_.debounce(function(){var srclang=this.mediaElement.player.selectedTrack?this.mediaElement.player.selectedTrack.srclang:"none";Adapt.offlineStorage.set("captions",srclang);Adapt.trigger("media:captionsChange",this,srclang)}.bind(this),250));this.listenTo(Adapt,"media:captionsChange",this.onCaptionsChanged)},onCaptionsChanged:function onCaptionsChanged(view,lang){if(view&&view.cid===this.cid)return;lang=this.checkForSupportedCCLanguage(lang);this.mediaElement.player.setTrack(lang);var $inputs=this.$(".mejs-captions-selector input");$inputs.filter(":checked").prop("checked",false);$inputs.filter("[value=\""+lang+"\"]").prop("checked",true)},checkForSupportedCCLanguage:function checkForSupportedCCLanguage(lang){if(!lang||lang==="none")return"none";if(_.findWhere(this.model.get("_media").cc,{srclang:lang}))return lang;return this.model.get("_startLanguage")||"none"},onMediaElementPlay:function onMediaElementPlay(event){this.queueGlobalEvent("play");Adapt.trigger("media:stop",this);if(this.model.get("_pauseWhenOffScreen"))$(this.mediaElement).on("inview",this.onMediaElementInview);this.model.set({"_isMediaPlaying":true,"_isMediaEnded":false});if(this.completionEvent==="play"){this.setCompletionStatus()}},onMediaElementPause:function onMediaElementPause(event){this.queueGlobalEvent("pause");$(this.mediaElement).off("inview",this.onMediaElementInview);this.model.set("_isMediaPlaying",false)},onMediaElementEnded:function onMediaElementEnded(event){this.queueGlobalEvent("ended");this.model.set("_isMediaEnded",true);if(this.completionEvent==="ended"){this.setCompletionStatus()}},onMediaElementInview:function onMediaElementInview(event,isInView){if(!isInView&&!event.currentTarget.paused)event.currentTarget.pause()},onMediaElementSeeking:function onMediaElementSeeking(event){var maxViewed=this.model.get("_maxViewed");if(!maxViewed){maxViewed=0}if(event.target.currentTime>maxViewed){event.target.currentTime=maxViewed}},onMediaElementTimeUpdate:function onMediaElementTimeUpdate(event){var maxViewed=this.model.get("_maxViewed");if(!maxViewed){maxViewed=0}if(event.target.currentTime>maxViewed){this.model.set("_maxViewed",event.target.currentTime)}},setupPlayPauseToggle:function setupPlayPauseToggle(){var player=this.mediaElement.player;if(!player){console.log("Media.setupPlayPauseToggle: OOPS! there's no player reference.");return}player.options.clickToPlayPause=false;this.onOverlayClick=this.onOverlayClick.bind(this);this.onMediaElementClick=this.onMediaElementClick.bind(this);this.$(".mejs-overlay-button").on("click",this.onOverlayClick);this.$(".mejs-mediaelement").on("click",this.onMediaElementClick)},onMediaStop:function onMediaStop(view){if(view&&view.cid===this.cid)return;if(!this.mediaElement||!this.mediaElement.player)return;this.mediaElement.player.pause()},onOverlayClick:function onOverlayClick(){var player=this.mediaElement.player;if(!player)return;player.play()},onMediaElementClick:function onMediaElementClick(event){var player=this.mediaElement.player;if(!player)return;var isPaused=player.media.paused;if(!isPaused)player.pause()},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},remove:function remove(){this.$(".mejs-overlay-button").off("click",this.onOverlayClick);this.$(".mejs-mediaelement").off("click",this.onMediaElementClick);if(this.model.get("_useClosedCaptions")){var selector=this.model.get("_playerOptions").toggleCaptionsButtonWhenOnlyOne?".mejs-captions-button button":".mejs-captions-selector";this.$(selector).off("click.mediaCaptionsChange")}var modelOptions=this.model.get("_playerOptions");delete modelOptions.success;var media=this.model.get("_media");if(media){switch(media.type){case"video/vimeo":this.$("iframe")[0].isRemoved=true;}}if(this.mediaElement&&this.mediaElement.player){var player_id=this.mediaElement.player.id;purge(this.$el[0]);this.mediaElement.player.remove();if(mejs.players[player_id]){delete mejs.players[player_id]}}if(this.mediaElement){$(this.mediaElement).off({"play":this.onMediaElementPlay,"pause":this.onMediaElementPause,"ended":this.onMediaElementEnded,"seeking":this.onMediaElementSeeking,"timeupdate":this.onMediaElementTimeUpdate,"inview":this.onMediaElementInview});this.mediaElement.src="";$(this.mediaElement.pluginElement).remove();delete this.mediaElement}ComponentView.prototype.remove.call(this)},onDeviceChanged:function onDeviceChanged(){if(this.model.get("_media").source){this.$(".mejs-container").width(this.$(".component-widget").width())}},onPlayerReady:function onPlayerReady(mediaElement,domObject){this.mediaElement=mediaElement;var player=this.mediaElement.player;if(!player)player=mejs.players[this.$(".mejs-container").attr("id")];var hasTouch=mejs.MediaFeatures.hasTouch;if(hasTouch){this.setupPlayPauseToggle()}this.addThirdPartyAfterFixes();this.cleanUpPlayerAfter();if(player&&this.model.has("_startVolume")){player.setVolume(parseInt(this.model.get("_startVolume"))/100)}this.setReadyStatus();this.setupEventListeners()},addThirdPartyAfterFixes:function addThirdPartyAfterFixes(){var media=this.model.get("_media");switch(media.type){case"video/vimeo":this.$(".mejs-container").attr("tabindex",0);}},cleanUpPlayerAfter:function cleanUpPlayerAfter(){this.$("[aria-valuemax='NaN']").attr("aria-valuemax",0)},onScreenSizeChanged:function onScreenSizeChanged(){this.$("audio, video").width(this.$(".component-widget").width())},onSkipToTranscript:function onSkipToTranscript(){_.delay(function(){this.$(".media-transcript-container button").a11y_focus()}.bind(this),250)},onToggleInlineTranscript:function onToggleInlineTranscript(event){if(event)event.preventDefault();var $transcriptBodyContainer=this.$(".media-inline-transcript-body-container");var $button=this.$(".media-inline-transcript-button");var $buttonText=this.$(".media-inline-transcript-button .transcript-text-container");if($transcriptBodyContainer.hasClass("inline-transcript-open")){$transcriptBodyContainer.stop(true,true).slideUp(function(){$(window).resize()});$button.attr("aria-expanded",false);$transcriptBodyContainer.removeClass("inline-transcript-open");$buttonText.html(this.model.get("_transcript").inlineTranscriptButton)}else{$transcriptBodyContainer.stop(true,true).slideDown(function(){$(window).resize()});$button.attr("aria-expanded",true);$transcriptBodyContainer.addClass("inline-transcript-open");$buttonText.html(this.model.get("_transcript").inlineTranscriptCloseButton);if(this.model.get("_transcript")._setCompletionOnView!==false){this.setCompletionStatus()}}},onExternalTranscriptClicked:function onExternalTranscriptClicked(event){if(this.model.get("_transcript")._setCompletionOnView!==false){this.setCompletionStatus()}},queueGlobalEvent:function queueGlobalEvent(eventType){var t=Date.now();var lastEvent=this.lastEvent||{time:0};var timeSinceLastEvent=t-lastEvent.time;var debounceTime=500;this.lastEvent={time:t,type:eventType};clearTimeout(this.eventTimeout);if(eventType==="ended"){return this.triggerGlobalEvent(eventType)}if(timeSinceLastEvent>debounceTime){this.eventTimeout=setTimeout(this.triggerGlobalEvent.bind(this,eventType),debounceTime)}},triggerGlobalEvent:function triggerGlobalEvent(eventType){var player=this.mediaElement.player;var eventObj={type:eventType,src:this.mediaElement.src,platform:this.mediaElement.pluginType};if(player)eventObj.isVideo=player.isVideo;Adapt.trigger("media",eventObj)}});return Adapt.register("media",{model:ComponentModel.extend({}),view:MediaView})});define("components/adapt-contrib-narrative/js/adapt-contrib-narrative",["require","coreViews/componentView","coreJS/adapt"],function(require){var ComponentView=require("coreViews/componentView");var Adapt=require("coreJS/adapt");var Narrative=ComponentView.extend({events:{"click .narrative-strapline-title":"openPopup","click .narrative-controls":"onNavigationClicked","click .narrative-indicators .narrative-progress":"onProgressClicked","click .narrative-slider-graphic":"graphic_handler","click .close_btn":"close_handler","click .strategy_btn":"strategy_handler"},graphic_handler:function graphic_handler(event){if(this.model.get("_classes")=="custom_M9"&&this.model.get("_stage")==1){this.$(".popup_img").addClass("visible")}},close_handler:function close_handler(){this.$(".popup_img").removeClass("visible");this.$(".popup_trategy").removeClass("visible")},strategy_handler:function strategy_handler(){this.$(".popup_trategy").addClass("visible")},preRender:function preRender(){this.listenTo(Adapt,"device:changed",this.reRender,this);this.listenTo(Adapt,"device:resize",this.resizeControl,this);this.listenTo(Adapt,"notify:closed",this.closeNotify,this);this.setDeviceSize();this.checkIfResetOnRevisit()},setDeviceSize:function setDeviceSize(){if(Adapt.device.screenSize==="large"){this.$el.addClass("desktop").removeClass("mobile");this.model.set("_isDesktop",true)}else{this.$el.addClass("mobile").removeClass("desktop");this.model.set("_isDesktop",false)}},postRender:function postRender(){this.renderState();this.$(".narrative-slider").imageready(_.bind(function(){this.setReadyStatus()},this));this.setupNarrative()},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit);this.model.set({_stage:0});_.each(this.model.get("_items"),function(item){item._isVisited=false})}},setupNarrative:function setupNarrative(){this.setDeviceSize();if(!this.model.has("_items")||!this.model.get("_items").length)return;this.model.set("_marginDir","left");if(Adapt.config.get("_defaultDirection")=="rtl"){this.model.set("_marginDir","right")}this.model.set("_itemCount",this.model.get("_items").length);this.model.set("_active",true);if(this.model.get("_stage")){this.setStage(this.model.get("_stage"),true)}else{this.setStage(0,true)}this.calculateWidths();if(Adapt.device.screenSize!=="large"&&!this.model.get("_wasHotgraphic")){this.replaceInstructions()}this.setupEventListeners();var hasNavigationInTextArea=this.model.get("_hasNavigationInTextArea");if(hasNavigationInTextArea==true){var indicatorWidth=this.$(".narrative-indicators").width();var marginLeft=indicatorWidth/2;this.$(".narrative-indicators").css({marginLeft:"-"+marginLeft+"px"})}},calculateWidths:function calculateWidths(){var slideWidth=this.$(".narrative-slide-container").width();var slideCount=this.model.get("_itemCount");var marginRight=this.$(".narrative-slider-graphic").css("margin-right");var extraMargin=marginRight===""?0:parseInt(marginRight);var fullSlideWidth=(slideWidth+extraMargin)*slideCount;this.$(".narrative-slider-graphic").width(slideWidth);this.$(".narrative-strapline-header").width(slideWidth);this.$(".narrative-strapline-title").width(slideWidth);this.$(".narrative-slider").width(fullSlideWidth);this.$(".narrative-strapline-header-inner").width(fullSlideWidth);var stage=this.model.get("_stage");var margin=-(stage*slideWidth);this.$(".narrative-slider").css("margin-"+this.model.get("_marginDir"),margin);this.$(".narrative-strapline-header-inner").css("margin-"+this.model.get("_marginDir"),margin);this.model.set("_finalItemLeft",fullSlideWidth-slideWidth)},resizeControl:function resizeControl(){var wasDesktop=this.model.get("_isDesktop");this.setDeviceSize();if(wasDesktop!=this.model.get("_isDesktop"))this.replaceInstructions();this.calculateWidths();this.evaluateNavigation()},reRender:function reRender(){if(this.model.get("_wasHotgraphic")&&Adapt.device.screenSize=="large"){this.replaceWithHotgraphic()}else{this.resizeControl()}},closeNotify:function closeNotify(){this.evaluateCompletion()},replaceInstructions:function replaceInstructions(){if(Adapt.device.screenSize==="large"){this.$(".narrative-instruction-inner").html(this.model.get("instruction")).a11y_text()}else if(this.model.get("mobileInstruction")&&!this.model.get("_wasHotgraphic")){this.$(".narrative-instruction-inner").html(this.model.get("mobileInstruction")).a11y_text()}},replaceWithHotgraphic:function replaceWithHotgraphic(){if(!Adapt.componentStore.hotgraphic)throw"Hotgraphic not included in build";var Hotgraphic=Adapt.componentStore.hotgraphic;var model=this.prepareHotgraphicModel();var newHotgraphic=new Hotgraphic({model:model});var $container=$(".component-container",$("."+this.model.get("_parentId")));$container.append(newHotgraphic.$el);this.remove();$.a11y_update();_.defer(function(){Adapt.trigger("device:resize")})},prepareHotgraphicModel:function prepareHotgraphicModel(){var model=this.model;model.set("_component","hotgraphic");model.set("body",model.get("originalBody"));model.set("instruction",model.get("originalInstruction"));return model},moveSliderToIndex:function moveSliderToIndex(itemIndex,animate,callback){var extraMargin=parseInt(this.$(".narrative-slider-graphic").css("margin-right"));var movementSize=this.$(".narrative-slide-container").width()+extraMargin;var marginDir={};if(animate&&!Adapt.config.get("_disableAnimation")){marginDir["margin-"+this.model.get("_marginDir")]=-(movementSize*itemIndex);this.$(".narrative-slider").velocity("stop",true).velocity(marginDir);this.$(".narrative-strapline-header-inner").velocity("stop",true).velocity(marginDir,{complete:callback})}else{marginDir["margin-"+this.model.get("_marginDir")]=-(movementSize*itemIndex);this.$(".narrative-slider").css(marginDir);this.$(".narrative-strapline-header-inner").css(marginDir);callback()}},setStage:function setStage(stage,initial){this.model.set("_stage",stage);if(this.model.get("_isDesktop")){var currentItem=this.getCurrentItem(stage);currentItem._isVisited=true}this.$(".narrative-progress:visible").removeClass("selected").eq(stage).addClass("selected");this.$(".narrative-slider-graphic").children(".controls").a11y_cntrl_enabled(false);this.$(".narrative-slider-graphic").eq(stage).children(".controls").a11y_cntrl_enabled(true);this.$(".narrative-content-item").addClass("narrative-hidden").a11y_on(false).eq(stage).removeClass("narrative-hidden").a11y_on(true);this.$(".narrative-strapline-title").a11y_cntrl_enabled(false).eq(stage).a11y_cntrl_enabled(true);this.evaluateNavigation();this.evaluateCompletion();this.moveSliderToIndex(stage,!initial,_.bind(function(){if(this.model.get("_isDesktop")){if(!initial)this.$(".narrative-content-item").eq(stage).a11y_focus()}else{if(!initial)this.$(".narrative-strapline-title").a11y_focus()}},this))},constrainStage:function constrainStage(stage){if(stage>this.model.get("_items").length-1){stage=this.model.get("_items").length-1}else if(stage<0){stage=0}return stage},constrainXPosition:function constrainXPosition(previousLeft,newLeft,deltaX){if(newLeft>0&&deltaX>0){newLeft=previousLeft+deltaX/(newLeft*0.1)}var finalItemLeft=this.model.get("_finalItemLeft");if(newLeft<-finalItemLeft&&deltaX<0){var distance=Math.abs(newLeft+finalItemLeft);newLeft=previousLeft+deltaX/(distance*0.1)}return newLeft},evaluateNavigation:function evaluateNavigation(){var currentStage=this.model.get("_stage");var itemCount=this.model.get("_itemCount");if(currentStage==0){this.$(".narrative-controls").addClass("narrative-hidden");if(itemCount>1){this.$(".narrative-control-right").removeClass("narrative-hidden")}}else{this.$(".narrative-control-left").removeClass("narrative-hidden");if(currentStage==itemCount-1){this.$(".narrative-control-right").addClass("narrative-hidden")}else{this.$(".narrative-control-right").removeClass("narrative-hidden")}}},getNearestItemIndex:function getNearestItemIndex(){var currentPosition=parseInt(this.$(".narrative-slider").css("margin-left"));var graphicWidth=this.$(".narrative-slider-graphic").width();var absolutePosition=currentPosition/graphicWidth;var stage=this.model.get("_stage");var relativePosition=stage-Math.abs(absolutePosition);if(relativePosition<-0.3){stage++}else if(relativePosition>0.3){stage--}return this.constrainStage(stage)},getCurrentItem:function getCurrentItem(index){return this.model.get("_items")[index]},getVisitedItems:function getVisitedItems(){return _.filter(this.model.get("_items"),function(item){return item._isVisited})},evaluateCompletion:function evaluateCompletion(){if(this.getVisitedItems().length===this.model.get("_items").length){this.trigger("allItems")}},moveElement:function moveElement($element,deltaX){var previousLeft=parseInt($element.css("margin-left"));var newLeft=previousLeft+deltaX;newLeft=this.constrainXPosition(previousLeft,newLeft,deltaX);$element.css("margin-"+this.model.get("_marginDir"),newLeft+"px")},openPopup:function openPopup(event){event.preventDefault();var currentItem=this.getCurrentItem(this.model.get("_stage"));var popupObject={title:currentItem.title,body:currentItem.body};currentItem._isVisited=true;Adapt.trigger("notify:popup",popupObject)},onNavigationClicked:function onNavigationClicked(event){if(!this.model.get("_active"))return;var stage=this.model.get("_stage");var numberOfItems=this.model.get("_itemCount");if($(event.currentTarget).hasClass("narrative-control-right")){stage++}else if($(event.currentTarget).hasClass("narrative-control-left")){stage--}stage=(stage+numberOfItems)%numberOfItems;this.setStage(stage)},onProgressClicked:function onProgressClicked(event){event.preventDefault();var clickedIndex=$(event.target).index();this.setStage(clickedIndex)},inview:function inview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop&&this._isVisibleBottom){this.$(".component-inner").off("inview");this.setCompletionStatus()}}},onCompletion:function onCompletion(){this.setCompletionStatus();if(this.completionEvent&&this.completionEvent!="inview"){this.off(this.completionEvent,this)}},setupEventListeners:function setupEventListeners(){this.completionEvent=!this.model.get("_setCompletionOn")?"allItems":this.model.get("_setCompletionOn");if(this.completionEvent!=="inview"&&this.model.get("_items").length>1){this.on(this.completionEvent,_.bind(this.onCompletion,this))}else{this.$(".component-widget").on("inview",_.bind(this.inview,this))}}});Adapt.register("narrative",Narrative);return Narrative});define("components/adapt-contrib-slider/js/sliderView",["core/js/adapt","core/js/views/questionView"],function(Adapt,QuestionView){var SliderView=QuestionView.extend({events:{"click .slider-scale-number":"onNumberSelected","focus input[type=\"range\"]":"onHandleFocus","blur input[type=\"range\"]":"onHandleBlur"},resetQuestionOnRevisit:function resetQuestionOnRevisit(){this.setAllItemsEnabled();this.model.deselectAllItems();this.resetQuestion()},setupQuestion:function setupQuestion(){if(this.model.get("_isSubmitted"))return;this.selectItem(this.getIndexFromValue(this.model.get("_selectedItem").value),true)},setupRangeslider:function setupRangeslider(){this.$sliderScaleMarker=this.$(".slider-scale-marker");this.$slider=this.$("input[type=\"range\"]");if(this.model.has("_scaleStep")){this.$slider.attr({"step":this.model.get("_scaleStep")})}this.$slider.rangeslider({polyfill:false,onSlide:_.bind(this.handleSlide,this)});this.oldValue=0;if(this._deferEnable){this.setAllItemsEnabled()}},handleSlide:function handleSlide(position,value){if(this.oldValue===value){return}var itemIndex=this.getIndexFromValue(value);var pixels=this.mapIndexToPixels(itemIndex);this.selectItem(itemIndex,false);this.animateToPosition(pixels);this.oldValue=value},disableQuestion:function disableQuestion(){this.setAllItemsEnabled()},enableQuestion:function enableQuestion(){this.setAllItemsEnabled()},setAllItemsEnabled:function setAllItemsEnabled(){var isEnabled=this.model.get("_isEnabled");if(!this.$slider){this._deferEnable=true;return}if(!isEnabled){this.$(".slider-widget").addClass("disabled");this.$slider.prop("disabled",true).rangeslider("update",true);return}this.$(".slider-widget").removeClass("disabled");this.$slider.prop("disabled",false).rangeslider("update",true)},onQuestionRendered:function onQuestionRendered(){this.setupRangeslider();this.setScalePositions();this.onScreenSizeChanged();this.showScaleMarker(true);this.listenTo(Adapt,"device:resize",this.onScreenSizeChanged);this.setAltText(this.model.get("_scaleStart"));this.setReadyStatus()},animateToPosition:function animateToPosition(newPosition){if(!this.$sliderScaleMarker)return;this.$sliderScaleMarker.velocity("stop").velocity({left:newPosition},{duration:200,easing:"linear",mobileHA:false})},getIndexFromValue:function getIndexFromValue(itemValue){var scaleStart=this.model.get("_scaleStart");var scaleEnd=this.model.get("_scaleEnd");return Math.round(this.mapValue(itemValue,scaleStart,scaleEnd,0,this.model.get("_items").length-1))},setAltText:function setAltText(value){this.$(".slider-handle").attr("aria-valuenow",value)},mapIndexToPixels:function mapIndexToPixels(value,$widthObject){var numberOfItems=this.model.get("_items").length;var width=$widthObject?$widthObject.width():this.$(".slider-scaler").width();return Math.round(this.mapValue(value,0,numberOfItems-1,0,width))},mapPixelsToIndex:function mapPixelsToIndex(value){var numberOfItems=this.model.get("_items").length;var width=this.$(".slider-sliderange").width();return Math.round(this.mapValue(value,0,width,0,numberOfItems-1))},normalise:function normalise(value,low,high){var range=high-low;return(value-low)/range},mapValue:function mapValue(value,inputLow,inputHigh,outputLow,outputHigh){var normal=this.normalise(value,inputLow,inputHigh);return normal*(outputHigh-outputLow)+outputLow},onHandleFocus:function onHandleFocus(event){event.preventDefault();this.$slider.on("keydown",_.bind(this.onKeyDown,this))},onHandleBlur:function onHandleBlur(event){event.preventDefault();this.$slider.off("keydown")},onKeyDown:function onKeyDown(event){if(event.which===9)return;event.preventDefault();var newItemIndex=this.getIndexFromValue(this.model.get("_selectedItem").value);switch(event.which){case 40:case 37:newItemIndex=Math.max(newItemIndex-1,0);break;case 38:case 39:newItemIndex=Math.min(newItemIndex+1,this.model.get("_items").length-1);break;}this.selectItem(newItemIndex);if(typeof newItemIndex==="number")this.showScaleMarker(true);this.animateToPosition(this.mapIndexToPixels(newItemIndex));this.setSliderValue(this.getValueFromIndex(newItemIndex));this.setAltText(this.getValueFromIndex(newItemIndex))},onNumberSelected:function onNumberSelected(event){event.preventDefault();if(this.model.get("_isInteractionComplete")){return}if(this.$slider.prop("disabled")){return}var itemValue=parseFloat($(event.currentTarget).attr("data-id"));var index=this.getIndexFromValue(itemValue);this.selectItem(index);this.animateToPosition(this.mapIndexToPixels(index));this.setAltText(itemValue);this.setSliderValue(itemValue)},getValueFromIndex:function getValueFromIndex(index){return this.model.get("_items")[index].value},resetControlStyles:function resetControlStyles(){this.$(".slider-handle").empty();this.showScaleMarker(false);this.$(".slider-bar").animate({width:"0px"});this.setSliderValue(this.model.get("_items")[0].value)},onCannotSubmit:function onCannotSubmit(){},setSliderValue:function setSliderValue(value){if(this.$slider){this.$slider.val(value).change()}},showMarking:function showMarking(){if(!this.model.get("_canShowMarking"))return;this.$(".slider-widget").removeClass("correct incorrect").addClass(this.model.get("_selectedItem").correct?"correct":"incorrect")},resetQuestion:function resetQuestion(){this.selectItem(0,true);this.animateToPosition(0);this.resetControlStyles();this.showScaleMarker(true);this.setAltText(this.model.get("_scaleStart"))},setScalePositions:function setScalePositions(){var numberOfItems=this.model.get("_items").length;_.each(this.model.get("_items"),function(item,index){var normalisedPosition=this.normalise(index,0,numberOfItems-1);this.$(".slider-scale-number").eq(index).data("normalisedPosition",normalisedPosition)},this)},showScale:function showScale(){var $markers=this.$(".slider-markers").empty();if(this.model.get("_showScale")===false){$markers.eq(0).css({display:"none"});this.$(".slider-scale-number").css(this.model.get("_showScaleIndicator")?{visibility:"hidden"}:{display:"none"});return}var $scaler=this.$(".slider-scaler");for(var i=1,count=this.model.get("_items").length-1;i<count;i++){$markers.append("<div class='slider-line component-item-color' style='left: "+this.mapIndexToPixels(i,$scaler)+"px'>")}this.showScaleNumbers()},showScaleNumbers:function showScaleNumbers(){var $scaler=this.$(".slider-scaler");var $numbers=this.$(".slider-scale-number");if(this.model.get("_showScaleNumbers")===false){$numbers.css("display","none");return}var scaleWidth=$scaler.width();this.model.get("_items").forEach(function(item,index){var $number=$numbers.eq(index);var newLeft=Math.round($number.data("normalisedPosition")*scaleWidth);$number.css({left:newLeft})})},showLabels:function showLabels(){if(!this.model.get("labelStart")&&!this.model.get("labelEnd")){this.$(".slider-scale-labels").eq(0).css({display:"none"})}},remapSliderBar:function remapSliderBar(){var $scaler=this.$(".slider-scaler");var currentIndex=this.getIndexFromValue(this.model.get("_selectedItem").value);var left=this.mapIndexToPixels(currentIndex,$scaler);this.$(".slider-handle").css({left:left+"px"});this.$(".slider-scale-marker").css({left:left+"px"});this.$(".slider-bar").width(left)},onScreenSizeChanged:function onScreenSizeChanged(){this.showScale();this.showLabels();this.remapSliderBar();if(this.$(".slider-widget").hasClass("show-user-answer")){this.hideCorrectAnswer()}else if(this.$(".slider-widget").hasClass("show-correct-answer")){this.showCorrectAnswer()}},showCorrectAnswer:function showCorrectAnswer(){var answers=[];if(this.model.has("_correctAnswer")){var correctAnswer=this.model.get("_correctAnswer")}if(this.model.has("_correctRange")){var bottom=this.model.get("_correctRange")._bottom;var top=this.model.get("_correctRange")._top;var step=this.model.has("_scaleStep")?this.model.get("_scaleStep"):1}this.showScaleMarker(false);if(correctAnswer){answers.push(correctAnswer)}else if(bottom!==undefined&&top!==undefined){var answer=this.model.get("_correctRange")._bottom;var topOfRange=this.model.get("_correctRange")._top;while(answer<=topOfRange){answers.push(answer);answer+=step}}else{console.log("adapt-contrib-slider::WARNING: no correct answer or correct range set in JSON")}var middleAnswer=answers[Math.floor(answers.length/2)];this.animateToPosition(this.mapIndexToPixels(this.getIndexFromValue(middleAnswer)));this.showModelAnswers(answers);this.setSliderValue(middleAnswer)},showModelAnswers:function showModelAnswers(correctAnswerArray){var $parentDiv=this.$(".slider-modelranges");_.each(correctAnswerArray,function(correctAnswer,index){$parentDiv.append($("<div class='slider-model-answer component-item-color component-item-text-color'>"));var $element=$(this.$(".slider-modelranges .slider-model-answer")[index]);var startingLeft=this.mapIndexToPixels(this.getIndexFromValue(this.model.get("_selectedItem").value));if(this.model.get("_showNumber"))$element.html(correctAnswer);$element.css({left:startingLeft}).fadeIn(0,_.bind(function(){$element.animate({left:this.mapIndexToPixels(this.getIndexFromValue(correctAnswer))})},this))},this)},hideCorrectAnswer:function hideCorrectAnswer(){var userAnswerIndex=this.getIndexFromValue(this.model.get("_userAnswer"));this.$(".slider-modelranges").empty();this.showScaleMarker(true);this.selectItem(userAnswerIndex,true);this.animateToPosition(this.mapIndexToPixels(userAnswerIndex));this.setSliderValue(this.model.get("_userAnswer"))},selectItem:function selectItem(itemIndex,noFocus){_.each(this.model.get("_items"),function(item,index){item.selected=index===itemIndex;if(item.selected){this.model.set("_selectedItem",item);this.$("input").attr({"value":item.value,"aria-valuenow":item.value})}},this);this.showNumber(true)},showScaleMarker:function showScaleMarker(show){var $scaleMarker=this.$(".slider-scale-marker");if(this.model.get("_showScaleIndicator")){this.showNumber(show);if(show){$scaleMarker.addClass("display-block")}else{$scaleMarker.removeClass("display-block")}}},showNumber:function showNumber(show){var $scaleMarker=this.$(".slider-scale-marker");if(this.model.get("_showNumber")){if(show){$scaleMarker.html(this.model.get("_selectedItem").value)}else{$scaleMarker.html=""}}}});return SliderView});define("components/adapt-contrib-slider/js/sliderModel",["core/js/adapt","core/js/models/questionModel"],function(Adapt,QuestionModel){var SliderModel=QuestionModel.extend({init:function init(){QuestionModel.prototype.init.call(this);this.setupModelItems();this.set("_selectedItem",this.get("_items")[0])},getDecimalPlaces:function getDecimalPlaces(num){return(num.toString().split(".")[1]||[]).length},setupModelItems:function setupModelItems(){var items=[];var answer=this.get("_correctAnswer");var range=this.get("_correctRange");var start=this.get("_scaleStart");var end=this.get("_scaleEnd");var step=this.get("_scaleStep")||1;var dp=this.getDecimalPlaces(step);for(var i=start;i<=end;i+=step){if(dp!==0){i=parseFloat(i.toFixed(dp))}items.push({value:i,selected:false,correct:answer?i===Number(answer):i>=range._bottom&&i<=range._top})}this.set({"_items":items,"_marginDir":Adapt.config.get("_defaultDirection")==="rtl"?"right":"left"})},canSubmit:function canSubmit(){return true},restoreUserAnswers:function restoreUserAnswers(){if(!this.get("_isSubmitted")){this.set({_selectedItem:{},_userAnswer:undefined});return}var items=this.get("_items");var userAnswer=this.get("_userAnswer");for(var i=0,l=items.length;i<l;i++){var item=items[i];if(item.value===userAnswer){item.selected=true;this.set("_selectedItem",item);break}}this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()},storeUserAnswer:function storeUserAnswer(){this.set("_userAnswer",this.get("_selectedItem").value)},resetUserAnswer:function resetUserAnswer(){this.set({_isAtLeastOneCorrectSelection:false,_selectedItem:{},_userAnswer:undefined})},deselectAllItems:function deselectAllItems(){_.each(this.get("_items"),function(item){item.selected=false},this)},isCorrect:function isCorrect(){var numberOfCorrectAnswers=0;_.each(this.get("_items"),function(item,index){if(item.selected&&item.correct){this.set("_isAtLeastOneCorrectSelection",true);numberOfCorrectAnswers++}},this);this.set("_numberOfCorrectAnswers",numberOfCorrectAnswers);return this.get("_isAtLeastOneCorrectSelection")?true:false},isPartlyCorrect:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")},setScore:function setScore(){var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var questionWeight=this.get("_questionWeight");var score=questionWeight*numberOfCorrectAnswers;this.set("_score",score)},getResponse:function getResponse(){return this.get("_userAnswer").toString()},getResponseType:function getResponseType(){return"numeric"}});return SliderModel});define("components/adapt-contrib-slider/js/adapt-contrib-slider",["core/js/adapt","./sliderView","./sliderModel","libraries/rangeslider"],function(Adapt,SliderView,SliderModel){return Adapt.register("slider",{view:SliderView,model:SliderModel})});define("components/adapt-contrib-text/js/adapt-contrib-text",["require","coreViews/componentView","coreJS/adapt"],function(require){var ComponentView=require("coreViews/componentView");var Adapt=require("coreJS/adapt");var branch1=false;var branch2=false;var branch3=false;var branch4=false;var branch5=false;var branch6=false;var branch7=false;var onPageVisit1=false;var onPageVisit2=false;var onPageVisit3=false;var Text=ComponentView.extend({events:{"click .branching3.imgbranch1":"oncustomButtonView1","click .branching3.imgbranch2":"oncustomButtonView2","click .branching3.imgbranch3":"oncustomButtonView3","click .branching3.img01":"oncustomButtonView4","click .branching3.img02":"oncustomButtonView5","click .branching3.img001":"oncustomButtonView6","click .branching3.img002":"oncustomButtonView7","click .component-body-inner":"graphic_handler","click .close_btn":"close_handler","click .strategy_btn":"strategy_handler"},graphic_handler:function graphic_handler(event){if(this.model.get("_classes")=="custom_M3"&&this.model.get("_stage")==1){this.$(".popup_img").addClass("visible")}},close_handler:function close_handler(){this.$(".popup_img").removeClass("visible");this.$(".popup_trategy").removeClass("visible")},strategy_handler:function strategy_handler(){this.$(".popup_trategy").addClass("visible")},initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.render()},oncustomButtonView1:function oncustomButtonView1(event){branch1=true;onPageVisit1=true},oncustomButtonView2:function oncustomButtonView2(event){branch2=true;onPageVisit1=true},oncustomButtonView3:function oncustomButtonView3(event){branch3=true;onPageVisit1=true},oncustomButtonView4:function oncustomButtonView4(event){branch4=true;onPageVisit2=true},oncustomButtonView5:function oncustomButtonView5(event){branch5=true;onPageVisit2=true},oncustomButtonView6:function oncustomButtonView6(event){branch6=true;onPageVisit3=true},oncustomButtonView7:function oncustomButtonView7(event){branch7=true;onPageVisit3=true},scrollToPageElement:function scrollToPageElement(event){var currentComponentSelector1=".c-01_00-20";var $currentComponent1=$(currentComponentSelector1);if(onPageVisit2){Adapt.scrollTo(currentComponentSelector2,{duration:400})}if(onPageVisit3){}if(onPageVisit1){Adapt.scrollTo(currentComponentSelector1,{duration:400})}},preRender:function preRender(){this.checkIfResetOnRevisit()},postRender:function postRender(){this.setReadyStatus();this.setupInview();this.scrollToPageElement();if(branch1){this.$(".branching3.imgbranch1").addClass("visited")}if(branch2){this.$(".branching3.imgbranch2").addClass("visited")}if(branch3){this.$(".branching3.imgbranch3").addClass("visited")}if(branch4){this.$(".branching3.img01").addClass("visited")}if(branch5){this.$(".branching3.img02").addClass("visited")}if(branch6){this.$(".branching3.img001").addClass("visited")}if(branch7){this.$(".branching3.img002").addClass("visited")}},setupInview:function setupInview(){var selector=this.getInviewElementSelector();if(!selector){this.setCompletionStatus()}else{this.model.set("inviewElementSelector",selector);this.$(selector).on("inview",_.bind(this.inview,this))}},getInviewElementSelector:function getInviewElementSelector(){if(this.model.get("body"))return".component-body";if(this.model.get("instruction"))return".component-instruction";if(this.model.get("displayTitle"))return".component-title";return null},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},inview:function inview(event,visible,visiblePartX,visiblePartY){if(visible){if(visiblePartY==="top"){this._isVisibleTop=true}else if(visiblePartY==="bottom"){this._isVisibleBottom=true}else{this._isVisibleTop=true;this._isVisibleBottom=true}if(this._isVisibleTop&&this._isVisibleBottom){this.$(this.model.get("inviewElementSelector")).off("inview");this.setCompletionStatus()}}},remove:function remove(){if(this.model.has("inviewElementSelector")){this.$(this.model.get("inviewElementSelector")).off("inview")}ComponentView.prototype.remove.call(this)}},{template:"text"});Adapt.register("text",Text);return Text});define("components/adapt-contrib-textInput/js/textInputView",["core/js/views/questionView"],function(QuestionView){var TextInputView=QuestionView.extend({events:{"focus input":"clearValidationError","change input":"onInputChanged"},resetQuestionOnRevisit:function resetQuestionOnRevisit(){this.setAllItemsEnabled(false);this.resetQuestion()},setupQuestion:function setupQuestion(){this.model.setupRandomisation()},disableQuestion:function disableQuestion(){this.setAllItemsEnabled(false)},enableQuestion:function enableQuestion(){this.setAllItemsEnabled(true)},setAllItemsEnabled:function setAllItemsEnabled(isEnabled){this.model.get("_items").forEach(function(item,index){var $itemInput=this.$("input").eq(index);$itemInput.prop("disabled",!isEnabled)},this)},onQuestionRendered:function onQuestionRendered(){this.setReadyStatus()},clearValidationError:function clearValidationError(){this.$(".textinput-item-textbox").removeClass("textinput-validation-error")},onCannotSubmit:function onCannotSubmit(){this.showValidationError()},showValidationError:function showValidationError(){this.$(".textinput-item-textbox").addClass("textinput-validation-error")},showMarking:function showMarking(){if(!this.model.get("_canShowMarking"))return;this.model.get("_items").forEach(function(item,i){var $item=this.$(".textinput-item").eq(i);$item.removeClass("correct incorrect").addClass(item._isCorrect?"correct":"incorrect")},this)},resetQuestion:function resetQuestion(){this.$(".textinput-item-textbox").prop("disabled",!this.model.get("_isEnabled")).val("");this.model.set({_isAtLeastOneCorrectSelection:false,_isCorrect:undefined})},showCorrectAnswer:function showCorrectAnswer(){if(this.model.get("_answers")){var correctAnswers=this.model.get("_answers");this.model.get("_items").forEach(function(item,index){this.$(".textinput-item-textbox").eq(index).val(correctAnswers[index][0])},this)}else{this.model.get("_items").forEach(function(item,index){this.$(".textinput-item-textbox").eq(index).val(item._answers[0])},this)}},hideCorrectAnswer:function hideCorrectAnswer(){this.model.get("_items").forEach(function(item,index){this.$(".textinput-item-textbox").eq(index).val(item.userAnswer)},this)},onInputChanged:function onInputChanged(e){var $input=$(e.target);this.model.setItemUserAnswer($input.parent(".component-item").index(),$input.val())}});return TextInputView});define("components/adapt-contrib-textInput/js/textInputModel",["core/js/models/questionModel"],function(QuestionModel){var TextInputModel=QuestionModel.extend({init:function init(){QuestionModel.prototype.init.call(this);this.set("_genericAnswerIndexOffset",TextInputModel.genericAnswerIndexOffset);this.setupQuestionItemIndexes()},setupQuestionItemIndexes:function setupQuestionItemIndexes(){this.get("_items").forEach(function(item,index){if(item._index===undefined)item._index=index;if(item._answerIndex===undefined)item._answerIndex=-1})},restoreUserAnswers:function restoreUserAnswers(){if(!this.get("_isSubmitted"))return;var userAnswer=this.get("_userAnswer");var genericAnswers=this.get("_answers");this.get("_items").forEach(function(item){var answerIndex=userAnswer[item._index];if(answerIndex>=TextInputModel.genericAnswerIndexOffset){item.userAnswer=genericAnswers[answerIndex-TextInputModel.genericAnswerIndexOffset];item._answerIndex=answerIndex}else if(answerIndex>-1){item.userAnswer=item._answers[answerIndex];item._answerIndex=answerIndex}else{if(item.userAnswer===undefined)item.userAnswer="******";item._answerIndex=-1}if(item.userAnswer instanceof Array)item.userAnswer=item.userAnswer[0]});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()},setupRandomisation:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;this.set("_items",_.shuffle(this.get("_items")))},canSubmit:function canSubmit(){var canSubmit=_.every(this.get("_items"),function(item){return item.userAnswer!==""});return canSubmit},setItemUserAnswer:function setItemUserAnswer(itemIndex,userAnswer){var item=this.get("_items")[itemIndex];item.userAnswer=userAnswer},storeUserAnswer:function storeUserAnswer(){var items=this.get("_items");this.isCorrect();var userAnswer=new Array(items.length);items.forEach(function(item,index){userAnswer[item._index]=item._answerIndex});this.set("_userAnswer",userAnswer)},isCorrect:function isCorrect(){if(this.get("_answers")){this.markGenericAnswers()}else{this.markSpecificAnswers()}return!_.contains(_.pluck(this.get("_items"),"_isCorrect"),false)},isPartlyCorrect:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")},markGenericAnswers:function markGenericAnswers(){var numberOfCorrectAnswers=0;var correctAnswers=this.get("_answers").slice();var usedAnswerIndexes=[];this.get("_items").forEach(function(item){correctAnswers.forEach(function(answerGroup,answerIndex){if(_.indexOf(usedAnswerIndexes,answerIndex)>-1)return;if(this.checkAnswerIsCorrect(answerGroup,item.userAnswer)==false)return;usedAnswerIndexes.push(answerIndex);item._isCorrect=true;item._answerIndex=answerIndex+TextInputModel.genericAnswerIndexOffset;this.set({_numberOfCorrectAnswers:++numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:true})},this);if(!item._isCorrect)item._isCorrect=false},this)},markSpecificAnswers:function markSpecificAnswers(){var numberOfCorrectAnswers=0;this.get("_items").forEach(function(item){if(!item._answers)return;var userAnswer=item.userAnswer||"";if(this.checkAnswerIsCorrect(item._answers,userAnswer)){item._isCorrect=true;item._answerIndex=_.indexOf(item._answers,this.cleanupUserAnswer(userAnswer));this.set({_numberOfCorrectAnswers:++numberOfCorrectAnswers,_isAtLeastOneCorrectSelection:true})}else{item._isCorrect=false;item._answerIndex=-1}},this)},checkAnswerIsCorrect:function checkAnswerIsCorrect(possibleAnswers,userAnswer){var uAnswer=this.cleanupUserAnswer(userAnswer);var matched=possibleAnswers.filter(function(cAnswer){return this.cleanupUserAnswer(cAnswer)==uAnswer},this);var answerIsCorrect=matched&&matched.length>0;if(answerIsCorrect)this.set("_hasAtLeastOneCorrectSelection",true);return answerIsCorrect},cleanupUserAnswer:function cleanupUserAnswer(userAnswer){if(this.get("_allowsAnyCase")){userAnswer=userAnswer.toLowerCase()}if(this.get("_allowsPunctuation")){userAnswer=userAnswer.replace(/[\.,-\/#!$£%\^&\*;:{}=\-_`~()]/g,"");userAnswer=userAnswer.replace(/(  +)+/g," ")}return $.trim(userAnswer)},setScore:function setScore(){var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var questionWeight=this.get("_questionWeight");var itemLength=this.get("_items").length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.set("_score",score)},resetUserAnswer:function resetUserAnswer(){this.get("_items").forEach(function(item){item._isCorrect=false;item.userAnswer=""})},getResponse:function getResponse(){return _.pluck(this.get("_items"),"userAnswer").join("[,]")},getResponseType:function getResponseType(){return"fill-in"}},{genericAnswerIndexOffset:65536});return TextInputModel});define("components/adapt-contrib-textInput/js/adapt-contrib-textInput",["core/js/adapt","./textInputView","./textInputModel"],function(Adapt,TextInputView,TextInputModel){return Adapt.register("textinput",{view:TextInputView,model:TextInputModel})});(function(factory){if(typeof define==="function"&&define.amd){define("components/adapt-dragdrop-master/js/jquery-ui.js",["jquery"],factory)}else{factory(jQuery)}})(function($){$.ui=$.ui||{};$.extend($.ui,{version:"1.11.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({scrollParent:function scrollParent(includeHidden){var position=this.css("position"),excludeStaticParent=position==="absolute",overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);if(excludeStaticParent&&parent.css("position")==="static"){return false}return overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")+parent.css("overflow-x"))}).eq(0);return position==="fixed"||!scrollParent.length?$(this[0].ownerDocument||document):scrollParent},uniqueId:function(){var uuid=0;return function(){return this.each(function(){if(!this.id){this.id="ui-id-"+ ++uuid}})}}(),removeUniqueId:function removeUniqueId(){return this.each(function(){if(/^ui-id-\d+$/.test(this.id)){$(this).removeAttr("id")}})}});function _focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false}img=$("img[usemap='#"+mapName+"']")[0];return!!img&&visible(img)}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return $.css(this,"visibility")==="hidden"}).length}$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function focusable(element){return _focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function tabbable(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&_focusable(element,!isTabIndexNaN)}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0}if(margin){size-=parseFloat($.css(elem,"margin"+this))||0}});return size}$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this)}return this.each(function(){$(this).css(type,reduce(this,size)+"px")})};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size)}return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px")})}})}if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}}if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key))}else{return removeData.call(this)}}}($.fn.removeData)}$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.fn.extend({focus:function(orig){return function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem)}},delay)}):orig.apply(this,arguments)}}($.fn.focus),disableSelection:function(){var eventType="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(eventType+".ui-disableSelection",function(event){event.preventDefault()})}}(),enableSelection:function enableSelection(){return this.unbind(".ui-disableSelection")},zIndex:function zIndex(_zIndex){if(_zIndex!==undefined){return this.css("zIndex",_zIndex)}if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value}}elem=elem.parent()}}return 0}});$.ui.plugin={add:function add(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]])}},call:function call(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(!set){return}if(!allowDisconnected&&(!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11)){return}for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args)}}}};var widget_uuid=0,widget_slice=Array.prototype.slice;$.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++){try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove")}}catch(e){}}orig(elems)}}($.cleanData);$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element)}if(arguments.length){this._createWidget(options,element)}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base;basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return}proxiedPrototype[prop]=function(){var _super=function _super(){return base.prototype[prop].apply(this,arguments)},_superApply=function _superApply(args){return base.prototype[prop].apply(this,args)};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}()});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)});delete existingConstructor._childConstructors}else{base._childConstructors.push(constructor)}$.widget.bridge(name,constructor);return constructor};$.widget.extend=function(target){var input=widget_slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value)}else{target[key]=value}}}}return target};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=widget_slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(options==="instance"){returnValue=instance;return false}if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'")}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance")}methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false}})}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});if(instance._init){instance._init()}}else{$.data(this,fullName,new object(options,this))}})}return returnValue}};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function _createWidget(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widget_uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function remove(event){if(event.target===element){this.destroy()}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function destroy(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function widget(){return this.element},option:function option(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options)}if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key]}curOption[key]=value}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key]}options[key]=value}}this._setOptions(options);return this},_setOptions:function _setOptions(options){var key;for(key in options){this._setOption(key,options[key])}return this},_setOption:function _setOption(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled",!!value);if(value){this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}}return this},enable:function enable(){return this._setOptions({disabled:false})},disable:function disable(){return this._setOptions({disabled:true})},_on:function _on(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false}if(!handlers){handlers=element;element=this.element;delegateElement=this.widget()}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element)}$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return}return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++}var match=event.match(/^([\w:-]*)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy)}else{element.bind(eventName,handlerProxy)}})},_off:function _off(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName)},_delay:function _delay(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function _hoverable(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function mouseenter(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function mouseleave(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function _focusable(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function focusin(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function focusout(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function _trigger(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop]}}}this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented())}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options}}var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options}}hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay)}if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options)}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback)}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0])}next()})}}});var widget=$.widget;var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false});var mouse=$.widget("ui.mouse",{version:"1.11.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function _mouseInit(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function _mouseDestroy(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function _mouseDown(event){if(mouseHandled){return}this._mouseStarted&&this._mouseUp(event);this._mouseDownEvent=event;var that=this,btnIsLeft=event.which===1,elIsCancel=typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false;if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(event)!==false;if(!this._mouseStarted){event.preventDefault();return true}}if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(event){return that._mouseMove(event)};this._mouseUpDelegate=function(event){return that._mouseUp(event)};this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true},_mouseMove:function _mouseMove(event){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event)}else if(!event.which){return this._mouseUp(event)}if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault()}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==false;this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)}return!this._mouseStarted},_mouseUp:function _mouseUp(event){this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(event)}mouseHandled=false;return false},_mouseDistanceMet:function _mouseDistanceMet(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function _mouseDelayMet(){return this.mouseDelayMet},_mouseStart:function _mouseStart(){},_mouseDrag:function _mouseDrag(){},_mouseStop:function _mouseStop(){},_mouseCapture:function _mouseCapture(){return true}});$.widget("ui.draggable",$.ui.mouse,{version:"1.11.1",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function _create(){if(this.options.helper==="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))){this.element[0].style.position="relative"}if(this.options.addClasses){this.element.addClass("ui-draggable")}if(this.options.disabled){this.element.addClass("ui-draggable-disabled")}this._setHandleClassName();this._mouseInit()},_setOption:function _setOption(key,value){this._super(key,value);if(key==="handle"){this._removeHandleClassName();this._setHandleClassName()}},_destroy:function _destroy(){if((this.helper||this.element).is(".ui-draggable-dragging")){this.destroyOnClear=true;return}this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._removeHandleClassName();this._mouseDestroy()},_mouseCapture:function _mouseCapture(event){var document=this.document[0],o=this.options;try{if(document.activeElement&&document.activeElement.nodeName.toLowerCase()!=="body"){$(document.activeElement).blur()}}catch(error){}if(this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0){return false}this.handle=this._getHandle(event);if(!this.handle){return false}$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body")});return true},_mouseStart:function _mouseStart(event){var o=this.options;this.helper=this._createHelper(event);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if($.ui.ddmanager){$.ui.ddmanager.current=this}this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent(true);this.offsetParent=this.helper.offsetParent();this.offsetParentCssPosition=this.offsetParent.css("position");this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.offset.scroll=false;$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event,false);this.originalPageX=event.pageX;this.originalPageY=event.pageY;o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt);this._setContainment();if(this._trigger("start",event)===false){this._clear();return false}this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}this._mouseDrag(event,true);if($.ui.ddmanager){$.ui.ddmanager.dragStart(this,event)}return true},_mouseDrag:function _mouseDrag(event,noPropagation){if(this.offsetParentCssPosition==="fixed"){this.offset.parent=this._getParentOffset()}this.position=this._generatePosition(event,true);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===false){this._mouseUp({});return false}this.position=ui.position}this.helper[0].style.left=this.position.left+"px";this.helper[0].style.top=this.position.top+"px";if($.ui.ddmanager){$.ui.ddmanager.drag(this,event)}return false},_mouseStop:function _mouseStop(event){var that=this,dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour){dropped=$.ui.ddmanager.drop(this,event)}if(this.dropped){dropped=this.dropped;this.dropped=false}if(this.options.revert==="invalid"&&!dropped||this.options.revert==="valid"&&dropped||this.options.revert===true||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)){$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger("stop",event)!==false){that._clear()}})}else{if(this._trigger("stop",event)!==false){this._clear()}}return false},_mouseUp:function _mouseUp(event){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});if($.ui.ddmanager){$.ui.ddmanager.dragStop(this,event)}this.element.focus();return $.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function cancel(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({})}else{this._clear()}return this},_getHandle:function _getHandle(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:true},_setHandleClassName:function _setHandleClassName(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element;this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function _removeHandleClassName(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function _createHelper(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):o.helper==="clone"?this.element.clone().removeAttr("id"):this.element;if(!helper.parents("body").length){helper.appendTo(o.appendTo==="parent"?this.element[0].parentNode:o.appendTo)}if(helper[0]!==this.element[0]&&!/(fixed|absolute)/.test(helper.css("position"))){helper.css("position","absolute")}return helper},_adjustOffsetFromHelper:function _adjustOffsetFromHelper(obj){if(typeof obj==="string"){obj=obj.split(" ")}if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0}}if("left"in obj){this.offset.click.left=obj.left+this.margins.left}if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left}if("top"in obj){this.offset.click.top=obj.top+this.margins.top}if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top}},_isRootNode:function _isRootNode(element){return /(html|body)/i.test(element.tagName)||element===this.document[0]},_getParentOffset:function _getParentOffset(){var po=this.offsetParent.offset(),document=this.document[0];if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()}if(this._isRootNode(this.offsetParent[0])){po={top:0,left:0}}return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function _getRelativeOffset(){if(this.cssPosition!=="relative"){return{top:0,left:0}}var p=this.element.position(),scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+(!scrollIsRootNode?this.scrollParent.scrollTop():0),left:p.left-(parseInt(this.helper.css("left"),10)||0)+(!scrollIsRootNode?this.scrollParent.scrollLeft():0)}},_cacheMargins:function _cacheMargins(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function _cacheHelperProportions(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function _setContainment(){var over,c,ce,o=this.options,document=this.document[0];this.relativeContainer=null;if(!o.containment){this.containment=null;return}if(o.containment==="window"){this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(o.containment==="document"){this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(o.containment.constructor===Array){this.containment=o.containment;return}if(o.containment==="parent"){o.containment=this.helper[0].parentNode}c=$(o.containment);ce=c[0];if(!ce){return}over=c.css("overflow")!=="hidden";this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relativeContainer=c},_convertPositionTo:function _convertPositionTo(d,pos){if(!pos){pos=this.position}var mod=d==="absolute"?1:-1,scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-(this.cssPosition==="fixed"?-this.offset.scroll.top:scrollIsRootNode?0:this.offset.scroll.top)*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-(this.cssPosition==="fixed"?-this.offset.scroll.left:scrollIsRootNode?0:this.offset.scroll.left)*mod}},_generatePosition:function _generatePosition(event,constrainPosition){var containment,co,top,left,o=this.options,scrollIsRootNode=this._isRootNode(this.scrollParent[0]),pageX=event.pageX,pageY=event.pageY;if(!scrollIsRootNode||!this.offset.scroll){this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}}if(constrainPosition){if(this.containment){if(this.relativeContainer){co=this.relativeContainer.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]}else{containment=this.containment}if(event.pageX-this.offset.click.left<containment[0]){pageX=containment[0]+this.offset.click.left}if(event.pageY-this.offset.click.top<containment[1]){pageY=containment[1]+this.offset.click.top}if(event.pageX-this.offset.click.left>containment[2]){pageX=containment[2]+this.offset.click.left}if(event.pageY-this.offset.click.top>containment[3]){pageY=containment[3]+this.offset.click.top}}if(o.grid){top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3]?top:top-this.offset.click.top>=containment[1]?top-o.grid[1]:top+o.grid[1]:top;left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2]?left:left-this.offset.click.left>=containment[0]?left-o.grid[0]:left+o.grid[0]:left}if(o.axis==="y"){pageX=this.originalPageX}if(o.axis==="x"){pageY=this.originalPageY}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.offset.scroll.top:scrollIsRootNode?0:this.offset.scroll.top),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.offset.scroll.left:scrollIsRootNode?0:this.offset.scroll.left)}},_clear:function _clear(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval){this.helper.remove()}this.helper=null;this.cancelHelperRemoval=false;if(this.destroyOnClear){this.destroy()}},_trigger:function _trigger(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui,this],true);if(type==="drag"){this.positionAbs=this._convertPositionTo("absolute")}return $.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function _uiHash(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});$.ui.plugin.add("draggable","connectToSortable",{start:function start(event,ui,inst){var o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$(this).sortable("instance");if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable)}})},stop:function stop(event,ui,inst){var uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert){this.instance.options.revert=this.shouldRevert}this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper==="original"){this.instance.currentItem.css({top:"auto",left:"auto"})}}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable)}})},drag:function drag(event,ui,inst){var that=this;$.each(inst.sortables,function(){var innermostIntersecting=false,thisSortable=this;this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){innermostIntersecting=true;$.each(inst.sortables,function(){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this!==thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.contains(thisSortable.instance.element[0],this.instance.element[0])){innermostIntersecting=false}return innermostIntersecting})}if(innermostIntersecting){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(that).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0]};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst}if(this.instance.currentItem){this.instance._mouseDrag(event)}}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder){this.instance.placeholder.remove()}inst._trigger("fromSortable",event);inst.dropped=false}}})}});$.ui.plugin.add("draggable","cursor",{start:function start(event,ui,instance){var t=$("body"),o=instance.options;if(t.css("cursor")){o._cursor=t.css("cursor")}t.css("cursor",o.cursor)},stop:function stop(event,ui,instance){var o=instance.options;if(o._cursor){$("body").css("cursor",o._cursor)}}});$.ui.plugin.add("draggable","opacity",{start:function start(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css("opacity")){o._opacity=t.css("opacity")}t.css("opacity",o.opacity)},stop:function stop(event,ui,instance){var o=instance.options;if(o._opacity){$(ui.helper).css("opacity",o._opacity)}}});$.ui.plugin.add("draggable","scroll",{start:function start(event,ui,i){if(!i.scrollParentNotHidden){i.scrollParentNotHidden=i.helper.scrollParent(false)}if(i.scrollParentNotHidden[0]!==i.document[0]&&i.scrollParentNotHidden[0].tagName!=="HTML"){i.overflowOffset=i.scrollParentNotHidden.offset()}},drag:function drag(event,ui,i){var o=i.options,scrolled=false,scrollParent=i.scrollParentNotHidden[0],document=i.document[0];if(scrollParent!==document&&scrollParent.tagName!=="HTML"){if(!o.axis||o.axis!=="x"){if(i.overflowOffset.top+scrollParent.offsetHeight-event.pageY<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop+o.scrollSpeed}else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop-o.scrollSpeed}}if(!o.axis||o.axis!=="y"){if(i.overflowOffset.left+scrollParent.offsetWidth-event.pageX<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft+o.scrollSpeed}else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft-o.scrollSpeed}}}else{if(!o.axis||o.axis!=="x"){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed)}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)}}if(!o.axis||o.axis!=="y"){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed)}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)}}}if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(i,event)}}});$.ui.plugin.add("draggable","snap",{start:function start(event,ui,i){var o=i.options;i.snapElements=[];$(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var $t=$(this),$o=$t.offset();if(this!==i.element[0]){i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})}})},drag:function drag(event,ui,inst){var ts,bs,ls,rs,l,r,t,b,i,first,o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--){l=inst.snapElements[i].left;r=l+inst.snapElements[i].width;t=inst.snapElements[i].top;b=t+inst.snapElements[i].height;if(x2<l-d||x1>r+d||y2<t-d||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)){if(inst.snapElements[i].snapping){inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}))}inst.snapElements[i].snapping=false;continue}if(o.snapMode!=="inner"){ts=Math.abs(t-y2)<=d;bs=Math.abs(b-y1)<=d;ls=Math.abs(l-x2)<=d;rs=Math.abs(r-x1)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top}if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top}if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left}if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left}}first=ts||bs||ls||rs;if(o.snapMode!=="outer"){ts=Math.abs(t-y1)<=d;bs=Math.abs(b-y2)<=d;ls=Math.abs(l-x1)<=d;rs=Math.abs(r-x2)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top}if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top}if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left}if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left}}if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)){inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}))}inst.snapElements[i].snapping=ts||bs||ls||rs||first}}});$.ui.plugin.add("draggable","stack",{start:function start(event,ui,instance){var min,o=instance.options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});if(!group.length){return}min=parseInt($(group[0]).css("zIndex"),10)||0;$(group).each(function(i){$(this).css("zIndex",min+i)});this.css("zIndex",min+group.length)}});$.ui.plugin.add("draggable","zIndex",{start:function start(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css("zIndex")){o._zIndex=t.css("zIndex")}t.css("zIndex",o.zIndex)},stop:function stop(event,ui,instance){var o=instance.options;if(o._zIndex){$(ui.helper).css("zIndex",o._zIndex)}}});var draggable=$.ui.draggable;$.widget("ui.droppable",{version:"1.11.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function _create(){var proportions,o=this.options,accept=o.accept;this.isover=false;this.isout=true;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept)};this.proportions=function(){if(arguments.length){proportions=arguments[0]}else{return proportions?proportions:proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}}};this._addToManager(o.scope);o.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function _addToManager(scope){$.ui.ddmanager.droppables[scope]=$.ui.ddmanager.droppables[scope]||[];$.ui.ddmanager.droppables[scope].push(this)},_splice:function _splice(drop){var i=0;for(;i<drop.length;i++){if(drop[i]===this){drop.splice(i,1)}}},_destroy:function _destroy(){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function _setOption(key,value){if(key==="accept"){this.accept=$.isFunction(value)?value:function(d){return d.is(value)}}else if(key==="scope"){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop);this._addToManager(value)}this._super(key,value)},_activate:function _activate(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass){this.element.addClass(this.options.activeClass)}if(draggable){this._trigger("activate",event,this.ui(draggable))}},_deactivate:function _deactivate(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}if(draggable){this._trigger("deactivate",event,this.ui(draggable))}},_over:function _over(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return}if(this.accept.call(this.element[0],draggable.currentItem||draggable.element)){if(this.options.hoverClass){this.element.addClass(this.options.hoverClass)}this._trigger("over",event,this.ui(draggable))}},_out:function _out(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return}if(this.accept.call(this.element[0],draggable.currentItem||draggable.element)){if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("out",event,this.ui(draggable))}},_drop:function _drop(event,custom){var draggable=custom||$.ui.ddmanager.current,childrenIntersection=false;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return false}this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var inst=$(this).droppable("instance");if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope===draggable.options.scope&&inst.accept.call(inst.element[0],draggable.currentItem||draggable.element)&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance,event)){childrenIntersection=true;return false}});if(childrenIntersection){return false}if(this.accept.call(this.element[0],draggable.currentItem||draggable.element)){if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("drop",event,this.ui(draggable));return this.element}return false},ui:function ui(c){return{draggable:c.currentItem||c.element,helper:c.helper,position:c.position,offset:c.positionAbs}}});$.ui.intersect=function(){function isOverAxis(x,reference,size){return x>=reference&&x<reference+size}return function(draggable,droppable,toleranceMode,event){if(!droppable.offset){return false}var x1=(draggable.positionAbs||draggable.position.absolute).left,y1=(draggable.positionAbs||draggable.position.absolute).top,x2=x1+draggable.helperProportions.width,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,t=droppable.offset.top,r=l+droppable.proportions().width,b=t+droppable.proportions().height;switch(toleranceMode){case"fit":return l<=x1&&x2<=r&&t<=y1&&y2<=b;case"intersect":return l<x1+draggable.helperProportions.width/2&&x2-draggable.helperProportions.width/2<r&&t<y1+draggable.helperProportions.height/2&&y2-draggable.helperProportions.height/2<b;case"pointer":return isOverAxis(event.pageY,t,droppable.proportions().height)&&isOverAxis(event.pageX,l,droppable.proportions().width);case"touch":return(y1>=t&&y1<=b||y2>=t&&y2<=b||y1<t&&y2>b)&&(x1>=l&&x1<=r||x2>=l&&x2<=r||x1<l&&x2>r);default:return false;}}}();$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function prepareOffsets(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();droppablesLoop:for(i=0;i<m.length;i++){if(m[i].options.disabled||t&&!m[i].accept.call(m[i].element[0],t.currentItem||t.element)){continue}for(j=0;j<list.length;j++){if(list[j]===m[i].element[0]){m[i].proportions().height=0;continue droppablesLoop}}m[i].visible=m[i].element.css("display")!=="none";if(!m[i].visible){continue}if(type==="mousedown"){m[i]._activate.call(m[i],event)}m[i].offset=m[i].element.offset();m[i].proportions({width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight})}},drop:function drop(draggable,event){var dropped=false;$.each(($.ui.ddmanager.droppables[draggable.options.scope]||[]).slice(),function(){if(!this.options){return}if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance,event)){dropped=this._drop.call(this,event)||dropped}if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)){this.isout=true;this.isover=false;this._deactivate.call(this,event)}});return dropped},dragStart:function dragStart(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event)}})},drag:function drag(draggable,event){if(draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event)}$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible){return}var parentInstance,scope,parent,intersects=$.ui.intersect(draggable,this,this.options.tolerance,event),c=!intersects&&this.isover?"isout":intersects&&!this.isover?"isover":null;if(!c){return}if(this.options.greedy){scope=this.options.scope;parent=this.element.parents(":data(ui-droppable)").filter(function(){return $(this).droppable("instance").options.scope===scope});if(parent.length){parentInstance=$(parent[0]).droppable("instance");parentInstance.greedyChild=c==="isover"}}if(parentInstance&&c==="isover"){parentInstance.isover=false;parentInstance.isout=true;parentInstance._out.call(parentInstance,event)}this[c]=true;this[c==="isout"?"isover":"isout"]=false;this[c==="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c==="isout"){parentInstance.isout=false;parentInstance.isover=true;parentInstance._over.call(parentInstance,event)}})},dragStop:function dragStop(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable");if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event)}}};var droppable=$.ui.droppable});(function(factory){if(typeof define==="function"&&define.amd){define("components/adapt-dragdrop-master/js/jquery.ui.touch-punch.js",["jquery"],factory)}else{factory(jQuery)}})(function($){$.support.touch="ontouchend"in document;if(!$.support.touch){return}var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,_mouseDestroy=mouseProto._mouseDestroy,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return}event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent)}mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return}touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,"mouseover");simulateMouseEvent(event,"mousemove");simulateMouseEvent(event,"mousedown")};mouseProto._touchMove=function(event){if(!touchHandled){return}this._touchMoved=true;simulateMouseEvent(event,"mousemove")};mouseProto._touchEnd=function(event){if(!touchHandled){return}simulateMouseEvent(event,"mouseup");simulateMouseEvent(event,"mouseout");if(!this._touchMoved){simulateMouseEvent(event,"click")}touchHandled=false};mouseProto._mouseInit=function(){var self=this;self.element.bind({touchstart:$.proxy(self,"_touchStart"),touchmove:$.proxy(self,"_touchMove"),touchend:$.proxy(self,"_touchEnd")});_mouseInit.call(self)};mouseProto._mouseDestroy=function(){var self=this;self.element.unbind({touchstart:$.proxy(self,"_touchStart"),touchmove:$.proxy(self,"_touchMove"),touchend:$.proxy(self,"_touchEnd")});_mouseDestroy.call(self)}});define("components/adapt-dragdrop-master/js/adapt-dragdrop",["require","coreJS/adapt","coreViews/questionView","./jquery-ui.js","./jquery.ui.touch-punch.js"],function(require){var Adapt=require("coreJS/adapt");var QuestionView=require("coreViews/questionView");var JQueryUI=require("./jquery-ui.js");var TouchPunch=require("./jquery.ui.touch-punch.js");var nCounter=0;var DragDrop=QuestionView.extend({events:{"dragcreate .ui-draggable":"onCreateDragItem","dragstart .ui-draggable":"onStartDragItem","dragstop .ui-draggable":"onStopDragItem","dropactivate .ui-droppable":"onDropItemActivate","dropdeactivate .ui-droppable":"onDropItemDeactivate","drop .ui-droppable":"onDropItem","dropout .ui-droppable":"onDropOutItem","dropover .ui-droppable":"onDropOverItem","click .dragdrop-widget .button.submit":"onSubmitClicked","click .dragdrop-widget .button.reset":"onResetClicked","click .dragdrop-widget .button.model":"onModelAnswerClicked","click .dragdrop-widget .button.user":"onUserAnswerClicked"},preRender:function preRender(){QuestionView.prototype.preRender.apply(this);$(window).on("resize",this.reRender.bind(this))},postRender:function postRender(){QuestionView.prototype.postRender.apply(this);this.initDragDropItems();this.setReadyStatus()},reRender:function reRender(){var placedDraggables=[];_.each(this.model.get("_items"),function(item){if(item.currentDraggableId){placedDraggables.push(item.currentDraggableId);this.moveDraggableToDroppable($("#"+item.currentDraggableId),$("#"+item.id),true)}},this);_.each(this.model.get("_draggableItems"),function(item){if(placedDraggables.indexOf(item.id)==-1){this.revert($("#"+item.id),true)}},this)},initDragDropItems:function initDragDropItems(){_.each(this.model.get("_draggableItems"),function(draggableItem){$("#"+draggableItem.id).draggable({})},this);_.each(this.model.get("_items"),function(droppableItem){$("#"+droppableItem.id).droppable({accept:"#"+_.pluck(droppableItem._accepted,"id").join(", #"),activeClass:"ui-state-hover",hoverClass:"ui-state-active"})},this)},onCreateDragItem:function onCreateDragItem(event,ui){this.setOriginals($(event.target))},setOriginals:function setOriginals($draggable){var originalWidth=$draggable.parent().width();var originalHeight=$draggable.parent().height();var percent;var left=$draggable.position().left;percent=left/originalWidth;$draggable.data("original-left",percent);var bottom,top=$draggable.position().top;percent=top/originalHeight;$draggable.data("original-top",percent);this.revert($draggable,true)},reCalculateOriginals:function reCalculateOriginals($draggable){},onStartDragItem:function onStartDragItem(event,ui){},onStopDragItem:function onStopDragItem(event,ui){var draggerId=$(event.target).attr("id");var dropperItem=_.find(this.model.get("_items"),function(item){if(item.currentDraggableId==draggerId)return item});if(!dropperItem)this.revert($("#"+draggerId))},revert:function revert($d,instant){instant=instant||false;$d.removeClass("ui-state-placed");var left=$d.data("original-left");var top=$d.data("original-top");var leftToBe=left*$d.parent().width();var topToBe=top*$d.parent().height();if(!instant)$d.animate({"left":leftToBe,"top":topToBe},500,function(){});else{$d.css("left",leftToBe),$d.css("top",topToBe)}},onDropItemActivate:function onDropItemActivate(event,ui){var $draggable=$(ui.draggable);var draggableItem=this.findDraggableItem($draggable.attr("id"));var $droppable=$(event.target);var droppableItem=this.findDroppableItem($droppable.attr("id"))},onDropItemDeactivate:function onDropItemDeactivate(event,ui){var $draggable=$(ui.draggable);var draggableItem=this.findDraggableItem($draggable.attr("id"));var $droppable=$(event.target);var droppableItem=this.findDroppableItem($droppable.attr("id"))},moveDraggableToDroppable:function moveDraggableToDroppable($draggable,$droppable,instant){instant=instant||false;var left=$droppable.position().left;var top=$droppable.position().top;if(!instant)$draggable.animate({left:left,top:top},500,function(){$draggable.addClass("ui-state-placed")});else{$draggable.css("left",left);$draggable.css("top",top)}},onDropItem:function onDropItem(event,ui){var $draggable=$(ui.draggable);var draggableItem=this.findDraggableItem($draggable.attr("id"));var $droppable=$(event.target);var droppableItem=this.findDroppableItem($droppable.attr("id"));$droppable.addClass("ui-state-highlight");if(droppableItem.currentDraggableId){var residentDraggable=this.findDraggableItem(droppableItem.currentDraggableId);this.revert($("#"+residentDraggable.id))}droppableItem.currentDraggableId=draggableItem.id;this.moveDraggableToDroppable($draggable,$droppable);nCounter++;if(this.model.get("_items").length==nCounter){this.$(".buttons-action").a11y_cntrl_enabled(true)}},onDropOutItem:function onDropOutItem(event,ui){var $draggable=$(ui.draggable);$draggable.removeClass("ui-state-placed");var draggableItem=this.findDraggableItem($draggable.attr("id"));var dropperId=$(event.target).attr("id");console.log(draggableItem.id+"Moved out of Dropzone "+dropperId);var dropperItem=_.find(this.model.get("_items"),function(item){if(item.id==dropperId&&draggableItem.id==item.currentDraggableId){console.log("Removing current from "+dropperId);item.currentDraggableId=null;$(event.target).removeClass("ui-state-highlight");return item}})},onDropOverItem:function onDropOverItem(event,ui){var $droppable=$(ui.draggable.element);var droppableItem=this.findDraggableItem($droppable.attr("id"))},debugLog:function debugLog(){console.log(_.pluck(this.model.get("_items"),"currentDraggableId"))},findDraggableItem:function findDraggableItem(id){return _.find(this.model.get("_draggableItems"),function(dragger){if(dragger.id==id)return dragger})},findDroppableItem:function findDroppableItem(id){return _.find(this.model.get("_items"),function(item){if(item.id==id)return item})},canSubmit:function canSubmit(){var canSubmit=true;this.$(".ui-droppable",this.el).each(_.bind(function(index,element){var $element=$(element);if(!$element.hasClass("ui-state-highlight")){canSubmit=false}},this));return canSubmit},forEachAnswer:function forEachAnswer(callback){var _this=this;this.model.set("_isAtLeastOneCorrectSelection",false);_.each(this.model.get("_items"),function(item,index){var correctSelection=false;_.each(item._accepted,function(accepted){if(item.currentDraggableId==accepted.id){if(accepted._isCorrect){correctSelection=true;item._isCorrect=true;_this.model.set("_isAtLeastOneCorrectSelection",true)}else{item._isCorrect=false}}});callback(correctSelection,item)},this)},showMarking:function showMarking(){_.each(this.model.get("_items"),function(item,i){var $item=$("#"+item.id);$item.removeClass("correct incorrect");$item.addClass(item.correct?"correct":"incorrect")},this)},markQuestion:function markQuestion(){console.log("Marking Question");this.forEachAnswer(function(correct,item){item.correct=correct});QuestionView.prototype.markQuestion.apply(this)},onEnabledChanged:function onEnabledChanged(){this.$(".ui-droppable").prop("disabled",!this.model.get("_isEnabled"))},onResetClicked:function onResetClicked(event){QuestionView.prototype.onResetClicked.apply(this,arguments);var $item=null;_.each(this.model.get("_items"),function(item){$item=$("#"+item.id);$item.removeClass("ui-state-highlight");item.currentDraggableId=null;item._isCorrect=item.correct=false},this);_.each(this.model.get("_draggableItems"),function(item){this.revert($("#"+item.id))},this);this.setAllItemsEnabled(true)},onSubmitClicked:function onSubmitClicked(event){QuestionView.prototype.onSubmitClicked.apply(this,arguments);if(this.canSubmit()){this.setAllItemsEnabled(false)}},setAllItemsEnabled:function setAllItemsEnabled(enabled){this.$(".ui-draggable").draggable("option","disabled",!enabled)},onModelAnswerShown:function onModelAnswerShown(){alert("TODO : SHOW the model answer "+this.model.get("_userAnswer"));var placedItems=[];_.each(this.model.get("_items"),function(item,index){if(!item._isCorrect){var $dropzone=$("#"+item.id);var correctItem=_.find(item._accepted,function(accepted){if(accepted._isCorrect)return accepted},this);if(correctItem){item.currentDraggableId=correctItem.id;item.correct=true;$dropzone.removeClass("correct incorrect");$dropzone.addClass(item.correct?"correct":"incorrect");var $correctItem=$("#"+correctItem.id);placedItems.push(correctItem.id);this.moveDraggableToDroppable($correctItem,$dropzone)}}else placedItems.push(item.currentDraggableId)},this);this.revertLeftOvers(placedItems)},revertLeftOvers:function revertLeftOvers(arr){_.each(this.model.get("_draggableItems"),function(item){if(arr.indexOf(item.id)==-1){this.revert($("#"+item.id))}},this)},onUserAnswerShown:function onUserAnswerShown(event){var placedItems=[];_.each(this.model.get("_items"),function(item,i){var $dropzone=$("#"+item.id);var ansId=this.model.get("_userAnswer")[i];var $userAnswerItem=$("#"+ansId);item.currentDraggableId=ansId;placedItems.push(ansId);item.correct=item._isCorrect;$dropzone.removeClass("correct incorrect");$dropzone.addClass(item.correct?"correct":"incorrect");this.moveDraggableToDroppable($userAnswerItem,$dropzone)},this);this.revertLeftOvers(placedItems)},storeUserAnswer:function storeUserAnswer(){var userAnswer=[];this.forEachAnswer(function(correct,item){userAnswer.push(item.currentDraggableId)});this.model.set("_userAnswer",userAnswer)}});Adapt.register("dragdrop",DragDrop)});define("components/adapt-go-next/js/adapt-go-next",["coreViews/componentView","coreJS/adapt"],function(ComponentView,Adapt){var GoNext=ComponentView.extend({DEBUG:false,log:function log(){if(this.DEBUG==false)return;var args=Array.prototype.slice.call(arguments);args.unshift(this.model.get("_id"));args.unshift("GoNext");if(window.console&&window.console.log){try{}catch(e){}}},events:{"click .go-next-button":"handleClick"},preRender:function preRender(){this.checkIfResetOnRevisit()},postRender:function postRender(){this.log("rendering");var page=this.getParentModel(this.model,"page");if(page){this.log("page id",page.get("_id"));var complete=page.get("_isComplete");if(!complete){this.$el.addClass("go-next-hidden");this.listenTo(Adapt,"remove",this.onRemove);this.listenTo(page,"change:_isComplete",this.handlePageComplete)}}this.setReadyStatus();this.setCompletionStatus()},checkIfResetOnRevisit:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}},handleClick:function handleClick(e){this.log("handleClick",e);this.log("_navigateTo",this.model.get("_navigateTo"));var id=this.model.get("_navigateTo");if(id!=="menu"){this.navigateToElement(id,{trigger:true,replace:false})}else{Adapt.trigger("navigation:homeButton")}e.preventDefault()},handlePageComplete:function handlePageComplete(model,value,isPerformingCompletionQueue){this.log("handlePageComplete",arguments);if(value){this.showComponent()}},onRemove:function onRemove(){this.stopListening(Adapt,"remove",this.onRemove);var page=this.getParentModel(this.model,"page");if(page){this.stopListening(page,"change:_isComplete",this.handlePageComplete)}this.$el.remove();this.stopListening()},showComponent:function showComponent(){this.$el.removeClass("go-next-hidden");Adapt.trigger("device:resize")},getParentId:function getParentId(model,type){return this.getParentModel(model,type).get("_id")},getParentModel:function getParentModel(model,type){if(typeof type==="undefined"||type==""){type="course"}if(model.get("_type")===type)return model;var parentModel=model;var m;var iteration=0;while(parentModel!=null){parentModel=parentModel.getParent();if(parentModel.get("_type")===type){m=parentModel;break}}return m},navigateToElement:function navigateToElement(selector,navSettings,settings){console.log("GoNext","navigateToElement",arguments);var settings=settings||{};var navSettings=navSettings||{trigger:true,replace:false};var currentModelId=selector.replace(/\./g,"");var currentModel=Adapt.findById(currentModelId);var currentPage=currentModel._siblings==="contentObjects"?currentModel:currentModel.findAncestor("contentObjects");if(currentPage.get("_id")===Adapt.location._currentId){return Adapt.scrollTo(selector,settings)}Backbone.history.navigate("#/id/"+currentPage.get("_id"),navSettings);Adapt.once("pageView:ready",function(){_.defer(function(){Adapt.location=_.extend(Adapt.location,{_currentLocation:undefined,_lastVisitedPage:undefined,_lastVisitedType:undefined,_previousContentType:undefined,_previousId:undefined});Adapt.scrollTo(selector,settings)})})}});Adapt.register("go-next",GoNext);return GoNext});define("extensions/adapt-close-master/js/adapt-close",["core/js/adapt"],function(Adapt){var CloseView=Backbone.View.extend({initialize:function initialize(){this.listenTo(Adapt,{"navigation:closeButton":this.onCloseButton,"close:confirm":this.onCloseConfirm,"app:languageChanged":this.remove}).render()},render:function render(){var data=this.model.toJSON();data._globals=Adapt.course.get("_globals");var template=Handlebars.templates.close;this.setElement(template(data)).$el.prependTo($(".navigation-inner"))},onCloseButton:function onCloseButton(){var prompt=!Adapt.course.get("_isComplete")?this.model.get("_notifyPromptIfIncomplete"):this.model.get("_notifyPromptIfComplete");if(!prompt||!prompt._isEnabled)return Adapt.trigger("close:confirm");Adapt.trigger("notify:prompt",{title:prompt.title,body:prompt.body,_prompts:[{promptText:prompt.confirm,_callbackEvent:"close:confirm"},{promptText:prompt.cancel}]})},onCloseConfirm:function onCloseConfirm(){var config=Adapt.course.get("_close");config.browserPromptIfIncomplete=config.browserPromptIfComplete=false;top.window.close()}});function onBeforeUnload(config){return!Adapt.course.get("_isComplete")?config.browserPromptIfIncomplete||undefined:config.browserPromptIfComplete||undefined}function initialise(){var config=Adapt.course.get("_close");if(!config||!config._isEnabled)return;var button=config._button;if(button&&button._isEnabled){new CloseView({model:new Backbone.Model(button)})}if(config.browserPromptIfIncomplete||config.browserPromptIfComplete){}}Adapt.once("adapt:start",function(){initialise();Adapt.on("app:languageChanged",function(){$(window).off("beforeunload.close");Adapt.once("router:location",initialise)})})});define("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleView",["core/js/adapt","core/js/views/articleView"],function(Adapt,AdaptArticleView){var AssessmentView={postRender:function postRender(){AdaptArticleView.prototype.postRender.call(this);if(this.model.isAssessmentEnabled()){this._setupEventListeners();var config=this.model.getConfig();if(config&&config._questions&&config._questions._canShowMarking===false){this.$el.addClass("no-marking")}}this.$el.addClass("assessment")},_setupEventListeners:function _setupEventListeners(){this.listenTo(Adapt,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset,remove:this._onRemove})},_removeEventListeners:function _removeEventListeners(){this.stopListening(Adapt,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset})},_onAssessmentComplete:function _onAssessmentComplete(state,model){if(state.id!=this.model.get("_assessment")._id)return;console.log("assessment complete",state,model)},_onAssessmentReset:function _onAssessmentReset(state,model){if(state.id!=this.model.get("_assessment")._id)return;console.log("assessment reset",state,model)},_onRemove:function _onRemove(){this._removeEventListeners()}};return AssessmentView});define("extensions/adapt-contrib-assessment/js/adapt-assessmentQuestionBank",["require"],function(require){var QuestionBank=function QuestionBank(quizBankid,articleId,numQuestionBlocks,uniqueQuestions){this._id=quizBankid;this._articleId=articleId;this._numQuestionBlocks=numQuestionBlocks;this._uniqueQuestions=uniqueQuestions;this.questionBlocks=[];this.unUsedQuestionBlocks=undefined;this.usedQuestionBlocks=[]};QuestionBank.prototype={getID:function getID(){return this._id},addBlock:function addBlock(block){this.questionBlocks.push(block)},getRandomQuestionBlocks:function getRandomQuestionBlocks(){this.checkResetUnunsedBlocks();var questionBlocks=[];var usedQuestionBlocks=this.usedQuestionBlocks.slice(0);for(var i=0;i<this._numQuestionBlocks;i++){var question=this.getRandomQuestion();if(question!==undefined){questionBlocks.push(question)}else{if(usedQuestionBlocks.length===0)break;var index=Math.floor(Math.random()*(usedQuestionBlocks.length-1));question=usedQuestionBlocks.splice(index,1)[0];questionBlocks.push(question)}}return questionBlocks},checkResetUnunsedBlocks:function checkResetUnunsedBlocks(){if(this.unUsedQuestionBlocks!==undefined&&this._uniqueQuestions)return;this.unUsedQuestionBlocks=this.questionBlocks.slice(0)},getRandomQuestion:function getRandomQuestion(){if(this.unUsedQuestionBlocks!==undefined&&this.unUsedQuestionBlocks.length<1){console.warn("assessment:"+this._articleId+" No more unique questions for _assessment._quizBankID "+this._id);return undefined}var index=Math.round(Math.random()*(this.unUsedQuestionBlocks.length-1));var questionBlock=this.unUsedQuestionBlocks[index];this.usedQuestionBlocks.push(questionBlock);this.unUsedQuestionBlocks.splice(index,1);return questionBlock}};return QuestionBank});define("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleModel",["core/js/adapt","./adapt-assessmentQuestionBank"],function(Adapt,QuestionBank){var givenIdCount=0;var assessmentConfigDefaults={_isEnabled:true,_questions:{_resetType:"soft",_canShowFeedback:false,_canShowMarking:false,_canShowModelAnswer:false},_suppressMarking:false,_isPercentageBased:true,_scoreToPass:100,_includeInTotalScore:true,_assessmentWeight:1,_isResetOnRevisit:true,_reloadPageOnReset:true,_attempts:"infinite",_allowResetIfPassed:false};var AssessmentModel={_postInitialize:function _postInitialize(){if(!this.isAssessmentEnabled())return;var assessmentConfig=this.getConfig();_.extend(this,{_currentQuestionComponents:null,_originalChildModels:null,_questionBanks:null,_forceResetOnRevisit:false});var attemptsLeft;switch(assessmentConfig._attempts){case"infinite":case 0:case undefined:case-1:case null:attemptsLeft="infinite";break;default:attemptsLeft=assessmentConfig._attempts;break;}this.set({_currentQuestionComponentIds:[],_assessmentCompleteInSession:false,_attemptInProgress:false,_isAssessmentComplete:false,_numberOfQuestionsAnswered:0,_lastAttemptScoreAsPercent:0,_attempts:attemptsLeft,_attemptsLeft:attemptsLeft,_attemptsSpent:0});this.listenToOnce(Adapt,"app:dataReady",this._onDataReady);this.listenTo(Adapt,"remove",this._onRemove)},init:function init(){this._originalChildModels=this.getChildren().models;this._currentQuestionComponents=this.findDescendantModels("components",{where:{_isQuestionType:true}});this.set("_currentQuestionComponentIds",this._currentQuestionComponents.map(function(comp){return comp.get("_id")}));this._setAssessmentOwnershipOnChildrenModels()},_setAssessmentOwnershipOnChildrenModels:function _setAssessmentOwnershipOnChildrenModels(){var assessmentConfig=this.get("_assessment");var childConfig={_isPartOfAssessment:true,_assessmentId:assessmentConfig._id};for(var i=0,l=this._originalChildModels.length;i<l;i++){var blockModel=this._originalChildModels[i];blockModel.set(childConfig);blockModel.setOnChildren(childConfig)}},_onDataReady:function _onDataReady(){Adapt.assessment.register(this)},_setupAssessmentData:function _setupAssessmentData(force,callback){var assessmentConfig=this.getConfig();var state=this.getState();var shouldResetAssessment=!this.get("_attemptInProgress")&&!state.isPass||force===true;var shouldResetQuestions=assessmentConfig._isResetOnRevisit&&(state.allowResetIfPassed||!state.isPass)||force===true;if(shouldResetAssessment||shouldResetQuestions){Adapt.trigger("assessments:preReset",this.getState(),this)}var quizModels;if(shouldResetAssessment){this.set({_numberOfQuestionsAnswered:0,_isAssessmentComplete:false,_assessmentCompleteInSession:false,_score:0});this.getChildren().models=this._originalChildModels;if(assessmentConfig._banks&&assessmentConfig._banks._isEnabled&&assessmentConfig._banks._split.length>1){quizModels=this._setupBankedAssessment()}else if(assessmentConfig._randomisation&&assessmentConfig._randomisation._isEnabled){quizModels=this._setupRandomisedAssessment()}}if(!quizModels){quizModels=this.getChildren().models}else if(quizModels.length===0){quizModels=this.getChildren().models;console.warn("assessment: Not enough unique questions to create a fresh assessment, using last selection")}this.getChildren().models=quizModels;this._currentQuestionComponents=this.findDescendantModels("components",{where:{_isQuestionType:true}});var currentQuestionsCollection=new Backbone.Collection(this._currentQuestionComponents);for(var i=0;i<=currentQuestionsCollection.length-1;i++){var getId=currentQuestionsCollection.models[i].attributes._id;var displayTitle=currentQuestionsCollection.models[i].attributes;displayTitle="<h3 class=\"custom_heading\">Question"+" "+(i+1)+"</h3>";currentQuestionsCollection.models[i].attributes.displayTitle=displayTitle;var title=currentQuestionsCollection.models[i].attributes;title="Question"+" "+(i+1);currentQuestionsCollection.models[i].attributes.title=title}this.set("_currentQuestionComponentIds",this._currentQuestionComponents.map(function(comp){return comp.get("_id")}));if(shouldResetAssessment||shouldResetQuestions){this._resetQuestions(function(){this.set("_attemptInProgress",true);Adapt.trigger("assessments:reset",this.getState(),this);finalise.apply(this)}.bind(this))}else{finalise.apply(this)}function finalise(){if(!state.isComplete){this.set("_attemptInProgress",true)}this._overrideQuestionComponentSettings();this._setupQuestionListeners();this._checkNumberOfQuestionsAnswered();this._updateQuestionsState();Adapt.assessment.saveState();if(typeof callback=="function")callback.apply(this);if(shouldResetAssessment||shouldResetQuestions){Adapt.trigger("assessments:postReset",this.getState(),this)}}},_setupBankedAssessment:function _setupBankedAssessment(){var assessmentConfig=this.getConfig();this._setupBanks();var questionModels=[];for(var bankId in this._questionBanks){if(this._questionBanks.hasOwnProperty(bankId)){var questionBank=this._questionBanks[bankId];var questions=questionBank.getRandomQuestionBlocks();questionModels=questionModels.concat(questions)}}if(assessmentConfig._banks._randomisation){questionModels=_.shuffle(questionModels)}return questionModels},_setupBanks:function _setupBanks(){var assessmentConfig=this.getConfig();var banks=assessmentConfig._banks._split.split(",");var bankId;this._questionBanks=[];for(var i=0,l=banks.length;i<l;i++){var bank=banks[i];bankId=i+1;var questionBank=new QuestionBank(bankId,this.get("_id"),bank,true);this._questionBanks[bankId]=questionBank}var children=this.getChildren().models;for(var j=0,count=children.length;j<count;j++){var blockModel=children[j];var blockAssessmentConfig=blockModel.get("_assessment");bankId=blockAssessmentConfig._quizBankID;this._questionBanks[bankId].addBlock(blockModel)}},_setupRandomisedAssessment:function _setupRandomisedAssessment(){var assessmentConfig=this.getConfig();var randomisationModel=assessmentConfig._randomisation;var blockModels=this.getChildren().models;var questionModels=_.shuffle(blockModels);if(randomisationModel._blockCount>0){questionModels=questionModels.slice(0,randomisationModel._blockCount)}return questionModels},_overrideQuestionComponentSettings:function _overrideQuestionComponentSettings(){var newSettings=this._getMarkingSettings();var questionConfig=this.getConfig()._questions;if(questionConfig.hasOwnProperty("_canShowFeedback")){newSettings._canShowFeedback=questionConfig._canShowFeedback}if(!_.isEmpty(newSettings)){for(var i=0,l=this._currentQuestionComponents.length;i<l;i++){this._currentQuestionComponents[i].set(newSettings,{pluginName:"_assessment"})}}},_setupQuestionListeners:function _setupQuestionListeners(){var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_isInteractionComplete"))continue;this.listenTo(question,"change:_isInteractionComplete",this._onQuestionCompleted)}},_checkNumberOfQuestionsAnswered:function _checkNumberOfQuestionsAnswered(){var questionComponents=this._currentQuestionComponents;var numberOfQuestionsAnswered=0;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_isInteractionComplete")){numberOfQuestionsAnswered++}}this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered)},_removeQuestionListeners:function _removeQuestionListeners(){var questionComponents=this._currentQuestionComponents;if(!questionComponents)return;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];this.stopListening(question,"change:_isInteractionComplete",this._onQuestionCompleted)}},_onQuestionCompleted:function _onQuestionCompleted(questionModel,value){if(value===false)return;if(!questionModel.get("_isInteractionComplete"))return;var numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");numberOfQuestionsAnswered++;this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered);this._updateQuestionsState();Adapt.assessment.saveState();this._checkAssessmentComplete()},_checkAssessmentComplete:function _checkAssessmentComplete(){var numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");var allQuestionsAnswered=numberOfQuestionsAnswered>=this._currentQuestionComponents.length;if(!allQuestionsAnswered)return;this._onAssessmentComplete()},_onAssessmentComplete:function _onAssessmentComplete(){var assessmentConfig=this.getConfig();this.set("_attemptInProgress",false);this._spendAttempt();var scoreAsPercent=this._getScoreAsPercent();var score=this._getScore();var maxScore=this._getMaxScore();this.set({_scoreAsPercent:scoreAsPercent,_score:score,_maxScore:maxScore,_lastAttemptScoreAsPercent:scoreAsPercent,_assessmentCompleteInSession:true,_isAssessmentComplete:true});this._updateQuestionsState();this._checkIsPass();this._removeQuestionListeners();if(this._isMarkingSuppressionEnabled()&&!this._isAttemptsLeft()){_.defer(function(){this._overrideMarkingSettings();this._refreshQuestions()}.bind(this))}Adapt.trigger("assessments:complete",this.getState(),this)},_updateQuestionsState:function _updateQuestionsState(){var questions=[];var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var questionComponent=questionComponents[i];var questionModel={_id:questionComponent.get("_id"),_isCorrect:questionComponent.get("_isCorrect")===undefined?null:questionComponent.get("_isCorrect")};questions.push(questionModel)}this.set("_questions",questions)},_checkIsPass:function _checkIsPass(){var assessmentConfig=this.getConfig();var isPercentageBased=assessmentConfig._isPercentageBased;var scoreToPass=assessmentConfig._scoreToPass;var scoreAsPercent=this.get("_scoreAsPercent");var score=this.get("_score");var isPass=isPercentageBased?scoreAsPercent>=scoreToPass:score>=scoreToPass;this.set("_isPass",isPass)},_getMarkingSettings:function _getMarkingSettings(){var markingSettings={};if(this._shouldSuppressMarking()){markingSettings={_canShowMarking:false,_canShowModelAnswer:false}}else{var questionConfig=this.getConfig()._questions;if(questionConfig.hasOwnProperty("_canShowModelAnswer")){markingSettings._canShowModelAnswer=questionConfig._canShowModelAnswer}if(questionConfig.hasOwnProperty("_canShowMarking")){markingSettings._canShowMarking=questionConfig._canShowMarking}}return markingSettings},_overrideMarkingSettings:function _overrideMarkingSettings(){var newMarkingSettings=this._getMarkingSettings();for(var i=0,l=this._currentQuestionComponents.length;i<l;i++){this._currentQuestionComponents[i].set(newMarkingSettings,{pluginName:"_assessment"})}},_refreshQuestions:function _refreshQuestions(){for(var a=0,b=this._currentQuestionComponents.length;a<b;a++){var question=this._currentQuestionComponents[a];question.refresh()}},_shouldSuppressMarking:function _shouldSuppressMarking(){return this._isMarkingSuppressionEnabled()&&this._isAttemptsLeft()},_isMarkingSuppressionEnabled:function _isMarkingSuppressionEnabled(){var assessmentConfig=this.getConfig();return assessmentConfig._suppressMarking},_isAttemptsLeft:function _isAttemptsLeft(){if(this.get("_isAssessmentComplete")&&this.get("_isPass"))return false;if(this.get("_attemptsLeft")===0)return false;return true},_spendAttempt:function _spendAttempt(){if(!this._isAttemptsLeft())return false;var attemptsSpent=this.get("_attemptsSpent");this.set("_attemptsSpent",++attemptsSpent);if(this.get("_attempts")=="infinite")return true;var attemptsLeft=this.get("_attemptsLeft");this.set("_attemptsLeft",--attemptsLeft);return true},_getScore:function _getScore(){var score=0;var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_isCorrect")&&question.get("_questionWeight")){score+=question.get("_questionWeight")}}return score},_getMaxScore:function _getMaxScore(){var maxScore=0;var questionComponents=this._currentQuestionComponents;for(var i=0,l=questionComponents.length;i<l;i++){var question=questionComponents[i];if(question.get("_questionWeight")){maxScore+=question.get("_questionWeight")}}return maxScore},_getScoreAsPercent:function _getScoreAsPercent(){if(this._getMaxScore()===0)return 0;return Math.round(this._getScore()/this._getMaxScore()*100)},_getLastAttemptScoreAsPercent:function _getLastAttemptScoreAsPercent(){return this.get("_lastAttemptScoreAsPercent")},_checkReloadPage:function _checkReloadPage(){if(!this.canResetInPage())return false;var parentId=this.getParent().get("_id");var currentLocation=Adapt.location._currentId;if(currentLocation!=parentId)return false;if(!this.get("_isReady"))return false;return true},_reloadPage:function _reloadPage(){this._forceResetOnRevisit=true;_.delay(function(){Backbone.history.navigate("#/id/"+Adapt.location._currentId,{replace:true,trigger:true})},250)},_resetQuestions:function _resetQuestions(callback){var assessmentConfig=this.getConfig();var syncIterations=1;var i=0,qs=this._currentQuestionComponents,len=qs.length;function step(){for(var j=0,count=Math.min(syncIterations,len-i);j<count;i++,j++){var question=qs[i];question.reset(assessmentConfig._questions._resetType,true)}i==len?callback():setTimeout(step)}step()},_onRemove:function _onRemove(){this._removeQuestionListeners()},_setCompletionStatus:function _setCompletionStatus(){this.set({_isComplete:true,_isInteractionComplete:true})},_checkIfQuestionsWereRestored:function _checkIfQuestionsWereRestored(){if(this.get("_assessmentCompleteInSession"))return;if(!this.get("_isAssessmentComplete"))return;var wereQuestionsRestored=true;var questions=this.get("_questions");for(var i=0,l=questions.length;i<l;i++){var question=questions[i];var questionModel=Adapt.findById(question._id);if(!questionModel.get("_isSubmitted")){wereQuestionsRestored=false;break}}if(!wereQuestionsRestored){this.set("_assessmentCompleteInSession",true);return true}return false},isAssessmentEnabled:function isAssessmentEnabled(){if(this.get("_assessment")&&this.get("_assessment")._isEnabled)return true;return false},canResetInPage:function canResetInPage(){var assessmentConfig=this.getConfig();if(assessmentConfig._reloadPageOnReset===false)return false;return true},reset:function reset(force,callback){if(this._isResetInProgress){this.once("reset",function(){this._isResetInProgress=false;if(typeof callback=="function"){callback(true)}});return}var assessmentConfig=this.getConfig();force=this._forceResetOnRevisit||force===true;this._forceResetOnRevisit=false;var isPageReload=this._checkReloadPage();if(this.get("_assessmentCompleteInSession")&&!assessmentConfig._isResetOnRevisit&&!isPageReload&&!force){if(typeof callback=="function"){callback(false)}return false}var wereQuestionsRestored=this._checkIfQuestionsWereRestored();force=force||wereQuestionsRestored;if(force&&!this._isAttemptsLeft()){this.set({_attemptsLeft:this.get("_attempts"),_attemptsSpent:0})}var allowResetIfPassed=this.get("_assessment")._allowResetIfPassed;if(!this._isAttemptsLeft()&&!force&&!allowResetIfPassed){if(typeof callback=="function")callback(false);return false}if(!isPageReload){this.once("reset",function(){this._isResetInProgress=false;if(typeof callback=="function"){callback(true)}});this._isResetInProgress=true;this._setupAssessmentData(force,function(){this.trigger("reset")})}else{this._reloadPage();if(typeof callback=="function"){callback(true)}}return true},getSaveState:function getSaveState(){var state=this.getState();var indexByIdQuestions=[];var cfg=this.getConfig();var banksActive=cfg._banks&&cfg._banks._isEnabled&&cfg._banks._split.length>1;var randomisationActive=cfg._randomisation&&cfg._randomisation._isEnabled;if(!banksActive&&!randomisationActive){this.findDescendantModels("components").forEach(function(component){var componentModel={_id:component.get("_id"),_isCorrect:component.get("_isCorrect")===undefined?null:component.get("_isCorrect")};indexByIdQuestions.push(componentModel)});indexByIdQuestions=_.indexBy(indexByIdQuestions,"_id")}else{indexByIdQuestions=_.indexBy(state.questions,"_id")}for(var id in indexByIdQuestions){if(indexByIdQuestions.hasOwnProperty(id)){indexByIdQuestions[id]=indexByIdQuestions[id]._isCorrect}}var saveState=[state.isComplete?1:0,state.attemptsSpent,state.maxScore,state.score,state.attemptInProgress?1:0,indexByIdQuestions];return saveState},setRestoreState:function setRestoreState(restoreState){var id;var isComplete=restoreState[0]==1?true:false;var attempts=this.get("_attempts");var attemptsSpent=restoreState[1];var maxScore=restoreState[2];var score=restoreState[3];var attemptInProgress=restoreState[4]==1?true:false;var scoreAsPercent;var indexByIdQuestions=restoreState[5];var blockIds={};for(id in indexByIdQuestions){if(indexByIdQuestions.hasOwnProperty(id)){var blockId=Adapt.findById(id).get("_parentId");blockIds[blockId]=Adapt.findById(blockId)}}var restoredChildrenModels=_.values(blockIds);if(indexByIdQuestions)this.getChildren().models=restoredChildrenModels;this.set({_isAssessmentComplete:isComplete,_assessmentCompleteInSession:false,_attemptsSpent:attemptsSpent,_attemptInProgress:attemptInProgress,_attemptsLeft:attempts==="infinite"?attempts:attempts-attemptsSpent,_maxScore:maxScore||this._getMaxScore(),_score:score||0});if(score){scoreAsPercent=Math.round(score/maxScore*100)}else{scoreAsPercent=0}this.set({_scoreAsPercent:scoreAsPercent,_lastAttemptScoreAsPercent:scoreAsPercent});var questions=[];for(id in indexByIdQuestions){if(indexByIdQuestions.hasOwnProperty(id)&&Adapt.findById(id).get("_isQuestionType")){questions.push({_id:id,_isCorrect:indexByIdQuestions[id]})}}this.set("_questions",questions);if(isComplete)this._checkIsPass();Adapt.trigger("assessments:restored",this.getState(),this)},getState:function getState(){var assessmentConfig=this.getConfig();var state={id:assessmentConfig._id,type:"article-assessment",pageId:this.getParent().get("_id"),articleId:this.get("_id"),isEnabled:assessmentConfig._isEnabled,isComplete:this.get("_isAssessmentComplete"),isPercentageBased:assessmentConfig._isPercentageBased,scoreToPass:assessmentConfig._scoreToPass,score:this.get("_score"),scoreAsPercent:this.get("_scoreAsPercent"),maxScore:this.get("_maxScore"),isPass:this.get("_isPass"),includeInTotalScore:assessmentConfig._includeInTotalScore,assessmentWeight:assessmentConfig._assessmentWeight,attempts:this.get("_attempts"),attemptsSpent:this.get("_attemptsSpent"),attemptsLeft:this.get("_attemptsLeft"),attemptInProgress:this.get("_attemptInProgress"),lastAttemptScoreAsPercent:this.get("_lastAttemptScoreAsPercent"),questions:this.get("_questions"),resetType:assessmentConfig._questions._resetType,allowResetIfPassed:assessmentConfig._allowResetIfPassed,questionModels:new Backbone.Collection(this._currentQuestionComponents)};return state},getConfig:function getConfig(){var assessmentConfig=this.get("_assessment");if(!assessmentConfig){assessmentConfig=$.extend(true,{},assessmentConfigDefaults)}else{assessmentConfig=$.extend(true,{},assessmentConfigDefaults,assessmentConfig)}if(assessmentConfig._id===undefined){assessmentConfig._id="givenId"+givenIdCount++}this.set("_assessment",assessmentConfig);return assessmentConfig}};return AssessmentModel});define("extensions/adapt-contrib-assessment/js/assessment",["core/js/adapt"],function(Adapt){var assessmentsConfigDefaults={_isPercentageBased:true,_scoreToPass:100,_isDefaultsLoaded:true};Adapt.assessment=_.extend({_assessments:_.extend([],{_byPageId:{},_byAssessmentId:{}}),initialize:function initialize(){this.listenTo(Adapt,{"assessments:complete":this._onAssessmentsComplete,"router:location":this._checkResetAssessmentsOnRevisit,"router:plugin":this._handleRoute,"app:dataReady":this._onDataReady})},_onAssessmentsComplete:function _onAssessmentsComplete(state){var assessmentId=state.id;state.isComplete=true;if(assessmentId===undefined)return;if(!this._getStateByAssessmentId(assessmentId)){Adapt.log.warn("assessments: state was not registered when assessment was created")}this.saveState();this._setPageProgress();this._checkAssessmentsComplete()},_restoreModelState:function _restoreModelState(assessmentModel){if(!this._saveStateModel){this._saveStateModel=Adapt.offlineStorage.get("assessment")}if(this._saveStateModel){var state=assessmentModel.getState();if(this._saveStateModel[state.id]){assessmentModel.setRestoreState(this._saveStateModel[state.id])}}},_handleRoute:function _handleRoute(plugin,id){if(plugin!=="assessment"&&plugin!=="article-assessment"||id===undefined){return}if(!Adapt.findById(id)){var assessment=Adapt.assessment._assessments._byAssessmentId[id];if(assessment){id=assessment.get("_id")}else{Adapt.log.warn("Assessment not found with _id: "+id);return}}_.defer(function(){Backbone.history.navigate("#/id/"+id,{trigger:true,replace:true})})},_checkResetAssessmentsOnRevisit:function _checkResetAssessmentsOnRevisit(toObject){if(toObject._contentType!=="page")return;var pageAssessmentModels=this._getAssessmentByPageId(toObject._currentId);if(pageAssessmentModels===undefined)return;Adapt.wait.for(function resetAllAssessments(allAssessmentHaveReset){var numberOfAssessments=pageAssessmentModels.length;var numberOfResetAssessments=0;var forceAssessmentReset=false;pageAssessmentModels.forEach(function(model){model.reset(forceAssessmentReset,function(){numberOfResetAssessments++;var haveAllModelsReset=numberOfResetAssessments===numberOfAssessments;if(!haveAllModelsReset){return}allAssessmentHaveReset()})})});this._setPageProgress()},_onDataReady:function _onDataReady(){this._assessments=_.extend([],{_byPageId:{},_byAssessmentId:{}});this._restoredCount=0},_checkAssessmentsComplete:function _checkAssessmentsComplete(){var allAssessmentsComplete=true;var assessmentToPostBack=0;var states=this._getStatesByAssessmentId();var assessmentStates=[];for(var id in states){var state=states[id];if(!state.includeInTotalScore)continue;if(!state.isComplete){allAssessmentsComplete=false;break}assessmentToPostBack++;assessmentStates.push(state)}if(!allAssessmentsComplete||assessmentToPostBack===0)return false;if(assessmentToPostBack===1){this._setupSingleAssessmentConfiguration(assessmentStates[0])}_.defer(function(){Adapt.trigger("assessment:complete",this.getState())}.bind(this));return true},_setupSingleAssessmentConfiguration:function _setupSingleAssessmentConfiguration(assessmentState){var assessmentsConfig=Adapt.course.get("_assessment");$.extend(true,assessmentsConfig,{_isPercentageBased:assessmentState.isPercentageBased,_scoreToPass:assessmentState.scoreToPass});Adapt.course.set("_assessment",assessmentsConfig)},_getAssessmentByPageId:function _getAssessmentByPageId(pageId){return this._assessments._byPageId[pageId]},_getStateByAssessmentId:function _getStateByAssessmentId(assessmentId){if(assessmentId===undefined){return null}return this._assessments._byAssessmentId[assessmentId].getState()},_getStatesByAssessmentId:function _getStatesByAssessmentId(){var states={};for(var i=0,l=this._assessments.length;i<l;i++){var assessmentModel=this._assessments[i];var state=assessmentModel.getState();states[state.id]=state}return states},_setPageProgress:function _setPageProgress(){for(var k in this._assessments._byPageId){var assessments=this._assessments._byPageId[k];var assessmentsTotal=assessments.length;var assessmentsPassed=0;for(var i=0,l=assessments.length;i<l;i++){var assessmentState=assessments[i].getState();if(assessmentState.includeInTotalScore&&!assessmentState.isPass)continue;if(assessmentState.isComplete){assessmentsPassed++}}try{var pageModel=Adapt.findById(k);pageModel.set({_subProgressTotal:assessmentsTotal,_subProgressComplete:assessmentsPassed})}catch(e){}}},_addToAssessmentIdMap:function _addToAssessmentIdMap(id,model){if(id===undefined){Adapt.log.warn("An assessment has been registered with an undefined value for \"_id\"");return}if(id===""){Adapt.log.warn("An assessment has been registered with an empty value for \"_id\"")}if(!this._assessments._byAssessmentId[id]){this._assessments._byAssessmentId[id]=model}else{Adapt.log.warn("An assessment with an _id of \""+id+"\" already exists!")}},_setupQuestionNumbering:function _setupQuestionNumbering(){var getRelatedQuestions=function getRelatedQuestions(data){var currentAssessmentId=data._assessmentId;var currentAssessment=Adapt.assessment.get(currentAssessmentId);return currentAssessment.getState().questions};Handlebars.registerHelper("questionNumber",function getQuestionNumber(){var data=this.view?this.view.model.toJSON():this;if(!data._isPartOfAssessment)return;var related=_.pluck(getRelatedQuestions(data),"_id");return related.indexOf(data._id)+1});Handlebars.registerHelper("questionCount",function getTotalQuestions(){var data=this.view?this.view.model.toJSON():this;if(!data._isPartOfAssessment)return;return getRelatedQuestions(data).length})},register:function register(assessmentModel){var state=assessmentModel.getState();var assessmentId=state.id;var pageId=state.pageId;if(this._assessments._byPageId[pageId]===undefined){this._assessments._byPageId[pageId]=[]}this._assessments._byPageId[pageId].push(assessmentModel);this._addToAssessmentIdMap(assessmentId,assessmentModel);this._assessments.push(assessmentModel);this._restoreModelState(assessmentModel);this._restoredCount++;Adapt.trigger("assessments:register",state,assessmentModel);this._setPageProgress();this._setupQuestionNumbering();if(this._restoredCount===this._assessments.length){Adapt.trigger("assessment:restored",this.getState())}},get:function get(id){if(id===undefined){return this._assessments.slice(0)}else{return this._assessments._byAssessmentId[id]}},saveState:function saveState(){this._saveStateModel={};for(var i=0,assessmentModel;assessmentModel=this._assessments[i++];){var state=assessmentModel.getState();this._saveStateModel[state.id]=assessmentModel.getSaveState()}Adapt.offlineStorage.set("assessment",this._saveStateModel)},getConfig:function getConfig(){var assessmentsConfig=Adapt.course.get("_assessment");if(assessmentsConfig&&assessmentsConfig._isDefaultsLoaded){return assessmentsConfig}if(assessmentsConfig===undefined){assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults)}else{assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults,assessmentsConfig)}Adapt.course.set("_assessment",assessmentsConfig);return assessmentsConfig},getState:function getState(){var assessmentsConfig=this.getConfig();var score=0;var maxScore=0;var isPass=false;var totalAssessments=0;var states=this._getStatesByAssessmentId();var assessmentsComplete=0;for(var id in states){var state=states[id];if(!state.includeInTotalScore)continue;if(state.isComplete)assessmentsComplete++;totalAssessments++;maxScore+=state.maxScore/state.assessmentWeight;score+=state.score/state.assessmentWeight}var isComplete=assessmentsComplete==totalAssessments;var scoreAsPercent=Math.round(score/maxScore*100);if((assessmentsConfig._scoreToPass||100)&&isComplete){if(assessmentsConfig._isPercentageBased!==false){if(scoreAsPercent>=assessmentsConfig._scoreToPass)isPass=true}else{if(score>=assessmentsConfig._scoreToPass)isPass=true}}return{isComplete:isComplete,isPercentageBased:assessmentsConfig._isPercentageBased,isPass:isPass,scoreAsPercent:scoreAsPercent,maxScore:maxScore,score:score,scoreToPass:assessmentsConfig._scoreToPass,assessmentsComplete:assessmentsComplete,assessments:totalAssessments}}},Backbone.Events);Adapt.assessment.initialize()});define("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleExtension",["core/js/views/articleView","core/js/models/articleModel","./adapt-assessmentArticleView","./adapt-assessmentArticleModel","./assessment"],function(ArticleView,ArticleModel,AdaptAssessmentArticleView,AdaptAssessmentArticleModel){var ArticleViewInitialize=ArticleView.prototype.initialize;ArticleView.prototype.initialize=function(options){if(this.model.get("_assessment")&&this.model.get("_assessment")._isEnabled===true){_.extend(this,AdaptAssessmentArticleView)}return ArticleViewInitialize.apply(this,arguments)};var ArticleModelInitialize=ArticleModel.prototype.initialize;ArticleModel.prototype.initialize=function(options){if(this.get("_assessment")&&this.get("_assessment")._isEnabled===true){_.extend(this,AdaptAssessmentArticleModel);var returnValue=ArticleModelInitialize.apply(this,arguments);this._postInitialize();return returnValue}return ArticleModelInitialize.apply(this,arguments)}});define("extensions/adapt-contrib-bookmarking/js/adapt-contrib-bookmarking",["core/js/adapt"],function(Adapt){var Bookmarking=Backbone.Controller.extend({bookmarkLevel:null,watchViewIds:null,watchViews:[],restoredLocationID:null,currentLocationID:null,initialize:function initialize(){this.listenToOnce(Adapt,"router:location",this.onAdaptInitialize)},onAdaptInitialize:function onAdaptInitialize(){if(!this.checkIsEnabled())return;this.setupEventListeners();this.checkRestoreLocation()},checkIsEnabled:function checkIsEnabled(){var courseBookmarkModel=Adapt.course.get("_bookmarking");if(!courseBookmarkModel||!courseBookmarkModel._isEnabled)return false;if(!Adapt.offlineStorage)return false;return true},setupEventListeners:function setupEventListeners(){this._onScroll=_.debounce(this.checkLocation.bind(this),1000);this.listenTo(Adapt,{"menuView:ready":this.setupMenu,"pageView:preRender":this.setupPage})},checkRestoreLocation:function checkRestoreLocation(){this.restoredLocationID=Adapt.offlineStorage.get("location");if(!this.restoredLocationID||this.restoredLocationID==="undefined")return;this.listenToOnce(Adapt,"pageView:ready menuView:ready",this.restoreLocation)},restoreLocation:function restoreLocation(){_.defer(function(){this.stopListening(Adapt,"pageView:ready menuView:ready",this.restoreLocation);if(this.restoredLocationID===Adapt.location._currentId||!Adapt.findById(this.restoredLocationID)){return}var locationOnscreen=$("."+this.restoredLocationID).onscreen();var isLocationOnscreen=locationOnscreen&&locationOnscreen.percentInview>0;var isLocationFullyInview=locationOnscreen&&locationOnscreen.percentInview===100;if(isLocationOnscreen&&isLocationFullyInview){return}if(Adapt.course.get("_bookmarking")._showPrompt===false){this.navigateToPrevious();return}this.showPrompt()}.bind(this))},showPrompt:function showPrompt(){var courseBookmarkModel=Adapt.course.get("_bookmarking");var buttons=courseBookmarkModel._buttons||{yes:"Yes",no:"No"};this.listenToOnce(Adapt,{"bookmarking:continue":this.navigateToPrevious,"bookmarking:cancel":this.navigateCancel});var promptObject={title:courseBookmarkModel.title,body:courseBookmarkModel.body,_prompts:[{promptText:buttons.yes||"Yes",_callbackEvent:"bookmarking:continue"},{promptText:buttons.no||"No",_callbackEvent:"bookmarking:cancel"}],_showIcon:true};var accessibility=Adapt.config.get("_accessibility");if(!accessibility||!accessibility._isActive){Adapt.trigger("notify:prompt",promptObject);return}$(".loading").show();$("#a11y-focuser").focus();$("body").attr("aria-hidden",true);_.delay(function(){$(".loading").hide();$("body").removeAttr("aria-hidden");Adapt.trigger("notify:prompt",promptObject)},3000)},navigateToPrevious:function navigateToPrevious(){_.defer(function(){var isSinglePage=Adapt.contentObjects.models.length==1;Backbone.history.navigate("#/id/"+this.restoredLocationID,{trigger:true,replace:isSinglePage})}.bind(this));this.stopListening(Adapt,"bookmarking:cancel")},navigateCancel:function navigateCancel(){this.stopListening(Adapt,"bookmarking:continue")},resetLocationID:function resetLocationID(){this.setLocationID("")},setupMenu:function setupMenu(menuView){var menuModel=menuView.model;if(!menuModel.get("_parentId")){this.resetLocationID();return}this.setLocationID(menuModel.get("_id"))},getBookmarkLevel:function getBookmarkLevel(pageModel){var defaultLevel=Adapt.course.get("_bookmarking")._level||"component";var bookmarkModel=pageModel.get("_bookmarking");var isInherit=!bookmarkModel||!bookmarkModel._level||bookmarkModel._level==="inherit";return isInherit?defaultLevel:bookmarkModel._level},setupPage:function setupPage(pageView){var pageBookmarkModel=pageView.model.get("_bookmarking");if(pageBookmarkModel&&pageBookmarkModel._isEnabled===false){this.resetLocationID();return}this.setLocationID(pageView.model.get("_id"));this.bookmarkLevel=this.getBookmarkLevel(pageView.model);if(this.bookmarkLevel==="page"){return}this.watchViewIds=pageView.model.findDescendantModels(this.bookmarkLevel+"s").map(function(desc){return desc.get("_id")});this.listenTo(Adapt,this.bookmarkLevel+"View:postRender",this.captureViews);this.listenToOnce(Adapt,"remove",this.releaseViews);$(window).on("scroll",this._onScroll)},captureViews:function captureViews(view){this.watchViews.push(view)},setLocationID:function setLocationID(id){if(!Adapt.offlineStorage)return;if(this.currentLocationID==id)return;Adapt.offlineStorage.set("location",id);this.currentLocationID=id},releaseViews:function releaseViews(){this.watchViews.length=0;this.watchViewIds.length=0;this.stopListening(Adapt,"remove",this.releaseViews);this.stopListening(Adapt,this.bookmarkLevel+"View:postRender",this.captureViews);$(window).off("scroll",this._onScroll)},checkLocation:function checkLocation(){var highestOnscreen=0;var highestOnscreenLocation="";for(var i=0,l=this.watchViews.length;i<l;i++){var view=this.watchViews[i];var isViewAPageChild=this.watchViewIds.indexOf(view.model.get("_id"))>-1;if(!isViewAPageChild)continue;var element=$("."+view.model.get("_id"));var measurements=element.onscreen();if(!measurements.onscreen)continue;if(measurements.percentInview>highestOnscreen){highestOnscreen=measurements.percentInview;highestOnscreenLocation=view.model.get("_id")}}if(highestOnscreenLocation)this.setLocationID(highestOnscreenLocation)}});return new Bookmarking});define("extensions/adapt-contrib-languagePicker/js/languagePickerNavigationView",["core/js/adapt"],function(Adapt){var NavigationView=Backbone.View.extend({className:"navigation",attributes:{role:"navigation"},initialize:function initialize(){this.template="languagePickerNavigation";this.setupHelpers();this.preRender()},preRender:function preRender(){Adapt.trigger("navigationView:preRender",this);this.render()},render:function render(){var template=Handlebars.templates[this.template];this.$el.html(template({_config:this.model.get("_accessibility"),_accessibility:Adapt.config.get("_accessibility")})).insertBefore("#app");_.defer(function(){Adapt.trigger("navigationView:postRender",this)}.bind(this));return this},setupHelpers:function setupHelpers(){Handlebars.registerHelper("a11y_aria_label",function(text){})}});return NavigationView});define("extensions/adapt-contrib-languagePicker/js/languagePickerView",["core/js/adapt","./languagePickerNavigationView"],function(Adapt,NavigationView){var LanguagePickerView=Backbone.View.extend({events:{"click .languagepicker-languages button":"onLanguageClick"},className:"languagepicker",initialize:function initialize(){this.initializeNavigation();$("html").addClass("in-languagepicker");this.listenTo(Adapt,"remove",this.remove);this.render()},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data));this.$el.addClass(data._classes);document.title=this.model.get("title")||"";_.defer(this.postRender.bind(this))},postRender:function postRender(){$(".loading").hide()},onLanguageClick:function onLanguageClick(event){this.destroyNavigation();this.model.setLanguage($(event.target).val())},initializeNavigation:function initializeNavigation(){this.navigationView=new NavigationView({model:this.model})},destroyNavigation:function destroyNavigation(){this.navigationView.remove()},remove:function remove(){$("html").removeClass("in-languagepicker");Backbone.View.prototype.remove.apply(this,arguments)}},{template:"languagePickerView"});return LanguagePickerView});define("extensions/adapt-contrib-languagePicker/js/languagePickerDrawerView",["core/js/adapt"],function(Adapt){var LanguagePickerDrawerView=Backbone.View.extend({events:{"click button":"onButtonClick"},initialize:function initialize(){this.listenTo(Adapt,{remove:this.remove,"languagepicker:changelanguage:yes":this.onDoChangeLanguage,"languagepicker:changelanguage:no":this.onDontChangeLanguage});this.render()},render:function render(){var data=this.model.toJSON();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))},onButtonClick:function onButtonClick(event){var newLanguage=$(event.target).attr("data-language");this.model.set("newLanguage",newLanguage);var data=this.model.getLanguageDetails(newLanguage);var promptObject={_classes:"dir-ltr",title:data.warningTitle,body:data.warningMessage,_prompts:[{promptText:data._buttons.yes,_callbackEvent:"languagepicker:changelanguage:yes"},{promptText:data._buttons.no,_callbackEvent:"languagepicker:changelanguage:no"}],_showIcon:true};if(data._direction==="rtl"){promptObject._classes="dir-rtl"}this.$finishFocus=$.a11y.state.focusStack.pop();$.a11y.state.focusStack.push($("#focuser"));Adapt.once("drawer:closed",function(){_.delay(function(){Adapt.once("popup:opened",function(){$.a11y.state.focusStack.pop();$.a11y.state.focusStack.push($("#focuser"))});Adapt.trigger("notify:prompt",promptObject)},250)});Adapt.trigger("drawer:closeDrawer")},onDoChangeLanguage:function onDoChangeLanguage(){var newLanguage=this.model.get("newLanguage");this.model.setTrackedData();this.model.setLanguage(newLanguage);this.remove()},onDontChangeLanguage:function onDontChangeLanguage(){this.remove();_.delay(function(){this.$finishFocus.a11y_focus()}.bind(this),500)}},{template:"languagePickerDrawerView"});return LanguagePickerDrawerView});define("extensions/adapt-contrib-languagePicker/js/languagePickerNavView",["core/js/adapt","./languagePickerDrawerView"],function(Adapt,LanguagePickerDrawerView){var LanguagePickerNavView=Backbone.View.extend({tagName:"button",className:function className(){var classNames="languagepicker-icon base icon";var customClass=this.model.get("_languagePickerIconClass")||"icon-language-2";return classNames+" "+customClass},events:{"click":"onClick"},initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove)},onClick:function onClick(event){Adapt.drawer.triggerCustomView(new LanguagePickerDrawerView({model:this.model}).$el,false)}});return LanguagePickerNavView});define("extensions/adapt-contrib-languagePicker/js/languagePickerModel",["core/js/adapt"],function(Adapt){var LanguagePickerModel=Backbone.Model.extend({defaults:{_isEnabled:false,displayTitle:"",body:"",_languages:[]},trackedData:{components:[],blocks:[]},locationId:null,initialize:function initialize(){this.listenTo(Adapt.config,"change:_activeLanguage",this.markLanguageAsSelected);this.listenTo(Adapt,"app:dataLoaded",this.onDataLoaded)},getLanguageDetails:function getLanguageDetails(language){var _languages=this.get("_languages");return _.find(_languages,function(item){return item._language===language})},setLanguage:function setLanguage(language){Adapt.config.set({"_activeLanguage":language,"_defaultDirection":this.getLanguageDetails(language)._direction})},markLanguageAsSelected:function markLanguageAsSelected(model,language){this.get("_languages").forEach(function(item){item._isSelected=item._language===language})},onDataLoaded:function onDataLoaded(){if(!this.get("_restoreStateOnLanguageChange")){return}_.defer(function(){this.locationId=Adapt.offlineStorage.get("location")||null;this.restoreState()}.bind(this))},restoreLocation:function restoreLocation(){if(!Adapt.mapById(this.locationId))return;_.defer(Adapt.navigateToElement,"."+this.locationId)},restoreState:function restoreState(){if(this.isTrackedDataEmpty())return;if(this.trackedData.components){this.trackedData.components.forEach(this.setTrackableState)}if(this.trackedData.blocks){this.trackedData.blocks.forEach(this.setTrackableState)}},isTrackedDataEmpty:function isTrackedDataEmpty(){return _.isEqual(this.trackedData,{components:[],blocks:[]})},getTrackableState:function getTrackableState(){var components=this.getState(Adapt.components.models);var blocks=this.getState(Adapt.blocks.models);return{components:_.compact(components),blocks:_.compact(blocks)}},getState:function getState(models){return models.map(function(model){if(model.get("_isComplete")){return model.getTrackableState()}})},setTrackedData:function setTrackedData(){if(this.get("_restoreStateOnLanguageChange")){this.listenToOnce(Adapt,"menuView:ready",this.restoreLocation);this.trackedData=this.getTrackableState()}},setTrackableState:function setTrackableState(stateObject){var restoreModel=Adapt.findById(stateObject._id);if(restoreModel){restoreModel.setTrackableState(stateObject)}else{Adapt.log.warn("LanguagePicker unable to restore state for: "+stateObject._id)}}});return LanguagePickerModel});define("extensions/adapt-contrib-languagePicker/js/adapt-languagePicker",["core/js/adapt","./languagePickerView","./languagePickerNavView","./languagePickerModel"],function(Adapt,LanguagePickerView,LanguagePickerNavView,LanguagePickerModel){var languagePickerModel;Adapt.once("configModel:dataLoaded",onConfigLoaded);function onConfigLoaded(){if(!Adapt.config.has("_languagePicker"))return;if(!Adapt.config.get("_languagePicker")._isEnabled)return;Adapt.config.set("_canLoadData",false);languagePickerModel=new LanguagePickerModel(Adapt.config.get("_languagePicker"));Adapt.on("router:menu router:page",setupNavigationView);if(Adapt.offlineStorage.ready){onOfflineStorageReady()}else{Adapt.once("offlineStorage:ready",onOfflineStorageReady)}}function onOfflineStorageReady(){var storedLanguage=Adapt.offlineStorage.get("lang");if(storedLanguage){languagePickerModel.setLanguage(storedLanguage)}else if(languagePickerModel.get("_showOnCourseLoad")===false){languagePickerModel.setLanguage(Adapt.config.get("_defaultLanguage"))}else{showLanguagePickerView()}}function showLanguagePickerView(){var languagePickerView=new LanguagePickerView({model:languagePickerModel});languagePickerView.$el.appendTo("#wrapper")}function setupNavigationView(){var courseGlobals=Adapt.course.get("_globals")._extensions;var navigationBarLabel="";if(courseGlobals._languagePicker){navigationBarLabel=courseGlobals._languagePicker.navigationBarLabel}var languagePickerNavView=new LanguagePickerNavView({model:languagePickerModel,attributes:{"aria-label":navigationBarLabel}});languagePickerNavView.$el.appendTo(".navigation-inner")}});define("extensions/adapt-contrib-pageLevelProgress/js/completionCalculations",["coreJS/adapt"],function(Adapt){function calculateCompletion(contentObjectModel){var viewType=contentObjectModel.get("_type"),nonAssessmentComponentsTotal=0,nonAssessmentComponentsCompleted=0,assessmentComponentsTotal=0,assessmentComponentsCompleted=0,subProgressCompleted=0,subProgressTotal=0,isComplete=contentObjectModel.get("_isComplete")?1:0;if(viewType=="page"){var children=contentObjectModel.findDescendants("components").where({"_isAvailable":true,"_isOptional":false});var availableChildren=filterAvailableChildren(children);var components=getPageLevelProgressEnabledModels(availableChildren);var nonAssessmentComponents=getNonAssessmentComponents(components);nonAssessmentComponentsTotal=nonAssessmentComponents.length|0,nonAssessmentComponentsCompleted=getComponentsCompleted(nonAssessmentComponents).length;var assessmentComponents=getAssessmentComponents(components);assessmentComponentsTotal=assessmentComponents.length|0,assessmentComponentsCompleted=getComponentsInteractionCompleted(assessmentComponents).length;subProgressCompleted=contentObjectModel.get("_subProgressComplete")||0;subProgressTotal=contentObjectModel.get("_subProgressTotal")||0;var pageCompletion={"subProgressCompleted":subProgressCompleted,"subProgressTotal":subProgressTotal,"nonAssessmentCompleted":nonAssessmentComponentsCompleted,"nonAssessmentTotal":nonAssessmentComponentsTotal,"assessmentCompleted":assessmentComponentsCompleted,"assessmentTotal":assessmentComponentsTotal};if(contentObjectModel.get("_pageLevelProgress")&&contentObjectModel.get("_pageLevelProgress")._showPageCompletion!==false&&Adapt.course.get("_pageLevelProgress")&&Adapt.course.get("_pageLevelProgress")._showPageCompletion!==false){pageCompletion.nonAssessmentCompleted+=isComplete;pageCompletion.nonAssessmentTotal+=1}return pageCompletion}else if(viewType=="menu"){_.each(contentObjectModel.get("_children").models,function(contentObject){var completionObject=calculateCompletion(contentObject);subProgressCompleted+=contentObjectModel.subProgressCompleted||0;subProgressTotal+=contentObjectModel.subProgressTotal||0;nonAssessmentComponentsTotal+=completionObject.nonAssessmentTotal;nonAssessmentComponentsCompleted+=completionObject.nonAssessmentCompleted;assessmentComponentsTotal+=completionObject.assessmentTotal;assessmentComponentsCompleted+=completionObject.assessmentCompleted});return{"subProgressCompleted":subProgressCompleted,"subProgressTotal":subProgressTotal,"nonAssessmentCompleted":nonAssessmentComponentsCompleted,"nonAssessmentTotal":nonAssessmentComponentsTotal,"assessmentCompleted":assessmentComponentsCompleted,"assessmentTotal":assessmentComponentsTotal}}}function getNonAssessmentComponents(models){return _.filter(models,function(model){return!model.get("_isPartOfAssessment")})}function getAssessmentComponents(models){return _.filter(models,function(model){return model.get("_isPartOfAssessment")})}function getComponentsCompleted(models){return _.filter(models,function(item){return item.get("_isComplete")})}function getComponentsInteractionCompleted(models){return _.filter(models,function(item){return item.get("_isInteractionComplete")})}function getPageLevelProgressEnabledModels(models){return _.filter(models,function(model){if(model.get("_pageLevelProgress")){return model.get("_pageLevelProgress")._isEnabled}})}function unavailableInHierarchy(parents){if(parents.length>0){var parentsAvailable=_.map(parents,function(parent){return parent.get("_isAvailable")});return _.indexOf(parentsAvailable,false)>-1}else{return}}function filterAvailableChildren(children){var availableChildren=[];for(var child=0;child<children.length;child++){var parents=children[child].getParents().models;if(!unavailableInHierarchy(parents)){availableChildren.push(children[child])}}return availableChildren}return{calculateCompletion:calculateCompletion,getPageLevelProgressEnabledModels:getPageLevelProgressEnabledModels,filterAvailableChildren:filterAvailableChildren}});define("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressMenuView",["require","coreJS/adapt","backbone"],function(require){var Adapt=require("coreJS/adapt");var Backbone=require("backbone");var PageLevelProgressMenuView=Backbone.View.extend({className:"page-level-progress-menu-item",initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.ariaText="";if(Adapt.course.get("_globals")._extensions&&Adapt.course.get("_globals")._extensions._pageLevelProgress&&Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressMenuBar){this.ariaText=Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressMenuBar+" "}this.render();_.defer(_.bind(function(){this.updateProgressBar()},this))},events:{},render:function render(){var data=this.model.toJSON();_.extend(data,{_globals:Adapt.course.get("_globals")});var template=Handlebars.templates["pageLevelProgressMenu"];this.$el.html(template(data));return this},updateProgressBar:function updateProgressBar(){if(this.model.get("completedChildrenAsPercentage")){var percentageOfCompleteComponents=this.model.get("completedChildrenAsPercentage")}else{var percentageOfCompleteComponents=0}this.$(".page-level-progress-menu-item-indicator-bar .aria-label").html(this.ariaText+Math.floor(percentageOfCompleteComponents)+"%")}});return PageLevelProgressMenuView});define("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressView",["require","coreJS/adapt","backbone"],function(require){var Adapt=require("coreJS/adapt");var Backbone=require("backbone");var PageLevelProgressView=Backbone.View.extend({className:"page-level-progress",initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.render()},events:{"click .page-level-progress-item button":"scrollToPageElement"},scrollToPageElement:function scrollToPageElement(event){if(event&&event.preventDefault)event.preventDefault();var currentComponentSelector="."+$(event.currentTarget).attr("data-page-level-progress-id");var $currentComponent=$(currentComponentSelector);Adapt.once("drawer:closed",function(){Adapt.scrollTo($currentComponent,{duration:400})});Adapt.trigger("drawer:closeDrawer")},render:function render(){var components=this.collection.toJSON();var data={components:components,_globals:Adapt.course.get("_globals")};var template=Handlebars.templates["pageLevelProgress"];this.$el.html(template(data));this.$el.a11y_aria_label(true);return this}});return PageLevelProgressView});define("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressNavigationView",["require","coreJS/adapt","backbone","./completionCalculations","extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressView"],function(require){var Adapt=require("coreJS/adapt");var Backbone=require("backbone");var completionCalculations=require("./completionCalculations");var PageLevelProgressView=require("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressView");var PageLevelProgressNavigationView=Backbone.View.extend({tagName:"button",className:"base page-level-progress-navigation",initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.listenTo(Adapt,"router:location",this.updateProgressBar);this.listenTo(Adapt,"pageLevelProgress:update",this.refreshProgressBar);this.listenTo(this.collection,"change:_isInteractionComplete",this.updateProgressBar);this.listenTo(this.model,"change:_isInteractionComplete",this.updateProgressBar);this.$el.attr("role","button");this.ariaText="";if(Adapt.course.has("_globals")&&Adapt.course.get("_globals")._extensions&&Adapt.course.get("_globals")._extensions._pageLevelProgress&&Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressIndicatorBar){this.ariaText=Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressIndicatorBar+" "}this.render();_.defer(_.bind(function(){this.updateProgressBar()},this))},events:{"click":"onProgressClicked"},render:function render(){var components=this.collection.toJSON();var data={components:components,_globals:Adapt.course.get("_globals")};var template=Handlebars.templates["pageLevelProgressNavigation"];$(".navigation-inner").append(this.$el.html(template(data)));return this},refreshProgressBar:function refreshProgressBar(){var currentPageComponents=this.model.findDescendants("components").where({"_isAvailable":true});var availableChildren=completionCalculations.filterAvailableChildren(currentPageComponents);var enabledProgressComponents=completionCalculations.getPageLevelProgressEnabledModels(availableChildren);this.collection=new Backbone.Collection(enabledProgressComponents);this.updateProgressBar()},updateProgressBar:function updateProgressBar(){var completionObject=completionCalculations.calculateCompletion(this.model);var completed=completionObject.nonAssessmentCompleted+completionObject.assessmentCompleted+completionObject.subProgressCompleted;var total=completionObject.nonAssessmentTotal+completionObject.assessmentTotal+completionObject.subProgressTotal;var percentageComplete=Math.floor(completed/total*100);this.$(".page-level-progress-navigation-bar").css("width",percentageComplete+"%");this.$el.attr("aria-label",this.ariaText+percentageComplete+"%");this.$el.attr("title",this.ariaText+percentageComplete+"%");this.model.set("completedChildrenAsPercentage",percentageComplete)},onProgressClicked:function onProgressClicked(event){if(event&&event.preventDefault)event.preventDefault();Adapt.drawer.triggerCustomView(new PageLevelProgressView({collection:this.collection}).$el,false)}});return PageLevelProgressNavigationView});define("extensions/adapt-contrib-pageLevelProgress/js/adapt-contrib-pageLevelProgress",["require","coreJS/adapt","backbone","./completionCalculations","extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressMenuView","extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressNavigationView"],function(require){var Adapt=require("coreJS/adapt");var Backbone=require("backbone");var completionCalculations=require("./completionCalculations");var PageLevelProgressMenuView=require("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressMenuView");var PageLevelProgressNavigationView=require("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressNavigationView");function setupPageLevelProgress(pageModel,enabledProgressComponents){new PageLevelProgressNavigationView({model:pageModel,collection:new Backbone.Collection(enabledProgressComponents)})}Adapt.on("menuView:postRender",function(view){if(view.model.get("_id")==Adapt.location._currentId)return;if(!Adapt.course.get("_pageLevelProgress")||!Adapt.course.get("_pageLevelProgress")._isEnabled){return}var pageLevelProgress=view.model.get("_pageLevelProgress");var viewType=view.model.get("_type");if(viewType=="course")return;if(pageLevelProgress&&pageLevelProgress._isEnabled){var completionObject=completionCalculations.calculateCompletion(view.model);var completed=completionObject.nonAssessmentCompleted+completionObject.subProgressCompleted;var total=completionObject.nonAssessmentTotal+completionObject.subProgressTotal;var percentageComplete=Math.floor(completed/total*100);view.model.set("completedChildrenAsPercentage",percentageComplete);view.$el.find(".menu-item-inner").append(new PageLevelProgressMenuView({model:view.model}).$el)}});Adapt.on("router:page",function(pageModel){if(!Adapt.course.get("_pageLevelProgress")||!Adapt.course.get("_pageLevelProgress")._isEnabled){return}var currentPageComponents=pageModel.findDescendants("components").where({"_isAvailable":true});var availableComponents=completionCalculations.filterAvailableChildren(currentPageComponents);var enabledProgressComponents=completionCalculations.getPageLevelProgressEnabledModels(availableComponents);if(enabledProgressComponents.length>0){setupPageLevelProgress(pageModel,enabledProgressComponents)}})});define("extensions/adapt-contrib-resources/js/adapt-contrib-resourcesView",["core/js/adapt"],function(Adapt){var ResourcesView=Backbone.View.extend({className:"resources",initialize:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.render()},events:{"click .resources-filter button":"onFilterClicked"},render:function render(){this.$el.html(Handlebars.templates.resources({model:this.model.toJSON(),resources:this.collection.toJSON()}));_.defer(function(){this.listenTo(Adapt,"drawer:triggerCustomView",this.remove)}.bind(this));return this},onFilterClicked:function onFilterClicked(e){if(e&&e.preventDefault)e.preventDefault();this.$(".resources-filter button").removeClass("selected");var items;var filter=$(e.currentTarget).addClass("selected").attr("data-filter");if(filter==="all"){items=this.$(".resources-item").removeClass("display-none")}else{this.$(".resources-item").removeClass("display-none").not("."+filter).addClass("display-none");items=this.$(".resources-item."+filter)}if(items.length>0)$(items[0]).a11y_focus()}});return ResourcesView});define("extensions/adapt-contrib-resources/js/adapt-contrib-resourcesHelpers",["handlebars","core/js/adapt"],function(Handlebars,Adapt){var helpers={resources_has_type:function resources_has_type(resources,type,block){var hasType=_.some(resources,_.matcher({_type:type}));return hasType?block.fn(this):block.inverse(this)},resources_has_multiple_types:function resources_has_multiple_types(resources,block){if(resources.length===1)return block.inverse(this);var allSameType=_.every(resources,_.matcher({_type:resources[0]._type}));return allSameType?block.inverse(this):block.fn(this)},resources_get_column_count:function resources_get_column_count(resources){return _.uniq(_.pluck(resources,"_type")).length+1},resources_force_download:function resources_force_download(resource,block){if(Adapt.device.browser==="internet explorer"||Adapt.device.OS==="ios"){return block.inverse(this)}return resource._forceDownload||resource.filename?block.fn(this):block.inverse(this)}};for(var name in helpers){if(helpers.hasOwnProperty(name)){Handlebars.registerHelper(name,helpers[name])}}});define("extensions/adapt-contrib-resources/js/adapt-contrib-resources",["core/js/adapt","./adapt-contrib-resourcesView","./adapt-contrib-resourcesHelpers"],function(Adapt,ResourcesView,ResourcesHelpers){function setupResources(resourcesData){var resourcesModel=new Backbone.Model(resourcesData);var resourcesCollection=new Backbone.Collection(resourcesModel.get("_resourcesItems"));Adapt.on("resources:showResources",function(){Adapt.drawer.triggerCustomView(new ResourcesView({model:resourcesModel,collection:resourcesCollection}).$el)})}function initResources(){var courseResources=Adapt.course.get("_resources");if(!courseResources||courseResources._isEnabled===false)return;var drawerObject={title:courseResources.title,description:courseResources.description,className:"resources-drawer",drawerOrder:courseResources._drawerOrder||0};Adapt.drawer.addItem(drawerObject,"resources:showResources");setupResources(courseResources)}Adapt.on("adapt:start",initResources)});define("extensions/adapt-contrib-spoor/js/scorm/wrapper",["libraries/SCORM_API_wrapper"],function(pipwerks){var ScormWrapper=function ScormWrapper(){this.setCompletedWhenFailed=true;this.commitOnStatusChange=true;this.timedCommitFrequency=10;this.maxCommitRetries=5;this.commitRetryDelay=1000;this.commitRetryPending=false;this.commitRetries=0;this.lastCommitSuccessTime=null;this.exitStateIfIncomplete="auto";this.exitStateIfComplete="auto";this.timedCommitIntervalID=null;this.retryCommitTimeoutID=null;this.logOutputWin=null;this.startTime=null;this.endTime=null;this.lmsConnected=false;this.finishCalled=false;this.logger=Logger.getInstance();this.scorm=pipwerks.SCORM;this.scorm.handleExitMode=false;this.suppressErrors=false;if(window.__debug)this.showDebugWindow();if(window.API&&window.API.__offlineAPIWrapper||window.API_1484_11&&window.API_1484_11.__offlineAPIWrapper)this.logger.error("Offline SCORM API is being used. No data will be reported to the LMS!")};ScormWrapper.instance=null;ScormWrapper.getInstance=function(){if(ScormWrapper.instance===null)ScormWrapper.instance=new ScormWrapper;return ScormWrapper.instance};ScormWrapper.prototype.getVersion=function(){return this.scorm.version};ScormWrapper.prototype.setVersion=function(value){this.logger.debug("ScormWrapper::setVersion: "+value);this.scorm.version=value};ScormWrapper.prototype.initialize=function(){this.logger.debug("ScormWrapper::initialize");this.lmsConnected=this.scorm.init();if(this.lmsConnected){this.startTime=new Date;this.initTimedCommit()}else{this.handleError("Course could not connect to the LMS")}return this.lmsConnected};ScormWrapper.prototype.isFirstSession=function(){return this.getValue(this.isSCORM2004()?"cmi.entry":"cmi.core.entry")==="ab-initio"};ScormWrapper.prototype.setIncomplete=function(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","incomplete");if(this.commitOnStatusChange)this.commit()};ScormWrapper.prototype.setCompleted=function(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","completed");if(this.commitOnStatusChange)this.commit()};ScormWrapper.prototype.setPassed=function(){if(this.isSCORM2004()){this.setValue("cmi.completion_status","completed");this.setValue("cmi.success_status","passed")}else{this.setValue("cmi.core.lesson_status","passed")}if(this.commitOnStatusChange)this.commit()};ScormWrapper.prototype.setFailed=function(){if(this.isSCORM2004()){this.setValue("cmi.success_status","failed");if(this.setCompletedWhenFailed){this.setValue("cmi.completion_status","completed")}}else{this.setValue("cmi.core.lesson_status","failed")}if(this.commitOnStatusChange)this.commit()};ScormWrapper.prototype.getStatus=function(){var status=this.getValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status");switch(status.toLowerCase()){case"passed":case"completed":case"incomplete":case"failed":case"browsed":case"not attempted":case"not_attempted":case"unknown":return status;default:this.handleError("ScormWrapper::getStatus: invalid lesson status '"+status+"' received from LMS");return null;}};ScormWrapper.prototype.setStatus=function(status){switch(status.toLowerCase()){case"incomplete":this.setIncomplete();break;case"completed":this.setCompleted();break;case"passed":this.setPassed();break;case"failed":this.setFailed();break;default:this.handleError("ScormWrapper::setStatus: the status '"+status+"' is not supported.");}};ScormWrapper.prototype.getScore=function(){return this.getValue(this.isSCORM2004()?"cmi.score.raw":"cmi.core.score.raw")};ScormWrapper.prototype.setScore=function(_score,_minScore,_maxScore){if(this.isSCORM2004()){this.setValue("cmi.score.raw",_score);this.setValue("cmi.score.min",_minScore);this.setValue("cmi.score.max",_maxScore);var range=_maxScore-_minScore;var scaledScore=((_score-_minScore)/range).toFixed(7);this.setValue("cmi.score.scaled",scaledScore)}else{this.setValue("cmi.core.score.raw",_score);if(this.isSupported("cmi.core.score.min"))this.setValue("cmi.core.score.min",_minScore);if(this.isSupported("cmi.core.score.max"))this.setValue("cmi.core.score.max",_maxScore)}};ScormWrapper.prototype.getLessonLocation=function(){return this.getValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location")};ScormWrapper.prototype.setLessonLocation=function(_location){this.setValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location",_location)};ScormWrapper.prototype.getSuspendData=function(){return this.getValue("cmi.suspend_data")};ScormWrapper.prototype.setSuspendData=function(_data){this.setValue("cmi.suspend_data",_data)};ScormWrapper.prototype.getStudentName=function(){return this.getValue(this.isSCORM2004()?"cmi.learner_name":"cmi.core.student_name")};ScormWrapper.prototype.getStudentId=function(){return this.getValue(this.isSCORM2004()?"cmi.learner_id":"cmi.core.student_id")};ScormWrapper.prototype.setLanguage=function(_lang){if(this.isSCORM2004()){this.setValue("cmi.learner_preference.language",_lang)}else{if(this.isSupported("cmi.student_preference.language")){this.setValue("cmi.student_preference.language",_lang)}}};ScormWrapper.prototype.commit=function(){this.logger.debug("ScormWrapper::commit");if(this.lmsConnected){if(this.commitRetryPending){this.logger.debug("ScormWrapper::commit: skipping this commit call as one is already pending.")}else{if(this.scorm.save()){this.commitRetries=0;this.lastCommitSuccessTime=new Date}else{if(this.commitRetries<this.maxCommitRetries&&!this.finishCalled){this.commitRetries++;this.initRetryCommit()}else{var _errorCode=this.scorm.debug.getCode();var _errorMsg="Course could not commit data to the LMS";_errorMsg+="\nError "+_errorCode+": "+this.scorm.debug.getInfo(_errorCode);_errorMsg+="\nLMS Error Info: "+this.scorm.debug.getDiagnosticInfo(_errorCode);this.handleError(_errorMsg)}}}}else{this.handleError("Course is not connected to the LMS")}};ScormWrapper.prototype.finish=function(){this.logger.debug("ScormWrapper::finish");if(this.lmsConnected&&!this.finishCalled){this.finishCalled=true;if(this.timedCommitIntervalID!==null){window.clearInterval(this.timedCommitIntervalID)}if(this.commitRetryPending){window.clearTimeout(this.retryCommitTimeoutID);this.commitRetryPending=false}if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.endTime=new Date;if(this.isSCORM2004()){this.scorm.set("cmi.session_time",this.convertToSCORM2004Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.exit",this.getExitState())}else{this.scorm.set("cmi.core.session_time",this.convertToSCORM12Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.core.exit",this.getExitState())}this.lmsConnected=false;if(!this.scorm.quit()){this.handleError("Course could not finish")}}else{this.handleError("Course is not connected to the LMS")}};ScormWrapper.prototype.recordInteraction=function(id,response,correct,latency,type){if(this.isSupported("cmi.interactions._count")){switch(type){case"choice":this.recordInteractionMultipleChoice.apply(this,arguments);break;case"matching":this.recordInteractionMatching.apply(this,arguments);break;case"numeric":this.isSCORM2004()?this.recordInteractionScorm2004.apply(this,arguments):this.recordInteractionScorm12.apply(this,arguments);break;case"fill-in":this.recordInteractionFillIn.apply(this,arguments);break;default:console.error("ScormWrapper.recordInteraction: unknown interaction type of '"+type+"' encountered...");}}else{this.logger.info("ScormWrapper::recordInteraction: cmi.interactions are not supported by this LMS...")}};ScormWrapper.prototype.getValue=function(_property){this.logger.debug("ScormWrapper::getValue: _property="+_property);if(this.finishCalled){this.logger.debug("ScormWrapper::getValue: ignoring request as 'finish' has been called");return}if(this.lmsConnected){var _value=this.scorm.get(_property);var _errorCode=this.scorm.debug.getCode();var _errorMsg="";if(_errorCode!==0){if(_errorCode===403){this.logger.warn("ScormWrapper::getValue: data model element not initialized")}else{_errorMsg+="Course could not get "+_property;_errorMsg+="\nError Info: "+this.scorm.debug.getInfo(_errorCode);_errorMsg+="\nLMS Error Info: "+this.scorm.debug.getDiagnosticInfo(_errorCode);this.handleError(_errorMsg)}}this.logger.debug("ScormWrapper::getValue: returning "+_value);return _value+""}else{this.handleError("Course is not connected to the LMS")}};ScormWrapper.prototype.setValue=function(_property,_value){this.logger.debug("ScormWrapper::setValue: _property="+_property+" _value="+_value);if(this.finishCalled){this.logger.debug("ScormWrapper::setValue: ignoring request as 'finish' has been called");return}if(this.lmsConnected){var _success=this.scorm.set(_property,_value);var _errorCode=this.scorm.debug.getCode();var _errorMsg="";if(!_success){if(_errorCode!==0){_errorMsg+="Course could not set "+_property+" to "+_value;_errorMsg+="\nError Info: "+this.scorm.debug.getInfo(_errorCode);_errorMsg+="\nLMS Error Info: "+this.scorm.debug.getDiagnosticInfo(_errorCode);this.handleError(_errorMsg)}else{this.logger.warn("ScormWrapper::setValue: LMS reported that the 'set' call failed but then said there was no error!")}}return _success}else{this.handleError("Course is not connected to the LMS")}};ScormWrapper.prototype.isSupported=function(_property){this.logger.debug("ScormWrapper::isSupported: _property="+_property);if(this.finishCalled){this.logger.debug("ScormWrapper::isSupported: ignoring request as 'finish' has been called");return}if(this.lmsConnected){var _value=this.scorm.get(_property);var _errorCode=this.scorm.debug.getCode();return _errorCode===401?false:true}else{this.handleError("Course is not connected to the LMS");return false}};ScormWrapper.prototype.initTimedCommit=function(){this.logger.debug("ScormWrapper::initTimedCommit");if(this.timedCommitFrequency>0){var delay=this.timedCommitFrequency*(60*1000);this.timedCommitIntervalID=window.setInterval(this.commit.bind(this),delay)}};ScormWrapper.prototype.initRetryCommit=function(){this.logger.debug("ScormWrapper::initRetryCommit "+this.commitRetries+" out of "+this.maxCommitRetries);this.commitRetryPending=true;this.retryCommitTimeoutID=window.setTimeout(this.doRetryCommit.bind(this),this.commitRetryDelay)};ScormWrapper.prototype.doRetryCommit=function(){this.logger.debug("ScormWrapper::doRetryCommit");this.commitRetryPending=false;this.commit()};ScormWrapper.prototype.handleError=function(_msg){this.logger.error(_msg);if(!this.suppressErrors&&(!this.logOutputWin||this.logOutputWin.closed)&&confirm("An error has occured:\n\n"+_msg+"\n\nPress 'OK' to view debug information to send to technical support."))this.showDebugWindow()};ScormWrapper.prototype.getInteractionCount=function(){var count=this.getValue("cmi.interactions._count");return count===""?0:count};ScormWrapper.prototype.recordInteractionScorm12=function(id,response,correct,latency,type){id=this.trim(id);var cmiPrefix="cmi.interactions."+this.getInteractionCount();this.setValue(cmiPrefix+".id",id);this.setValue(cmiPrefix+".type",type);this.setValue(cmiPrefix+".student_response",response);this.setValue(cmiPrefix+".result",correct?"correct":"wrong");if(latency!==null&&latency!==undefined)this.setValue(cmiPrefix+".latency",this.convertToSCORM12Time(latency));this.setValue(cmiPrefix+".time",this.getCMITime())};ScormWrapper.prototype.recordInteractionScorm2004=function(id,response,correct,latency,type){id=this.trim(id);var cmiPrefix="cmi.interactions."+this.getInteractionCount();this.setValue(cmiPrefix+".id",id);this.setValue(cmiPrefix+".type",type);this.setValue(cmiPrefix+".learner_response",response);this.setValue(cmiPrefix+".result",correct?"correct":"incorrect");if(latency!==null&&latency!==undefined)this.setValue(cmiPrefix+".latency",this.convertToSCORM2004Time(latency));this.setValue(cmiPrefix+".timestamp",this.getISO8601Timestamp())};ScormWrapper.prototype.recordInteractionMultipleChoice=function(id,response,correct,latency,type){if(this.isSCORM2004()){response=response.replace(/,|#/g,"[,]")}else{response=response.replace(/#/g,",");response=this.checkResponse(response,"choice")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)};ScormWrapper.prototype.recordInteractionMatching=function(id,response,correct,latency,type){response=response.replace(/#/g,",");if(this.isSCORM2004()){response=response.replace(/,/g,"[,]");response=response.replace(/\./g,"[.]")}else{response=this.checkResponse(response,"matching")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)};ScormWrapper.prototype.recordInteractionFillIn=function(id,response,correct,latency,type){var maxLength=this.isSCORM2004()?250:255;if(response.length>maxLength){response=response.substr(0,maxLength);this.logger.warn("ScormWrapper::recordInteractionFillIn: response data for "+id+" is longer than the maximum allowed length of "+maxLength+" characters; data will be truncated to avoid an error.")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)};ScormWrapper.prototype.showDebugWindow=function(){if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.logOutputWin=window.open("log_output.html","Log","width=600,height=300,status=no,scrollbars=yes,resizable=yes,menubar=yes,toolbar=yes,location=yes,top=0,left=0");if(this.logOutputWin)this.logOutputWin.focus();return};ScormWrapper.prototype.convertToSCORM12Time=function(msConvert){var msPerSec=1000;var msPerMin=msPerSec*60;var msPerHour=msPerMin*60;var ms=msConvert%msPerSec;msConvert=msConvert-ms;var secs=msConvert%msPerMin;msConvert=msConvert-secs;secs=secs/msPerSec;var mins=msConvert%msPerHour;msConvert=msConvert-mins;mins=mins/msPerMin;var hrs=msConvert/msPerHour;if(hrs>9999){return"9999:99:99.99"}else{var str=[this.padWithZeroes(hrs,4),this.padWithZeroes(mins,2),this.padWithZeroes(secs,2)].join(":");return str+"."+Math.floor(ms/10)}};ScormWrapper.prototype.convertToSCORM2004Time=function(msConvert){var csConvert=Math.floor(msConvert/10);var csPerSec=100;var csPerMin=csPerSec*60;var csPerHour=csPerMin*60;var csPerDay=csPerHour*24;var days=Math.floor(csConvert/csPerDay);csConvert-=days*csPerDay;days=days?days+"D":"";var hours=Math.floor(csConvert/csPerHour);csConvert-=hours*csPerHour;hours=hours?hours+"H":"";var mins=Math.floor(csConvert/csPerMin);csConvert-=mins*csPerMin;mins=mins?mins+"M":"";var secs=Math.floor(csConvert/csPerSec);csConvert-=secs*csPerSec;secs=secs?secs:"0";var cs=csConvert;cs=cs?"."+cs:"";var seconds=secs+cs+"S";var hms=[hours,mins,seconds].join("");return"P"+days+"T"+hms};ScormWrapper.prototype.getCMITime=function(){var date=new Date;var hours=this.padWithZeroes(date.getHours(),2);var min=this.padWithZeroes(date.getMinutes(),2);var sec=this.padWithZeroes(date.getSeconds(),2);return[hours,min,sec].join(":")};ScormWrapper.prototype.getISO8601Timestamp=function(){var date=new Date().toISOString();return date.replace(/.\d\d\dZ/,"")};ScormWrapper.prototype.padWithZeroes=function(numToPad,padBy){var len=padBy;while(--len){numToPad="0"+numToPad}return numToPad.slice(-padBy)};ScormWrapper.prototype.trim=function(str){return str.replace(/^\s*|\s*$/g,"")};ScormWrapper.prototype.isSCORM2004=function(){return this.scorm.version==="2004"};ScormWrapper.prototype.checkResponse=function(response,responseType){if(!response)return response;if(responseType!="choice"&&responseType!="matching")return response;response=response.split(/,|#/);var self=this;if(responseType=="choice"){response=response.map(checkIdentifier)}else{response=response.map(function(r){var identifiers=r.split(".");return checkIdentifier(identifiers[0])+"."+checkIdentifier(identifiers[1])})}function checkIdentifier(r){var i;if(r.length==1&&r>="0"&&r<="9")return r;if(r.length==1&&r>="a"&&r<="z")return r;i=parseInt(r);if(isNaN(i)||i<10||i>35){self.handleError("Numeric choice/matching response elements must use a value from 0 to 35 in SCORM 1.2")}return Number(i).toString(36)}return response.join(",")};ScormWrapper.prototype.getExitState=function(){var completionStatus=this.scorm.data.completionStatus;var isIncomplete=completionStatus==="incomplete"||completionStatus==="not attempted";var exitState=isIncomplete?this.exitStateIfIncomplete:this.exitStateIfComplete;if(exitState!=="auto")return exitState;if(this.isSCORM2004())return isIncomplete?"suspend":"normal";return""};return ScormWrapper});Logger=function Logger(){this.logArr=[];this.registeredViews=[]};Logger.instance=null;Logger.LOG_TYPE_INFO=0;Logger.LOG_TYPE_WARN=1;Logger.LOG_TYPE_ERROR=2;Logger.LOG_TYPE_DEBUG=3;Logger.getInstance=function(){if(Logger.instance==null)Logger.instance=new Logger;return Logger.instance};Logger.prototype.getEntries=function(){return this.logArr};Logger.prototype.getLastEntry=function(){return this.logArr[this.logArr.length-1]};Logger.prototype.info=function(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_INFO,time:Date.now()};this.updateViews()};Logger.prototype.warn=function(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_WARN,time:Date.now()};this.updateViews()};Logger.prototype.error=function(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_ERROR,time:Date.now()};this.updateViews()};Logger.prototype.debug=function(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_DEBUG,time:Date.now()};this.updateViews()};Logger.prototype.registerView=function(_view){this.registeredViews[this.registeredViews.length]=_view};Logger.prototype.unregisterView=function(_view){for(var i=0;i<this.registeredViews.length;i++){if(this.registeredViews[i]==_view){this.registeredViews.splice(i,1);i--}}};Logger.prototype.updateViews=function(){for(var i=0;i<this.registeredViews.length;i++){if(this.registeredViews[i])this.registeredViews[i].update(this)}};define("extensions/adapt-contrib-spoor/js/scorm/logger",function(){});define("extensions/adapt-contrib-spoor/js/scorm",["libraries/SCORM_API_wrapper","./scorm/wrapper","./scorm/logger"],function(API,wrapper,logger){return wrapper.getInstance()});define("extensions/adapt-contrib-spoor/js/serializers/default",["core/js/adapt"],function(Adapt){var serializer={serialize:function serialize(){return this.serializeSaveState("_isComplete")},serializeSaveState:function serializeSaveState(attribute){if(Adapt.course.get("_latestTrackingId")===undefined){var message="This course is missing a latestTrackingID.\n\nPlease run the grunt process prior to deploying this module on LMS.\n\nScorm tracking will not work correctly until this is done.";console.error(message)}var excludeAssessments=Adapt.config.get("_spoor")&&Adapt.config.get("_spoor")._tracking&&Adapt.config.get("_spoor")._tracking._excludeAssessments;var data=[];var length=Adapt.course.get("_latestTrackingId")+1;for(var i=0;i<length;i++){data[i]="-"}_.each(Adapt.blocks.models,function(model,index){var _trackingId=model.get("_trackingId"),isPartOfAssessment=model.getParent().get("_assessment"),state=model.get(attribute)?1:0;if(excludeAssessments&&isPartOfAssessment){state=0}if(_trackingId===undefined){var message="Block '"+model.get("_id")+"' doesn't have a tracking ID assigned.\n\nPlease run the grunt process prior to deploying this module on LMS.\n\nScorm tracking will not work correctly until this is done.";console.error(message)}else{data[_trackingId]=state}},this);return data.join("")},deserialize:function deserialize(completion,callback){var syncIterations=1;var i=0,arr=this.deserializeSaveState(completion),len=arr.length;function step(){var state;for(var j=0,count=Math.min(syncIterations,len-i);j<count;i++,j++){state=arr[i];if(state===1){markBlockAsComplete(Adapt.blocks.findWhere({_trackingId:i}))}}i==len?callback():setTimeout(step)}function markBlockAsComplete(block){if(!block){return}block.getChildren().each(function(child){child.set("_isComplete",true)})}step()},deserializeSaveState:function deserializeSaveState(string){var completionArray=string.split("");for(var i=0;i<completionArray.length;i++){if(completionArray[i]==="-"){completionArray[i]=-1}else{completionArray[i]=parseInt(completionArray[i],10)}}return completionArray}};return serializer});(function(_){function toPrecision(number,precision){if(precision===undefined)precision=2;var multiplier=1*Math.pow(10,precision);return Math.round(number*multiplier)/multiplier}function BinaryToNumber(bin,length){return parseInt(bin.substr(0,length),2)}function NumberToBinary(number,length){return Padding.fillLeft(number.toString(2),length)}var Padding={addLeft:function PaddingAddLeft(str,x,char){char=char||"0";return new Array(x+1).join(char)+str},addRight:function PaddingAddRight(str,x,char){char=char||"0";return str+new Array(x+1).join(char)},fillLeft:function PaddingFillLeft(str,x,char){if(str.length<x){var paddingLength=x-str.length;return Padding.addLeft(str,paddingLength,char)}return str},fillRight:function PaddingFillLeft(str,x,char){if(str.length<x){var paddingLength=x-str.length;return Padding.addRight(str,paddingLength,char)}return str},fillBlockLeft:function PaddingFillBlockRight(str,x,char){if(str.length%x){var paddingLength=x-str.length%x;return Padding.addLeft(str,paddingLength,char)}return str},fillBlockRight:function PaddingFillBlockRight(str,x,char){if(str.length%x){var paddingLength=x-str.length%x;return Padding.addRight(str,paddingLength,char)}return str}};function Base64(){switch(arguments.length){case 1:var firstArgumentType=_typeof(arguments[0]);switch(firstArgumentType){case"number":return Base64._indexes[arguments[0]];case"string":return Base64._chars[arguments[0]];default:throw"Invalid arguments type";}case 2:var char=arguments[0];var index=arguments[1];Base64._chars[char]=index;Base64._indexes[index]=char;return;default:throw"Invalid number of arguments";}}Base64._chars={};Base64._indexes={};(function(){var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-/";for(var i=0,l=alphabet.length;i<l;i++){Base64(alphabet[i],i)}})();function DataType(){switch(arguments.length){case 1:switch(_typeof(arguments[0])){case"object":var item=arguments[0];if(DataType._types[item.type]===undefined)DataType._types[item.type]=[];DataType._types[item.type].push(item);item.index=DataType._indexes.length;DataType._indexes.push(item);DataType[item.name]=item;return;case"string":return DataType.getName(arguments[0]);case"number":return DataType.getIndex(arguments[0]);default:throw"Argument type not allowed";}default:throw"Too many arguments";}}DataType.VARIABLELENGTHDESCRIPTORSIZE=8;DataType._types={};DataType._indexes=[];DataType.getName=function DataTypeGetName(name){if(DataType[name])return DataType[name];throw"Type name not found '"+name+"'"};DataType.getIndex=function DataTypeGetIndex(index){if(DataType._indexes[index])return DataType._indexes[index];throw"Type index not found '"+index+"'"};DataType.getTypes=function DataTypeGetTypes(type){if(DataType._types[type])return DataType._types[type];throw"Type not found '"+type+"'"};DataType.checkBounds=function DataTypeCheckBounds(name,number){var typeDef=DataType(name);if(number>typeDef.max)throw name+" value is larger than "+typeDef.max;if(number<typeDef.min)throw name+" value is smaller than "+typeDef.min};DataType.getNumberType=function DataTypeGetNumberType(number){var isDecimal=number-Math.floor(number)!==0;var numberDataTypes=DataType.getTypes("number");for(var t=0,type;type=numberDataTypes[t++];){if(number<=type.max&&number>=type.min&&(!isDecimal||isDecimal==type.decimal)){return type}}};DataType.getVariableType=function DataTypeGetVariableType(variable){var variableNativeType=variable instanceof Array?"array":_typeof(variable);var variableDataType;switch(variableNativeType){case"number":variableDataType=DataType.getNumberType(variable);break;case"string":variableDataType=DataType.getName("string");break;default:var supportedItemDataTypes=DataType.getTypes(variableNativeType);switch(supportedItemDataTypes.length){case 1:variableDataType=supportedItemDataTypes[0];break;default:throw"Type not found '"+variableNativeType+"'";}}if(!variableDataType)throw"Cannot assess type '"+variableNativeType+"'";return variableDataType};DataType.getArrayType=function getArrayType(arr){var foundItemTypes=[];for(var i=0,l=arr.length;i<l;i++){var item=arr[i];var itemDataType=DataType.getVariableType(item);if(_.findWhere(foundItemTypes,{name:itemDataType.name}))continue;foundItemTypes.push(itemDataType)}switch(foundItemTypes.length){case 0:throw"Cannot determine array data types";case 1:return foundItemTypes[0];default:var nativeTypeNames=_.pluck(foundItemTypes,"type");var uniqueNativeTypeNames=_.uniq(nativeTypeNames);var hasManyNativeTypes=uniqueNativeTypeNames.length>1;if(hasManyNativeTypes)return DataType("variable");switch(uniqueNativeTypeNames[0]){case"number":var foundDecimal=_.findWhere(foundItemTypes,{decimal:true});if(foundDecimal)return foundDecimal;return _.max(foundItemTypes,function(type){return type.max});}throw"Unsupported data types";}};(function(){var types=[{"size":"fixed","length":1,"name":"boolean","type":"boolean"},{"max":15,"min":0,"decimal":false,"size":"fixed","length":4,"name":"half","type":"number"},{"max":255,"min":0,"decimal":false,"size":"fixed","length":8,"name":"byte","type":"number"},{"max":65535,"min":0,"decimal":false,"size":"fixed","length":16,"name":"short","type":"number"},{"max":4294967295,"min":0,"decimal":false,"size":"fixed","length":32,"name":"long","type":"number"},{"max":4294967295,"min":-4294967295,"decimal":true,"precision":2,"size":"variable","name":"double","type":"number"},{"name":"base16","size":"variable","type":"string"},{"name":"base64","size":"variable","type":"string"},{"name":"array","size":"variable","type":"array"},{"name":"variable","size":"variable","type":"variable"},{"name":"string","size":"variable","type":"string"}];for(var i=0,type;type=types[i++];){DataType(type)}})();function Converter(fromType,toType){fromType=Converter.translateTypeAlias(fromType);toType=Converter.translateTypeAlias(toType);var args=[].slice.call(arguments,2);if(fromType!="binary"&&toType!="binary"){if(!Converter._converters[fromType])throw"Type not found '"+fromType+"'";if(!Converter._converters[fromType]["binary"])throw"Type not found 'binary'";var bin=Converter._converters[fromType]["binary"].call(this,args[0],Converter.WRAPOUTPUT);if(!Converter._converters["binary"][toType])throw"Type not found '"+toType+"'";return Converter._converters["binary"][toType].call(this,bin,Converter.WRAPOUTPUT)}if(!Converter._converters[fromType])throw"Type not found '"+fromType+"'";if(!Converter._converters[fromType][toType])throw"Type not found '"+toType+"'";return Converter._converters[fromType][toType].call(this,args[0],Converter.WRAPOUTPUT)}Converter.WRAPOUTPUT=false;Converter.translateTypeAlias=function ConverterTranslateTypeAlias(type){type=type.toLowerCase();for(var Type in Converter._typeAliases){if(Type==type||(" "+Converter._typeAliases[Type].join(" ")+" ").indexOf(" "+type+" ")>=0)return Type}throw"Type not found '"+type+"'"};Converter._typeAliases={"base64":["b64"],"base16":["hex","b16"],"double":["dbl","decimal","d"],"long":["lng","l"],"short":["s"],"byte":["b"],"half":["h"],"number":["num","n"],"binary":["bin"],"boolean":["bool"],"array":["arr"]};Converter._variableWrapLength=function ConverterVariableWrapLength(bin){var variableLength=bin.length;var binLength=NumberToBinary(variableLength,DataType.VARIABLELENGTHDESCRIPTORSIZE);return binLength+bin};Converter._variableLength=function ConverterVariableLength(bin){var VLDS=DataType.VARIABLELENGTHDESCRIPTORSIZE;var variableLength=BinaryToNumber(bin,VLDS);return variableLength};Converter._variableUnwrapLength=function ConverterVariableUnwrapLength(bin){var VLDS=DataType.VARIABLELENGTHDESCRIPTORSIZE;var variableLength=BinaryToNumber(bin,VLDS);return bin.substr(VLDS,variableLength)};Converter._converters={"base64":{"binary":function ConverterBase64ToBinary(base64){var firstByte=Base64(base64.substr(0,1));var binFirstByte=NumberToBinary(firstByte,6);var paddingLength=BinaryToNumber(binFirstByte,6);var bin="";for(var i=0,ch;ch=base64[i++];){var block=Base64(ch).toString(2);block=Padding.fillLeft(block,6);bin+=block}bin=bin.substr(6+paddingLength);return bin}},"base16":{"binary":function ConverterBase16ToBinary(hex){var firstByte=Base64(base64.substr(0,1));var binFirstByte=NumberToBinary(firstByte,4);var paddingLength=BinaryToNumber(binFirstByte,4);var bin="";for(var i=0,ch;ch=hex[i++];){var block=parseInt(ch,16).toString(2);block=Padding.fillLeft(block,4);bin+=block}bin=bin.substr(6+paddingLength);return bin}},"double":{"binary":function ConverterDoubleToBinary(dbl,wrap){var typeDef=DataType("double");DataType.checkBounds("double",dbl);dbl=toPrecision(dbl,typeDef.precision);var dblStr=dbl.toString(10);var isMinus=dbl<0;var baseStr,exponentStr,highStr,lowStr,decimalPosition,hasDecimal;var exponentPos=dblStr.indexOf("e");if(exponentPos>-1){baseStr=dblStr.substr(0,exponentPos);exponentStr=Math.abs(dblStr.substr(exponentPos+1));if(isMinus)baseStr=baseStr.substr(1);decimalPosition=baseStr.indexOf(".");hasDecimal=decimalPosition>-1;if(hasDecimal){highStr=baseStr.substr(0,decimalPosition);lowStr=baseStr.substr(decimalPosition+1);exponentStr=Math.abs(exponentStr)+lowStr.length;baseStr=highStr+lowStr}}else{baseStr=dblStr;exponentStr="0";if(isMinus)dblStr=dblStr.substr(1);decimalPosition=dblStr.indexOf(".");hasDecimal=decimalPosition>-1;if(hasDecimal){highStr=dblStr.substr(0,decimalPosition);lowStr=dblStr.substr(decimalPosition+1);exponentStr=lowStr.length;if(highStr=="0"){baseStr=parseInt(lowStr,10).toString(10)}else{baseStr=highStr+lowStr}}else{baseStr=dblStr}}var bin=[];var binLong=Padding.fillBlockLeft(parseInt(baseStr,10).toString(2),4);var binMinus=isMinus?"1":"0";var binExponent=Padding.fillLeft(parseInt(exponentStr,10).toString(2),7);bin.push(binMinus);bin.push(binExponent);bin.push(binLong);if(wrap===false){return bin.join("")}else{return Converter._variableWrapLength(bin.join(""))}}},"long":{"binary":function ConverterLongToBinary(value){var typeDef=DataType("long");DataType.checkBounds("long",value);value=toPrecision(value,0);return Padding.fillLeft(value.toString(2),typeDef.length)}},"short":{"binary":function ConverterShortToBinary(value){var typeDef=DataType("short");DataType.checkBounds("short",value);value=toPrecision(value,0);return Padding.fillLeft(value.toString(2),typeDef.length)}},"byte":{"binary":function ConverterByteToBinary(value){var typeDef=DataType("byte");DataType.checkBounds("byte",value);value=toPrecision(value,0);return Padding.fillLeft(value.toString(2),typeDef.length)}},"half":{"binary":function ConverterHalfToBinary(value){var typeDef=DataType("half");DataType.checkBounds("half",value);value=toPrecision(value,0);return Padding.fillLeft(value.toString(2),typeDef.length)}},"boolean":{"binary":function ConverterBooleanToBinary(bool){return bool?"1":"0"}},"array":{"binary":function ConverterArrayToBinary(arr,wrap){var typeDef=DataType("array");var arrayItemType=DataType.getArrayType(arr);var isVariableArray=arrayItemType.name=="vairable";if(isVariableArray){var bin=half2bin(15);return bin}else{var binArrayIdentifier=Converter._converters["half"]["binary"](arrayItemType.index);var binItemsArray=[];for(var i=0,l=arr.length;i<l;i++){var item=arr[i];var binItem=Converter._converters[arrayItemType.name]["binary"](item);binItemsArray.push(binItem)}var binItems=binItemsArray.join("");var paddingLength=0;if(binItems.length%4)paddingLength=4-binItems.length%4;var binPaddingLen=NumberToBinary(paddingLength,2);var binPadding=new Array(paddingLength+1).join("0");var bin=[];bin.push(binArrayIdentifier);bin.push(binPaddingLen);bin.push(binPadding);bin.push(binItems);var finished=bin.join("");if(wrap===false)return finished;var wrapped=Converter._variableWrapLength(finished);return wrapped}}},"binary":{"array":function ConverterBinaryToArray(bin,wrap){var typeDef=DataType("array");if(wrap!==false)bin=Converter._variableUnwrapLength(bin);var binArrayIdentifier=bin.substr(0,4);var binPaddingLen=bin.substr(4,2);var arrayIdentifier=Converter._converters["binary"]["half"](binArrayIdentifier);var paddingLength=BinaryToNumber(binPaddingLen,2);var dataStart=4+2+paddingLength;var dataLength=bin.length-dataStart;var binItems=bin.substr(dataStart,dataLength);var arrayItemType=DataType(arrayIdentifier);var isVariableArray=arrayItemType.name=="variable";var rtn=[];if(isVariableArray){}else{var hasVariableLengthChildren=arrayItemType.size=="variable";if(hasVariableLengthChildren){var VLDS=DataType.VARIABLELENGTHDESCRIPTORSIZE;while(binItems!=""){var variableLength=Converter._variableLength(binItems);var binItem=binItems.substr(0,VLDS+variableLength);binItems=binItems.substr(VLDS+variableLength);rtn.push(Converter._converters["binary"][arrayItemType.name](binItem))}}else{while(binItems!=""){var binItem=binItems.substr(0,arrayItemType.length);binItems=binItems.substr(arrayItemType.length);rtn.push(Converter._converters["binary"][arrayItemType.name](binItem))}}}return rtn},"base64":function ConverterBinaryToBase64(bin){var paddingLength=0;if(bin.length%6)paddingLength=6-bin.length%6;binPaddingLen=NumberToBinary(paddingLength,6);binPadding=Padding.addLeft("",paddingLength);bin=binPaddingLen+binPadding+bin;var binLength=bin.length;var base64="";for(var b=0;b<10000;b++){if(b*6>=binLength)break;var block=bin.substr(b*6,6);base64+=Base64(parseInt(block,2))}return base64},"base16":function ConverterBinaryToBase16(bin){var paddingLength=0;if(bin.length%4)paddingLength=4-bin.length%4;binPaddingLen=NumberToBinary(paddingLength,4);binPadding=Padding.addLeft("",paddingLength);bin=binPaddingLen+binPadding+bin;var binLength=bin.length;var hex="";for(var b=0;b<10000;b++){if(b*4>=binLength)break;var block=bin.substr(b*4,4);hex+=parseInt(block,2).toString(16)}return hex},"double":function ConverterBinaryToDouble(bin,wrap){var typeDef=DataType("double");if(wrap!==false)bin=Converter._variableUnwrapLength(bin);var isMinus=bin.substr(0,1)==1;var exponentByte=parseInt("0"+bin.substr(1,7),2);var baseLong=parseInt(bin.substr(8,bin.length),2);var dbl=parseFloat(baseLong+"E-"+exponentByte,10);if(isMinus)dbl=dbl*-1;return dbl},"long":function ConverterBinaryToLong(bin){return parseInt(bin.substr(0,32),2)},"short":function ConverterBinaryToShort(bin){return parseInt(bin.substr(0,16),2)},"byte":function ConverterBinaryToByte(bin){return parseInt(bin.substr(0,8),2)},"half":function ConverterBinaryToHalf(bin){return parseInt(bin.substr(0,4),2)},"boolean":function ConverterBinaryToBoolean(bin){return bin.substr(0,1)=="1"?true:false},"number":function ConverterBinaryToNumber(bin){return parseInt(bin,2)}}};window.SCORMSuspendData={serialize:function SCORMSuspendDataSerialize(arr){return Converter("array","base64",arr)},deserialize:function SCORMSuspendDataDeserialize(base64){return Converter("base64","array",base64)},Base64:Base64,Converter:Converter,DataType:DataType}})(_);define("extensions/adapt-contrib-spoor/js/serializers/scormSuspendDataSerializer",function(){});define("extensions/adapt-contrib-spoor/js/serializers/questions",["core/js/adapt","./scormSuspendDataSerializer"],function(Adapt){var includes={"_isQuestionType":true,"_isResetOnRevisit":false};var serializer={serialize:function serialize(){return this.serializeSaveState()},serializeSaveState:function serializeSaveState(){if(Adapt.course.get("_latestTrackingId")===undefined){var message="This course is missing a latestTrackingID.\n\nPlease run the grunt process prior to deploying this module on LMS.\n\nScorm tracking will not work correctly until this is done.";console.error(message);return""}var rtn="";try{var data=this.captureData();if(data.length===0)return"";rtn=SCORMSuspendData.serialize(data)}catch(e){console.error(e)}return rtn},captureData:function captureData(){var data=[];var trackingIds=Adapt.blocks.pluck("_trackingId");var blocks={};var countInBlock={};for(var i=0,l=trackingIds.length;i<l;i++){var trackingId=trackingIds[i];var blockModel=Adapt.blocks.findWhere({_trackingId:trackingId});var componentModels=blockModel.getChildren().where(includes);for(var c=0,cl=componentModels.length;c<cl;c++){var component=componentModels[c].toJSON();var blockId=component._parentId;if(!blocks[blockId]){blocks[blockId]=blockModel.toJSON()}var block=blocks[blockId];if(countInBlock[blockId]===undefined)countInBlock[blockId]=-1;countInBlock[blockId]++;var blockLocation=countInBlock[blockId];if(component["_isInteractionComplete"]===false||component["_isComplete"]===false){continue}var hasUserAnswer=component["_userAnswer"]!==undefined;var isUserAnswerArray=component["_userAnswer"]instanceof Array;if(hasUserAnswer&&isUserAnswerArray&&component["_userAnswer"].length===0){hasUserAnswer=false;isUserAnswerArray=false}var numericParameters=[blockLocation,block["_trackingId"],component["_score"]||0,component["_attemptsLeft"]||0];var booleanParameters=[hasUserAnswer,isUserAnswerArray,component["_isInteractionComplete"],component["_isSubmitted"],component["_isCorrect"]||false];var dataItem=[numericParameters,booleanParameters];if(hasUserAnswer){var userAnswer=isUserAnswerArray?component["_userAnswer"]:[component["_userAnswer"]];var arrayType=SCORMSuspendData.DataType.getArrayType(userAnswer);switch(arrayType.name){case"string":case"variable":console.log("Cannot store _userAnswers from component "+component._id+" as array is of variable or string type.");continue;}dataItem.push(userAnswer)}data.push(dataItem)}}return data},deserialize:function deserialize(str){try{var data=SCORMSuspendData.deserialize(str);this.releaseData(data)}catch(e){console.error(e)}},releaseData:function releaseData(arr){for(var i=0,l=arr.length;i<l;i++){var dataItem=arr[i];var numericParameters=dataItem[0];var booleanParameters=dataItem[1];var blockLocation=numericParameters[0];var trackingId=numericParameters[1];var score=numericParameters[2];var attemptsLeft=numericParameters[3]||0;var hasUserAnswer=booleanParameters[0];var isUserAnswerArray=booleanParameters[1];var isInteractionComplete=booleanParameters[2];var isSubmitted=booleanParameters[3];var isCorrect=booleanParameters[4];var block=Adapt.blocks.findWhere({_trackingId:trackingId});var components=block.getChildren();components=components.where(includes);var component=components[blockLocation];component.set("_isComplete",true);component.set("_isInteractionComplete",isInteractionComplete);component.set("_isSubmitted",isSubmitted);component.set("_score",score);component.set("_isCorrect",isCorrect);component.set("_attemptsLeft",attemptsLeft);if(hasUserAnswer){var userAnswer=dataItem[2];if(!isUserAnswerArray)userAnswer=userAnswer[0];component.set("_userAnswer",userAnswer)}}}};return serializer});define("extensions/adapt-contrib-spoor/js/adapt-stateful-session",["core/js/adapt","./serializers/default","./serializers/questions","core/js/enums/completionStateEnum"],function(Adapt,serializer,questions,COMPLETION_STATE){var AdaptStatefulSession=_.extend({_config:null,_shouldStoreResponses:true,_shouldRecordInteractions:true,initialize:function initialize(callback){this._onWindowUnload=this.onWindowUnload.bind(this);this.getConfig();this.getLearnerInfo();this.restoreSessionState(function(){_.defer(this.setupEventListeners.bind(this));callback()}.bind(this))},getConfig:function getConfig(){this._config=Adapt.config.has("_spoor")?Adapt.config.get("_spoor"):false;this._shouldStoreResponses=this._config&&this._config._tracking&&this._config._tracking._shouldStoreResponses;if(this._config&&this._config._tracking&&this._config._tracking._shouldRecordInteractions===false){this._shouldRecordInteractions=false}},getLearnerInfo:function getLearnerInfo(){var globals=Adapt.course.get("_globals");if(!globals._learnerInfo){globals._learnerInfo={}}_.extend(globals._learnerInfo,Adapt.offlineStorage.get("learnerinfo"))},saveSessionState:function saveSessionState(){var sessionPairs=this.getSessionState();Adapt.offlineStorage.set(sessionPairs)},restoreSessionState:function restoreSessionState(callback){var sessionPairs=Adapt.offlineStorage.get();var hasNoPairs=_.keys(sessionPairs).length===0;var doSynchronousPart=function(){if(sessionPairs.questions&&this._shouldStoreResponses)questions.deserialize(sessionPairs.questions);if(sessionPairs._isCourseComplete)Adapt.course.set("_isComplete",sessionPairs._isCourseComplete);if(sessionPairs._isAssessmentPassed)Adapt.course.set("_isAssessmentPassed",sessionPairs._isAssessmentPassed);callback()}.bind(this);if(hasNoPairs)return callback();if(sessionPairs.completion){serializer.deserialize(sessionPairs.completion,doSynchronousPart)}else{doSynchronousPart()}},getSessionState:function getSessionState(){var sessionPairs={"completion":serializer.serialize(),"questions":this._shouldStoreResponses===true?questions.serialize():"","_isCourseComplete":Adapt.course.get("_isComplete")||false,"_isAssessmentPassed":Adapt.course.get("_isAssessmentPassed")||false};return sessionPairs},setupEventListeners:function setupEventListeners(){$(window).on("beforeunload unload",this._onWindowUnload);if(this._shouldStoreResponses){this.listenTo(Adapt.components,"change:_isInteractionComplete",this.onQuestionComponentComplete)}if(this._shouldRecordInteractions){this.listenTo(Adapt,"questionView:recordInteraction",this.onQuestionRecordInteraction)}this.listenTo(Adapt.blocks,"change:_isComplete",this.onBlockComplete);this.listenTo(Adapt,{"assessment:complete":this.onAssessmentComplete,"app:languageChanged":this.onLanguageChanged,"tracking:complete":this.onTrackingComplete})},removeEventListeners:function removeEventListeners(){$(window).off("beforeunload unload",this._onWindowUnload);this.stopListening()},reattachEventListeners:function reattachEventListeners(){this.removeEventListeners();this.setupEventListeners()},onBlockComplete:function onBlockComplete(block){this.saveSessionState()},onQuestionComponentComplete:function onQuestionComponentComplete(component){if(!component.get("_isQuestionType"))return;this.saveSessionState()},onTrackingComplete:function onTrackingComplete(completionData){this.saveSessionState();var completionStatus=completionData.status.asLowerCase;switch(completionData.status){case COMPLETION_STATE.COMPLETED:case COMPLETION_STATE.PASSED:{if(!this._config._reporting._onTrackingCriteriaMet){Adapt.log.warn("No value defined for '_onTrackingCriteriaMet', so defaulting to '"+completionStatus+"'")}else{completionStatus=this._config._reporting._onTrackingCriteriaMet}break}case COMPLETION_STATE.FAILED:{if(!this._config._reporting._onAssessmentFailure){Adapt.log.warn("No value defined for '_onAssessmentFailure', so defaulting to '"+completionStatus+"'")}else{completionStatus=this._config._reporting._onAssessmentFailure}}}Adapt.offlineStorage.set("status",completionStatus)},onAssessmentComplete:function onAssessmentComplete(stateModel){Adapt.course.set("_isAssessmentPassed",stateModel.isPass);this.saveSessionState();this.submitScore(stateModel)},onQuestionRecordInteraction:function onQuestionRecordInteraction(questionView){var responseType=questionView.getResponseType();if(_.isEmpty(responseType))return;var id=questionView.model.get("_id");var response=questionView.getResponse();var result=questionView.isCorrect();var latency=questionView.getLatency();Adapt.offlineStorage.set("interaction",id,response,result,latency,responseType)},onLanguageChanged:function onLanguageChanged(){this.reattachEventListeners();this.saveSessionState();if(this._config._reporting&&this._config._reporting._resetStatusOnLanguageChange===true){Adapt.offlineStorage.set("status","incomplete")}},submitScore:function submitScore(stateModel){if(this._config&&!this._config._tracking._shouldSubmitScore)return;if(stateModel.isPercentageBased){Adapt.offlineStorage.set("score",stateModel.scoreAsPercent,0,100)}else{Adapt.offlineStorage.set("score",stateModel.score,0,stateModel.maxScore)}},onWindowUnload:function onWindowUnload(){this.removeEventListeners()}},Backbone.Events);return AdaptStatefulSession});define("extensions/adapt-contrib-spoor/js/adapt-offlineStorage-scorm",["core/js/adapt","./scorm","core/js/offlineStorage"],function(Adapt,scorm){var temporaryStore={};var suspendDataStore={};var suspendDataRestored=false;Adapt.offlineStorage.initialize({get:function get(name){if(name===undefined){if(this.useTemporaryStore())return temporaryStore;suspendDataStore=this.getCustomStates();var data=_.extend(_.clone(suspendDataStore),{location:scorm.getLessonLocation(),score:scorm.getScore(),status:scorm.getStatus(),student:scorm.getStudentName(),learnerInfo:this.getLearnerInfo()});suspendDataRestored=true;return data}if(this.useTemporaryStore())return temporaryStore[name];switch(name.toLowerCase()){case"location":return scorm.getLessonLocation();case"score":return scorm.getScore();case"status":return scorm.getStatus();case"student":return scorm.getStudentName();case"learnerinfo":return this.getLearnerInfo();default:return this.getCustomState(name);}},set:function set(name,value){var args=[].slice.call(arguments,1);var isObject=_typeof(name)=="object";if(isObject){value=name;name="suspendData"}if(this.useTemporaryStore()){if(isObject){temporaryStore=_.extend(temporaryStore,value)}else{temporaryStore[name]=value}return true}switch(name.toLowerCase()){case"interaction":return scorm.recordInteraction.apply(scorm,args);case"location":return scorm.setLessonLocation.apply(scorm,args);case"score":return scorm.setScore.apply(scorm,args);case"status":return scorm.setStatus.apply(scorm,args);case"student":case"learnerinfo":return false;case"lang":scorm.setLanguage(value);case"suspenddata":default:if(isObject){suspendDataStore=_.extend(suspendDataStore,value)}else{suspendDataStore[name]=value}var dataAsString=JSON.stringify(suspendDataStore);return suspendDataRestored?scorm.setSuspendData(dataAsString):false;}},getCustomStates:function getCustomStates(){var isSuspendDataStoreEmpty=_.isEmpty(suspendDataStore);if(!isSuspendDataStoreEmpty&&suspendDataRestored)return _.clone(suspendDataStore);var dataAsString=scorm.getSuspendData();if(dataAsString===""||dataAsString===" "||dataAsString===undefined)return{};var dataAsJSON=JSON.parse(dataAsString);if(!isSuspendDataStoreEmpty&&!suspendDataRestored)dataAsJSON=_.extend(dataAsJSON,suspendDataStore);return dataAsJSON},getCustomState:function getCustomState(name){var dataAsJSON=this.getCustomStates();return dataAsJSON[name]},useTemporaryStore:function useTemporaryStore(){var cfg=Adapt.config.get("_spoor");if(!scorm.lmsConnected||cfg&&cfg._isEnabled===false)return true;return false},getLearnerInfo:function getLearnerInfo(){var name=scorm.getStudentName();var firstname="",lastname="";if(name&&name!=="undefined"&&name.indexOf(",")>-1){var nameSplit=name.split(",");lastname=$.trim(nameSplit[0]);firstname=$.trim(nameSplit[1]);name=firstname+" "+lastname}else{console.log("SPOOR: LMS learner_name not in 'lastname, firstname' format")}return{name:name,lastname:lastname,firstname:firstname,id:scorm.getStudentId()}}})});define("extensions/adapt-contrib-spoor/js/adapt-contrib-spoor",["core/js/adapt","./scorm","./adapt-stateful-session","./adapt-offlineStorage-scorm"],function(Adapt,scorm,adaptStatefulSession){var Spoor=_.extend({_config:null,initialize:function initialize(){this.listenToOnce(Adapt,{"offlineStorage:prepare":this.onPrepareOfflineStorage,"app:dataReady":function appDataReady(){Adapt.wait.for(adaptStatefulSession.initialize.bind(adaptStatefulSession))}})},onPrepareOfflineStorage:function onPrepareOfflineStorage(){if(!this.checkConfig()){Adapt.offlineStorage.setReadyStatus();return}this.configureAdvancedSettings();scorm.initialize();Adapt.offlineStorage.get();Adapt.offlineStorage.setReadyStatus();this.setupEventListeners()},checkConfig:function checkConfig(){this._config=Adapt.config.get("_spoor")||false;if(this._config&&this._config._isEnabled!==false)return true;return false},configureAdvancedSettings:function configureAdvancedSettings(){if(this._config._advancedSettings){var settings=this._config._advancedSettings;if(settings._showDebugWindow)scorm.showDebugWindow();scorm.setVersion(settings._scormVersion||"1.2");if(settings._suppressErrors){scorm.suppressErrors=settings._suppressErrors}if(settings._commitOnStatusChange){scorm.commitOnStatusChange=settings._commitOnStatusChange}if(_.isFinite(settings._timedCommitFrequency)){scorm.timedCommitFrequency=settings._timedCommitFrequency}if(_.isFinite(settings._maxCommitRetries)){scorm.maxCommitRetries=settings._maxCommitRetries}if(_.isFinite(settings._commitRetryDelay)){scorm.commitRetryDelay=settings._commitRetryDelay}if("_exitStateIfIncomplete"in settings){scorm.exitStateIfIncomplete=settings._exitStateIfIncomplete}if("_exitStateIfComplete"in settings){scorm.exitStateIfComplete=settings._exitStateIfComplete}}else{scorm.setVersion("1.2")}if(window.location.search.indexOf("nolmserrors")!=-1)scorm.suppressErrors=true},setupEventListeners:function setupEventListeners(){var advancedSettings=this._config._advancedSettings;var shouldCommitOnVisibilityChange=(!advancedSettings||advancedSettings._commitOnVisibilityChangeHidden!==false)&&document.addEventListener;this._onWindowUnload=this.onWindowUnload.bind(this);$(window).on("beforeunload unload",this._onWindowUnload);if(shouldCommitOnVisibilityChange){document.addEventListener("visibilitychange",this.onVisibilityChange)}require(["libraries/jquery.keycombo"],function(){$.onKeyCombo([68,69,86],function(){scorm.showDebugWindow()})})},removeEventListeners:function removeEventListeners(){$(window).off("beforeunload unload",this._onWindowUnload);document.removeEventListener("visibilitychange",this.onVisibilityChange)},onVisibilityChange:function onVisibilityChange(){if(document.visibilityState==="hidden")scorm.commit()},onWindowUnload:function onWindowUnload(){this.removeEventListeners();if(!scorm.finishCalled){scorm.finish()}}},Backbone.Events);Spoor.initialize()});define("extensions/adapt-contrib-trickle/js/trickleView",["core/js/adapt"],function(Adapt){var TrickleView=Backbone.View.extend({isSteplocked:false,completionAttribute:null,initialize:function initialize(options){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){var AdaptEvents={"trickle:kill":this.onKill,"remove":this.onRemove};this.onPreRender(this);AdaptEvents[this.model.get("_type")+"View:postRender"]=this.onPostRender;this.listenTo(Adapt,AdaptEvents);this.on("steplock",this.onStepLock);this.on("stepunlock",this.onStepUnlock)},onPreRender:function onPreRender(view){this.completionAttribute=Adapt.trickle.getCompletionAttribute();if(!this.isElementEnabled())return;Adapt.trigger("trickle:preRender",this)},onPostRender:function onPostRender(view){if(view.model.get("_id")!==this.model.get("_id"))return;if(!this.isElementEnabled())return;Adapt.trigger("trickle:postRender",this)},isElementEnabled:function isElementEnabled(){var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle)return false;if(this.model.get(this.completionAttribute))return false;var isArticleWithOnChildren=this.model.get("_type")==="article"&&trickle._onChildren;if(isArticleWithOnChildren){return false}if(trickle._isEnabled===true)return true;return false},onStepLock:function onStepLock(){if(!this.isElementEnabled()){this.continueToNext();return}var trickle=Adapt.trickle.getModelConfig(this.model);var isSteplocking=trickle._stepLocking&&trickle._stepLocking._isEnabled;if(!isSteplocking){this.continueToNext();return}Adapt.trigger("trickle:steplock",this);this.isSteplocked=true},continueToNext:function continueToNext(){Adapt.trigger("trickle:continue",this)},onStepUnlock:function onStepUnlock(){if(!this.isSteplocked)return;this.isSteplocked=false;Adapt.trigger("trickle:stepunlock",this)},onKill:function onKill(){this.detachFromElement()},onRemove:function onRemove(){this.detachFromElement()},detachFromElement:function detachFromElement(){this.undelegateEvents();this.stopListening();this.model=null;this.articleModel=null;this.$el=null;this.el=null}});return TrickleView});define("extensions/adapt-contrib-trickle/js/pageView",["core/js/adapt","./trickleView"],function(Adapt,TrickleView){var PageView=Backbone.View.extend({currentDescendantIndex:0,currentLocksOnDescendant:0,currentDescendant:null,initialize:function initialize(options){if(!this.isPageEnabled()){return this.detachFromPage()}this.setupDescendants();if(!this.haveDescendantsGotTrickle()){return this.detachFromPage()}this.addClassToHtml();this.setupEventListeners()},isPageEnabled:function isPageEnabled(){var trickleConfig=Adapt.trickle.getModelConfig(this.model);if(trickleConfig&&trickleConfig._isEnabled===false)return false;return true},setupDescendants:function setupDescendants(){this.currentDescendant=null;this.descendantViews={};this.getDescendants();Adapt.trigger("trickle:descendants",this)},descendantsChildFirst:null,descendantsParentFirst:null,descendantViews:null,getDescendants:function getDescendants(){this.descendantsChildFirst=this.model.getAllDescendantModels();this.descendantsParentFirst=this.model.getAllDescendantModels(true);this.setDescendantsTrickleDefaults();this.descendantsChildFirst=this.filterComponents(this.descendantsChildFirst);this.descendantsParentFirst=this.filterComponents(this.descendantsParentFirst)},filterComponents:function filterComponents(descendants){return descendants.filter(function(descendant){if(descendant.get("_type")==="component")return false;if(!descendant.get("_isAvailable"))return false;return true})},setDescendantsTrickleDefaults:function setDescendantsTrickleDefaults(){this.descendantsParentFirst.forEach(function(descendant){var trickle=Adapt.trickle.getModelConfig(descendant);if(!trickle){return}trickle._stepLocking=_.extend({"_isEnabled":true,"_isCompletionRequired":true,"_isLockedOnRevisit":false},trickle._stepLocking);trickle=_.extend({"_isEnabled":true,"_autoScroll":true,"_scrollDuration":500,"_onChildren":true,"_scrollTo":"@block +1"},trickle);Adapt.trickle.setModelConfig(descendant,trickle);if(trickle._onChildren&&descendant.get("_type")==="article"){this.setupArticleOnChildren(descendant,trickle)}descendant.set("_isTrickleConfigured",true)}.bind(this))},setupArticleOnChildren:function setupArticleOnChildren(articleModel,articleTrickleConfig){var articleBlocks=articleModel.getChildren();articleBlocks.each(function(blockModel,index){var blockTrickleConfig=Adapt.trickle.getModelConfig(blockModel);for(var k in blockTrickleConfig){if(_typeof(blockTrickleConfig[k])==="object"){blockTrickleConfig[k]=_.extend({},articleTrickleConfig[k],blockTrickleConfig[k])}}blockTrickleConfig=_.extend({},articleTrickleConfig,blockTrickleConfig);if(articleBlocks.length===index+1){blockTrickleConfig._isFinal=true}if(index===0){blockTrickleConfig._isStart=true}Adapt.trickle.setModelConfig(blockModel,blockTrickleConfig)})},haveDescendantsGotTrickle:function haveDescendantsGotTrickle(){return this.descendantsChildFirst.some(function(descendant){var trickle=Adapt.trickle.getModelConfig(descendant);return trickle&&trickle._isEnabled===true})},addClassToHtml:function addClassToHtml(){$("html").addClass("trickle")},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"remove":this.onRemove,"articleView:preRender":this.onDescendantPreRender,"blockView:preRender":this.onDescendantPreRender,"trickle:unwait":this.onUnwait,"trickle:wait":this.onWait,"trickle:continue":this.onContinue,"trickle:skip":this.onSkip,"trickle:kill":this.onKill});this.listenToOnce(this.model,"change:_isReady",this.onPageReady)},onDescendantPreRender:function onDescendantPreRender(view){if(view.model.get("_type")==="component")return;var descendantView=new TrickleView({model:view.model,el:view.el});this.descendantViews[view.model.get("_id")]=descendantView},onPageReady:function onPageReady(model,value){if(!value)return;this.currentDescendant=null;Adapt.trigger("trickle:started");this.gotoNextDescendant()},gotoNextDescendant:function gotoNextDescendant(){this.getDescendants();if(this.currentDescendant){this.currentDescendant.trigger("stepunlock");this.currentDescendant=null}for(var index=this.currentDescendantIndex||0,l=this.descendantsChildFirst.length;index<l;index++){var descendant=this.descendantsChildFirst[index];switch(descendant.get("_type")){case"block":case"article":this.currentLocksOnDescendant=0;this.currentDescendantIndex=index;var currentId=descendant.get("_id");this.currentDescendant=this.descendantViews[currentId];this.currentDescendant.trigger("steplock");return;}}this.finished()},onContinue:function onContinue(view){if(!this.currentDescendant)return;if(view.model.get("_id")!==this.currentDescendant.model.get("_id"))return;this.onSkip()},onWait:function onWait(){this.currentLocksOnDescendant++},onUnwait:function onUnwait(){this.currentLocksOnDescendant--;if(this.currentLocksOnDescendant>0)return;var lastDescendant=this.currentDescendant.model;this.currentDescendantIndex++;this.gotoNextDescendant();Adapt.trickle.scroll(lastDescendant)},onSkip:function onSkip(){this.currentDescendantIndex++;this.gotoNextDescendant()},onKill:function onKill(){this.finished();this.detachFromPage()},finished:function finished(){Adapt.trigger("trickle:finished");this.detachFromPage()},onRemove:function onRemove(){this.finished()},detachFromPage:function detachFromPage(){$("html").removeClass("trickle");this.undelegateEvents();this.stopListening();this.model=null;this.$el=null;this.el=null;this.currentDescendant=null;this.descendantViews=null;this.descendantsChildFirst=null;this.descendantsParentFirst=null;Adapt.trickle.pageView=null}});return PageView});define("extensions/adapt-contrib-trickle/js/handlers/buttonView",["core/js/adapt","core/js/views/componentView"],function(Adapt,ComponentView){var completionAttribute="_isComplete";var TrickleButtonView=Backbone.View.extend({isStepLocking:false,hasStepLocked:false,isStepLocked:false,isStepLockFinished:false,hasStepPreCompleted:false,isWaitingForClick:false,allowVisible:false,allowEnabled:true,overlayShownCount:0,el:function el(){this.setupPreRender();return Handlebars.templates["trickle-button"](this.model.toJSON())},setupPreRender:function setupPreRender(){this.setupButtonVisible();this.setupButtonEnabled()},setupButtonVisible:function setupButtonVisible(){var trickle=Adapt.trickle.getModelConfig(this.model);this.allowVisible=false;trickle._button._isVisible=false;if(trickle._button._styleBeforeCompletion==="visible"){this.allowVisible=true;if(trickle._button._autoHide&&trickle._button._isFullWidth){trickle._button._isVisible=false}else{trickle._button._isVisible=true}}},setupButtonEnabled:function setupButtonEnabled(){var trickle=Adapt.trickle.getModelConfig(this.model);if(trickle._stepLocking._isCompletionRequired===false){this.allowEnabled=true;trickle._button._isDisabled=false}else if(trickle._button._styleBeforeCompletion==="visible"){this.allowEnabled=false;trickle._button._isDisabled=true}else{trickle._button._isDisabled=false;this.allowEnabled=true}},events:{"click button":"onButtonClick"},initialize:function initialize(options){this.getCompletionAttribute();this.debounceCheckAutoHide();this.setupStepLocking();this.setupEventListeners()},getCompletionAttribute:function getCompletionAttribute(){var trickle=Adapt.trickle.getModelConfig(Adapt.config);if(!trickle)return;if(!trickle._completionAttribute)return;completionAttribute=trickle._completionAttribute},setupStepLocking:function setupStepLocking(){var trickle=Adapt.trickle.getModelConfig(this.model);this.isStepLocked=Boolean(trickle._stepLocking._isEnabled)},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:overlay":this.onOverlay,"trickle:unoverlay":this.onUnoverlay,"trickle:steplock":this.onStepLock,"trickle:stepunlock":this.onStepUnlock,"trickle:skip":this.onSkip,"trickle:kill":this.onKill,"trickle:update":this.onUpdate,"remove":this.onRemove});this.listenTo(this.model,"change:"+completionAttribute,this.onCompletion)},debounceCheckAutoHide:function debounceCheckAutoHide(){this.checkButtonAutoHideSync=this.checkButtonAutoHide.bind(this);this.checkButtonAutoHide=_.debounce(this.checkButtonAutoHideSync,100)},checkButtonAutoHide:function checkButtonAutoHide(){if(!this.allowVisible){this.setButtonVisible(false);return}var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle._button._autoHide){this.setButtonVisible(true);return}else if(this.overlayShownCount>0){this.setButtonVisible(false);return}var measurements=this.$el.onscreen();var isJustOffscreen=measurements.bottom>-100;if(measurements.onscreen||isJustOffscreen){this.setButtonVisible(true)}else{this.setButtonVisible(false)}},setButtonVisible:function setButtonVisible(isVisible){var trickle=Adapt.trickle.getModelConfig(this.model);trickle._button._isVisible=Boolean(isVisible);this.$(".component-inner").toggleClass("display-none",!trickle._button._isVisible)},checkButtonEnabled:function checkButtonEnabled(){this.setButtonEnabled(this.allowEnabled)},setButtonEnabled:function setButtonEnabled(isEnabled){var trickle=Adapt.trickle.getModelConfig(this.model);var $button=this.$("button");if(isEnabled){$button.removeClass("disabled").removeAttr("disabled");trickle._button._isDisabled=true;if(document.activeElement&&document.activeElement.isSameNode(this.$(".aria-label")[0])){this.$(".aria-label").focusNext()}this.$(".aria-label").a11y_cntrl(false)}else{$button.addClass("disabled").attr("disabled","disabled");trickle._button._isDisabled=false}},onStepLock:function onStepLock(view){if(!this.isViewMatch(view))return;this.hasStepLocked=true;this.isStepLocking=true;this.overlayShownCount=0;var trickle=Adapt.trickle.getModelConfig(this.model);if(!this.isButtonEnabled())return;var isCompleteAndShouldRelock=trickle._stepLocking._isLockedOnRevisit&&this.model.get(completionAttribute);if(isCompleteAndShouldRelock){this.isStepLocked=true;this.model.set("_isTrickleAutoScrollComplete",false);Adapt.trigger("trickle:wait");this.allowVisible=true;this.checkButtonAutoHide()}else if(this.hasStepPreCompleted){this.isStepLocked=true;this.model.set("_isTrickleAutoScrollComplete",false);this.allowVisible=true;this.stepCompleted()}this.setupOnScreenListener()},onOverlay:function onOverlay(){this.overlayShownCount++},onUnoverlay:function onUnoverlay(){this.overlayShownCount--;this.checkButtonAutoHide()},setupOnScreenListener:function setupOnScreenListener(){var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle._button._autoHide)return;this.$el.on("onscreen",this.checkButtonAutoHideSync)},isViewMatch:function isViewMatch(view){return view.model.get("_id")===this.model.get("_id")},isButtonEnabled:function isButtonEnabled(){var trickle=Adapt.trickle.getModelConfig(this.model);if(!trickle._isEnabled||!trickle._button._isEnabled)return false;return true},onCompletion:function onCompletion(model,value){if(value===false)return;this.hasStepPreCompleted=true;if(!this.hasStepLocked)return;this.stepCompleted()},stepCompleted:function stepCompleted(){if(this.isStepLockFinished)return;this.isStepLocked=false;this.allowVisible=false;this.allowEnabled=false;if(this.isButtonEnabled()){if(this.isStepLocking){this.isStepLocked=true;this.isWaitingForClick=true;Adapt.trigger("trickle:wait")}else{this.isStepLockFinished=true}this.allowVisible=true;this.allowEnabled=true}this.model.set("_isTrickleAutoScrollComplete",false);this.checkButtonAutoHideSync();this.checkButtonEnabled()},onButtonClick:function onButtonClick(){if(this.isStepLocked){Adapt.trigger("trickle:unwait");this.isStepLocked=false;this.isStepLockFinished=true}else{this.model.set("_isTrickleAutoScrollComplete",false);Adapt.trickle.scroll(this.model)}var trickle=this.model.get("_trickle");switch(trickle._button._styleAfterClick){case"hidden":this.allowVisible=false;this.checkButtonAutoHideSync();break;case"disabled":this.allowEnabled=false;this.checkButtonAutoHideSync();}},onUpdate:function onUpdate(){var trickle=Adapt.trickle.getModelConfig(this.model);if(trickle._button._autoHide&&this.isStepLocking){this.$el.off("onscreen",this.checkButtonAutoHideSync)}var $original=this.$el;var $newEl=$(Handlebars.templates["trickle-button"](this.model.toJSON()));$original.replaceWith($newEl);this.setElement($newEl);if(trickle._button._autoHide&&this.isStepLocking){this.$el.on("onscreen",this.checkButtonAutoHideSync)}},onStepUnlock:function onStepUnlock(view){if(!this.isViewMatch(view))return;this.$el.off("onscreen",this.checkButtonAutoHideSync);this.isStepLocking=false;this.overlayShownCount=0;if(document.activeElement&&document.activeElement.isSameNode(this.$(".aria-label")[0])){this.$(".aria-label").focusNext()}this.$(".aria-label").a11y_cntrl(false)},onSkip:function onSkip(){if(!this.isStepLocking)return;this.onKill()},onKill:function onKill(){this.$el.off("onscreen",this.checkButtonAutoHideSync);if(this.isWaitingForClick){this.model.set("_isTrickleAutoScrollComplete",true)}this.isWaitingForClick=false;this.isStepLocked=false;this.isStepLocking=false;this.allowVisible=false;this.allowEnabled=false;this.isStepLockFinished=true;this.model.set("_isTrickleAutoScrollComplete",false);this.checkButtonAutoHide();this.checkButtonEnabled()},onRemove:function onRemove(){if(this.isWaitingForClick){this.model.set("_isTrickleAutoScrollComplete",true)}this.isWaitingForClick=false;this.$el.off("onscreen",this.checkButtonAutoHideSync);this.isStepLocking=true;this.remove()}});return TrickleButtonView});define("extensions/adapt-contrib-trickle/js/handlers/button",["core/js/adapt","./buttonView"],function(Adapt,ButtonView){var TrickleButtonHandler=Backbone.Controller.extend({buttonViews:null,initialize:function initialize(){this.listenToOnce(Adapt,{"app:dataReady":this.onAppDataReady,remove:this.onRemove})},onAppDataReady:function onAppDataReady(){this.buttonViews={};this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:preRender":this.onPreRender,"trickle:postRender":this.onPostRender})},onPreRender:function onPreRender(view){if(!this.isTrickleEnabled(view.model))return;this.setupConfigDefaults(view.model);this.buttonViews[view.model.get("_id")]=new ButtonView({model:view.model})},onPostRender:function onPostRender(view){if(!this.isTrickleEnabled(view.model))return;view.$el.append(this.buttonViews[view.model.get("_id")].$el)},isTrickleEnabled:function isTrickleEnabled(model){var trickle=Adapt.trickle.getModelConfig(model);if(!trickle||!trickle._isEnabled)return false;if(trickle._onChildren&&model.get("_type")==="article")return false;return true},setupConfigDefaults:function setupConfigDefaults(model){if(model.get("_isTrickleButtonConfigured"))return;var defaults={_isEnabled:true,_styleBeforeCompletion:"hidden",_styleAfterClick:"hidden",_isFullWidth:true,_autoHide:false,_className:"",text:"Continue",startText:"Begin",finalText:"Finish",_component:"trickle-button",_isLocking:true,_isVisible:false,_isDisabled:false};var trickle=Adapt.trickle.getModelConfig(model);trickle._button=_.extend(defaults,trickle._button);if(trickle._button._isFullWidth){trickle._stepLocking._isEnabled=true;trickle._button._styleAfterClick="hidden"}else{trickle._button._autoHide=false}Adapt.trickle.setModelConfig(model,trickle);model.set("_isTrickleButtonConfigured",true)},onRemove:function onRemove(){this.buttonViews={}}});return new TrickleButtonHandler});define("extensions/adapt-contrib-trickle/js/handlers/completion",["core/js/adapt"],function(Adapt){var completionAttribute="_isComplete";var TrickleCompletionHandler=Backbone.Controller.extend({isStepLocking:false,isCompleted:false,stepModel:null,initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.getCompletionAttribute();this.setupEventListeners()},getCompletionAttribute:function getCompletionAttribute(){var trickle=Adapt.trickle.getModelConfig(Adapt.config);if(!trickle)return;if(!trickle._completionAttribute)return;completionAttribute=trickle._completionAttribute},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:descendants":this.onDescendants,"trickle:steplock":this.onStepLock,"trickle:stepunlock":this.onStepUnlock,"trickle:kill":this.onKill,"remove":this.onRemove})},onDescendants:function onDescendants(view){view.descendantsParentFirst.forEach(function(descendant){var trickle=Adapt.trickle.getModelConfig(descendant);if(!trickle)return;trickle._wasCompletedPreRender=descendant.get(completionAttribute)})},onStepLock:function onStepLock(view){var isModelComplete=view.model.get(completionAttribute);var trickle=Adapt.trickle.getModelConfig(view.model);if(!trickle._stepLocking._isCompletionRequired&&!trickle._stepLocking._isLockedOnRevisit){if(!isModelComplete)return;Adapt.trigger("trickle:continue",view);return}if(trickle._stepLocking._isCompletionRequired&&isModelComplete&&trickle._wasCompletedPreRender){Adapt.trigger("trickle:continue",view);return}Adapt.trigger("trickle:wait");if(isModelComplete){Adapt.trigger("trickle:unwait");return}view.model.set("_isTrickleAutoScrollComplete",false);this.isCompleted=false;this.isStepLocking=true;this.stepModel=view.model;this.listenTo(this.stepModel,"change:"+completionAttribute,this.onCompletion)},onCompletion:function onCompletion(model,value){if(value===false)return;this.stepCompleted()},stepCompleted:function stepCompleted(){if(!this.isStepLocking)return;if(this.isCompleted)return;this.isCompleted=true;this.stopListening(this.stepModel,"change:"+completionAttribute,this.onCompletion);Adapt.trigger("trickle:unwait")},onKill:function onKill(){this.onStepUnlock()},onRemove:function onRemove(){this.onStepUnlock()},onStepUnlock:function onStepUnlock(){this.stopListening(this.stepModel,"change:"+completionAttribute,this.onCompletion);this.isStepLocking=false;this.stepModel=null;this.isCompleted=false}});return new TrickleCompletionHandler});define("extensions/adapt-contrib-trickle/js/handlers/notify",["core/js/adapt"],function(Adapt){var TrickleNotifyHandler=Backbone.Controller.extend({isStepLocking:false,isNotifyOpen:false,initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"notify:opened":this.onNotifyOpened,"notify:closed":this.onNotifyClosed,"trickle:stepunlock":this.onStepUnlock,"remove":this.onRemove})},onStepLock:function onStepLock(view){this.isStepLocking=true},onNotifyOpened:function onNotifyOpened(){if(!this.isStepLocking)return;this.isNotifyOpen=true;Adapt.trigger("trickle:overlay");Adapt.trigger("trickle:wait")},onNotifyClosed:function onNotifyClosed(){if(!this.isStepLocking)return;if(!this.isNotifyOpen)return;this.isNotifyOpen=false;Adapt.trigger("trickle:unoverlay");Adapt.trigger("trickle:unwait")},onStepUnlock:function onStepUnlock(){this.isStepLocking=false},onRemove:function onRemove(){this.onStepUnlock()}});return new TrickleNotifyHandler});define("extensions/adapt-contrib-trickle/js/handlers/resize",["core/js/adapt"],function(Adapt){var TrickleBodyResizeHandler=Backbone.Controller.extend({isStepLocking:false,stepView:null,initialize:function initialize(){this.listenToOnce(Adapt,{"app:dataReady":this.onAppDataReady,"adapt:initialize":this.onAdaptInitialized})},onAppDataReady:function onAppDataReady(){this.onResize=this.onResize.bind(this);this.preventWrapperScroll=this.preventWrapperScroll.bind(this);this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"trickle:resize":this.onTrickleResize,"trickle:stepunlock":this.onStepUnlock,"trickle:kill":this.onKill,"trickle:finished":this.onFinished,"remove":this.onRemove})},onAdaptInitialized:function onAdaptInitialized(){this.wrapper=document.getElementById("wrapper");this.wrapper.addEventListener("scroll",this.preventWrapperScroll)},onStepLock:function onStepLock(view){this.isStepLocking=true;this.stepView=view;$(window).on("resize",this.onResize);$(".page").on("resize",this.onResize);Adapt.trigger("trickle:resize")},preventWrapperScroll:function preventWrapperScroll(event){if(!this.isStepLocking)return;var top=this.wrapper.scrollTop;if(top===0)return;this.wrapper.scrollTop=0;window.scrollTo(0,window.pageYOffset+top)},onResize:function onResize(){if(!this.isStepLocking)return;Adapt.trigger("trickle:resize")},onTrickleResize:function onTrickleResize(){if(!this.isStepLocking)return;var offset=this.stepView.$el.offset();var height=this.stepView.$el.height();var $wrapper=$(this.wrapper);var topPadding=parseInt($wrapper.css("padding-top")||"0");var bottom=offset["top"]-topPadding+height;$wrapper.css("height",bottom)},onStepUnlock:function onStepUnlock(view){this.isStepLocking=false;this.stepView=null;$(window).off("resize",this.onResize);$(".page").off("resize",this.onResize)},onKill:function onKill(){this.onFinished();this.onStepUnlock()},onFinished:function onFinished(){this.wrapper.removeEventListener("scroll",this.preventWrapperScroll);$(this.wrapper).css("height","")},onRemove:function onRemove(){this.onStepUnlock();this.stepView=null}});return new TrickleBodyResizeHandler});define("extensions/adapt-contrib-trickle/js/handlers/tutor",["core/js/adapt"],function(Adapt){var TrickleTutorHandler=Backbone.Controller.extend({stepLockedId:null,isStepLocking:false,isTutorOpen:false,initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"tutor:opened":this.onTutorOpened,"tutor:closed":this.onTutorClosed,"trickle:stepunlock":this.onStepUnlock,"remove":this.onRemove})},onStepLock:function onStepLock(view){if(view){this.stepLockedId=view.model.get("_id")}this.isStepLocking=true},onTutorOpened:function onTutorOpened(view,alertObject){if(!this.isStepLocking)return;if(!this.isOriginStepLocked(view))return;this.isTutorOpen=true;Adapt.trigger("trickle:overlay");Adapt.trigger("trickle:wait")},isOriginStepLocked:function isOriginStepLocked(view){if(!view||!this.stepLockedId)return true;var parents=view.model.getAncestorModels();var hasStepLockedParent=_.find(parents,function(ancestor){return ancestor.get("_id")===this.stepLockedId},this);if(!hasStepLockedParent)return false;return true},onTutorClosed:function onTutorClosed(view,alertObject){if(!this.isStepLocking)return;if(!this.isTutorOpen)return;if(!this.isOriginStepLocked(view))return;this.isTutorOpen=false;Adapt.trigger("trickle:unoverlay");Adapt.trigger("trickle:unwait")},onStepUnlock:function onStepUnlock(){this.isStepLocking=false;this.stepLockedId=null},onRemove:function onRemove(){this.onStepUnlock()}});return new TrickleTutorHandler});define("extensions/adapt-contrib-trickle/js/handlers/visibility",["core/js/adapt"],function(Adapt){var TrickleVisibilityHandler=Backbone.Controller.extend({isStepLocking:false,trickleModel:null,initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"trickle:steplock":this.onStepLock,"trickle:visibility":this.onVisibility,"trickle:stepunlock":this.onStepUnlock,"trickle:kill":this.onKill,"trickle:finished":this.onFinished,"remove":this.onRemove})},onStepLock:function onStepLock(view){this.isStepLocking=true;this.trickleModel=view.model;Adapt.trigger("trickle:visibility")},onVisibility:function onVisibility(){if(!this.isStepLocking)return;if(!Adapt.trickle.pageView)return;var descendantsParentFirst=Adapt.trickle.pageView.descendantsParentFirst;var trickleModelId=this.trickleModel.get("_id");var trickleType=this.trickleModel.get("_type");var atIndex=_.findIndex(descendantsParentFirst,function(descendant){if(descendant.get("_id")===trickleModelId)return true});descendantsParentFirst.forEach(function(descendant,index){var components=descendant.findDescendantModels("components");if(index<=atIndex){descendant.set("_isVisible",true,{pluginName:"trickle"});components.forEach(function(componentModel){componentModel.set("_isVisible",true,{pluginName:"trickle"})});return}if(trickleType==="article"&&descendant.get("_type")==="block"){if(descendant.get("_parentId")===trickleModelId){descendant.set("_isVisible",true,{pluginName:"trickle"});components.forEach(function(componentModel){componentModel.set("_isVisible",true,{pluginName:"trickle"})});return}}descendant.set("_isVisible",false,{pluginName:"trickle"});components.forEach(function(componentModel){componentModel.set("_isVisible",false,{pluginName:"trickle"})})})},onStepUnlock:function onStepUnlock(view){this.isStepLocking=false;this.trickleModel=null},onKill:function onKill(){this.onFinished();this.onStepUnlock()},onFinished:function onFinished(){var descendantsParentFirst=Adapt.trickle.pageView.descendantsParentFirst;descendantsParentFirst.forEach(function(descendant){descendant.set("_isVisible",true,{pluginName:"trickle"});var components=descendant.findDescendantModels("components");components.forEach(function(componentModel){componentModel.set("_isVisible",true,{pluginName:"trickle"})})})},onRemove:function onRemove(){this.onStepUnlock()}});return new TrickleVisibilityHandler});define("extensions/adapt-contrib-trickle/js/handlers/done",["core/js/adapt"],function(Adapt){var TrickleDone=Backbone.Controller.extend({initialize:function initialize(){this.listenToOnce(Adapt,"app:dataReady",this.onAppDataReady)},onAppDataReady:function onAppDataReady(){this.setupEventListeners()},setupEventListeners:function setupEventListeners(){this.onDone=_.debounce(this.onDone.bind(this),50);this.listenTo(Adapt,{"trickle:steplock":this.onDone,"trickle:stepunlock":this.onDone,"trickle:continue":this.onDone,"trickle:finished":this.onDone})},onDone:function onDone(){Adapt.trigger("trickle:done")}});return new TrickleDone});define("extensions/adapt-contrib-trickle/js/adapt-contrib-trickle",["core/js/adapt","./pageView","./handlers/button","./handlers/completion","./handlers/notify","./handlers/resize","./handlers/tutor","./handlers/visibility","./handlers/done"],function(Adapt,PageView){var Trickle=Backbone.Controller.extend({model:null,pageView:null,initialize:function initialize(){this.listenToOnce(Adapt,{"app:dataReady":this.onAppDataReady})},onAppDataReady:function onAppDataReady(){this.getCourseModel();if(!this.isCourseEnabled())return;this.setupListeners()},getCourseModel:function getCourseModel(){this.model=Adapt.course},isCourseEnabled:function isCourseEnabled(){var trickleConfig=this.getModelConfig(this.model);if(trickleConfig&&trickleConfig._isEnabled===false)return false;return true},getModelConfig:function getModelConfig(model){return model.get("_trickle")},getCompletionAttribute:function getCompletionAttribute(){var trickle=this.getModelConfig(Adapt.config);if(!trickle)return"_isComplete";return trickle._completionAttribute||"_isComplete"},setModelConfig:function setModelConfig(model,config){return model.set("_trickle",config)},setupListeners:function setupListeners(){this.listenTo(Adapt,{"pageView:preRender":this.onPagePreRender,"remove":this.onRemove})},onPagePreRender:function onPagePreRender(view){this.pageView=new PageView({model:view.model,el:view.el})},scroll:function scroll(fromModel){if(!this.shouldScrollPage(fromModel))return;var trickle=Adapt.trickle.getModelConfig(fromModel);var scrollTo=trickle._scrollTo;if(scrollTo===undefined)scrollTo="@block +1";fromModel.set("_isTrickleAutoScrollComplete",true);var scrollToId="";switch(scrollTo.substr(0,1)){case"@":var relativeModel=fromModel.findRelativeModel(scrollTo,{filter:function filter(model){return model.get("_isAvailable")}});if(relativeModel===undefined)return;scrollToId=relativeModel.get("_id");break;case".":scrollToId=scrollTo.substr(1,scrollTo.length-1);break;default:scrollToId=scrollTo;}if(scrollToId=="")return;$("."+scrollToId).focusOrNext();var isAutoScrollOff=!trickle._autoScroll;if(isAutoScrollOff){return false}var duration=fromModel.get("_trickle")._scrollDuration||500;Adapt.scrollTo("."+scrollToId,{duration:duration})},shouldScrollPage:function shouldScrollPage(fromModel){var trickle=Adapt.trickle.getModelConfig(fromModel);if(!trickle||!trickle._isEnabled)return false;var hasScrolled=fromModel.get("_isTrickleAutoScrollComplete");if(hasScrolled)return false;var isArticleWithOnChildren=fromModel.get("_type")==="article"&&trickle._onChildren;if(isArticleWithOnChildren)return false;return true}});return Adapt.trickle=new Trickle});define("extensions/adapt-contrib-tutor/js/adapt-contrib-tutor",["coreJS/adapt"],function(Adapt){Adapt.on("questionView:showFeedback",function(view){var alertObject={title:view.model.get("feedbackTitle"),body:view.model.get("feedbackMessage")};var attributes={};var classes=[];if(view.model.has("_isCorrect")){if(view.model.get("_isCorrect")){classes.push("correct")}else{if(view.model.has("_isAtLeastOneCorrectSelection")){if(view.model.get("_isAtLeastOneCorrectSelection")){classes.push("partially-correct")}else{classes.push("incorrect")}}else{classes.push("incorrect")}}}if(view.model.has("_component")){classes.push("component-"+view.model.get("_component"))}else if(view.model.has("_extension")){classes.push("extension-"+view.model.get("_extension"))}attributes["data-adapt-id"]=view.model.get("_id");alertObject._classes=classes.join(" ");alertObject._attributes=attributes;Adapt.once("notify:closed",function(){Adapt.trigger("tutor:closed",view,alertObject)});Adapt.trigger("notify:popup",alertObject);Adapt.trigger("tutor:opened",view,alertObject)})});define("extensions/adapt-expose-master/js/adapt-expose",["require","coreViews/componentView","coreJS/adapt"],function(require){function toHyphenCase(str){if(!str)return false;return str.replace(/([A-Z])/g,"-$1").toLowerCase()}var ComponentView=require("coreViews/componentView");var Adapt=require("coreJS/adapt");var Expose=ComponentView.extend({events:{"click .expose-item-cover":"toggleItem","click .expose-item-content":"toggleItem","click .expose-item-button":"toggleItem"},onDeviceResize:function onDeviceResize(){this.setupColumns();this.setEqualHeights()},preRender:function preRender(){this.animationType=toHyphenCase(this.model.get("_animationType"))||"fade"},postRender:function postRender(){this.$(".expose-item").children().addClass(this.animationType);this.setupColumns();this.setupEventListeners();this.$(".expose-item-img").imageready(_.bind(this.onImageReady,this))},onImageReady:function onImageReady(){this.setEqualHeights();this.setReadyStatus()},setupColumns:function setupColumns(){if(this.model.get("_columns")&&$(window).width()>760){var w=100/this.model.get("_columns")+"%";this.$(".expose-items").addClass("expose-columns");this.$(".expose-item").width(w).addClass("expose-column")}else{this.$(".expose-items").removeClass("expose-columns");this.$(".expose-item").width("auto").removeClass("expose-column")}},setEqualHeights:function setEqualHeights(){if(this.model.get("_equalHeights")===false)return;var $contentElements=this.$(".expose-item-content");$contentElements.height("auto");var hMax=0;_.each($contentElements,function(el){var h=$(el).outerHeight();if(h>hMax)hMax=h});$contentElements.height(hMax)},setupEventListeners:function setupEventListeners(){this.listenTo(Adapt,{"device:resize":this.onDeviceResize})},toggleItem:function toggleItem(e){if(e.target.tagName==="A")return;var $parent=$(e.currentTarget).parent();var $cover=$parent.children(".expose-item-cover");$cover.toggleClass(this.animationType);if(!$cover.is(".visited")){$cover.addClass("visited");var i=$cover.parents(".expose-item").index();this.model.get("_items")[i]._isVisited=true;this.evaluateCompletion()}},evaluateCompletion:function evaluateCompletion(){var incompleteItems=_.filter(this.model.get("_items"),function(item){return!item._isVisited});!incompleteItems.length&&this.onComplete()},onComplete:function onComplete(){this.setCompletionStatus()}});Adapt.register("expose",Expose);return Expose});define("core/js/views/menuView",["core/js/adapt","core/js/views/adaptView"],function(Adapt,AdaptView){var MenuView=AdaptView.extend({className:function className(){var visible="visibility-hidden";if(this.model.get("_isVisible")){visible=""}return"menu "+"menu-"+this.model.get("_id")+" "+this.model.get("_classes")+" "+this.setVisibility()+" "+(this.model.get("_isComplete")?"completed":"")},preRender:function preRender(){$.inview.lock("menuView");this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this.$el.css("opacity",0);this.listenTo(this.model,"change:_isReady",this.isReady)},postRender:function postRender(){},isReady:function isReady(){if(!this.model.get("_isReady"))return;var performIsReady=function(){$(".loading").hide();$(window).scrollTop(0);Adapt.trigger("menuView:ready",this);$.inview.unlock("menuView");var styleOptions={opacity:1};if(this.disableAnimation){this.$el.css(styleOptions);$.inview()}else{this.$el.velocity(styleOptions,{duration:"fast",complete:function complete(){$.inview()}})}$(window).scroll()}.bind(this);Adapt.wait.queue(function(){_.defer(performIsReady)})}},{type:"menu"});return MenuView});define("menu/adapt-menu-3063/js/adapt-menu-3063",["require","coreJS/adapt","coreViews/menuView","extensions/adapt-contrib-pageLevelProgress/js/completionCalculations","extensions/adapt-contrib-spoor/js/scorm"],function(require){var Adapt=require("coreJS/adapt"),MenuView=require("coreViews/menuView"),completionCalculations=require("extensions/adapt-contrib-pageLevelProgress/js/completionCalculations"),scorm=require("extensions/adapt-contrib-spoor/js/scorm");var completionStatus={assessmentCompleted:0,assessmentTotal:0,completed:0,nonAssessmentCompleted:0,nonAssessmentTotal:0,percentageComplete:0,subProgressCompleted:0,subProgressTotal:0,total:0},Menu3063View=MenuView.extend({events:{"click .button":"triggerEvent"},postRender:function postRender(){this.model.getChildren().each(function(item,index){console.log("Menu3063View","postRender#each",index,"_id",item.get("_id"),"_treatAsAvailable",item.get("_treatAsAvailable"));if(item.get("_isAvailable")||item.get("_treatAsAvailable")){var id=item.get("_id");item.checkCompletionStatus();item.checkInteractionCompletionStatus();completionStatus[item.get("_id")]={};completionStatus[item.get("_id")]=completionCalculations.calculateCompletion(item);var completionObject=completionStatus[item.get("_id")];var completed=completionObject.nonAssessmentCompleted+completionObject.subProgressCompleted;var total=completionObject.nonAssessmentTotal+completionObject.subProgressTotal;var percentageComplete=Math.floor(completed/total*100);completionObject.completed=completed;completionObject.total=total;completionObject.percentageComplete=percentageComplete}});var nthChild=0;this.model.getChildren().each(function(item){var id=item.get("_id");if(item.get("_isAvailable")){var completionObject=completionStatus[id];item.progress={"completed":completionObject.completed,"total":completionObject.total,"percentageComplete":completionObject.percentageComplete};var isEnabled=item.get("_isEnabled"),unlockCondition=item.get("unlockCondition");if(unlockCondition&&unlockCondition.complete){var unlock=false;var ids=unlockCondition.complete;if(ids.length>0){unlock=true;for(var i=0,max=ids.length;i<max;i++){if(completionStatus.hasOwnProperty(ids[i])){var co=completionStatus[ids[i]];if(co.completed!=co.total){unlock=false;break}}else{console.warn("Menu3063View","Unknown contentObject id found: '"+ids[i]+"', check the 'unlockCondition.complete' for "+item.get("_id"))}}}else{console.warn("Menu3063View","No complete 'ids' found, check the 'unlockCondition' for "+item.get("_id"));unlock=true}if(unlock===false){item.set("_isEnabled",false)}else{item.set("_isEnabled",true)}}else{}nthChild++;item.set("_nthChild",nthChild);this.$(".menu-container-inner .menu-items").append(new Menu3063ItemView({model:item}).$el)}})},triggerEvent:function triggerEvent(event){event.preventDefault();var currentEvent=$(event.currentTarget).attr("data-event");Adapt.trigger(currentEvent)}},{template:"menu-3063"}),Menu3063ItemView=MenuView.extend({className:function className(){var nthChild=this.model.get("_nthChild");return["menu-item","menu-item-"+this.model.get("_id"),this.model.get("_classes"),this.model.get("_isEnabled")!=true?"menu-disabled":"","nth-child-"+nthChild,nthChild%2===0?"nth-child-even":"nth-child-odd","grid3","grid3-"+((nthChild-1)%3+1)].join(" ")},preRender:function preRender(){var completionObject=completionStatus[this.model.get("_id")],completed=completionObject.completed,total=completionObject.total,percentageComplete=completionObject.percentageComplete,progressParts=this.model.get("_progressParts"),i,max,tmpStatus;if(progressParts){completed=0;total=0;percentageComplete=0;for(i=0,max=progressParts.length;i<max;i++){tmpStatus=completionStatus[progressParts[i]];if(tmpStatus){total+=tmpStatus.total;completed+=tmpStatus.completed;percentageComplete+=tmpStatus.percentageComplete}}total/=max;completed/=max;percentageComplete/=max}console.log("Menu3063ItemView:"+this.model.get("_id"),"completed",completed);console.log("Menu3063ItemView:"+this.model.get("_id"),"total",total);console.log("Menu3063ItemView:"+this.model.get("_id"),"percentageComplete",percentageComplete);var _isAssessment=this.model.get("_isAssessment")||false,_isCompleted=_isAssessment&&(scorm&&scorm.lmsConnected?scorm.getStatus()==="passed"||scorm.getStatus()==="completed":true);console.log("Menu3063ItemView","_isAssessment",_isAssessment);console.log("Menu3063ItemView","Adapt.course.get('_isComplete')",Adapt.course.get("_isComplete"));console.log("Menu3063ItemView","percentageComplete",percentageComplete);console.log("Menu3063ItemView","_isCompleted",_isCompleted);if(_isAssessment&&_isCompleted&&percentageComplete>0){var isPass=Adapt.assessment.getState().isPass||scorm.getStatus()==="passed"||scorm.getStatus()==="completed";console.log("Menu3063ItemView","Adapt.assessment.getState().isPass",isPass);console.log("Menu3063ItemView","scorm.getStatus() === passed",scorm.getStatus(),scorm.getStatus()==="passed");if(isPass){completed=total}else{completed=0}}if(completed>0){this.model.set("_progressClass",completed==total?"progress-completed":"progress-started")}else{this.model.set("_progressClass","progress-not-started")}},postRender:function postRender(){this.$(".menu-item-progress").removeClass("progress-not-started").removeClass("progress-started").removeClass("progress-completed");var progressClass=this.model.get("_progressClass");if(!_.isUndefined(progressClass)&&progressClass!=""){this.$(".menu-item-progress").addClass(progressClass)}if(this.model.get("_isEnabled")!=true){this.$("a").each(function(i,o){$(o).attr("href","javascript:void(0)")})}if(this.$("img").length>0){this.$el.imageready(_.bind(function(){this.setReadyStatus()},this))}else{this.setReadyStatus()}}},{template:"menu-3063-item"});Adapt.on("router:menu",function(model){$("html").addClass("in-menu");$("body").addClass("menu-background");$("#wrapper").append(new Menu3063View({model:model}).$el)});Adapt.on("router:page",function(model){$("html").removeClass("in-menu");$("body").removeClass("menu-background")})});define("theme/adapt-contrib-vanilla/js/theme-block",["require","coreJS/adapt","backbone"],function(require){var Adapt=require("coreJS/adapt");var Backbone=require("backbone");var ThemeBlockView=Backbone.View.extend({initialize:function initialize(){this.setStyles();this.listenTo(Adapt,"device:resize",this.setStyles);this.listenTo(Adapt,"remove",this.remove)},setStyles:function setStyles(){this.setBackground();this.setMinHeight();this.setDividerBlock()},setBackground:function setBackground(){var backgroundColor=this.model.get("_themeBlockConfig")._backgroundColor;if(backgroundColor){this.$el.addClass(backgroundColor)}},setMinHeight:function setMinHeight(){var minHeight=0;var minHeights=this.model.get("_themeBlockConfig")._minimumHeights;if(minHeights){if(Adapt.device.screenSize=="large"){minHeight=minHeights._large}else if(Adapt.device.screenSize=="medium"){minHeight=minHeights._medium}else{minHeight=minHeights._small}}this.$el.css({minHeight:minHeight+"px"})},setDividerBlock:function setDividerBlock(){var dividerBlock=this.model.get("_themeBlockConfig")._isDividerBlock;if(dividerBlock){this.$el.addClass("divider-block")}}});return ThemeBlockView});define("theme/adapt-contrib-vanilla/js/vanilla",["require","coreJS/adapt","backbone","theme/adapt-contrib-vanilla/js/theme-block"],function(require){var Adapt=require("coreJS/adapt");var Backbone=require("backbone");var ThemeBlock=require("theme/adapt-contrib-vanilla/js/theme-block");Adapt.on("blockView:postRender",function(view){var theme=view.model.get("_theme");if(theme){new ThemeBlock({model:new Backbone.Model({_themeBlockConfig:theme}),el:view.$el})}})});;define("plugins",["components/adapt-contrib-accordion/js/adapt-contrib-accordion","components/adapt-contrib-assessmentResults/js/adapt-contrib-assessmentResults","components/adapt-contrib-blank/js/adapt-contrib-blank","components/adapt-contrib-flipcard/js/adapt-contrib-flipcard","components/adapt-contrib-gmcq/js/adapt-contrib-gmcq","components/adapt-contrib-graphic/js/adapt-contrib-graphic","components/adapt-contrib-hotgraphic/js/adapt-contrib-hotgraphic","components/adapt-contrib-matching/js/adapt-contrib-matching","components/adapt-contrib-mcq/js/adapt-contrib-mcq","components/adapt-contrib-media/js/adapt-contrib-media","components/adapt-contrib-narrative/js/adapt-contrib-narrative","components/adapt-contrib-slider/js/adapt-contrib-slider","components/adapt-contrib-text/js/adapt-contrib-text","components/adapt-contrib-textInput/js/adapt-contrib-textInput","components/adapt-dragdrop-master/js/adapt-dragdrop","components/adapt-go-next/js/adapt-go-next","extensions/adapt-close-master/js/adapt-close","extensions/adapt-contrib-assessment/js/adapt-assessmentArticleExtension","extensions/adapt-contrib-bookmarking/js/adapt-contrib-bookmarking","extensions/adapt-contrib-languagePicker/js/adapt-languagePicker","extensions/adapt-contrib-pageLevelProgress/js/adapt-contrib-pageLevelProgress","extensions/adapt-contrib-resources/js/adapt-contrib-resources","extensions/adapt-contrib-spoor/js/adapt-contrib-spoor","extensions/adapt-contrib-trickle/js/adapt-contrib-trickle","extensions/adapt-contrib-tutor/js/adapt-contrib-tutor","extensions/adapt-expose-master/js/adapt-expose","menu/adapt-menu-3063/js/adapt-menu-3063","theme/adapt-contrib-vanilla/js/vanilla"],function(){});require(["core/js/adapt","core/js/accessibility","core/js/data","core/js/offlineStorage","core/js/logging","core/js/tracking","core/js/device","core/js/drawer","core/js/notify","core/js/router","core/js/models/lockingModel","core/js/helpers","core/js/scrolling","core/js/headings","core/js/navigation","plugins"],function(Adapt){$("body").append(Handlebars.templates.loading());Adapt.data.on("ready",function triggerInit(){Adapt.log.debug("Calling Adapt.init");Adapt.init();Adapt.off("adaptCollection:dataLoaded courseModel:dataLoaded")}).init()});define("core/js/app",function(){});
